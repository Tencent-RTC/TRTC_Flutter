!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.TrtcWrapper=t():e.TrtcWrapper=t()}(self,(()=>(()=>{var e={79:function(e,t,i){var r;r=function(e,t){var i=function(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}(t),r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},r(e,t)},n=function(){return n=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},n.apply(this,arguments)};function o(e,t,i,r){return new(i||(i=Promise))((function(n,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function s(e,t){var i,r,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(i=1,r&&(n=2&a[0]?r.return:a[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,a[1])).done)return n;switch(r=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){s.label=a[1];break}if(6===a[0]&&s.label<n[1]){s.label=n[1],n=a;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(a);break}n[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{i=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function a(e,t,i){if(i||2===arguments.length)for(var r,n=0,o=t.length;n<o;n++)!r&&n in t||(r||(r=Array.prototype.slice.call(t,0,n)),r[n]=t[n]);return e.concat(r||Array.prototype.slice.call(t))}var c,l,u,d,h,p,m,_,f=function(e,t){return function(e){var t=Object.prototype.hasOwnProperty,i="~";function r(){}function n(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function o(e,t,r,o,s){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new n(r,o||e,s),c=i?i+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(i=!1)),a.prototype.eventNames=function(){var e,r,n=[];if(0===this._eventsCount)return n;for(r in e=this._events)t.call(e,r)&&n.push(i?r.slice(1):r);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},a.prototype.listeners=function(e){var t=i?i+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,o=r.length,s=new Array(o);n<o;n++)s[n]=r[n].fn;return s},a.prototype.listenerCount=function(e){var t=i?i+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,n,o,s){var a=i?i+e:e;if(!this._events[a])return!1;var c,l,u=this._events[a],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,n),!0;case 5:return u.fn.call(u.context,t,r,n,o),!0;case 6:return u.fn.call(u.context,t,r,n,o,s),!0}for(l=1,c=new Array(d-1);l<d;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else{var h,p=u.length;for(l=0;l<p;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),d){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,r);break;case 4:u[l].fn.call(u[l].context,t,r,n);break;default:if(!c)for(h=1,c=new Array(d-1);h<d;h++)c[h-1]=arguments[h];u[l].fn.apply(u[l].context,c)}}return!0},a.prototype.on=function(e,t,i){return o(this,e,t,i,!1)},a.prototype.once=function(e,t,i){return o(this,e,t,i,!0)},a.prototype.removeListener=function(e,t,r,n){var o=i?i+e:e;if(!this._events[o])return this;if(!t)return s(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||n&&!a.once||r&&a.context!==r||s(this,o);else{for(var c=0,l=[],u=a.length;c<u;c++)(a[c].fn!==t||n&&!a[c].once||r&&a[c].context!==r)&&l.push(a[c]);l.length?this._events[o]=1===l.length?l[0]:l:s(this,o)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&s(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,e.exports=a}(t={exports:{}}),t.exports}();e.TRTCVideoResolution=void 0,(c=e.TRTCVideoResolution||(e.TRTCVideoResolution={}))[c.TRTCVideoResolution_120_120=1]="TRTCVideoResolution_120_120",c[c.TRTCVideoResolution_160_160=3]="TRTCVideoResolution_160_160",c[c.TRTCVideoResolution_270_270=5]="TRTCVideoResolution_270_270",c[c.TRTCVideoResolution_480_480=7]="TRTCVideoResolution_480_480",c[c.TRTCVideoResolution_160_120=50]="TRTCVideoResolution_160_120",c[c.TRTCVideoResolution_240_180=52]="TRTCVideoResolution_240_180",c[c.TRTCVideoResolution_280_210=54]="TRTCVideoResolution_280_210",c[c.TRTCVideoResolution_320_240=56]="TRTCVideoResolution_320_240",c[c.TRTCVideoResolution_400_300=58]="TRTCVideoResolution_400_300",c[c.TRTCVideoResolution_480_360=60]="TRTCVideoResolution_480_360",c[c.TRTCVideoResolution_640_480=62]="TRTCVideoResolution_640_480",c[c.TRTCVideoResolution_960_720=64]="TRTCVideoResolution_960_720",c[c.TRTCVideoResolution_160_90=100]="TRTCVideoResolution_160_90",c[c.TRTCVideoResolution_256_144=102]="TRTCVideoResolution_256_144",c[c.TRTCVideoResolution_320_180=104]="TRTCVideoResolution_320_180",c[c.TRTCVideoResolution_480_270=106]="TRTCVideoResolution_480_270",c[c.TRTCVideoResolution_640_360=108]="TRTCVideoResolution_640_360",c[c.TRTCVideoResolution_960_540=110]="TRTCVideoResolution_960_540",c[c.TRTCVideoResolution_1280_720=112]="TRTCVideoResolution_1280_720",c[c.TRTCVideoResolution_1920_1080=114]="TRTCVideoResolution_1920_1080",e.TRTCVideoStreamType=void 0,(l=e.TRTCVideoStreamType||(e.TRTCVideoStreamType={}))[l.TRTCVideoStreamTypeBig=0]="TRTCVideoStreamTypeBig",l[l.TRTCVideoStreamTypeSmall=1]="TRTCVideoStreamTypeSmall",l[l.TRTCVideoStreamTypeSub=2]="TRTCVideoStreamTypeSub",e.TRTCVideoFillMode=void 0,(u=e.TRTCVideoFillMode||(e.TRTCVideoFillMode={}))[u.TRTCVideoFillMode_Fill=0]="TRTCVideoFillMode_Fill",u[u.TRTCVideoFillMode_Fit=1]="TRTCVideoFillMode_Fit",e.TRTCVideoMirrorType=void 0,(d=e.TRTCVideoMirrorType||(e.TRTCVideoMirrorType={}))[d.TRTCVideoMirrorType_Auto=0]="TRTCVideoMirrorType_Auto",d[d.TRTCVideoMirrorType_Enable=1]="TRTCVideoMirrorType_Enable",d[d.TRTCVideoMirrorType_Disable=2]="TRTCVideoMirrorType_Disable",e.TRTCBeautyStyle=void 0,(h=e.TRTCBeautyStyle||(e.TRTCBeautyStyle={}))[h.TRTCBeautyStyleSmooth=0]="TRTCBeautyStyleSmooth",h[h.TRTCBeautyStyleNature=1]="TRTCBeautyStyleNature",e.TRTCAppScene=void 0,(p=e.TRTCAppScene||(e.TRTCAppScene={}))[p.TRTCAppSceneVideoCall=0]="TRTCAppSceneVideoCall",p[p.TRTCAppSceneLIVE=1]="TRTCAppSceneLIVE",p[p.TRTCAppSceneAudioCall=2]="TRTCAppSceneAudioCall",p[p.TRTCAppSceneVoiceChatRoom=3]="TRTCAppSceneVoiceChatRoom",e.TRTCRoleType=void 0,(m=e.TRTCRoleType||(e.TRTCRoleType={}))[m.TRTCRoleAnchor=20]="TRTCRoleAnchor",m[m.TRTCRoleAudience=21]="TRTCRoleAudience",e.TRTCAudioQuality=void 0,(_=e.TRTCAudioQuality||(e.TRTCAudioQuality={}))[_.TRTCAudioQualityDefault=0]="TRTCAudioQualityDefault",_[_.TRTCAudioQualitySpeech=1]="TRTCAudioQualitySpeech",_[_.TRTCAudioQualityMusic=3]="TRTCAudioQualityMusic";var g,T,v,S,y=function(e,t,i,r,n){void 0===e&&(e=""),void 0===t&&(t=""),void 0===i&&(i=""),void 0===r&&(r=""),void 0===n&&(n=""),this.deviceId=e,this.deviceName=t,this.kind=i,this.label=r,this.groupId=n};e.TRTCDeviceState=void 0,(g=e.TRTCDeviceState||(e.TRTCDeviceState={}))[g.TRTCDeviceStateAdd=0]="TRTCDeviceStateAdd",g[g.TRTCDeviceStateRemove=1]="TRTCDeviceStateRemove",g[g.TRTCDeviceStateActive=2]="TRTCDeviceStateActive",e.TRTCDeviceType=void 0,(T=e.TRTCDeviceType||(e.TRTCDeviceType={}))[T.TRTCDeviceTypeUnknow=-1]="TRTCDeviceTypeUnknow",T[T.TRTCDeviceTypeMic=0]="TRTCDeviceTypeMic",T[T.TRTCDeviceTypeSpeaker=1]="TRTCDeviceTypeSpeaker",T[T.TRTCDeviceTypeCamera=2]="TRTCDeviceTypeCamera",e.TRTCVideoRotation=void 0,(v=e.TRTCVideoRotation||(e.TRTCVideoRotation={}))[v.TRTCVideoRotation0=0]="TRTCVideoRotation0",v[v.TRTCVideoRotation90=1]="TRTCVideoRotation90",v[v.TRTCVideoRotation180=2]="TRTCVideoRotation180",v[v.TRTCVideoRotation270=3]="TRTCVideoRotation270",e.TRTCQuality=void 0,(S=e.TRTCQuality||(e.TRTCQuality={}))[S.TRTCQuality_Unknown=0]="TRTCQuality_Unknown",S[S.TRTCQuality_Excellent=1]="TRTCQuality_Excellent",S[S.TRTCQuality_Good=2]="TRTCQuality_Good",S[S.TRTCQuality_Poor=3]="TRTCQuality_Poor",S[S.TRTCQuality_Bad=4]="TRTCQuality_Bad",S[S.TRTCQuality_Vbad=5]="TRTCQuality_Vbad",S[S.TRTCQuality_Down=6]="TRTCQuality_Down";var E,I,R,C=function(t,i){void 0===t&&(t=""),void 0===i&&(i=e.TRTCQuality.TRTCQuality_Unknown),this.userId=t,this.quality=i},A=function(e,t,i,r,n,o,s,a,c,l){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=[]),void 0===c&&(c=0),void 0===l&&(l=0),this.upLoss=e,this.downLoss=t,this.appCpu=i,this.systemCpu=r,this.rtt=n,this.receivedBytes=o,this.sentBytes=s,this.localStatisticsArray=a,this.localStatisticsArraySize=c,this.remoteStatisticsArraySize=l};e.TRTCVideoResolutionMode=void 0,(E=e.TRTCVideoResolutionMode||(e.TRTCVideoResolutionMode={}))[E.TRTCVideoResolutionModeLandscape=0]="TRTCVideoResolutionModeLandscape",E[E.TRTCVideoResolutionModePortrait=1]="TRTCVideoResolutionModePortrait",e.TRTCVideoQosPreference=void 0,(I=e.TRTCVideoQosPreference||(e.TRTCVideoQosPreference={}))[I.TRTCVideoQosPreferenceSmooth=1]="TRTCVideoQosPreferenceSmooth",I[I.TRTCVideoQosPreferenceClear=2]="TRTCVideoQosPreferenceClear",e.TRTCQosControlMode=void 0,(R=e.TRTCQosControlMode||(e.TRTCQosControlMode={}))[R.TRTCQosControlModeClient=0]="TRTCQosControlModeClient",R[R.TRTCQosControlModeServer=1]="TRTCQosControlModeServer";var b,k,D,w=function(e,t,i,r){void 0===e&&(e=new ArrayBuffer(0)),void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),this.buffer=e,this.length=t,this.width=i,this.height=r};e.TRTCScreenCaptureSourceType=void 0,(b=e.TRTCScreenCaptureSourceType||(e.TRTCScreenCaptureSourceType={}))[b.TRTCScreenCaptureSourceTypeUnknown=-1]="TRTCScreenCaptureSourceTypeUnknown",b[b.TRTCScreenCaptureSourceTypeWindow=0]="TRTCScreenCaptureSourceTypeWindow",b[b.TRTCScreenCaptureSourceTypeScreen=1]="TRTCScreenCaptureSourceTypeScreen",b[b.TRTCScreenCaptureSourceTypeCustom=2]="TRTCScreenCaptureSourceTypeCustom",e.TRTCTranscodingConfigMode=void 0,(k=e.TRTCTranscodingConfigMode||(e.TRTCTranscodingConfigMode={}))[k.TRTCTranscodingConfigMode_Unknown=0]="TRTCTranscodingConfigMode_Unknown",k[k.TRTCTranscodingConfigMode_Manual=1]="TRTCTranscodingConfigMode_Manual",k[k.TRTCTranscodingConfigMode_Template_PureAudio=2]="TRTCTranscodingConfigMode_Template_PureAudio",k[k.TRTCTranscodingConfigMode_Template_PresetLayout=3]="TRTCTranscodingConfigMode_Template_PresetLayout",k[k.TRTCTranscodingConfigMode_Template_ScreenSharing=4]="TRTCTranscodingConfigMode_Template_ScreenSharing",k[k.TRTC_TranscodingConfigMode_Unknown=5]="TRTC_TranscodingConfigMode_Unknown",k[k.TRTC_TranscodingConfigMode_Manual=6]="TRTC_TranscodingConfigMode_Manual",k[k.TRTC_TranscodingConfigMode_Template_PureAudio=7]="TRTC_TranscodingConfigMode_Template_PureAudio",k[k.TRTC_TranscodingConfigMode_Template_PresetLayout=8]="TRTC_TranscodingConfigMode_Template_PresetLayout",k[k.TRTC_TranscodingConfigMode_Template_ScreenSharing=9]="TRTC_TranscodingConfigMode_Template_ScreenSharing",e.TRTCMixInputType=void 0,(D=e.TRTCMixInputType||(e.TRTCMixInputType={}))[D.TRTCMixInputTypeUndefined=0]="TRTCMixInputTypeUndefined",D[D.TRTCMixInputTypeAudioVideo=1]="TRTCMixInputTypeAudioVideo",D[D.TRTCMixInputTypePureVideo=2]="TRTCMixInputTypePureVideo",D[D.TRTCMixInputTypePureAudio=3]="TRTCMixInputTypePureAudio";var O,N="onError",P="live",M={20:"anchor",21:"audience"},L={0:"rtc",1:P,2:"rtc",3:P},V={0:"standard",1:"high",2:"standard_stereo",3:"high_stereo"};function x(){return Math.floor(performance.now())}!function(e){e[e.ActiveExitRoom=0]="ActiveExitRoom",e[e.KickedExitRoom=1]="KickedExitRoom"}(O||(O={}));var U,F,B=function(e){return void 0===e},H=function(e){return"number"==typeof e},j=function(e){return"boolean"==typeof e};!function(e){e.LIVE="live",e.RTC="rtc"}(U||(U={})),function(e){e.CONTAIN="contain",e.COVER="cover",e.FILL="fill"}(F||(F={}));var W={code:-1001,message:"参数错误, 请检查参数格式、是否非空等"},G={code:-1005,message:"not supported"},J="2.2.3",K=function(){function e(e,t){if(this.logRegion="tc",this.loggerManager=e,t){var i=t.sdkAppId,r=t.userId,n=t.seq;this.seq=n,e&&(this.logger=e.createLogger({id:"".concat(this.logRegion).concat(n),userId:r,sdkAppId:i}))}else this.logger=e;this.logger||(this.logger={debug:function(e){console.debug(e)},info:function(e){console.info(e)},warn:function(e){console.warn(e)},error:function(e){console.error(e)}})}return e.prototype.getLogMessage=function(e){var t=this;return e.map((function(e){return t.getStringifyMessage(e)})).join(" ")},e.prototype.getStringifyMessage=function(e){var t=this;if("object"!=typeof e)return e;if(e instanceof HTMLElement)return"".concat(e.tagName.toLocaleLowerCase(),"#").concat(e.id);if(e instanceof Array){var i=[];return Object.keys(e).forEach((function(r){return i[r]=t.getStringifyMessage(e[r])})),JSON.stringify(i)}if(e instanceof Object){var r={};return Object.keys(e).forEach((function(i){return r[i]=t.getStringifyMessage(e[i])})),JSON.stringify(r)}return e},e.prototype.update=function(e){var t=e.userId,i=e.sdkAppId;this.loggerManager&&this.loggerManager.createLogger&&(this.logger=this.loggerManager.createLogger({id:"".concat(this.logRegion).concat(this.seq),userId:t,sdkAppId:i}))},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=this.getLogMessage(e);this.logger.debug(i)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=this.getLogMessage(e);this.logger&&this.logger.info&&this.logger.info(i)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=this.getLogMessage(e);this.logger&&this.logger.warn&&this.logger.warn(i)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=this.getLogMessage(e);this.logger&&this.logger.error&&this.logger.error(i)},e}(),Q=null,z=i.default._loggerManager;z.info("TRTCCloud Version: ".concat(J));var Y="trtcCloud",q=1,X=function(t){function c(r){void 0===r&&(r={});var n=t.call(this)||this;n._version="",n._frameWorkType=30,n._component=0,n._language=0,n._localView=null,n._autoRecvAudio=!0,n._autoRecvVideo=!0,n._localTestView=null,n._isVideoPublish=!0,n._localRenderParams={rotation:e.TRTCVideoRotation.TRTCVideoRotation0,fillMode:e.TRTCVideoFillMode.TRTCVideoFillMode_Fill,mirrorType:e.TRTCVideoMirrorType.TRTCVideoMirrorType_Auto},n._videoProfile={},n._videoPlayOption={},n._isAudioPublish=!0,n._audioProfile=Object.keys(V)[0],n._isSharingScreen=!1,n._remoteStreamConfig=new Map,n._remoteStreamMap=new Map,n._cameraList=[],n._microphoneList=[],n._speakerList=[],n._currentCamera={},n._currentMicrophone={},n._currentSpeaker={},n._currentCameraId="",n._currentMicrophoneId="",n._currentSpeakerId="",n._screenShareParams={option:{}},n._isMobile=!1,n._isFrontCamera=!1,n._smallStreamVideoProfile=void 0,n._defaultVideoProfile={width:640,height:480,frameRate:15,bitrate:900},n._defaultScreenProfile={width:1920,height:1080,frameRate:15,bitrate:1500},n._defaultSmallVideoProfile={width:160,height:120,frameRate:15,bitrate:200},n._version=J;var o,s,a=r.frameWorkType,c=void 0===a?30:a,l=r.component,u=void 0===l?0:l;return n._frameWorkType=c,n._component=u,n._trtc=i.default.create(),n._testTrtc=i.default.create(),n._log=i.default._loggerManager,n.logger=new K(z,{seq:q++}),n._addTRTCEvents(),n.handleDeviceChange=n.handleDeviceChange.bind(n),navigator&&navigator.mediaDevices&&navigator.mediaDevices.addEventListener("devicechange",(o=n.handleDeviceChange,function(){for(var e=this,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];s>0&&clearTimeout(s),s=window.setTimeout((function(){o.apply(e,t),s=-1}),30)})),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}(c,t),c.getTRTCShareInstance=function(e){return Q||(Q=new c(e)),Q},c.prototype.destroyTRTCShareInstance=function(){Q&&(this._removeTRTCEvents(),Q._destroy(),Q=null)},c.prototype.getSDKVersion=function(){return this._version||""},c.prototype.enterRoom=function(e,t){return o(this,void 0,Promise,(function(){var i,r,o,a,c,l,u,d,h,p,m,_,f,g,T,v;return s(this,(function(s){switch(s.label){case 0:if(i=e.sdkAppId,r=e.userId,o=e.userSig,a=e.roomId,c=e.strRoomId,l=e.role,u=e.privateMapKey,d=e.businessInfo,h=e.enableAutoPlayDialog,p=e.proxy,m=e.streamId,_=e.userDefineRecordId,this.logger.update({sdkAppId:i,userId:r}),this.logger.info("".concat(Y,".enterRoom with params: "),e,t),!(i&&r&&o))return[3,5];s.label=1;case 1:return s.trys.push([1,3,,4]),f={sdkAppId:i,userId:r,userSig:o,roomId:a,strRoomId:c,role:M[l],scene:L[t],autoReceiveAudio:this._autoRecvAudio,autoReceiveVideo:this._autoRecvVideo,frameWorkType:this._frameWorkType,component:this._component,language:this._language},f=u?n(n({},f),{privateMapKey:u}):f,f=d?n(n({},f),{businessInfo:d}):f,f=h?n(n({},f),{enableAutoPlayDialog:h}):f,f=p?n(n({},f),{proxy:p}):f,f=m?n(n({},f),{streamId:m}):f,f=_?n(n({},f),{userDefineRecordId:_}):f,g=x(),[4,this._trtc.enterRoom(f)];case 2:return s.sent(),T=x()-g,this.emit("onEnterRoom",T),[3,4];case 3:return v=s.sent(),this.emit("onEnterRoom",-1),this._callFunctionErrorManage(v,"enterRoom"),[3,4];case 4:return[3,6];case 5:this._emitError(W),s.label=6;case 6:return[2]}}))}))},c.prototype.exitRoom=function(){return o(this,void 0,Promise,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return t.trys.push([0,4,,5]),this.logger.info("".concat(Y,".enterRoom")),this._isSharingScreen?[4,this.stopScreenShare()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[4,this._trtc.exitRoom()];case 3:return t.sent(),[3,5];case 4:return e=t.sent(),this._callFunctionErrorManage(e,"exitRoom"),[3,5];case 5:return[2]}}))}))},c.prototype.switchRole=function(e){return o(this,void 0,void 0,(function(){var t;return s(this,(function(i){switch(i.label){case 0:this.logger.info("".concat(Y,".switchRole with param: "),e),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._trtc.switchRole(M[e])];case 2:return i.sent(),this.emit("onSwitchRole",0,"switch role success, role = ".concat(e,", ").concat(M[e])),[3,4];case 3:return t=i.sent(),this.emit("onSwitchRole",null==t?void 0:t.getCode(),t.message),[3,4];case 4:return[2]}}))}))},c.prototype.setDefaultStreamRecvMode=function(e,t){return o(this,void 0,void 0,(function(){return s(this,(function(i){return this.logger.info("".concat(Y,".setDefaultStreamRecvMode with param: "),{autoRecvAudio:e,autoRecvVideo:t}),j(e)&&(this._autoRecvAudio=e),j(t)&&(this._autoRecvVideo=t),[2]}))}))},c.prototype._updateLocalVideo=function(){return o(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._trtc.updateLocalVideo(this._generateLocalVideoData())];case 1:return t.sent(),[3,3];case 2:if((e=t.sent()).code===i.default.ERROR_CODE.OPERATION_ABORT)return[2];throw e;case 3:return[2]}}))}))},c.prototype._updateLocalTestVideo=function(){return o(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._testTrtc.updateLocalVideo(this._generateLocalTestVideoData())];case 1:return t.sent(),[3,3];case 2:if((e=t.sent()).code===i.default.ERROR_CODE.OPERATION_ABORT)return[2];throw e;case 3:return[2]}}))}))},c.prototype._updateRemoteVideo=function(e,t){return o(this,void 0,void 0,(function(){var r;return s(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._trtc.updateRemoteVideo(this._generateRemoteVideoData(e,t))];case 1:return n.sent(),[3,3];case 2:if((r=n.sent()).code===i.default.ERROR_CODE.OPERATION_ABORT)return[2];throw r;case 3:return[2]}}))}))},c.prototype.startLocalPreview=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return o(this,void 0,Promise,(function(){var r,n,o,c,l,u,d,h;return s(this,(function(s){switch(s.label){case 0:this.logger.info("".concat(Y,".startLocalPreview with params: "),t),1===a([],t,!0).length?n=a([],t,!0)[0]:2===a([],t,!0).length&&(h=a([],t,!0),r=h[0],n=h[1]),B(r)||(this._setIsMobile(!0),this._setIsFrontCamera(r)),this._setLocalView(n),s.label=1;case 1:s.trys.push([1,8,,9]),s.label=2;case 2:return s.trys.push([2,4,,7]),[4,this._trtc.startLocalVideo(this._generateLocalVideoData())];case 3:return s.sent(),[3,7];case 4:return(o=s.sent()).code!==i.default.ERROR_CODE.OPERATION_ABORT?[3,6]:[4,this._updateLocalVideo()];case 5:return s.sent(),[2];case 6:throw o;case 7:return this.emit("onCameraDidReady"),c=this._getVideoProfile(),l=c.width,u=c.height,this.emit("onFirstVideoFrame","",e.TRTCVideoStreamType.TRTCVideoStreamTypeBig,l,u),[3,9];case 8:return d=s.sent(),this._callFunctionErrorManage(d,"startLocalPreview"),[3,9];case 9:return[2]}}))}))},c.prototype.updateLocalView=function(e){return o(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this.logger.info("".concat(Y,".updateLocalView with param: "),e),this._setLocalView(e),[4,this._updateLocalVideo()];case 1:return t.sent(),[2]}}))}))},c.prototype.stopLocalPreview=function(){return o(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:this.logger.info("".concat(Y,".stopLocalPreview")),t.label=1;case 1:return t.trys.push([1,3,,4]),this._setLocalView(null),[4,this._trtc.stopLocalVideo()];case 2:return t.sent(),[3,4];case 3:return e=t.sent(),console.warn("".concat(Y," stopLocalPreview error: ").concat(e)),this._callFunctionErrorManage(e,"stopLocalPreview"),[3,4];case 4:return[2]}}))}))},c.prototype.muteLocalVideo=function(e){return void 0===e&&(e=!1),o(this,void 0,void 0,(function(){var t;return s(this,(function(i){switch(i.label){case 0:this.logger.info("".concat(Y,".muteLocalVideo with params: "),e),i.label=1;case 1:return i.trys.push([1,3,,4]),this._setIsVideoPublish(!e),[4,this._updateLocalVideo()];case 2:return i.sent(),[3,4];case 3:return t=i.sent(),this._callFunctionErrorManage(t,"muteLocalVideo"),[3,4];case 4:return[2]}}))}))},c.prototype.startRemoteView=function(t,r,n){return o(this,void 0,void 0,(function(){var o,a;return s(this,(function(s){switch(s.label){case 0:this.logger.info("".concat(Y,".startRemoteView with params: "),t,r,n),s.label=1;case 1:if(s.trys.push([1,8,,9]),this._setRemoteStreamConfig(t,n,{view:r,small:n===e.TRTCVideoStreamType.TRTCVideoStreamTypeSmall}),!this._remoteStreamMap.get("".concat(t,"_").concat(this._getTRTCStreamType(n))))return[2];s.label=2;case 2:return s.trys.push([2,4,,7]),[4,this._trtc.startRemoteVideo(this._generateRemoteVideoData(t,n))];case 3:return s.sent(),[3,7];case 4:return(o=s.sent()).code!==i.default.ERROR_CODE.OPERATION_ABORT?[3,6]:[4,this._updateRemoteVideo(t,n)];case 5:return s.sent(),[2];case 6:throw o;case 7:return this.emit("onFirstVideoFrame",t,n,0,0),[3,9];case 8:return a=s.sent(),this._callFunctionErrorManage(a,"startRemoteView"),[3,9];case 9:return[2]}}))}))},c.prototype.updateRemoteView=function(e,t,i){return o(this,void 0,void 0,(function(){return s(this,(function(r){switch(r.label){case 0:return this.logger.info("".concat(Y,".updateRemoteView with params: "),e,t,i),this._setRemoteStreamConfig(e,i,{view:t}),this._remoteStreamMap.get("".concat(e,"_").concat(this._getTRTCStreamType(i)))?[4,this._updateRemoteVideo(e,i)]:[2];case 1:return r.sent(),[2]}}))}))},c.prototype.stopRemoteView=function(e,t){return o(this,void 0,void 0,(function(){var i;return s(this,(function(r){switch(r.label){case 0:this.logger.info("".concat(Y,".stopRemoteView with params: "),e,t),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._trtc.stopRemoteVideo({userId:e,streamType:this._getTRTCStreamType(t)})];case 2:return r.sent(),[3,4];case 3:return i=r.sent(),this._callFunctionErrorManage(i,"stopRemoteView"),[3,4];case 4:return[2]}}))}))},c.prototype.stopAllRemoteView=function(){return o(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:this.logger.info("".concat(Y,".stopAllRemoteView")),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this._trtc.stopRemoteVideo({userId:"*"})];case 2:return t.sent(),[3,4];case 3:return e=t.sent(),this._callFunctionErrorManage(e,"stopAllRemoteView"),[3,4];case 4:return[2]}}))}))},c.prototype.setVideoEncoderParam=function(e){return o(this,void 0,void 0,(function(){var t,i;return s(this,(function(r){switch(r.label){case 0:this.logger.info("".concat(Y,".setVideoEncoderParam with params: "),e),r.label=1;case 1:return r.trys.push([1,4,,5]),t=this._getTRTCVideoProfile("video",e),this._setVideoProfile(t),[4,this._updateLocalVideo()];case 2:return r.sent(),[4,this._updateLocalTestVideo()];case 3:return r.sent(),[3,5];case 4:return i=r.sent(),this._callFunctionErrorManage(i,"setVideoEncoderParam"),[3,5];case 5:return[2]}}))}))},c.prototype.setLocalRenderParams=function(e){return o(this,void 0,void 0,(function(){var t,i;return s(this,(function(r){switch(r.label){case 0:this.logger.info("".concat(Y,".setLocalRenderParams with params: "),e),Object.assign(this._localRenderParams,e),r.label=1;case 1:return r.trys.push([1,4,,5]),t={},e.mirrorType&&(t.mirror=this._getTRTCMirror(e.mirrorType)),e.fillMode&&(t.fillMode=this._getTRTCFillMode(e.fillMode)),this._setVideoPlayOption(t),[4,this._updateLocalVideo()];case 2:return r.sent(),[4,this._updateLocalTestVideo()];case 3:return r.sent(),[3,5];case 4:return i=r.sent(),this._callFunctionErrorManage(i,"setLocalRenderParams"),[3,5];case 5:return[2]}}))}))},c.prototype.setRemoteRenderParams=function(e,t,i){return o(this,void 0,void 0,(function(){var r;return s(this,(function(n){switch(n.label){case 0:this.logger.info("".concat(Y,".setRemoteRenderParams with params: "),e,t,i),n.label=1;case 1:return n.trys.push([1,3,,4]),this._setRemoteStreamConfig(e,t,i),[4,this._updateRemoteVideo(e,t)];case 2:return n.sent(),[3,4];case 3:return r=n.sent(),this._callFunctionErrorManage(r,"setRemoteRenderParams"),[3,4];case 4:return[2]}}))}))},c.prototype._updateLocalAudio=function(){return o(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this._trtc.updateLocalAudio(this._generateLocalAudioData())];case 1:return t.sent(),[3,3];case 2:if((e=t.sent()).code===i.default.ERROR_CODE.OPERATION_ABORT)return[2];throw e;case 3:return[2]}}))}))},c.prototype.startLocalAudio=function(t){return void 0===t&&(t=e.TRTCAudioQuality.TRTCAudioQualityDefault),o(this,void 0,void 0,(function(){var e,r;return s(this,(function(n){switch(n.label){case 0:this.logger.info("".concat(Y,".startLocalAudio with params: "),t),n.label=1;case 1:n.trys.push([1,8,,9]),this._setAudioProfile(V[t]),n.label=2;case 2:return n.trys.push([2,4,,7]),[4,this._trtc.startLocalAudio(this._generateLocalAudioData())];case 3:return n.sent(),[3,7];case 4:return(e=n.sent()).code!==i.default.ERROR_CODE.OPERATION_ABORT?[3,6]:[4,this._updateLocalAudio()];case 5:return n.sent(),[2];case 6:throw e;case 7:return this.emit("onMicDidReady"),[3,9];case 8:return r=n.sent(),console.warn("".concat(Y," startLocalAudio error: ").concat(r)),this._callFunctionErrorManage(r,"startLocalAudio"),[3,9];case 9:return[2]}}))}))},c.prototype.stopLocalAudio=function(){return o(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:this.logger.info("".concat(Y,".stopLocalAudio")),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this._trtc.stopLocalAudio()];case 2:return t.sent(),[3,4];case 3:return e=t.sent(),this._callFunctionErrorManage(e,"stopLocalAudio"),[3,4];case 4:return[2]}}))}))},c.prototype.muteLocalAudio=function(e){return void 0===e&&(e=!1),o(this,void 0,void 0,(function(){var t;return s(this,(function(i){switch(i.label){case 0:this.logger.info("".concat(Y,".muteLocalAudio with params: "),e),i.label=1;case 1:return i.trys.push([1,3,,4]),this._setIsAudioPublish(!e),[4,this._updateLocalAudio()];case 2:return i.sent(),[3,4];case 3:return t=i.sent(),this._callFunctionErrorManage(t,"muteLocalAudio"),[3,4];case 4:return[2]}}))}))},c.prototype.muteRemoteAudio=function(e,t){return void 0===t&&(t=!1),o(this,void 0,void 0,(function(){var i;return s(this,(function(r){switch(r.label){case 0:this.logger.info("".concat(Y,".muteRemoteAudio with params: "),e,t),r.label=1;case 1:return r.trys.push([1,3,,4]),e?[4,this._trtc.muteRemoteAudio(e,t)]:(this._emitError(W),[2]);case 2:return r.sent(),[3,4];case 3:return i=r.sent(),this._callFunctionErrorManage(i,"muteRemoteAudio"),[3,4];case 4:return[2]}}))}))},c.prototype.muteAllRemoteAudio=function(e){this.logger.info("".concat(Y,".muteAllRemoteAudio with params: "),e);try{this._trtc.muteRemoteAudio("*",e)}catch(e){this._callFunctionErrorManage(e,"muteAllRemoteAudio")}},c.prototype.setRemoteAudioVolume=function(e,t){this.logger.info("".concat(Y,".setRemoteAudioVolume with params: "),e,t);try{this._trtc.setRemoteAudioVolume(e,t)}catch(e){this._callFunctionErrorManage(e,"setRemoteAudioVolume")}},c.prototype.enableAudioVolumeEvaluation=function(e){this.logger.info("".concat(Y,".enableAudioVolumeEvaluation with params: "),e);try{this._trtc.enableAudioVolumeEvaluation(e)}catch(e){this._callFunctionErrorManage(e,"enableAudioVolumeEvaluation")}},c.prototype.enableSmallVideoStream=function(e,t){return o(this,void 0,Promise,(function(){var i;return s(this,(function(r){switch(r.label){case 0:return this.logger.info("".concat(Y,".enableSmallVideoStream with params: "),e,t),e?(i=this._getTRTCVideoProfile("small",t),this._setSmallStreamVideoProfile(i)):this._setSmallStreamVideoProfile(void 0),[4,this._updateLocalVideo()];case 1:return r.sent(),[2]}}))}))},c.prototype.startScreenShare=function(t,r,n){return o(this,void 0,void 0,(function(){var o,a,c,l,u,d;return s(this,(function(s){switch(s.label){case 0:this.logger.info("".concat(Y,".startScreenShare with params: "),t,r,n),s.label=1;case 1:return s.trys.push([1,3,,4]),o=(n||{}).screenAudio,a=void 0!==o&&o,c=this._getTRTCVideoProfile("screen",n),this._setScreenShareParams({view:t,profile:c,systemAudio:a}),[4,this._trtc.startScreenShare(this._getScreenShareParams())];case 2:return s.sent(),this._isSharingScreen=!0,l=c.width,u=c.height,this.emit("onFirstVideoFrame","",e.TRTCVideoStreamType.TRTCVideoStreamTypeSub,l,u),[3,4];case 3:if((d=s.sent()).code===i.default.ERROR_CODE.OPERATION_ABORT)return[2];throw console.error("Start share screen error:",d,d.code,d.name,d.message),d;case 4:return[2]}}))}))},c.prototype.setSubStreamEncoderParam=function(e){return o(this,void 0,void 0,(function(){var t,i;return s(this,(function(r){switch(r.label){case 0:this.logger.info("".concat(Y,".setSubStreamEncoderParam with params: "),e),r.label=1;case 1:return r.trys.push([1,3,,4]),t=this._getTRTCVideoProfile("screen",e),this._setScreenShareParams({profile:t}),[4,this._trtc.updateScreenShare(this._getScreenShareParams())];case 2:return r.sent(),[3,4];case 3:return i=r.sent(),this._callFunctionErrorManage(i,"setSubStreamEncoderParam"),[3,4];case 4:return[2]}}))}))},c.prototype.stopScreenShare=function(){return o(this,void 0,Promise,(function(){var e;return s(this,(function(t){switch(t.label){case 0:this.logger.info("".concat(Y,".stopScreenShare")),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this._trtc.stopScreenShare()];case 2:return t.sent(),this._isSharingScreen=!1,this.emit("onScreenCaptureStopped",0),[3,4];case 3:return e=t.sent(),this._callFunctionErrorManage(e,"stopScreenShare"),[3,4];case 4:return[2]}}))}))},c.prototype.startScreenCapture=function(){this._emitError(G)},c.prototype.pauseScreenCapture=function(){this._emitError(G)},c.prototype.resumeScreenCapture=function(){this._emitError(G)},c.prototype.getScreenCaptureSources=function(){this._emitError(G)},c.prototype.selectScreenCaptureTarget=function(){this._emitError(G)},c.prototype.getCameraDevicesList=function(){return o(this,void 0,Promise,(function(){var e,t,r;return s(this,(function(o){switch(o.label){case 0:this.logger.info("".concat(Y,".getCameraDevicesList")),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,i.default.getCameraList()];case 2:return e=o.sent(),t=e.map((function(e){return n(n({},e),{deviceName:e.label})})),this._cameraList=e,"{}"===JSON.stringify(this._currentCamera)&&(this._currentCamera=this.getDefaultDeviceInfo(e),this._currentCameraId=this._currentCamera.deviceId),[2,Promise.resolve(t)];case 3:return r=o.sent(),this._callFunctionErrorManage(r,"getCameraDevicesList"),[2,Promise.resolve([])];case 4:return[2]}}))}))},c.prototype.setCurrentCameraDevice=function(e){return o(this,void 0,Promise,(function(){var t;return s(this,(function(i){switch(i.label){case 0:this.logger.info("".concat(Y,".setCurrentCameraDevice with params: "),{cameraId:e}),i.label=1;case 1:return i.trys.push([1,4,,5]),e?(this._currentCameraId=e,this._currentCamera=this._cameraList.filter((function(t){return t.deviceId===e})),[4,this._updateLocalVideo()]):[2,!1];case 2:return i.sent(),[4,this._updateLocalTestVideo()];case 3:return i.sent(),[2,!0];case 4:return t=i.sent(),this._callFunctionErrorManage(t,"setCurrentCameraDevice"),[2,!1];case 5:return[2]}}))}))},c.prototype.getCurrentCameraDevice=function(){this.logger.info("".concat(Y,".getCurrentCameraDevice"));var e=this._currentCamera,t=e.deviceId,i=e.label,r=e.kind,n=e.groupId;return new y(t,i,r,i,n)},c.prototype.isFrontCamera=function(){return this._getIsFrontCamera()},c.prototype.switchCamera=function(e){return o(this,void 0,void 0,(function(){var t;return s(this,(function(i){switch(i.label){case 0:return this.logger.info("".concat(Y,".switchCamera with params: "),e),this._setIsFrontCamera(e),(t=this._getVideoPlayOption()).mirror=this._getTRTCMirror(this._localRenderParams.mirrorType),this._setVideoPlayOption(t),[4,this._updateLocalVideo()];case 1:return i.sent(),[2]}}))}))},c.prototype.getMicDevicesList=function(){return o(this,void 0,Promise,(function(){var e,t,r;return s(this,(function(o){switch(o.label){case 0:this.logger.info("".concat(Y,".getMicDevicesList")),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,i.default.getMicrophoneList()];case 2:return e=o.sent(),t=e.map((function(e){return n(n({},e),{deviceName:e.label})})),this._microphoneList=e,"{}"===JSON.stringify(this._currentMicrophone)&&(this._currentMicrophone=this.getDefaultDeviceInfo(e),this._currentMicrophoneId=this._currentMicrophone.deviceId),[2,Promise.resolve(t)];case 3:return r=o.sent(),this._callFunctionErrorManage(r,"getMicDevicesList"),[2,Promise.resolve([])];case 4:return[2]}}))}))},c.prototype.setCurrentMicDevice=function(e){return o(this,void 0,Promise,(function(){var t;return s(this,(function(i){switch(i.label){case 0:this.logger.info("".concat(Y,".setCurrentMicDevice with params: "),{micId:e}),i.label=1;case 1:return i.trys.push([1,3,,4]),e?(this._setCurrentMicrophoneId(e),this._currentMicrophone=this._microphoneList.filter((function(t){return t.deviceId===e})),[4,this._trtc.updateLocalAudio(this._generateLocalAudioData())]):[2,!1];case 2:return i.sent(),[2,!0];case 3:return t=i.sent(),this._callFunctionErrorManage(t,"setCurrentMicDevice"),[2,!1];case 4:return[2]}}))}))},c.prototype.getCurrentMicDevice=function(){this.logger.info("".concat(Y,".getCurrentMicDevice"));var e=this._currentMicrophone,t=e.deviceId,i=e.label,r=e.kind,n=e.groupId;return new y(t,i,r,i,n)},c.prototype.getSpeakerDevicesList=function(){return o(this,void 0,Promise,(function(){var e,t,r;return s(this,(function(o){switch(o.label){case 0:this.logger.info("".concat(Y,".getSpeakerDevicesList")),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,i.default.getSpeakerList()];case 2:return e=o.sent(),t=e.map((function(e){return n(n({},e),{deviceName:e.label})})),this._speakerList=e,"{}"===JSON.stringify(this._currentSpeaker)&&(this._currentSpeaker=this.getDefaultDeviceInfo(e),this._currentSpeakerId=this._currentSpeaker.deviceId),[2,Promise.resolve(t)];case 3:return r=o.sent(),this._callFunctionErrorManage(r,"getSpeakerDevicesList"),[2,Promise.resolve([])];case 4:return[2]}}))}))},c.prototype.setCurrentSpeakerDevice=function(e){return o(this,void 0,Promise,(function(){var t;return s(this,(function(r){switch(r.label){case 0:this.logger.info("".concat(Y,".setCurrentSpeakerDevice with params: "),{speakerId:e}),r.label=1;case 1:return r.trys.push([1,3,,4]),e?(this._setCurrentSpeakerId(e),this._currentSpeaker=this._speakerList.filter((function(t){return t.deviceId===e})),[4,i.default.setCurrentSpeaker(e)]):[2,!1];case 2:return r.sent(),[2,!0];case 3:return t=r.sent(),this._callFunctionErrorManage(t,"setCurrentSpeakerDevice"),[2,!1];case 4:return[2]}}))}))},c.prototype.getCurrentSpeakerDevice=function(){this.logger.info("".concat(Y,".getCurrentSpeakerDevice"));var e=this._currentSpeaker,t=e.deviceId,i=e.label,r=e.kind,n=e.groupId;return new y(t,i,r,i,n)},c.prototype.startCameraDeviceTest=function(e){return o(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this.logger.info("".concat(Y,".startCameraDeviceTest with params: "),e),e?(this._setLocalTestView(e),[4,this._testTrtc.startLocalVideo(this._generateLocalTestVideoData())]):[2];case 1:return t.sent(),[2]}}))}))},c.prototype.stopCameraDeviceTest=function(){return o(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.logger.info("".concat(Y,".stopCameraDeviceTest")),this._setLocalTestView(null),[4,this._testTrtc.stopLocalVideo()];case 1:return e.sent(),[2]}}))}))},c.prototype.startMicDeviceTest=function(t){return o(this,void 0,void 0,(function(){var r=this;return s(this,(function(n){switch(n.label){case 0:return this.logger.info("".concat(Y,".startMicDeviceTest with params: "),t),[4,this._testTrtc.startLocalAudio({publish:!1,option:{microphoneId:this._currentMicrophoneId,profile:V[e.TRTCAudioQuality.TRTCAudioQualityDefault]}})];case 1:return n.sent(),this._testTrtc.on(i.default.EVENT.AUDIO_VOLUME,(function(e){null==e||e.result.forEach((function(e){var t=e.userId,i=e.volume;""===t&&r.emit("onTestMicVolume",i)}))})),[4,this._testTrtc.enableAudioVolumeEvaluation(t)];case 2:return n.sent(),[2]}}))}))},c.prototype.stopMicDeviceTest=function(){return o(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return this.logger.info("".concat(Y,".stopMicDeviceTest")),[4,this._testTrtc.stopLocalAudio()];case 1:return e.sent(),[2]}}))}))},c.prototype.callExperimentalAPI=function(e){this.logger.info("".concat(Y,".callExperimentalAPI"),e);var t=function(e){if("string"!=typeof e)return e;var t;try{var i=JSON.parse(e);t="object"==typeof i&&i?i:e}catch(i){t=e}return t}(e);if(t!==e){var i=t.api,r=t.params;i&&r&&"setFramework"===i&&this._handleSetFrameWork(r)}},c.prototype._handleSetFrameWork=function(e){var t=e.frameWork,i=e.component,r=e.language;H(t)&&(this._frameWorkType=t),H(i)&&(this._component=i),H(r)&&(this._language=r)},c.prototype._unbindEvents=function(){},c.prototype._destroy=function(){this._unbindEvents()},c.prototype._emitError=function(e){e&&this.emit&&this.emit(N,e.code,e.message)},c.prototype._callFunctionErrorManage=function(e,t){e&&e.code===i.default.ERROR_CODE.OPERATION_ABORT||(e&&e.getCode&&e.getCode()?(this.emit(N,e.getCode(),e.message),this.logger.warn("(".concat(t,") failed - ").concat(e.message))):(this.emit(N,-1e3,e.message),this.logger.warn("(".concat(t,") failed - ").concat(e.message))))},c.prototype._getTRTCResolution=function(t){var i=(e.TRTCVideoResolution[t]||"").split("_");return{width:+(i.length>1&&i[1]),height:+(i.length>2&&i[2])}},c.prototype._getTRTCVideoProfile=function(t,i){var r=i.videoResolution,n=i.videoFps,o=i.videoBitrate,s=i.resMode,a={};switch(t){case"screen":a=this._defaultScreenProfile;break;case"small":a=this._defaultSmallVideoProfile;break;default:a=this._defaultVideoProfile}if(!B(r)){var c=this._getTRTCResolution(r);a.width=c.width,a.height=c.height}if(!B(s)&&s===e.TRTCVideoResolutionMode.TRTCVideoResolutionModePortrait){var l=a.height,u=a.width;a.width=l,a.height=u}return n&&(a.frameRate=n),o&&(a.bitrate=o),a},c.prototype._getTRTCStreamType=function(t){var r;return((r={})[e.TRTCVideoStreamType.TRTCVideoStreamTypeBig]=i.default.TYPE.STREAM_TYPE_MAIN,r[e.TRTCVideoStreamType.TRTCVideoStreamTypeSmall]=i.default.TYPE.STREAM_TYPE_MAIN,r[e.TRTCVideoStreamType.TRTCVideoStreamTypeSub]=i.default.TYPE.STREAM_TYPE_SUB,r)[t]},c.prototype._getTRTCFillMode=function(t){var i;return((i={})[e.TRTCVideoFillMode.TRTCVideoFillMode_Fill]=F.COVER,i[e.TRTCVideoFillMode.TRTCVideoFillMode_Fit]=F.CONTAIN,i)[t]},c.prototype._getTRTCMirror=function(t){var i;return t===e.TRTCVideoMirrorType.TRTCVideoMirrorType_Auto?!this._getIsMobile()||this._getIsFrontCamera():((i={})[e.TRTCVideoMirrorType.TRTCVideoMirrorType_Enable]=!0,i[e.TRTCVideoMirrorType.TRTCVideoMirrorType_Disable]=!1,i)[t]},c.prototype._getTRTCCloudDeviceType=function(t){return{camera:e.TRTCDeviceType.TRTCDeviceTypeCamera,microphone:e.TRTCDeviceType.TRTCDeviceTypeMic,speaker:e.TRTCDeviceType.TRTCDeviceTypeSpeaker}[t]},c.prototype._getTRTCCloudDeviceState=function(t){return{add:e.TRTCDeviceState.TRTCDeviceStateAdd,remove:e.TRTCDeviceState.TRTCDeviceStateRemove,active:e.TRTCDeviceState.TRTCDeviceStateActive}[t]},c.prototype._getTRTCCloudQuality=function(t){return[e.TRTCQuality.TRTCQuality_Unknown,e.TRTCQuality.TRTCQuality_Excellent,e.TRTCQuality.TRTCQuality_Good,e.TRTCQuality.TRTCQuality_Poor,e.TRTCQuality.TRTCQuality_Bad,e.TRTCQuality.TRTCQuality_Vbad,e.TRTCQuality.TRTCQuality_Down][t]},c.prototype._generateLocalVideoData=function(){var e={view:this._getLocalView(),publish:this._getIsVideoPublish(),option:n({profile:this._getVideoProfile(),small:this._getSmallStreamVideoProfile()},this._getVideoPlayOption())};return this._getIsMobile()?e&&Object.assign(e.option,{useFrontCamera:this._getIsFrontCamera()}):e&&Object.assign(e.option,{cameraId:this._getCurrentCameraId()}),e},c.prototype._generateLocalTestVideoData=function(){return{view:this._getLocalTestView(),publish:!1,option:n({cameraId:this._getCurrentCameraId(),profile:this._getVideoProfile()},this._getVideoPlayOption())}},c.prototype._generateLocalAudioData=function(){return{publish:this._getIsAudioPublish(),option:{microphoneId:this._getCurrentMicrophoneId(),profile:this._getAudioProfile()}}},c.prototype._generateRemoteVideoData=function(e,t){return this._remoteStreamConfig.get("".concat(e,"_").concat(this._getTRTCStreamType(t)))},c.prototype._addTRTCEvents=function(){var t=this;this._trtc.on(i.default.EVENT.ERROR,(function(e){var i;e&&t.emit("onError",null===(i=null==e?void 0:e.getCode)||void 0===i?void 0:i.getCode(),e.message)})),this._trtc.on(i.default.EVENT.REMOTE_USER_ENTER,(function(e){(null==e?void 0:e.userId)&&t.emit("onRemoteUserEnterRoom",e.userId)})),this._trtc.on(i.default.EVENT.REMOTE_USER_EXIT,(function(e){(null==e?void 0:e.userId)&&t.emit("onRemoteUserLeaveRoom",e.userId)})),this._trtc.on(i.default.EVENT.REMOTE_AUDIO_AVAILABLE,(function(e){(null==e?void 0:e.userId)&&t.emit("onUserAudioAvailable",e.userId,!0)})),this._trtc.on(i.default.EVENT.REMOTE_AUDIO_UNAVAILABLE,(function(e){(null==e?void 0:e.userId)&&t.emit("onUserAudioAvailable",e.userId,!1)})),this._trtc.on(i.default.EVENT.REMOTE_VIDEO_AVAILABLE,(function(e){t._emitVideoAvailable(e,!0)})),this._trtc.on(i.default.EVENT.REMOTE_VIDEO_UNAVAILABLE,(function(e){t._emitVideoAvailable(e,!1)})),this._trtc.on(i.default.EVENT.AUDIO_VOLUME,(function(e){(null==e?void 0:e.result)&&t.emit("onUserVoiceVolume",null==e?void 0:e.result,((null==e?void 0:e.result)||[]).length)})),this._trtc.on(i.default.EVENT.NETWORK_QUALITY,(function(e){var i=e.uplinkNetworkQuality,r=e.downlinkNetworkQuality,n=e.uplinkRTT,o=e.uplinkLoss,s=e.downlinkLoss,a=e.downlinkInfo,c=new C("",t._getTRTCCloudQuality(i)),l=[];a.length>0&&(l=a.map((function(e){return new C(e.userId,t._getTRTCCloudQuality(r))}))),t.emit("onNetworkQuality",c,l);var u=new A(o,s,0,0,n,0,0);t.emit("onStatistics",u)})),this._trtc.on(i.default.EVENT.SCREEN_SHARE_STOPPED,(function(){t.emit("onScreenCaptureStopped",0),t._isSharingScreen=!1})),this._trtc.on(i.default.EVENT.PUBLISH_STATE_CHANGED,(function(i){var r=i.mediaType;"started"===i.state&&("audio"===r?t.emit("onSendFirstLocalAudioFrame"):"video"===r?t.emit("onSendFirstLocalVideoFrame",e.TRTCVideoStreamType.TRTCVideoStreamTypeBig):"screen"===r&&t.emit("onSendFirstLocalVideoFrame",e.TRTCVideoStreamType.TRTCVideoStreamTypeSub))}))},c.prototype._removeTRTCEvents=function(){this._trtc.off("*")},c.prototype._emitVideoAvailable=function(e,t){var r=e.userId,n=e.streamType;t?this._remoteStreamMap.set("".concat(r,"_").concat(n),!0):this._remoteStreamMap.delete("".concat(r,"_").concat(n)),n===i.default.TYPE.STREAM_TYPE_SUB?r&&this.emit("onUserSubStreamAvailable",r,t):r&&this.emit("onUserVideoAvailable",r,t)},c.prototype._setLocalView=function(e){this._localView=e},c.prototype._getLocalView=function(){return this._localView},c.prototype._setIsMobile=function(e){this._isMobile=e},c.prototype._getIsMobile=function(){return this._isMobile},c.prototype._setIsFrontCamera=function(e){this._isFrontCamera=e},c.prototype._getIsFrontCamera=function(){return this._isFrontCamera},c.prototype._getSmallStreamVideoProfile=function(){return this._smallStreamVideoProfile},c.prototype._setSmallStreamVideoProfile=function(e){this._smallStreamVideoProfile=e},c.prototype._setIsVideoPublish=function(e){this._isVideoPublish=e},c.prototype._getIsVideoPublish=function(){return this._isVideoPublish},c.prototype._setVideoProfile=function(e){this._videoProfile=e},c.prototype._getVideoProfile=function(){return this._videoProfile},c.prototype._setVideoPlayOption=function(e){this._videoPlayOption=e},c.prototype._getVideoPlayOption=function(){return this._videoPlayOption},c.prototype._setLocalTestView=function(e){this._localTestView=e},c.prototype._getLocalTestView=function(){return this._localTestView},c.prototype._setScreenShareParams=function(e){var t=e.view,i=e.systemAudio,r=e.fillMode,n=e.profile;B(t)||(this._screenShareParams.view=t),B(i)||(this._screenShareParams.option.systemAudio=i),B(r)||(this._screenShareParams.option.fillMode=r),B(n)||(this._screenShareParams.option.profile=n)},c.prototype._getScreenShareParams=function(){return this._screenShareParams},c.prototype._setIsAudioPublish=function(e){this._isAudioPublish=e},c.prototype._getIsAudioPublish=function(){return this._isAudioPublish},c.prototype._setAudioProfile=function(e){this._audioProfile=e},c.prototype._getAudioProfile=function(){return this._audioProfile},c.prototype._setCurrentCameraId=function(e){this._currentCameraId=e},c.prototype._getCurrentCameraId=function(){return this._currentCameraId},c.prototype._setCurrentMicrophoneId=function(e){this._currentMicrophoneId=e},c.prototype._getCurrentMicrophoneId=function(){return this._currentMicrophoneId},c.prototype._setCurrentSpeakerId=function(e){this._currentSpeakerId=e},c.prototype._getCurrentSpeakerId=function(){return this._currentSpeakerId},c.prototype._setRemoteStreamConfig=function(t,i,r){var n=this._remoteStreamConfig.get("".concat(t,"_").concat(this._getTRTCStreamType(i)));n||(n={userId:t,streamType:this._getTRTCStreamType(i),option:{mirror:this._getTRTCMirror(e.TRTCVideoMirrorType.TRTCVideoMirrorType_Disable),fillMode:this._getTRTCFillMode(e.TRTCVideoFillMode.TRTCVideoFillMode_Fit)}});var o=r.view,s=r.mirrorType,a=r.fillMode,c=r.small;B(o)||(n.view=o),B(s)||(n.option.mirror=this._getTRTCMirror(s)),B(a)||(n.option.fillMode=this._getTRTCFillMode(a)),B(c)||(n.option.small=c),this._remoteStreamConfig.set("".concat(t,"_").concat(this._getTRTCStreamType(i)),n)},c.prototype.handleDeviceChange=function(){return o(this,void 0,void 0,(function(){var t=this;return s(this,(function(r){return i.default.getCameraList().then((function(i){return o(t,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return this._cameraList.length===i.length?[2]:[4,this.deviceChangeManage(this._cameraList,i,e.TRTCDeviceType.TRTCDeviceTypeCamera)];case 1:return t.sent(),this._cameraList=i,[2]}}))}))})),i.default.getMicrophoneList().then((function(i){return o(t,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.deviceChangeManage(this._microphoneList,i,e.TRTCDeviceType.TRTCDeviceTypeMic)];case 1:return t.sent(),this._microphoneList=i,[2]}}))}))})),i.default.getSpeakerList().then((function(i){return o(t,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,this.deviceChangeManage(this._speakerList,i,e.TRTCDeviceType.TRTCDeviceTypeSpeaker)];case 1:return t.sent(),this._speakerList=i,[2]}}))}))})),[2]}))}))},c.prototype.isSameDevice=function(e,t){var i=e&&e.deviceId&&e.groupId&&e.label,r=t&&t.deviceId&&t.groupId&&t.label;return!(!i||!r)&&e.deviceId===t.deviceId&&e.groupId===t.groupId&&e.label===t.label},c.prototype.deviceChangeManage=function(t,i,r){return o(this,void 0,void 0,(function(){var n,o,a,c,l;return s(this,(function(s){switch(s.label){case 0:return n=void 0,t.length!==i.length&&(o=(i||[]).map((function(e){return e.deviceId})),a=new y,t.length>i.length?(a=t.filter((function(e){return!o.includes(e.deviceId)}))[0]||{},n=e.TRTCDeviceState.TRTCDeviceStateRemove):(o=(t||[]).map((function(e){return e.deviceId})),a=i.filter((function(e){return!o.includes(e.deviceId)}))[0]||{},n=e.TRTCDeviceState.TRTCDeviceStateAdd),c=a.deviceId,this.emitOnDeviceChange(c,r,n)),l=this.getDefaultDeviceInfo(i),r!==e.TRTCDeviceType.TRTCDeviceTypeCamera||n!==e.TRTCDeviceState.TRTCDeviceStateRemove?[3,3]:this.isSameDevice(this._currentCamera,l)?[2]:l.deviceId?[4,this.autoChangeDevice(r,l)]:[3,2];case 1:s.sent(),s.label=2;case 2:s.label=3;case 3:return r!==e.TRTCDeviceType.TRTCDeviceTypeMic?[3,6]:this.isSameDevice(this._currentMicrophone,l)?[2]:l.deviceId?[4,this.autoChangeDevice(r,l)]:[3,5];case 4:s.sent(),s.label=5;case 5:s.label=6;case 6:return r!==e.TRTCDeviceType.TRTCDeviceTypeSpeaker?[3,9]:this.isSameDevice(this._currentSpeaker,l)?[2]:l.deviceId?[4,this.autoChangeDevice(r,l)]:[3,8];case 7:s.sent(),s.label=8;case 8:s.label=9;case 9:return[2]}}))}))},c.prototype.getDefaultDeviceInfo=function(e){var t=new y;if(0===e.length)return t;var i=e.filter((function(e){return"default"===e.deviceId}));return i.length>0?i[0]:e[0]},c.prototype.autoChangeDevice=function(t,r){return o(this,void 0,void 0,(function(){var n,o,a,c,l;return s(this,(function(s){switch(s.label){case 0:if(n=r.deviceId,t!==e.TRTCDeviceType.TRTCDeviceTypeCamera)return[3,8];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this._trtc.updateLocalVideo({option:{cameraId:n}})];case 2:return s.sent(),[3,4];case 3:return o=s.sent(),console.log("error",JSON.stringify(o)),o.code,i.default.ERROR_CODE.OPERATION_ABORT,[3,4];case 4:return s.trys.push([4,6,,7]),[4,this._testTrtc.updateLocalVideo({option:{cameraId:n}})];case 5:return s.sent(),[3,7];case 6:return a=s.sent(),console.log("testTRTC error",JSON.stringify(a)),a.code,i.default.ERROR_CODE.OPERATION_ABORT,[3,7];case 7:this._currentCameraId=n,this._currentCamera=r,this.emitOnDeviceChange(n,t,e.TRTCDeviceState.TRTCDeviceStateActive),s.label=8;case 8:if(t!==e.TRTCDeviceType.TRTCDeviceTypeMic)return[3,16];s.label=9;case 9:return s.trys.push([9,11,,12]),[4,this._trtc.updateLocalAudio({option:{microphoneId:n}})];case 10:return s.sent(),[3,12];case 11:return c=s.sent(),console.log("error",JSON.stringify(c)),c.code,i.default.ERROR_CODE.OPERATION_ABORT,[3,12];case 12:return s.trys.push([12,14,,15]),[4,this._testTrtc.updateLocalAudio({option:{microphoneId:n}})];case 13:return s.sent(),[3,15];case 14:return l=s.sent(),console.log("testTRTC error",JSON.stringify(l)),l.code,i.default.ERROR_CODE.OPERATION_ABORT,[3,15];case 15:this._currentMicrophoneId=n,this._currentMicrophone=r,this.emitOnDeviceChange(n,t,e.TRTCDeviceState.TRTCDeviceStateActive),s.label=16;case 16:return t!==e.TRTCDeviceType.TRTCDeviceTypeSpeaker?[3,18]:[4,i.default.setCurrentSpeaker(n)];case 17:s.sent(),this._currentSpeakerId=n,this._currentSpeaker=r,this.emitOnDeviceChange(n,t,e.TRTCDeviceState.TRTCDeviceStateActive),s.label=18;case 18:return[2]}}))}))},c.prototype.emitOnDeviceChange=function(e,t,i){this.emit("onDeviceChange",e,t,i)},c}(f);e.Rect=function(e,t,i,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),this.left=e,this.top=t,this.right=i,this.bottom=r},e.TRTCDeviceInfo=y,e.TRTCImageBuffer=w,e.TRTCLocalStatistics=function(t,i,r,n,o,s,a){void 0===t&&(t=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=e.TRTCVideoStreamType.TRTCVideoStreamTypeBig),this.width=t,this.height=i,this.frameRate=r,this.videoBitrate=n,this.audioSampleRate=o,this.audioBitrate=s,this.streamType=a},e.TRTCMixUser=function(t,i,r,n,o,s,a,c){void 0===t&&(t=""),void 0===i&&(i=""),void 0===r&&(r=null),void 0===n&&(n=0),void 0===o&&(o=!1),void 0===s&&(s=e.TRTCVideoStreamType.TRTCVideoStreamTypeBig),void 0===a&&(a=e.TRTCMixInputType.TRTCMixInputTypeUndefined),void 0===c&&(c=0),this.userId=t,this.roomId=i,this.rect=r,this.zOrder=n,this.pureAudio=o,this.streamType=s,this.inputType=a,this.renderMode=c},e.TRTCNetworkQosParam=function(t,i){void 0===t&&(t=e.TRTCVideoQosPreference.TRTCVideoQosPreferenceClear),void 0===i&&(i=e.TRTCQosControlMode.TRTCQosControlModeServer),this.preference=t,this.controlMode=i},e.TRTCParams=function(t,i,r,n,o,s,a,c,l,u,d){void 0===t&&(t=0),void 0===i&&(i=""),void 0===r&&(r=""),void 0===n&&(n=0),void 0===o&&(o=""),void 0===s&&(s=e.TRTCRoleType.TRTCRoleAnchor),void 0===a&&(a=null),void 0===l&&(l=null),void 0===u&&(u=null),void 0===d&&(d=30),this.sdkAppId=t,this.userId=i,this.userSig=r,this.roomId=n,this.strRoomId=o,this.role=s,this.privateMapKey=a,this.streamId=l,this.userDefineRecordId=u,this.frameWorkType=d},e.TRTCPublishCDNParam=function(e,t,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=null),this.appId=e,this.bizId=t,this.url=i},e.TRTCQualityInfo=C,e.TRTCRenderParams=function(t,i,r){void 0===t&&(t=e.TRTCVideoRotation.TRTCVideoRotation0),void 0===i&&(i=e.TRTCVideoFillMode.TRTCVideoFillMode_Fit),void 0===r&&(r=e.TRTCVideoMirrorType.TRTCVideoMirrorType_Disable),this.rotation=t,this.fillMode=i,this.mirrorType=r},e.TRTCScreenCaptureSourceInfo=function(t,i,r,n,o,s){void 0===t&&(t=e.TRTCScreenCaptureSourceType.TRTCScreenCaptureSourceTypeUnknown),void 0===i&&(i=""),void 0===r&&(r=""),void 0===n&&(n=new w),void 0===o&&(o=new w),void 0===s&&(s=!1),this.type=t,this.sourceId=i,this.sourceName=r,this.thumbBGRA=n,this.iconBGRA=o,this.isMinimizeWindow=s},e.TRTCStatistics=A,e.TRTCTranscodingConfig=function(t,i,r,n,o,s,a,c,l,u,d,h,p,m,_){void 0===t&&(t=e.TRTCTranscodingConfigMode.TRTCTranscodingConfigMode_Unknown),void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=15),void 0===c&&(c=2),void 0===l&&(l=0),void 0===u&&(u=""),void 0===d&&(d=64),void 0===h&&(h=48e3),void 0===p&&(p=1),void 0===m&&(m=[]),void 0===_&&(_=""),this.mode=t,this.appId=i,this.bizId=r,this.videoWidth=n,this.videoHeight=o,this.videoBitrate=s,this.videoFramerate=a,this.videoGOP=c,this.backgroundColor=l,this.backgroundImage=u,this.audioSampleRate=d,this.audioBitrate=h,this.audioChannels=p,this.mixUsersArray=m,this.mixUsersArraySize=m.length,this.streamId=_},e.TRTCVideoEncParam=function(t,i,r,n){void 0===t&&(t=e.TRTCVideoResolution.TRTCVideoResolution_640_360),void 0===i&&(i=e.TRTCVideoResolutionMode.TRTCVideoResolutionModeLandscape),void 0===r&&(r=15),void 0===n&&(n=550),this.videoResolution=t,this.resMode=i,this.videoFps=r,this.videoBitrate=n},e.TRTCVolumeInfo=function(e,t){void 0===e&&(e=""),void 0===t&&(t=0),this.userId=e,this.volume=t},e.default=X,Object.defineProperty(e,"__esModule",{value:!0})},r(t,i(734))},734:function(e,t,i){e.exports=function(){var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self?self:{},t=function(e){try{return!!e()}catch(e){return!0}},r=!t((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),n=r,o=Function.prototype,s=o.call,a=n&&o.bind.bind(s,s),c=n?a:function(e){return function(){return s.apply(e,arguments)}},l=c,u=l({}.toString),d=l("".slice),h=function(e){return d(u(e),8,-1)},p=t,m=h,_=Object,f=c("".split),g=p((function(){return!_("z").propertyIsEnumerable(0)}))?function(e){return"String"==m(e)?f(e,""):_(e)}:_,T=function(e){return null==e},v=T,S=TypeError,y=function(e){if(v(e))throw S("Can't call method on "+e);return e},E=g,I=y,R=function(e){return E(I(e))},C=function(e){return e&&e.Math==Math&&e},A=C("object"==typeof globalThis&&globalThis)||C("object"==typeof window&&window)||C("object"==typeof self&&self)||C("object"==typeof e&&e)||function(){return this}()||Function("return this")(),b={},k={get exports(){return b},set exports(e){b=e}},D=A,w=Object.defineProperty,O=function(e,t){try{w(D,e,{value:t,configurable:!0,writable:!0})}catch(i){D[e]=t}return t},N=O,P="__core-js_shared__",M=A[P]||N(P,{}),L=M;(k.exports=function(e,t){return L[e]||(L[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.30.0",mode:"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.0/LICENSE",source:"https://github.com/zloirock/core-js"});var V,x,U=y,F=Object,B=function(e){return F(U(e))},H=B,j=c({}.hasOwnProperty),W=Object.hasOwn||function(e,t){return j(H(e),t)},G=c,J=0,K=Math.random(),Q=G(1..toString),z=function(e){return"Symbol("+(void 0===e?"":e)+")_"+Q(++J+K,36)},Y="undefined"!=typeof navigator&&String(navigator.userAgent)||"",q=A,X=Y,$=q.process,Z=q.Deno,ee=$&&$.versions||Z&&Z.version,te=ee&&ee.v8;te&&(x=(V=te.split("."))[0]>0&&V[0]<4?1:+(V[0]+V[1])),!x&&X&&(!(V=X.match(/Edge\/(\d+)/))||V[1]>=74)&&(V=X.match(/Chrome\/(\d+)/))&&(x=+V[1]);var ie=x,re=ie,ne=t,oe=!!Object.getOwnPropertySymbols&&!ne((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&re&&re<41})),se=oe&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ae=b,ce=W,le=z,ue=oe,de=se,he=A.Symbol,pe=ae("wks"),me=de?he.for||he:he&&he.withoutSetter||le,_e=function(e){return ce(pe,e)||(pe[e]=ue&&ce(he,e)?he[e]:me("Symbol."+e)),pe[e]},fe="object"==typeof document&&document.all,ge={all:fe,IS_HTMLDDA:void 0===fe&&void 0!==fe},Te=ge.all,ve=ge.IS_HTMLDDA?function(e){return"function"==typeof e||e===Te}:function(e){return"function"==typeof e},Se=ve,ye=ge.all,Ee=ge.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:Se(e)||e===ye}:function(e){return"object"==typeof e?null!==e:Se(e)},Ie=Ee,Re=String,Ce=TypeError,Ae=function(e){if(Ie(e))return e;throw Ce(Re(e)+" is not an object")},be={},ke=!t((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),De=ke&&t((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),we={},Oe=Ee,Ne=A.document,Pe=Oe(Ne)&&Oe(Ne.createElement),Me=function(e){return Pe?Ne.createElement(e):{}},Le=Me,Ve=!ke&&!t((function(){return 7!=Object.defineProperty(Le("div"),"a",{get:function(){return 7}}).a})),xe=r,Ue=Function.prototype.call,Fe=xe?Ue.bind(Ue):function(){return Ue.apply(Ue,arguments)},Be=A,He=ve,je=function(e,t){return arguments.length<2?(i=Be[e],He(i)?i:void 0):Be[e]&&Be[e][t];var i},We=c({}.isPrototypeOf),Ge=je,Je=ve,Ke=We,Qe=Object,ze=se?function(e){return"symbol"==typeof e}:function(e){var t=Ge("Symbol");return Je(t)&&Ke(t.prototype,Qe(e))},Ye=String,qe=function(e){try{return Ye(e)}catch(e){return"Object"}},Xe=ve,$e=qe,Ze=TypeError,et=function(e){if(Xe(e))return e;throw Ze($e(e)+" is not a function")},tt=et,it=T,rt=function(e,t){var i=e[t];return it(i)?void 0:tt(i)},nt=Fe,ot=ve,st=Ee,at=TypeError,ct=Fe,lt=Ee,ut=ze,dt=rt,ht=TypeError,pt=_e("toPrimitive"),mt=function(e,t){if(!lt(e)||ut(e))return e;var i,r=dt(e,pt);if(r){if(void 0===t&&(t="default"),i=ct(r,e,t),!lt(i)||ut(i))return i;throw ht("Can't convert object to primitive value")}return void 0===t&&(t="number"),function(e,t){var i,r;if("string"===t&&ot(i=e.toString)&&!st(r=nt(i,e)))return r;if(ot(i=e.valueOf)&&!st(r=nt(i,e)))return r;if("string"!==t&&ot(i=e.toString)&&!st(r=nt(i,e)))return r;throw at("Can't convert object to primitive value")}(e,t)},_t=mt,ft=ze,gt=function(e){var t=_t(e,"string");return ft(t)?t:t+""},Tt=ke,vt=Ve,St=De,yt=Ae,Et=gt,It=TypeError,Rt=Object.defineProperty,Ct=Object.getOwnPropertyDescriptor,At="enumerable",bt="configurable",kt="writable";we.f=Tt?St?function(e,t,i){if(yt(e),t=Et(t),yt(i),"function"==typeof e&&"prototype"===t&&"value"in i&&kt in i&&!i[kt]){var r=Ct(e,t);r&&r[kt]&&(e[t]=i.value,i={configurable:bt in i?i[bt]:r[bt],enumerable:At in i?i[At]:r[At],writable:!1})}return Rt(e,t,i)}:Rt:function(e,t,i){if(yt(e),t=Et(t),yt(i),vt)try{return Rt(e,t,i)}catch(e){}if("get"in i||"set"in i)throw It("Accessors not supported");return"value"in i&&(e[t]=i.value),e};var Dt=Math.ceil,wt=Math.floor,Ot=Math.trunc||function(e){var t=+e;return(t>0?wt:Dt)(t)},Nt=Ot,Pt=function(e){var t=+e;return t!=t||0===t?0:Nt(t)},Mt=Pt,Lt=Math.max,Vt=Math.min,xt=function(e,t){var i=Mt(e);return i<0?Lt(i+t,0):Vt(i,t)},Ut=Pt,Ft=Math.min,Bt=function(e){return e>0?Ft(Ut(e),9007199254740991):0},Ht=Bt,jt=function(e){return Ht(e.length)},Wt=R,Gt=xt,Jt=jt,Kt=function(e){return function(t,i,r){var n,o=Wt(t),s=Jt(o),a=Gt(r,s);if(e&&i!=i){for(;s>a;)if((n=o[a++])!=n)return!0}else for(;s>a;a++)if((e||a in o)&&o[a]===i)return e||a||0;return!e&&-1}},Qt={includes:Kt(!0),indexOf:Kt(!1)},zt={},Yt=W,qt=R,Xt=Qt.indexOf,$t=zt,Zt=c([].push),ei=function(e,t){var i,r=qt(e),n=0,o=[];for(i in r)!Yt($t,i)&&Yt(r,i)&&Zt(o,i);for(;t.length>n;)Yt(r,i=t[n++])&&(~Xt(o,i)||Zt(o,i));return o},ti=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ii=ei,ri=ti,ni=Object.keys||function(e){return ii(e,ri)},oi=ke,si=De,ai=we,ci=Ae,li=R,ui=ni;be.f=oi&&!si?Object.defineProperties:function(e,t){ci(e);for(var i,r=li(t),n=ui(t),o=n.length,s=0;o>s;)ai.f(e,i=n[s++],r[i]);return e};var di,hi=je("document","documentElement"),pi=z,mi=b("keys"),_i=function(e){return mi[e]||(mi[e]=pi(e))},fi=Ae,gi=be,Ti=ti,vi=zt,Si=hi,yi=Me,Ei="prototype",Ii="script",Ri=_i("IE_PROTO"),Ci=function(){},Ai=function(e){return"<script>"+e+"</"+Ii+">"},bi=function(e){e.write(Ai("")),e.close();var t=e.parentWindow.Object;return e=null,t},ki=function(){try{di=new ActiveXObject("htmlfile")}catch(e){}var e,t;ki="undefined"!=typeof document?document.domain&&di?bi(di):("javascript:",(t=yi("iframe")).style.display="none",Si.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Ai("document.F=Object")),e.close(),e.F):bi(di);for(var i=Ti.length;i--;)delete ki[Ei][Ti[i]];return ki()};vi[Ri]=!0;var Di=Object.create||function(e,t){var i;return null!==e?(Ci[Ei]=fi(e),i=new Ci,Ci[Ei]=null,i[Ri]=e):i=ki(),void 0===t?i:gi.f(i,t)},wi=_e,Oi=Di,Ni=we.f,Pi=wi("unscopables"),Mi=Array.prototype;null==Mi[Pi]&&Ni(Mi,Pi,{configurable:!0,value:Oi(null)});var Li,Vi,xi,Ui=function(e){Mi[Pi][e]=!0},Fi={},Bi=ve,Hi=A.WeakMap,ji=Bi(Hi)&&/native code/.test(String(Hi)),Wi=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Gi=we,Ji=Wi,Ki=ke?function(e,t,i){return Gi.f(e,t,Ji(1,i))}:function(e,t,i){return e[t]=i,e},Qi=ji,zi=A,Yi=Ee,qi=Ki,Xi=W,$i=M,Zi=_i,er=zt,tr="Object already initialized",ir=zi.TypeError,rr=zi.WeakMap;if(Qi||$i.state){var nr=$i.state||($i.state=new rr);nr.get=nr.get,nr.has=nr.has,nr.set=nr.set,Li=function(e,t){if(nr.has(e))throw ir(tr);return t.facade=e,nr.set(e,t),t},Vi=function(e){return nr.get(e)||{}},xi=function(e){return nr.has(e)}}else{var or=Zi("state");er[or]=!0,Li=function(e,t){if(Xi(e,or))throw ir(tr);return t.facade=e,qi(e,or,t),t},Vi=function(e){return Xi(e,or)?e[or]:{}},xi=function(e){return Xi(e,or)}}var sr={set:Li,get:Vi,has:xi,enforce:function(e){return xi(e)?Vi(e):Li(e,{})},getterFor:function(e){return function(t){var i;if(!Yi(t)||(i=Vi(t)).type!==e)throw ir("Incompatible receiver, "+e+" required");return i}}},ar={},cr={},lr={}.propertyIsEnumerable,ur=Object.getOwnPropertyDescriptor,dr=ur&&!lr.call({1:2},1);cr.f=dr?function(e){var t=ur(this,e);return!!t&&t.enumerable}:lr;var hr=ke,pr=Fe,mr=cr,_r=Wi,fr=R,gr=gt,Tr=W,vr=Ve,Sr=Object.getOwnPropertyDescriptor;ar.f=hr?Sr:function(e,t){if(e=fr(e),t=gr(t),vr)try{return Sr(e,t)}catch(e){}if(Tr(e,t))return _r(!pr(mr.f,e,t),e[t])};var yr={},Er={get exports(){return yr},set exports(e){yr=e}},Ir=ke,Rr=W,Cr=Function.prototype,Ar=Ir&&Object.getOwnPropertyDescriptor,br=Rr(Cr,"name"),kr={EXISTS:br,PROPER:br&&"something"===function(){}.name,CONFIGURABLE:br&&(!Ir||Ir&&Ar(Cr,"name").configurable)},Dr=ve,wr=M,Or=c(Function.toString);Dr(wr.inspectSource)||(wr.inspectSource=function(e){return Or(e)});var Nr=wr.inspectSource,Pr=c,Mr=t,Lr=ve,Vr=W,xr=ke,Ur=kr.CONFIGURABLE,Fr=Nr,Br=sr.enforce,Hr=sr.get,jr=String,Wr=Object.defineProperty,Gr=Pr("".slice),Jr=Pr("".replace),Kr=Pr([].join),Qr=xr&&!Mr((function(){return 8!==Wr((function(){}),"length",{value:8}).length})),zr=String(String).split("String"),Yr=Er.exports=function(e,t,i){"Symbol("===Gr(jr(t),0,7)&&(t="["+Jr(jr(t),/^Symbol\(([^)]*)\)/,"$1")+"]"),i&&i.getter&&(t="get "+t),i&&i.setter&&(t="set "+t),(!Vr(e,"name")||Ur&&e.name!==t)&&(xr?Wr(e,"name",{value:t,configurable:!0}):e.name=t),Qr&&i&&Vr(i,"arity")&&e.length!==i.arity&&Wr(e,"length",{value:i.arity});try{i&&Vr(i,"constructor")&&i.constructor?xr&&Wr(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var r=Br(e);return Vr(r,"source")||(r.source=Kr(zr,"string"==typeof t?t:"")),e};Function.prototype.toString=Yr((function(){return Lr(this)&&Hr(this).source||Fr(this)}),"toString");var qr=ve,Xr=we,$r=yr,Zr=O,en=function(e,t,i,r){r||(r={});var n=r.enumerable,o=void 0!==r.name?r.name:t;if(qr(i)&&$r(i,o,r),r.global)n?e[t]=i:Zr(t,i);else{try{r.unsafe?e[t]&&(n=!0):delete e[t]}catch(e){}n?e[t]=i:Xr.f(e,t,{value:i,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return e},tn={},rn=ei,nn=ti.concat("length","prototype");tn.f=Object.getOwnPropertyNames||function(e){return rn(e,nn)};var on={};on.f=Object.getOwnPropertySymbols;var sn,an,cn,ln=je,un=tn,dn=on,hn=Ae,pn=c([].concat),mn=ln("Reflect","ownKeys")||function(e){var t=un.f(hn(e)),i=dn.f;return i?pn(t,i(e)):t},_n=W,fn=mn,gn=ar,Tn=we,vn=function(e,t,i){for(var r=fn(t),n=Tn.f,o=gn.f,s=0;s<r.length;s++){var a=r[s];_n(e,a)||i&&_n(i,a)||n(e,a,o(t,a))}},Sn=t,yn=ve,En=/#|\.prototype\./,In=function(e,t){var i=Cn[Rn(e)];return i==bn||i!=An&&(yn(t)?Sn(t):!!t)},Rn=In.normalize=function(e){return String(e).replace(En,".").toLowerCase()},Cn=In.data={},An=In.NATIVE="N",bn=In.POLYFILL="P",kn=In,Dn=A,wn=ar.f,On=Ki,Nn=en,Pn=O,Mn=vn,Ln=kn,Vn=function(e,t){var i,r,n,o,s,a=e.target,c=e.global,l=e.stat;if(i=c?Dn:l?Dn[a]||Pn(a,{}):(Dn[a]||{}).prototype)for(r in t){if(o=t[r],n=e.dontCallGetSet?(s=wn(i,r))&&s.value:i[r],!Ln(c?r:a+(l?".":"#")+r,e.forced)&&void 0!==n){if(typeof o==typeof n)continue;Mn(o,n)}(e.sham||n&&n.sham)&&On(o,"sham",!0),Nn(i,r,o,e)}},xn=!t((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Un=W,Fn=ve,Bn=B,Hn=xn,jn=_i("IE_PROTO"),Wn=Object,Gn=Wn.prototype,Jn=Hn?Wn.getPrototypeOf:function(e){var t=Bn(e);if(Un(t,jn))return t[jn];var i=t.constructor;return Fn(i)&&t instanceof i?i.prototype:t instanceof Wn?Gn:null},Kn=t,Qn=ve,zn=Ee,Yn=Jn,qn=en,Xn=_e("iterator"),$n=!1;[].keys&&("next"in(cn=[].keys())?(an=Yn(Yn(cn)))!==Object.prototype&&(sn=an):$n=!0);var Zn=!zn(sn)||Kn((function(){var e={};return sn[Xn].call(e)!==e}));Zn&&(sn={}),Qn(sn[Xn])||qn(sn,Xn,(function(){return this}));var eo={IteratorPrototype:sn,BUGGY_SAFARI_ITERATORS:$n},to=we.f,io=W,ro=_e("toStringTag"),no=function(e,t,i){e&&!i&&(e=e.prototype),e&&!io(e,ro)&&to(e,ro,{configurable:!0,value:t})},oo=eo.IteratorPrototype,so=Di,ao=Wi,co=no,lo=Fi,uo=function(){return this},ho=function(e,t,i,r){var n=t+" Iterator";return e.prototype=so(oo,{next:ao(+!r,i)}),co(e,n,!1),lo[n]=uo,e},po=c,mo=et,_o=ve,fo=String,go=TypeError,To=Ae,vo=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,i={};try{(e=function(e,t,i){try{return po(mo(Object.getOwnPropertyDescriptor(e,t)[i]))}catch(e){}}(Object.prototype,"__proto__","set"))(i,[]),t=i instanceof Array}catch(e){}return function(i,r){return To(i),function(e){if("object"==typeof e||_o(e))return e;throw go("Can't set "+fo(e)+" as a prototype")}(r),t?e(i,r):i.__proto__=r,i}}():void 0),So=Vn,yo=Fe,Eo=ve,Io=ho,Ro=Jn,Co=vo,Ao=no,bo=Ki,ko=en,Do=Fi,wo=kr.PROPER,Oo=kr.CONFIGURABLE,No=eo.IteratorPrototype,Po=eo.BUGGY_SAFARI_ITERATORS,Mo=_e("iterator"),Lo="keys",Vo="values",xo="entries",Uo=function(){return this},Fo=function(e,t,i,r,n,o,s){Io(i,t,r);var a,c,l,u=function(e){if(e===n&&_)return _;if(!Po&&e in p)return p[e];switch(e){case Lo:case Vo:case xo:return function(){return new i(this,e)}}return function(){return new i(this)}},d=t+" Iterator",h=!1,p=e.prototype,m=p[Mo]||p["@@iterator"]||n&&p[n],_=!Po&&m||u(n),f="Array"==t&&p.entries||m;if(f&&(a=Ro(f.call(new e)))!==Object.prototype&&a.next&&(Ro(a)!==No&&(Co?Co(a,No):Eo(a[Mo])||ko(a,Mo,Uo)),Ao(a,d,!0)),wo&&n==Vo&&m&&m.name!==Vo&&(Oo?bo(p,"name",Vo):(h=!0,_=function(){return yo(m,this)})),n)if(c={values:u(Vo),keys:o?_:u(Lo),entries:u(xo)},s)for(l in c)(Po||h||!(l in p))&&ko(p,l,c[l]);else So({target:t,proto:!0,forced:Po||h},c);return p[Mo]!==_&&ko(p,Mo,_,{name:n}),Do[t]=_,c},Bo=function(e,t){return{value:e,done:t}},Ho=R,jo=Ui,Wo=Fi,Go=sr,Jo=we.f,Ko=Fo,Qo=Bo,zo=ke,Yo="Array Iterator",qo=Go.set,Xo=Go.getterFor(Yo),$o=Ko(Array,"Array",(function(e,t){qo(this,{type:Yo,target:Ho(e),index:0,kind:t})}),(function(){var e=Xo(this),t=e.target,i=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,Qo(void 0,!0)):Qo("keys"==i?r:"values"==i?t[r]:[r,t[r]],!1)}),"values"),Zo=Wo.Arguments=Wo.Array;if(jo("keys"),jo("values"),jo("entries"),zo&&"values"!==Zo.name)try{Jo(Zo,"name",{value:"values"})}catch(e){}var es={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},ts=Me("span").classList,is=ts&&ts.constructor&&ts.constructor.prototype,rs=is===Object.prototype?void 0:is,ns=A,os=es,ss=rs,as=$o,cs=Ki,ls=_e,us=ls("iterator"),ds=ls("toStringTag"),hs=as.values,ps=function(e,t){if(e){if(e[us]!==hs)try{cs(e,us,hs)}catch(t){e[us]=hs}if(e[ds]||cs(e,ds,t),os[t])for(var i in as)if(e[i]!==as[i])try{cs(e,i,as[i])}catch(t){e[i]=as[i]}}};for(var ms in os)ps(ns[ms]&&ns[ms].prototype,ms);ps(ss,"DOMTokenList");var _s="undefined"!=typeof process&&"process"==h(process),fs=yr,gs=we,Ts=function(e,t,i){return i.get&&fs(i.get,t,{getter:!0}),i.set&&fs(i.set,t,{setter:!0}),gs.f(e,t,i)},vs=je,Ss=Ts,ys=ke,Es=_e("species"),Is=function(e){var t=vs(e);ys&&t&&!t[Es]&&Ss(t,Es,{configurable:!0,get:function(){return this}})},Rs=We,Cs=TypeError,As=function(e,t){if(Rs(t,e))return e;throw Cs("Incorrect invocation")},bs={};bs[_e("toStringTag")]="z";var ks="[object z]"===String(bs),Ds=ve,ws=h,Os=_e("toStringTag"),Ns=Object,Ps="Arguments"==ws(function(){return arguments}()),Ms=ks?ws:function(e){var t,i,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=Ns(e),Os))?i:Ps?ws(t):"Object"==(r=ws(t))&&Ds(t.callee)?"Arguments":r},Ls=c,Vs=t,xs=ve,Us=Ms,Fs=Nr,Bs=function(){},Hs=[],js=je("Reflect","construct"),Ws=/^\s*(?:class|function)\b/,Gs=Ls(Ws.exec),Js=!Ws.exec(Bs),Ks=function(e){if(!xs(e))return!1;try{return js(Bs,Hs,e),!0}catch(e){return!1}},Qs=function(e){if(!xs(e))return!1;switch(Us(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Js||!!Gs(Ws,Fs(e))}catch(e){return!0}};Qs.sham=!0;var zs,Ys,qs,Xs,$s=!js||Vs((function(){var e;return Ks(Ks.call)||!Ks(Object)||!Ks((function(){e=!0}))||e}))?Qs:Ks,Zs=$s,ea=qe,ta=TypeError,ia=function(e){if(Zs(e))return e;throw ta(ea(e)+" is not a constructor")},ra=Ae,na=ia,oa=T,sa=_e("species"),aa=function(e,t){var i,r=ra(e).constructor;return void 0===r||oa(i=ra(r)[sa])?t:na(i)},ca=r,la=Function.prototype,ua=la.apply,da=la.call,ha="object"==typeof Reflect&&Reflect.apply||(ca?da.bind(ua):function(){return da.apply(ua,arguments)}),pa=h,ma=c,_a=function(e){if("Function"===pa(e))return ma(e)},fa=et,ga=r,Ta=_a(_a.bind),va=function(e,t){return fa(e),void 0===t?e:ga?Ta(e,t):function(){return e.apply(t,arguments)}},Sa=c([].slice),ya=TypeError,Ea=function(e,t){if(e<t)throw ya("Not enough arguments");return e},Ia=/(?:ipad|iphone|ipod).*applewebkit/i.test(Y),Ra=A,Ca=ha,Aa=va,ba=ve,ka=W,Da=t,wa=hi,Oa=Sa,Na=Me,Pa=Ea,Ma=Ia,La=_s,Va=Ra.setImmediate,xa=Ra.clearImmediate,Ua=Ra.process,Fa=Ra.Dispatch,Ba=Ra.Function,Ha=Ra.MessageChannel,ja=Ra.String,Wa=0,Ga={},Ja="onreadystatechange";Da((function(){zs=Ra.location}));var Ka=function(e){if(ka(Ga,e)){var t=Ga[e];delete Ga[e],t()}},Qa=function(e){return function(){Ka(e)}},za=function(e){Ka(e.data)},Ya=function(e){Ra.postMessage(ja(e),zs.protocol+"//"+zs.host)};Va&&xa||(Va=function(e){Pa(arguments.length,1);var t=ba(e)?e:Ba(e),i=Oa(arguments,1);return Ga[++Wa]=function(){Ca(t,void 0,i)},Ys(Wa),Wa},xa=function(e){delete Ga[e]},La?Ys=function(e){Ua.nextTick(Qa(e))}:Fa&&Fa.now?Ys=function(e){Fa.now(Qa(e))}:Ha&&!Ma?(Xs=(qs=new Ha).port2,qs.port1.onmessage=za,Ys=Aa(Xs.postMessage,Xs)):Ra.addEventListener&&ba(Ra.postMessage)&&!Ra.importScripts&&zs&&"file:"!==zs.protocol&&!Da(Ya)?(Ys=Ya,Ra.addEventListener("message",za,!1)):Ys=Ja in Na("script")?function(e){wa.appendChild(Na("script"))[Ja]=function(){wa.removeChild(this),Ka(e)}}:function(e){setTimeout(Qa(e),0)});var qa={set:Va,clear:xa},Xa=function(){this.head=null,this.tail=null};Xa.prototype={add:function(e){var t={item:e,next:null},i=this.tail;i?i.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return null===(this.head=e.next)&&(this.tail=null),e.item}};var $a,Za,ec,tc,ic,rc=Xa,nc=/ipad|iphone|ipod/i.test(Y)&&"undefined"!=typeof Pebble,oc=/web0s(?!.*chrome)/i.test(Y),sc=A,ac=va,cc=ar.f,lc=qa.set,uc=rc,dc=Ia,hc=nc,pc=oc,mc=_s,_c=sc.MutationObserver||sc.WebKitMutationObserver,fc=sc.document,gc=sc.process,Tc=sc.Promise,vc=cc(sc,"queueMicrotask"),Sc=vc&&vc.value;if(!Sc){var yc=new uc,Ec=function(){var e,t;for(mc&&(e=gc.domain)&&e.exit();t=yc.get();)try{t()}catch(e){throw yc.head&&$a(),e}e&&e.enter()};dc||mc||pc||!_c||!fc?!hc&&Tc&&Tc.resolve?((tc=Tc.resolve(void 0)).constructor=Tc,ic=ac(tc.then,tc),$a=function(){ic(Ec)}):mc?$a=function(){gc.nextTick(Ec)}:(lc=ac(lc,sc),$a=function(){lc(Ec)}):(Za=!0,ec=fc.createTextNode(""),new _c(Ec).observe(ec,{characterData:!0}),$a=function(){ec.data=Za=!Za}),Sc=function(e){yc.head||$a(),yc.add(e)}}var Ic=Sc,Rc=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},Cc=A.Promise,Ac="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,bc=!Ac&&!_s&&"object"==typeof window&&"object"==typeof document,kc=A,Dc=Cc,wc=ve,Oc=kn,Nc=Nr,Pc=_e,Mc=bc,Lc=Ac,Vc=ie;Dc&&Dc.prototype;var xc=Pc("species"),Uc=!1,Fc=wc(kc.PromiseRejectionEvent),Bc=Oc("Promise",(function(){var e=Nc(Dc),t=e!==String(Dc);if(!t&&66===Vc)return!0;if(!Vc||Vc<51||!/native code/.test(e)){var i=new Dc((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};if((i.constructor={})[xc]=r,!(Uc=i.then((function(){}))instanceof r))return!0}return!t&&(Mc||Lc)&&!Fc})),Hc={CONSTRUCTOR:Bc,REJECTION_EVENT:Fc,SUBCLASSING:Uc},jc={},Wc=et,Gc=TypeError,Jc=function(e){var t,i;this.promise=new e((function(e,r){if(void 0!==t||void 0!==i)throw Gc("Bad Promise constructor");t=e,i=r})),this.resolve=Wc(t),this.reject=Wc(i)};jc.f=function(e){return new Jc(e)};var Kc,Qc,zc,Yc=Vn,qc=_s,Xc=A,$c=Fe,Zc=en,el=vo,tl=no,il=Is,rl=et,nl=ve,ol=Ee,sl=As,al=aa,cl=qa.set,ll=Ic,ul=Rc,dl=rc,hl=sr,pl=Cc,ml=jc,_l="Promise",fl=Hc.CONSTRUCTOR,gl=Hc.REJECTION_EVENT,Tl=Hc.SUBCLASSING,vl=hl.getterFor(_l),Sl=hl.set,yl=pl&&pl.prototype,El=pl,Il=yl,Rl=Xc.TypeError,Cl=Xc.document,Al=Xc.process,bl=ml.f,kl=bl,Dl=!!(Cl&&Cl.createEvent&&Xc.dispatchEvent),wl="unhandledrejection",Ol=function(e){var t;return!(!ol(e)||!nl(t=e.then))&&t},Nl=function(e,t){var i,r,n,o=t.value,s=1==t.state,a=s?e.ok:e.fail,c=e.resolve,l=e.reject,u=e.domain;try{a?(s||(2===t.rejection&&xl(t),t.rejection=1),!0===a?i=o:(u&&u.enter(),i=a(o),u&&(u.exit(),n=!0)),i===e.promise?l(Rl("Promise-chain cycle")):(r=Ol(i))?$c(r,i,c,l):c(i)):l(o)}catch(e){u&&!n&&u.exit(),l(e)}},Pl=function(e,t){e.notified||(e.notified=!0,ll((function(){for(var i,r=e.reactions;i=r.get();)Nl(i,e);e.notified=!1,t&&!e.rejection&&Ll(e)})))},Ml=function(e,t,i){var r,n;Dl?((r=Cl.createEvent("Event")).promise=t,r.reason=i,r.initEvent(e,!1,!0),Xc.dispatchEvent(r)):r={promise:t,reason:i},!gl&&(n=Xc["on"+e])?n(r):e===wl&&function(e,t){try{1==arguments.length?console.error(e):console.error(e,t)}catch(e){}}("Unhandled promise rejection",i)},Ll=function(e){$c(cl,Xc,(function(){var t,i=e.facade,r=e.value;if(Vl(e)&&(t=ul((function(){qc?Al.emit("unhandledRejection",r,i):Ml(wl,i,r)})),e.rejection=qc||Vl(e)?2:1,t.error))throw t.value}))},Vl=function(e){return 1!==e.rejection&&!e.parent},xl=function(e){$c(cl,Xc,(function(){var t=e.facade;qc?Al.emit("rejectionHandled",t):Ml("rejectionhandled",t,e.value)}))},Ul=function(e,t,i){return function(r){e(t,r,i)}},Fl=function(e,t,i){e.done||(e.done=!0,i&&(e=i),e.value=t,e.state=2,Pl(e,!0))},Bl=function(e,t,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===t)throw Rl("Promise can't be resolved itself");var r=Ol(t);r?ll((function(){var i={done:!1};try{$c(r,t,Ul(Bl,i,e),Ul(Fl,i,e))}catch(t){Fl(i,t,e)}})):(e.value=t,e.state=1,Pl(e,!1))}catch(t){Fl({done:!1},t,e)}}};if(fl&&(Il=(El=function(e){sl(this,Il),rl(e),$c(Kc,this);var t=vl(this);try{e(Ul(Bl,t),Ul(Fl,t))}catch(e){Fl(t,e)}}).prototype,(Kc=function(e){Sl(this,{type:_l,done:!1,notified:!1,parent:!1,reactions:new dl,rejection:!1,state:0,value:void 0})}).prototype=Zc(Il,"then",(function(e,t){var i=vl(this),r=bl(al(this,El));return i.parent=!0,r.ok=!nl(e)||e,r.fail=nl(t)&&t,r.domain=qc?Al.domain:void 0,0==i.state?i.reactions.add(r):ll((function(){Nl(r,i)})),r.promise})),Qc=function(){var e=new Kc,t=vl(e);this.promise=e,this.resolve=Ul(Bl,t),this.reject=Ul(Fl,t)},ml.f=bl=function(e){return e===El||void 0===e?new Qc(e):kl(e)},nl(pl)&&yl!==Object.prototype)){zc=yl.then,Tl||Zc(yl,"then",(function(e,t){var i=this;return new El((function(e,t){$c(zc,i,e,t)})).then(e,t)}),{unsafe:!0});try{delete yl.constructor}catch(e){}el&&el(yl,Il)}Yc({global:!0,constructor:!0,wrap:!0,forced:fl},{Promise:El}),tl(El,_l,!1),il(_l);var Hl=Fi,jl=_e("iterator"),Wl=Array.prototype,Gl=function(e){return void 0!==e&&(Hl.Array===e||Wl[jl]===e)},Jl=Ms,Kl=rt,Ql=T,zl=Fi,Yl=_e("iterator"),ql=function(e){if(!Ql(e))return Kl(e,Yl)||Kl(e,"@@iterator")||zl[Jl(e)]},Xl=Fe,$l=et,Zl=Ae,eu=qe,tu=ql,iu=TypeError,ru=function(e,t){var i=arguments.length<2?tu(e):t;if($l(i))return Zl(Xl(i,e));throw iu(eu(e)+" is not iterable")},nu=Fe,ou=Ae,su=rt,au=function(e,t,i){var r,n;ou(e);try{if(!(r=su(e,"return"))){if("throw"===t)throw i;return i}r=nu(r,e)}catch(e){n=!0,r=e}if("throw"===t)throw i;if(n)throw r;return ou(r),i},cu=va,lu=Fe,uu=Ae,du=qe,hu=Gl,pu=jt,mu=We,_u=ru,fu=ql,gu=au,Tu=TypeError,vu=function(e,t){this.stopped=e,this.result=t},Su=vu.prototype,yu=function(e,t,i){var r,n,o,s,a,c,l,u=i&&i.that,d=!(!i||!i.AS_ENTRIES),h=!(!i||!i.IS_RECORD),p=!(!i||!i.IS_ITERATOR),m=!(!i||!i.INTERRUPTED),_=cu(t,u),f=function(e){return r&&gu(r,"normal",e),new vu(!0,e)},g=function(e){return d?(uu(e),m?_(e[0],e[1],f):_(e[0],e[1])):m?_(e,f):_(e)};if(h)r=e.iterator;else if(p)r=e;else{if(!(n=fu(e)))throw Tu(du(e)+" is not iterable");if(hu(n)){for(o=0,s=pu(e);s>o;o++)if((a=g(e[o]))&&mu(Su,a))return a;return new vu(!1)}r=_u(e,n)}for(c=h?e.next:r.next;!(l=lu(c,r)).done;){try{a=g(l.value)}catch(e){gu(r,"throw",e)}if("object"==typeof a&&a&&mu(Su,a))return a}return new vu(!1)},Eu=_e("iterator"),Iu=!1;try{var Ru=0,Cu={next:function(){return{done:!!Ru++}},return:function(){Iu=!0}};Cu[Eu]=function(){return this},Array.from(Cu,(function(){throw 2}))}catch(e){}var Au=function(e,t){if(!t&&!Iu)return!1;var i=!1;try{var r={};r[Eu]=function(){return{next:function(){return{done:i=!0}}}},e(r)}catch(e){}return i},bu=Cc,ku=Hc.CONSTRUCTOR||!Au((function(e){bu.all(e).then(void 0,(function(){}))})),Du=Fe,wu=et,Ou=jc,Nu=Rc,Pu=yu;Vn({target:"Promise",stat:!0,forced:ku},{all:function(e){var t=this,i=Ou.f(t),r=i.resolve,n=i.reject,o=Nu((function(){var i=wu(t.resolve),o=[],s=0,a=1;Pu(e,(function(e){var c=s++,l=!1;a++,Du(i,t,e).then((function(e){l||(l=!0,o[c]=e,--a||r(o))}),n)})),--a||r(o)}));return o.error&&n(o.value),i.promise}});var Mu=Vn,Lu=Hc.CONSTRUCTOR,Vu=Cc,xu=je,Uu=ve,Fu=en,Bu=Vu&&Vu.prototype;if(Mu({target:"Promise",proto:!0,forced:Lu,real:!0},{catch:function(e){return this.then(void 0,e)}}),Uu(Vu)){var Hu=xu("Promise").prototype.catch;Bu.catch!==Hu&&Fu(Bu,"catch",Hu,{unsafe:!0})}var ju=Fe,Wu=et,Gu=jc,Ju=Rc,Ku=yu;Vn({target:"Promise",stat:!0,forced:ku},{race:function(e){var t=this,i=Gu.f(t),r=i.reject,n=Ju((function(){var n=Wu(t.resolve);Ku(e,(function(e){ju(n,t,e).then(i.resolve,r)}))}));return n.error&&r(n.value),i.promise}});var Qu=Fe,zu=jc;Vn({target:"Promise",stat:!0,forced:Hc.CONSTRUCTOR},{reject:function(e){var t=zu.f(this);return Qu(t.reject,void 0,e),t.promise}});var Yu=Ae,qu=Ee,Xu=jc,$u=function(e,t){if(Yu(e),qu(t)&&t.constructor===e)return t;var i=Xu.f(e);return(0,i.resolve)(t),i.promise},Zu=Vn,ed=Hc.CONSTRUCTOR,td=$u;je("Promise"),Zu({target:"Promise",stat:!0,forced:ed},{resolve:function(e){return td(this,e)}});var id=ve,rd=Ee,nd=vo,od=function(e,t,i){var r,n;return nd&&id(r=t.constructor)&&r!==i&&rd(n=r.prototype)&&n!==i.prototype&&nd(e,n),e},sd=Ee,ad=h,cd=_e("match"),ld=function(e){var t;return sd(e)&&(void 0!==(t=e[cd])?!!t:"RegExp"==ad(e))},ud=Ms,dd=String,hd=function(e){if("Symbol"===ud(e))throw TypeError("Cannot convert a Symbol value to a string");return dd(e)},pd=Ae,md=function(){var e=pd(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},_d=Fe,fd=W,gd=We,Td=md,vd=RegExp.prototype,Sd=function(e){var t=e.flags;return void 0!==t||"flags"in vd||fd(e,"flags")||!gd(vd,e)?t:_d(Td,e)},yd=t,Ed=A.RegExp,Id=yd((function(){var e=Ed("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),Rd=Id||yd((function(){return!Ed("a","y").sticky})),Cd=Id||yd((function(){var e=Ed("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),Ad={BROKEN_CARET:Cd,MISSED_STICKY:Rd,UNSUPPORTED_Y:Id},bd=we.f,kd=t,Dd=A.RegExp,wd=kd((function(){var e=Dd(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),Od=t,Nd=A.RegExp,Pd=Od((function(){var e=Nd("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),Md=ke,Ld=A,Vd=c,xd=kn,Ud=od,Fd=Ki,Bd=tn.f,Hd=We,jd=ld,Wd=hd,Gd=Sd,Jd=Ad,Kd=function(e,t,i){i in e||bd(e,i,{configurable:!0,get:function(){return t[i]},set:function(e){t[i]=e}})},Qd=en,zd=t,Yd=W,qd=sr.enforce,Xd=Is,$d=wd,Zd=Pd,eh=_e("match"),th=Ld.RegExp,ih=th.prototype,rh=Ld.SyntaxError,nh=Vd(ih.exec),oh=Vd("".charAt),sh=Vd("".replace),ah=Vd("".indexOf),ch=Vd("".slice),lh=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,uh=/a/g,dh=/a/g,hh=new th(uh)!==uh,ph=Jd.MISSED_STICKY,mh=Jd.UNSUPPORTED_Y;if(xd("RegExp",Md&&(!hh||ph||$d||Zd||zd((function(){return dh[eh]=!1,th(uh)!=uh||th(dh)==dh||"/a/i"!=th(uh,"i")}))))){for(var _h=function(e,t){var i,r,n,o,s,a,c=Hd(ih,this),l=jd(e),u=void 0===t,d=[],h=e;if(!c&&l&&u&&e.constructor===_h)return e;if((l||Hd(ih,e))&&(e=e.source,u&&(t=Gd(h))),e=void 0===e?"":Wd(e),t=void 0===t?"":Wd(t),h=e,$d&&"dotAll"in uh&&(r=!!t&&ah(t,"s")>-1)&&(t=sh(t,/s/g,"")),i=t,ph&&"sticky"in uh&&(n=!!t&&ah(t,"y")>-1)&&mh&&(t=sh(t,/y/g,"")),Zd&&(o=function(e){for(var t,i=e.length,r=0,n="",o=[],s={},a=!1,c=!1,l=0,u="";r<=i;r++){if("\\"===(t=oh(e,r)))t+=oh(e,++r);else if("]"===t)a=!1;else if(!a)switch(!0){case"["===t:a=!0;break;case"("===t:nh(lh,ch(e,r+1))&&(r+=2,c=!0),n+=t,l++;continue;case">"===t&&c:if(""===u||Yd(s,u))throw new rh("Invalid capture group name");s[u]=!0,o[o.length]=[u,l],c=!1,u="";continue}c?u+=t:n+=t}return[n,o]}(e),e=o[0],d=o[1]),s=Ud(th(e,t),c?this:ih,_h),(r||n||d.length)&&(a=qd(s),r&&(a.dotAll=!0,a.raw=_h(function(e){for(var t,i=e.length,r=0,n="",o=!1;r<=i;r++)"\\"!==(t=oh(e,r))?o||"."!==t?("["===t?o=!0:"]"===t&&(o=!1),n+=t):n+="[\\s\\S]":n+=t+oh(e,++r);return n}(e),i)),n&&(a.sticky=!0),d.length&&(a.groups=d)),e!==h)try{Fd(s,"source",""===h?"(?:)":h)}catch(e){}return s},fh=Bd(th),gh=0;fh.length>gh;)Kd(_h,th,fh[gh++]);ih.constructor=_h,_h.prototype=ih,Qd(Ld,"RegExp",_h,{constructor:!0})}Xd("RegExp");var Th=Fe,vh=c,Sh=hd,yh=md,Eh=Ad,Ih=Di,Rh=sr.get,Ch=wd,Ah=Pd,bh=b("native-string-replace",String.prototype.replace),kh=RegExp.prototype.exec,Dh=kh,wh=vh("".charAt),Oh=vh("".indexOf),Nh=vh("".replace),Ph=vh("".slice),Mh=function(){var e=/a/,t=/b*/g;return Th(kh,e,"a"),Th(kh,t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),Lh=Eh.BROKEN_CARET,Vh=void 0!==/()??/.exec("")[1];(Mh||Vh||Lh||Ch||Ah)&&(Dh=function(e){var t,i,r,n,o,s,a,c=this,l=Rh(c),u=Sh(e),d=l.raw;if(d)return d.lastIndex=c.lastIndex,t=Th(Dh,d,u),c.lastIndex=d.lastIndex,t;var h=l.groups,p=Lh&&c.sticky,m=Th(yh,c),_=c.source,f=0,g=u;if(p&&(m=Nh(m,"y",""),-1===Oh(m,"g")&&(m+="g"),g=Ph(u,c.lastIndex),c.lastIndex>0&&(!c.multiline||c.multiline&&"\n"!==wh(u,c.lastIndex-1))&&(_="(?: "+_+")",g=" "+g,f++),i=new RegExp("^(?:"+_+")",m)),Vh&&(i=new RegExp("^"+_+"$(?!\\s)",m)),Mh&&(r=c.lastIndex),n=Th(kh,p?i:c,g),p?n?(n.input=Ph(n.input,f),n[0]=Ph(n[0],f),n.index=c.lastIndex,c.lastIndex+=n[0].length):c.lastIndex=0:Mh&&n&&(c.lastIndex=c.global?n.index+n[0].length:r),Vh&&n&&n.length>1&&Th(bh,n[0],i,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(n[o]=void 0)})),n&&h)for(n.groups=s=Ih(null),o=0;o<h.length;o++)s[(a=h[o])[0]]=n[a[1]];return n});var xh=Dh;Vn({target:"RegExp",proto:!0,forced:/./.exec!==xh},{exec:xh});var Uh=h,Fh=Array.isArray||function(e){return"Array"==Uh(e)},Bh=Fh,Hh=$s,jh=Ee,Wh=_e("species"),Gh=Array,Jh=va,Kh=g,Qh=B,zh=jt,Yh=function(e,t){return new(function(e){var t;return Bh(e)&&(t=e.constructor,(Hh(t)&&(t===Gh||Bh(t.prototype))||jh(t)&&null===(t=t[Wh]))&&(t=void 0)),void 0===t?Gh:t}(e))(0===t?0:t)},qh=c([].push),Xh=function(e){var t=1==e,i=2==e,r=3==e,n=4==e,o=6==e,s=7==e,a=5==e||o;return function(c,l,u,d){for(var h,p,m=Qh(c),_=Kh(m),f=Jh(l,u),g=zh(_),T=0,v=d||Yh,S=t?v(c,g):i||s?v(c,0):void 0;g>T;T++)if((a||T in _)&&(p=f(h=_[T],T,m),e))if(t)S[T]=p;else if(p)switch(e){case 3:return!0;case 5:return h;case 6:return T;case 2:qh(S,h)}else switch(e){case 4:return!1;case 7:qh(S,h)}return o?-1:r||n?n:S}},$h={forEach:Xh(0),map:Xh(1),filter:Xh(2),some:Xh(3),every:Xh(4),find:Xh(5),findIndex:Xh(6),filterReject:Xh(7)},Zh=t,ep=function(e,t){var i=[][e];return!!i&&Zh((function(){i.call(null,t||function(){return 1},1)}))},tp=$h.forEach,ip=ep("forEach")?[].forEach:function(e){return tp(this,e,arguments.length>1?arguments[1]:void 0)},rp=A,np=es,op=rs,sp=ip,ap=Ki,cp=function(e){if(e&&e.forEach!==sp)try{ap(e,"forEach",sp)}catch(t){e.forEach=sp}};for(var lp in np)np[lp]&&cp(rp[lp]&&rp[lp].prototype);cp(op);var up=et,dp=B,hp=g,pp=jt,mp=TypeError,_p=function(e){return function(t,i,r,n){up(i);var o=dp(t),s=hp(o),a=pp(o),c=e?a-1:0,l=e?-1:1;if(r<2)for(;;){if(c in s){n=s[c],c+=l;break}if(c+=l,e?c<0:a<=c)throw mp("Reduce of empty array with no initial value")}for(;e?c>=0:a>c;c+=l)c in s&&(n=i(n,s[c],c,o));return n}},fp=[_p(!1),_p(!0)][0];Vn({target:"Array",proto:!0,forced:!_s&&ie>79&&ie<83||!ep("reduce")},{reduce:function(e){var t=arguments.length;return fp(this,e,t,t>1?arguments[1]:void 0)}});var gp=_a,Tp=en,vp=xh,Sp=t,yp=_e,Ep=Ki,Ip=yp("species"),Rp=RegExp.prototype,Cp=c,Ap=Pt,bp=hd,kp=y,Dp=Cp("".charAt),wp=Cp("".charCodeAt),Op=Cp("".slice),Np=function(e){return function(t,i){var r,n,o=bp(kp(t)),s=Ap(i),a=o.length;return s<0||s>=a?e?"":void 0:(r=wp(o,s))<55296||r>56319||s+1===a||(n=wp(o,s+1))<56320||n>57343?e?Dp(o,s):r:e?Op(o,s,s+2):n-56320+(r-55296<<10)+65536}},Pp={codeAt:Np(!1),charAt:Np(!0)},Mp=Pp.charAt,Lp=c,Vp=B,xp=Math.floor,Up=Lp("".charAt),Fp=Lp("".replace),Bp=Lp("".slice),Hp=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,jp=/\$([$&'`]|\d{1,2})/g,Wp=function(e,t,i,r,n,o){var s=i+e.length,a=r.length,c=jp;return void 0!==n&&(n=Vp(n),c=Hp),Fp(o,c,(function(o,c){var l;switch(Up(c,0)){case"$":return"$";case"&":return e;case"`":return Bp(t,0,i);case"'":return Bp(t,s);case"<":l=n[Bp(c,1,-1)];break;default:var u=+c;if(0===u)return o;if(u>a){var d=xp(u/10);return 0===d?o:d<=a?void 0===r[d-1]?Up(c,1):r[d-1]+Up(c,1):o}l=r[u-1]}return void 0===l?"":l}))},Gp=Fe,Jp=Ae,Kp=ve,Qp=h,zp=xh,Yp=TypeError,qp=ha,Xp=Fe,$p=c,Zp=t,em=Ae,tm=ve,im=T,rm=Pt,nm=Bt,om=hd,sm=y,am=function(e,t,i){return t+(i?Mp(e,t).length:1)},cm=rt,lm=Wp,um=function(e,t){var i=e.exec;if(Kp(i)){var r=Gp(i,e,t);return null!==r&&Jp(r),r}if("RegExp"===Qp(e))return Gp(zp,e,t);throw Yp("RegExp#exec called on incompatible receiver")},dm=_e("replace"),hm=Math.max,pm=Math.min,mm=$p([].concat),_m=$p([].push),fm=$p("".indexOf),gm=$p("".slice),Tm=function(e){return void 0===e?e:String(e)},vm="$0"==="a".replace(/./,"$0"),Sm=!!/./[dm]&&""===/./[dm]("a","$0"),ym=!Zp((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}));!function(e,t,i,r){var n=yp(e),o=!Sp((function(){var t={};return t[n]=function(){return 7},7!=""[e](t)})),s=o&&!Sp((function(){var t=!1,i=/a/;return"split"===e&&((i={}).constructor={},i.constructor[Ip]=function(){return i},i.flags="",i[n]=/./[n]),i.exec=function(){return t=!0,null},i[n](""),!t}));if(!o||!s||i){var a=gp(/./[n]),c=t(n,""[e],(function(e,t,i,r,n){var s=gp(e),c=t.exec;return c===vp||c===Rp.exec?o&&!n?{done:!0,value:a(t,i,r)}:{done:!0,value:s(i,t,r)}:{done:!1}}));Tp(String.prototype,e,c[0]),Tp(Rp,n,c[1])}r&&Ep(Rp[n],"sham",!0)}("replace",(function(e,t,i){var r=Sm?"$":"$0";return[function(e,i){var r=sm(this),n=im(e)?void 0:cm(e,dm);return n?Xp(n,e,r,i):Xp(t,om(r),e,i)},function(e,n){var o=em(this),s=om(e);if("string"==typeof n&&-1===fm(n,r)&&-1===fm(n,"$<")){var a=i(t,o,s,n);if(a.done)return a.value}var c=tm(n);c||(n=om(n));var l=o.global;if(l){var u=o.unicode;o.lastIndex=0}for(var d=[];;){var h=um(o,s);if(null===h)break;if(_m(d,h),!l)break;""===om(h[0])&&(o.lastIndex=am(s,nm(o.lastIndex),u))}for(var p="",m=0,_=0;_<d.length;_++){for(var f=om((h=d[_])[0]),g=hm(pm(rm(h.index),s.length),0),T=[],v=1;v<h.length;v++)_m(T,Tm(h[v]));var S=h.groups;if(c){var y=mm([f],T,g,s);void 0!==S&&_m(y,S);var E=om(qp(n,void 0,y))}else E=lm(f,s,g,T,S,n);g>=m&&(p+=gm(s,m,g)+E,m=g+f.length)}return p+gm(s,m)}]}),!ym||!vm||Sm);var Em=Qt.includes,Im=Ui;Vn({target:"Array",proto:!0,forced:t((function(){return!Array(1).includes()}))},{includes:function(e){return Em(this,e,arguments.length>1?arguments[1]:void 0)}}),Im("includes");var Rm=Pt,Cm=hd,Am=y,bm=RangeError,km=c,Dm=Bt,wm=hd,Om=y,Nm=km((function(e){var t=Cm(Am(this)),i="",r=Rm(e);if(r<0||1/0==r)throw bm("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(t+=t))1&r&&(i+=t);return i})),Pm=km("".slice),Mm=Math.ceil,Lm=function(e){return function(t,i,r){var n,o,s=wm(Om(t)),a=Dm(i),c=s.length,l=void 0===r?" ":wm(r);return a<=c||""==l?s:((o=Nm(l,Mm((n=a-c)/l.length))).length>n&&(o=Pm(o,0,n)),e?s+o:o+s)}},Vm={start:Lm(!1),end:Lm(!0)},xm=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(Y),Um=Vm.start;Vn({target:"String",proto:!0,forced:xm},{padStart:function(e){return Um(this,e,arguments.length>1?arguments[1]:void 0)}});var Fm=t,Bm=ke,Hm=_e("iterator"),jm=!Fm((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,i="";return e.pathname="c%20d",t.forEach((function(e,r){t.delete("b"),i+=r+e})),!t.size&&!Bm||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[Hm]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==i||"x"!==new URL("http://x",void 0).host})),Wm=en,Gm=function(e,t,i){for(var r in t)Wm(e,r,t[r],i);return e},Jm=gt,Km=we,Qm=Wi,zm=function(e,t,i){var r=Jm(t);r in e?Km.f(e,r,Qm(0,i)):e[r]=i},Ym=xt,qm=jt,Xm=zm,$m=Array,Zm=Math.max,e_=function(e,t,i){for(var r=qm(e),n=Ym(t,r),o=Ym(void 0===i?r:i,r),s=$m(Zm(o-n,0)),a=0;n<o;n++,a++)Xm(s,a,e[n]);return s.length=a,s},t_=e_,i_=Math.floor,r_=function(e,t){var i=e.length,r=i_(i/2);return i<8?n_(e,t):o_(e,r_(t_(e,0,r),t),r_(t_(e,r),t),t)},n_=function(e,t){for(var i,r,n=e.length,o=1;o<n;){for(r=o,i=e[o];r&&t(e[r-1],i)>0;)e[r]=e[--r];r!==o++&&(e[r]=i)}return e},o_=function(e,t,i,r){for(var n=t.length,o=i.length,s=0,a=0;s<n||a<o;)e[s+a]=s<n&&a<o?r(t[s],i[a])<=0?t[s++]:i[a++]:s<n?t[s++]:i[a++];return e},s_=r_,a_=Vn,c_=A,l_=Fe,u_=c,d_=ke,h_=jm,p_=en,m_=Ts,__=Gm,f_=no,g_=ho,T_=sr,v_=As,S_=ve,y_=W,E_=va,I_=Ms,R_=Ae,C_=Ee,A_=hd,b_=Di,k_=Wi,D_=ru,w_=ql,O_=Ea,N_=s_,P_=_e("iterator"),M_="URLSearchParams",L_=M_+"Iterator",V_=T_.set,x_=T_.getterFor(M_),U_=T_.getterFor(L_),F_=Object.getOwnPropertyDescriptor,B_=function(e){if(!d_)return c_[e];var t=F_(c_,e);return t&&t.value},H_=B_("fetch"),j_=B_("Request"),W_=B_("Headers"),G_=j_&&j_.prototype,J_=W_&&W_.prototype,K_=c_.RegExp,Q_=c_.TypeError,z_=c_.decodeURIComponent,Y_=c_.encodeURIComponent,q_=u_("".charAt),X_=u_([].join),$_=u_([].push),Z_=u_("".replace),ef=u_([].shift),tf=u_([].splice),rf=u_("".split),nf=u_("".slice),of=/\+/g,sf=Array(4),af=function(e){return sf[e-1]||(sf[e-1]=K_("((?:%[\\da-f]{2}){"+e+"})","gi"))},cf=function(e){try{return z_(e)}catch(t){return e}},lf=function(e){var t=Z_(e,of," "),i=4;try{return z_(t)}catch(e){for(;i;)t=Z_(t,af(i--),cf);return t}},uf=/[!'()~]|%20/g,df={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},hf=function(e){return df[e]},pf=function(e){return Z_(Y_(e),uf,hf)},mf=g_((function(e,t){V_(this,{type:L_,iterator:D_(x_(e).entries),kind:t})}),"Iterator",(function(){var e=U_(this),t=e.kind,i=e.iterator.next(),r=i.value;return i.done||(i.value="keys"===t?r.key:"values"===t?r.value:[r.key,r.value]),i}),!0),_f=function(e){this.entries=[],this.url=null,void 0!==e&&(C_(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===q_(e,0)?nf(e,1):e:A_(e)))};_f.prototype={type:M_,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,i,r,n,o,s,a,c=w_(e);if(c)for(i=(t=D_(e,c)).next;!(r=l_(i,t)).done;){if(o=(n=D_(R_(r.value))).next,(s=l_(o,n)).done||(a=l_(o,n)).done||!l_(o,n).done)throw Q_("Expected sequence with length 2");$_(this.entries,{key:A_(s.value),value:A_(a.value)})}else for(var l in e)y_(e,l)&&$_(this.entries,{key:l,value:A_(e[l])})},parseQuery:function(e){if(e)for(var t,i,r=rf(e,"&"),n=0;n<r.length;)(t=r[n++]).length&&(i=rf(t,"="),$_(this.entries,{key:lf(ef(i)),value:lf(X_(i,"="))}))},serialize:function(){for(var e,t=this.entries,i=[],r=0;r<t.length;)e=t[r++],$_(i,pf(e.key)+"="+pf(e.value));return X_(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var ff=function(){v_(this,gf);var e=V_(this,new _f(arguments.length>0?arguments[0]:void 0));d_||(this.length=e.entries.length)},gf=ff.prototype;if(__(gf,{append:function(e,t){O_(arguments.length,2);var i=x_(this);$_(i.entries,{key:A_(e),value:A_(t)}),d_||this.length++,i.updateURL()},delete:function(e){O_(arguments.length,1);for(var t=x_(this),i=t.entries,r=A_(e),n=0;n<i.length;)i[n].key===r?tf(i,n,1):n++;d_||(this.length=i.length),t.updateURL()},get:function(e){O_(arguments.length,1);for(var t=x_(this).entries,i=A_(e),r=0;r<t.length;r++)if(t[r].key===i)return t[r].value;return null},getAll:function(e){O_(arguments.length,1);for(var t=x_(this).entries,i=A_(e),r=[],n=0;n<t.length;n++)t[n].key===i&&$_(r,t[n].value);return r},has:function(e){O_(arguments.length,1);for(var t=x_(this).entries,i=A_(e),r=0;r<t.length;)if(t[r++].key===i)return!0;return!1},set:function(e,t){O_(arguments.length,1);for(var i,r=x_(this),n=r.entries,o=!1,s=A_(e),a=A_(t),c=0;c<n.length;c++)(i=n[c]).key===s&&(o?tf(n,c--,1):(o=!0,i.value=a));o||$_(n,{key:s,value:a}),d_||(this.length=n.length),r.updateURL()},sort:function(){var e=x_(this);N_(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,i=x_(this).entries,r=E_(e,arguments.length>1?arguments[1]:void 0),n=0;n<i.length;)r((t=i[n++]).value,t.key,this)},keys:function(){return new mf(this,"keys")},values:function(){return new mf(this,"values")},entries:function(){return new mf(this,"entries")}},{enumerable:!0}),p_(gf,P_,gf.entries,{name:"entries"}),p_(gf,"toString",(function(){return x_(this).serialize()}),{enumerable:!0}),d_&&m_(gf,"size",{get:function(){return x_(this).entries.length},configurable:!0,enumerable:!0}),f_(ff,M_),a_({global:!0,constructor:!0,forced:!h_},{URLSearchParams:ff}),!h_&&S_(W_)){var Tf=u_(J_.has),vf=u_(J_.set),Sf=function(e){if(C_(e)){var t,i=e.body;if(I_(i)===M_)return t=e.headers?new W_(e.headers):new W_,Tf(t,"content-type")||vf(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),b_(e,{body:k_(0,A_(i)),headers:k_(0,t)})}return e};if(S_(H_)&&a_({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return H_(e,arguments.length>1?Sf(arguments[1]):{})}}),S_(j_)){var yf=function(e){return v_(this,G_),new j_(e,arguments.length>1?Sf(arguments[1]):{})};G_.constructor=yf,yf.prototype=G_,a_({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:yf})}}var Ef={URLSearchParams:ff,getState:x_},If="\t\n\v\f\r                　\u2028\u2029\ufeff",Rf=y,Cf=hd,Af=If,bf=c("".replace),kf=RegExp("^["+Af+"]+"),Df=RegExp("(^|[^"+Af+"])["+Af+"]+$"),wf=function(e){return function(t){var i=Cf(Rf(t));return 1&e&&(i=bf(i,kf,"")),2&e&&(i=bf(i,Df,"$1")),i}},Of={start:wf(1),end:wf(2),trim:wf(3)},Nf=kr.PROPER,Pf=t,Mf=If,Lf=Of.trim;Vn({target:"String",proto:!0,forced:function(e){return Pf((function(){return!!Mf[e]()||"​᠎"!=="​᠎"[e]()||Nf&&Mf[e].name!==e}))}("trim")},{trim:function(){return Lf(this)}});var Vf=Vn,xf=ke,Uf=c,Ff=W,Bf=ve,Hf=We,jf=hd,Wf=Ts,Gf=vn,Jf=A.Symbol,Kf=Jf&&Jf.prototype;if(xf&&Bf(Jf)&&(!("description"in Kf)||void 0!==Jf().description)){var Qf={},zf=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:jf(arguments[0]),t=Hf(Kf,this)?new Jf(e):void 0===e?Jf():Jf(e);return""===e&&(Qf[t]=!0),t};Gf(zf,Jf),zf.prototype=Kf,Kf.constructor=zf;var Yf="Symbol(test)"==String(Jf("test")),qf=Uf(Kf.valueOf),Xf=Uf(Kf.toString),$f=/^Symbol\((.*)\)[^)]+$/,Zf=Uf("".replace),eg=Uf("".slice);Wf(Kf,"description",{configurable:!0,get:function(){var e=qf(this);if(Ff(Qf,e))return"";var t=Xf(e),i=Yf?eg(t,7,-1):Zf(t,$f,"$1");return""===i?void 0:i}}),Vf({global:!0,constructor:!0,forced:!0},{Symbol:zf})}var tg=Pp.charAt,ig=hd,rg=sr,ng=Fo,og=Bo,sg="String Iterator",ag=rg.set,cg=rg.getterFor(sg);ng(String,"String",(function(e){ag(this,{type:sg,string:ig(e),index:0})}),(function(){var e,t=cg(this),i=t.string,r=t.index;return r>=i.length?og(void 0,!0):(e=tg(i,r),t.index+=e.length,og(e,!1))}));var lg,ug=ke,dg=c,hg=Fe,pg=t,mg=ni,_g=on,fg=cr,gg=B,Tg=g,vg=Object.assign,Sg=Object.defineProperty,yg=dg([].concat),Eg=!vg||pg((function(){if(ug&&1!==vg({b:1},vg(Sg({},"a",{enumerable:!0,get:function(){Sg(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},i=Symbol(),r="abcdefghijklmnopqrst";return e[i]=7,r.split("").forEach((function(e){t[e]=e})),7!=vg({},e)[i]||mg(vg({},t)).join("")!=r}))?function(e,t){for(var i=gg(e),r=arguments.length,n=1,o=_g.f,s=fg.f;r>n;)for(var a,c=Tg(arguments[n++]),l=o?yg(mg(c),o(c)):mg(c),u=l.length,d=0;u>d;)a=l[d++],ug&&!hg(s,c,a)||(i[a]=c[a]);return i}:vg,Ig=Ae,Rg=au,Cg=va,Ag=Fe,bg=B,kg=function(e,t,i,r){try{return r?t(Ig(i)[0],i[1]):t(i)}catch(t){Rg(e,"throw",t)}},Dg=Gl,wg=$s,Og=jt,Ng=zm,Pg=ru,Mg=ql,Lg=Array,Vg=c,xg=2147483647,Ug=/[^\0-\u007E]/,Fg=/[.\u3002\uFF0E\uFF61]/g,Bg="Overflow: input needs wider integers to process",Hg=RangeError,jg=Vg(Fg.exec),Wg=Math.floor,Gg=String.fromCharCode,Jg=Vg("".charCodeAt),Kg=Vg([].join),Qg=Vg([].push),zg=Vg("".replace),Yg=Vg("".split),qg=Vg("".toLowerCase),Xg=function(e){return e+22+75*(e<26)},$g=function(e,t,i){var r=0;for(e=i?Wg(e/700):e>>1,e+=Wg(e/t);e>455;)e=Wg(e/35),r+=36;return Wg(r+36*e/(e+38))},Zg=function(e){var t=[];e=function(e){for(var t=[],i=0,r=e.length;i<r;){var n=Jg(e,i++);if(n>=55296&&n<=56319&&i<r){var o=Jg(e,i++);56320==(64512&o)?Qg(t,((1023&n)<<10)+(1023&o)+65536):(Qg(t,n),i--)}else Qg(t,n)}return t}(e);var i,r,n=e.length,o=128,s=0,a=72;for(i=0;i<e.length;i++)(r=e[i])<128&&Qg(t,Gg(r));var c=t.length,l=c;for(c&&Qg(t,"-");l<n;){var u=xg;for(i=0;i<e.length;i++)(r=e[i])>=o&&r<u&&(u=r);var d=l+1;if(u-o>Wg((xg-s)/d))throw Hg(Bg);for(s+=(u-o)*d,o=u,i=0;i<e.length;i++){if((r=e[i])<o&&++s>xg)throw Hg(Bg);if(r==o){for(var h=s,p=36;;){var m=p<=a?1:p>=a+26?26:p-a;if(h<m)break;var _=h-m,f=36-m;Qg(t,Gg(Xg(m+_%f))),h=Wg(_/f),p+=36}Qg(t,Gg(Xg(h))),a=$g(s,d,l==c),s=0,l++}}s++,o++}return Kg(t,"")},eT=Vn,tT=ke,iT=jm,rT=A,nT=va,oT=c,sT=en,aT=Ts,cT=As,lT=W,uT=Eg,dT=function(e){var t=bg(e),i=wg(this),r=arguments.length,n=r>1?arguments[1]:void 0,o=void 0!==n;o&&(n=Cg(n,r>2?arguments[2]:void 0));var s,a,c,l,u,d,h=Mg(t),p=0;if(!h||this===Lg&&Dg(h))for(s=Og(t),a=i?new this(s):Lg(s);s>p;p++)d=o?n(t[p],p):t[p],Ng(a,p,d);else for(u=(l=Pg(t,h)).next,a=i?new this:[];!(c=Ag(u,l)).done;p++)d=o?kg(l,n,[c.value,p],!0):c.value,Ng(a,p,d);return a.length=p,a},hT=e_,pT=Pp.codeAt,mT=hd,_T=no,fT=Ea,gT=Ef,TT=sr,vT=TT.set,ST=TT.getterFor("URL"),yT=gT.URLSearchParams,ET=gT.getState,IT=rT.URL,RT=rT.TypeError,CT=rT.parseInt,AT=Math.floor,bT=Math.pow,kT=oT("".charAt),DT=oT(/./.exec),wT=oT([].join),OT=oT(1..toString),NT=oT([].pop),PT=oT([].push),MT=oT("".replace),LT=oT([].shift),VT=oT("".split),xT=oT("".slice),UT=oT("".toLowerCase),FT=oT([].unshift),BT="Invalid scheme",HT="Invalid host",jT="Invalid port",WT=/[a-z]/i,GT=/[\d+-.a-z]/i,JT=/\d/,KT=/^0x/i,QT=/^[0-7]+$/,zT=/^\d+$/,YT=/^[\da-f]+$/i,qT=/[\0\t\n\r #%/:<>?@[\\\]^|]/,XT=/[\0\t\n\r #/:<>?@[\\\]^|]/,$T=/^[\u0000-\u0020]+/,ZT=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,ev=/[\t\n\r]/g,tv=function(e){var t,i,r,n;if("number"==typeof e){for(t=[],i=0;i<4;i++)FT(t,e%256),e=AT(e/256);return wT(t,".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,i=1,r=null,n=0,o=0;o<8;o++)0!==e[o]?(n>i&&(t=r,i=n),r=null,n=0):(null===r&&(r=o),++n);return n>i&&(t=r,i=n),t}(e),i=0;i<8;i++)n&&0===e[i]||(n&&(n=!1),r===i?(t+=i?":":"::",n=!0):(t+=OT(e[i],16),i<7&&(t+=":")));return"["+t+"]"}return e},iv={},rv=uT({},iv,{" ":1,'"':1,"<":1,">":1,"`":1}),nv=uT({},rv,{"#":1,"?":1,"{":1,"}":1}),ov=uT({},nv,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),sv=function(e,t){var i=pT(e,0);return i>32&&i<127&&!lT(t,e)?e:encodeURIComponent(e)},av={ftp:21,file:null,http:80,https:443,ws:80,wss:443},cv=function(e,t){var i;return 2==e.length&&DT(WT,kT(e,0))&&(":"==(i=kT(e,1))||!t&&"|"==i)},lv=function(e){var t;return e.length>1&&cv(xT(e,0,2))&&(2==e.length||"/"===(t=kT(e,2))||"\\"===t||"?"===t||"#"===t)},uv=function(e){return"."===e||"%2e"===UT(e)},dv={},hv={},pv={},mv={},_v={},fv={},gv={},Tv={},vv={},Sv={},yv={},Ev={},Iv={},Rv={},Cv={},Av={},bv={},kv={},Dv={},wv={},Ov={},Nv=function(e,t,i){var r,n,o,s=mT(e);if(t){if(n=this.parse(s))throw RT(n);this.searchParams=null}else{if(void 0!==i&&(r=new Nv(i,!0)),n=this.parse(s,null,r))throw RT(n);(o=ET(new yT)).bindURL(this),this.searchParams=o}};Nv.prototype={type:"URL",parse:function(e,t,i){var r,n,o,s,a,c=this,l=t||dv,u=0,d="",h=!1,p=!1,m=!1;for(e=mT(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=MT(e,$T,""),e=MT(e,ZT,"$1")),e=MT(e,ev,""),r=dT(e);u<=r.length;){switch(n=r[u],l){case dv:if(!n||!DT(WT,n)){if(t)return BT;l=pv;continue}d+=UT(n),l=hv;break;case hv:if(n&&(DT(GT,n)||"+"==n||"-"==n||"."==n))d+=UT(n);else{if(":"!=n){if(t)return BT;d="",l=pv,u=0;continue}if(t&&(c.isSpecial()!=lT(av,d)||"file"==d&&(c.includesCredentials()||null!==c.port)||"file"==c.scheme&&!c.host))return;if(c.scheme=d,t)return void(c.isSpecial()&&av[c.scheme]==c.port&&(c.port=null));d="","file"==c.scheme?l=Rv:c.isSpecial()&&i&&i.scheme==c.scheme?l=mv:c.isSpecial()?l=Tv:"/"==r[u+1]?(l=_v,u++):(c.cannotBeABaseURL=!0,PT(c.path,""),l=Dv)}break;case pv:if(!i||i.cannotBeABaseURL&&"#"!=n)return BT;if(i.cannotBeABaseURL&&"#"==n){c.scheme=i.scheme,c.path=hT(i.path),c.query=i.query,c.fragment="",c.cannotBeABaseURL=!0,l=Ov;break}l="file"==i.scheme?Rv:fv;continue;case mv:if("/"!=n||"/"!=r[u+1]){l=fv;continue}l=vv,u++;break;case _v:if("/"==n){l=Sv;break}l=kv;continue;case fv:if(c.scheme=i.scheme,n==lg)c.username=i.username,c.password=i.password,c.host=i.host,c.port=i.port,c.path=hT(i.path),c.query=i.query;else if("/"==n||"\\"==n&&c.isSpecial())l=gv;else if("?"==n)c.username=i.username,c.password=i.password,c.host=i.host,c.port=i.port,c.path=hT(i.path),c.query="",l=wv;else{if("#"!=n){c.username=i.username,c.password=i.password,c.host=i.host,c.port=i.port,c.path=hT(i.path),c.path.length--,l=kv;continue}c.username=i.username,c.password=i.password,c.host=i.host,c.port=i.port,c.path=hT(i.path),c.query=i.query,c.fragment="",l=Ov}break;case gv:if(!c.isSpecial()||"/"!=n&&"\\"!=n){if("/"!=n){c.username=i.username,c.password=i.password,c.host=i.host,c.port=i.port,l=kv;continue}l=Sv}else l=vv;break;case Tv:if(l=vv,"/"!=n||"/"!=kT(d,u+1))continue;u++;break;case vv:if("/"!=n&&"\\"!=n){l=Sv;continue}break;case Sv:if("@"==n){h&&(d="%40"+d),h=!0,o=dT(d);for(var _=0;_<o.length;_++){var f=o[_];if(":"!=f||m){var g=sv(f,ov);m?c.password+=g:c.username+=g}else m=!0}d=""}else if(n==lg||"/"==n||"?"==n||"#"==n||"\\"==n&&c.isSpecial()){if(h&&""==d)return"Invalid authority";u-=dT(d).length+1,d="",l=yv}else d+=n;break;case yv:case Ev:if(t&&"file"==c.scheme){l=Av;continue}if(":"!=n||p){if(n==lg||"/"==n||"?"==n||"#"==n||"\\"==n&&c.isSpecial()){if(c.isSpecial()&&""==d)return HT;if(t&&""==d&&(c.includesCredentials()||null!==c.port))return;if(s=c.parseHost(d))return s;if(d="",l=bv,t)return;continue}"["==n?p=!0:"]"==n&&(p=!1),d+=n}else{if(""==d)return HT;if(s=c.parseHost(d))return s;if(d="",l=Iv,t==Ev)return}break;case Iv:if(!DT(JT,n)){if(n==lg||"/"==n||"?"==n||"#"==n||"\\"==n&&c.isSpecial()||t){if(""!=d){var T=CT(d,10);if(T>65535)return jT;c.port=c.isSpecial()&&T===av[c.scheme]?null:T,d=""}if(t)return;l=bv;continue}return jT}d+=n;break;case Rv:if(c.scheme="file","/"==n||"\\"==n)l=Cv;else{if(!i||"file"!=i.scheme){l=kv;continue}if(n==lg)c.host=i.host,c.path=hT(i.path),c.query=i.query;else if("?"==n)c.host=i.host,c.path=hT(i.path),c.query="",l=wv;else{if("#"!=n){lv(wT(hT(r,u),""))||(c.host=i.host,c.path=hT(i.path),c.shortenPath()),l=kv;continue}c.host=i.host,c.path=hT(i.path),c.query=i.query,c.fragment="",l=Ov}}break;case Cv:if("/"==n||"\\"==n){l=Av;break}i&&"file"==i.scheme&&!lv(wT(hT(r,u),""))&&(cv(i.path[0],!0)?PT(c.path,i.path[0]):c.host=i.host),l=kv;continue;case Av:if(n==lg||"/"==n||"\\"==n||"?"==n||"#"==n){if(!t&&cv(d))l=kv;else if(""==d){if(c.host="",t)return;l=bv}else{if(s=c.parseHost(d))return s;if("localhost"==c.host&&(c.host=""),t)return;d="",l=bv}continue}d+=n;break;case bv:if(c.isSpecial()){if(l=kv,"/"!=n&&"\\"!=n)continue}else if(t||"?"!=n)if(t||"#"!=n){if(n!=lg&&(l=kv,"/"!=n))continue}else c.fragment="",l=Ov;else c.query="",l=wv;break;case kv:if(n==lg||"/"==n||"\\"==n&&c.isSpecial()||!t&&("?"==n||"#"==n)){if(".."===(a=UT(a=d))||"%2e."===a||".%2e"===a||"%2e%2e"===a?(c.shortenPath(),"/"==n||"\\"==n&&c.isSpecial()||PT(c.path,"")):uv(d)?"/"==n||"\\"==n&&c.isSpecial()||PT(c.path,""):("file"==c.scheme&&!c.path.length&&cv(d)&&(c.host&&(c.host=""),d=kT(d,0)+":"),PT(c.path,d)),d="","file"==c.scheme&&(n==lg||"?"==n||"#"==n))for(;c.path.length>1&&""===c.path[0];)LT(c.path);"?"==n?(c.query="",l=wv):"#"==n&&(c.fragment="",l=Ov)}else d+=sv(n,nv);break;case Dv:"?"==n?(c.query="",l=wv):"#"==n?(c.fragment="",l=Ov):n!=lg&&(c.path[0]+=sv(n,iv));break;case wv:t||"#"!=n?n!=lg&&("'"==n&&c.isSpecial()?c.query+="%27":c.query+="#"==n?"%23":sv(n,iv)):(c.fragment="",l=Ov);break;case Ov:n!=lg&&(c.fragment+=sv(n,rv))}u++}},parseHost:function(e){var t,i,r;if("["==kT(e,0)){if("]"!=kT(e,e.length-1))return HT;if(t=function(e){var t,i,r,n,o,s,a,c=[0,0,0,0,0,0,0,0],l=0,u=null,d=0,h=function(){return kT(e,d)};if(":"==h()){if(":"!=kT(e,1))return;d+=2,u=++l}for(;h();){if(8==l)return;if(":"!=h()){for(t=i=0;i<4&&DT(YT,h());)t=16*t+CT(h(),16),d++,i++;if("."==h()){if(0==i)return;if(d-=i,l>6)return;for(r=0;h();){if(n=null,r>0){if(!("."==h()&&r<4))return;d++}if(!DT(JT,h()))return;for(;DT(JT,h());){if(o=CT(h(),10),null===n)n=o;else{if(0==n)return;n=10*n+o}if(n>255)return;d++}c[l]=256*c[l]+n,2!=++r&&4!=r||l++}if(4!=r)return;break}if(":"==h()){if(d++,!h())return}else if(h())return;c[l++]=t}else{if(null!==u)return;d++,u=++l}}if(null!==u)for(s=l-u,l=7;0!=l&&s>0;)a=c[l],c[l--]=c[u+s-1],c[u+--s]=a;else if(8!=l)return;return c}(xT(e,1,-1)),!t)return HT;this.host=t}else if(this.isSpecial()){if(e=function(e){var t,i,r=[],n=Yg(zg(qg(e),Fg,"."),".");for(t=0;t<n.length;t++)i=n[t],Qg(r,jg(Ug,i)?"xn--"+Zg(i):i);return Kg(r,".")}(e),DT(qT,e))return HT;if(t=function(e){var t,i,r,n,o,s,a,c=VT(e,".");if(c.length&&""==c[c.length-1]&&c.length--,(t=c.length)>4)return e;for(i=[],r=0;r<t;r++){if(""==(n=c[r]))return e;if(o=10,n.length>1&&"0"==kT(n,0)&&(o=DT(KT,n)?16:8,n=xT(n,8==o?1:2)),""===n)s=0;else{if(!DT(10==o?zT:8==o?QT:YT,n))return e;s=CT(n,o)}PT(i,s)}for(r=0;r<t;r++)if(s=i[r],r==t-1){if(s>=bT(256,5-t))return null}else if(s>255)return null;for(a=NT(i),r=0;r<i.length;r++)a+=i[r]*bT(256,3-r);return a}(e),null===t)return HT;this.host=t}else{if(DT(XT,e))return HT;for(t="",i=dT(e),r=0;r<i.length;r++)t+=sv(i[r],iv);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return lT(av,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&cv(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,i=e.username,r=e.password,n=e.host,o=e.port,s=e.path,a=e.query,c=e.fragment,l=t+":";return null!==n?(l+="//",e.includesCredentials()&&(l+=i+(r?":"+r:"")+"@"),l+=tv(n),null!==o&&(l+=":"+o)):"file"==t&&(l+="//"),l+=e.cannotBeABaseURL?s[0]:s.length?"/"+wT(s,"/"):"",null!==a&&(l+="?"+a),null!==c&&(l+="#"+c),l},setHref:function(e){var t=this.parse(e);if(t)throw RT(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new Pv(e.path[0]).origin}catch(e){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+tv(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(mT(e)+":",dv)},getUsername:function(){return this.username},setUsername:function(e){var t=dT(mT(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<t.length;i++)this.username+=sv(t[i],ov)}},getPassword:function(){return this.password},setPassword:function(e){var t=dT(mT(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<t.length;i++)this.password+=sv(t[i],ov)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?tv(e):tv(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,yv)},getHostname:function(){var e=this.host;return null===e?"":tv(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Ev)},getPort:function(){var e=this.port;return null===e?"":mT(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=mT(e))?this.port=null:this.parse(e,Iv))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+wT(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,bv))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=mT(e))?this.query=null:("?"==kT(e,0)&&(e=xT(e,1)),this.query="",this.parse(e,wv)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=mT(e))?("#"==kT(e,0)&&(e=xT(e,1)),this.fragment="",this.parse(e,Ov)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Pv=function(e){var t=cT(this,Mv),i=fT(arguments.length,1)>1?arguments[1]:void 0,r=vT(t,new Nv(e,!1,i));tT||(t.href=r.serialize(),t.origin=r.getOrigin(),t.protocol=r.getProtocol(),t.username=r.getUsername(),t.password=r.getPassword(),t.host=r.getHost(),t.hostname=r.getHostname(),t.port=r.getPort(),t.pathname=r.getPathname(),t.search=r.getSearch(),t.searchParams=r.getSearchParams(),t.hash=r.getHash())},Mv=Pv.prototype,Lv=function(e,t){return{get:function(){return ST(this)[e]()},set:t&&function(e){return ST(this)[t](e)},configurable:!0,enumerable:!0}};if(tT&&(aT(Mv,"href",Lv("serialize","setHref")),aT(Mv,"origin",Lv("getOrigin")),aT(Mv,"protocol",Lv("getProtocol","setProtocol")),aT(Mv,"username",Lv("getUsername","setUsername")),aT(Mv,"password",Lv("getPassword","setPassword")),aT(Mv,"host",Lv("getHost","setHost")),aT(Mv,"hostname",Lv("getHostname","setHostname")),aT(Mv,"port",Lv("getPort","setPort")),aT(Mv,"pathname",Lv("getPathname","setPathname")),aT(Mv,"search",Lv("getSearch","setSearch")),aT(Mv,"searchParams",Lv("getSearchParams")),aT(Mv,"hash",Lv("getHash","setHash"))),sT(Mv,"toJSON",(function(){return ST(this).serialize()}),{enumerable:!0}),sT(Mv,"toString",(function(){return ST(this).serialize()}),{enumerable:!0}),IT){var Vv=IT.createObjectURL,xv=IT.revokeObjectURL;Vv&&sT(Pv,"createObjectURL",nT(Vv,IT)),xv&&sT(Pv,"revokeObjectURL",nT(xv,IT))}_T(Pv,"URL"),eT({global:!0,constructor:!0,forced:!iT,sham:!tT},{URL:Pv});var Uv="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Fv=Pt,Bv=Bt,Hv=RangeError,jv=function(e){if(void 0===e)return 0;var t=Fv(e),i=Bv(t);if(t!==i)throw Hv("Wrong length or index");return i},Wv=Array,Gv=Math.abs,Jv=Math.pow,Kv=Math.floor,Qv=Math.log,zv=Math.LN2,Yv={pack:function(e,t,i){var r,n,o,s=Wv(i),a=8*i-t-1,c=(1<<a)-1,l=c>>1,u=23===t?Jv(2,-24)-Jv(2,-77):0,d=e<0||0===e&&1/e<0?1:0,h=0;for((e=Gv(e))!=e||1/0===e?(n=e!=e?1:0,r=c):(r=Kv(Qv(e)/zv),e*(o=Jv(2,-r))<1&&(r--,o*=2),(e+=r+l>=1?u/o:u*Jv(2,1-l))*o>=2&&(r++,o/=2),r+l>=c?(n=0,r=c):r+l>=1?(n=(e*o-1)*Jv(2,t),r+=l):(n=e*Jv(2,l-1)*Jv(2,t),r=0));t>=8;)s[h++]=255&n,n/=256,t-=8;for(r=r<<t|n,a+=t;a>0;)s[h++]=255&r,r/=256,a-=8;return s[--h]|=128*d,s},unpack:function(e,t){var i,r=e.length,n=8*r-t-1,o=(1<<n)-1,s=o>>1,a=n-7,c=r-1,l=e[c--],u=127&l;for(l>>=7;a>0;)u=256*u+e[c--],a-=8;for(i=u&(1<<-a)-1,u>>=-a,a+=t;a>0;)i=256*i+e[c--],a-=8;if(0===u)u=1-s;else{if(u===o)return i?NaN:l?-1/0:1/0;i+=Jv(2,t),u-=s}return(l?-1:1)*i*Jv(2,u-t)}},qv=B,Xv=xt,$v=jt,Zv=function(e){for(var t=qv(this),i=$v(t),r=arguments.length,n=Xv(r>1?arguments[1]:void 0,i),o=r>2?arguments[2]:void 0,s=void 0===o?i:Xv(o,i);s>n;)t[n++]=e;return t},eS=A,tS=c,iS=ke,rS=Uv,nS=kr,oS=Ki,sS=Ts,aS=Gm,cS=t,lS=As,uS=Pt,dS=Bt,hS=jv,pS=Yv,mS=Jn,_S=vo,fS=tn.f,gS=Zv,TS=e_,vS=no,SS=sr,yS=nS.PROPER,ES=nS.CONFIGURABLE,IS="ArrayBuffer",RS="DataView",CS="prototype",AS="Wrong index",bS=SS.getterFor(IS),kS=SS.getterFor(RS),DS=SS.set,wS=eS[IS],OS=wS,NS=OS&&OS[CS],PS=eS[RS],MS=PS&&PS[CS],LS=Object.prototype,VS=eS.Array,xS=eS.RangeError,US=tS(gS),FS=tS([].reverse),BS=pS.pack,HS=pS.unpack,jS=function(e){return[255&e]},WS=function(e){return[255&e,e>>8&255]},GS=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},JS=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},KS=function(e){return BS(e,23,4)},QS=function(e){return BS(e,52,8)},zS=function(e,t,i){sS(e[CS],t,{configurable:!0,get:function(){return i(this)[t]}})},YS=function(e,t,i,r){var n=hS(i),o=kS(e);if(n+t>o.byteLength)throw xS(AS);var s=o.bytes,a=n+o.byteOffset,c=TS(s,a,a+t);return r?c:FS(c)},qS=function(e,t,i,r,n,o){var s=hS(i),a=kS(e);if(s+t>a.byteLength)throw xS(AS);for(var c=a.bytes,l=s+a.byteOffset,u=r(+n),d=0;d<t;d++)c[l+d]=u[o?d:t-d-1]};if(rS){var XS=yS&&wS.name!==IS;if(cS((function(){wS(1)}))&&cS((function(){new wS(-1)}))&&!cS((function(){return new wS,new wS(1.5),new wS(NaN),1!=wS.length||XS&&!ES})))XS&&ES&&oS(wS,"name",IS);else{(OS=function(e){return lS(this,NS),new wS(hS(e))})[CS]=NS;for(var $S,ZS=fS(wS),ey=0;ZS.length>ey;)($S=ZS[ey++])in OS||oS(OS,$S,wS[$S]);NS.constructor=OS}_S&&mS(MS)!==LS&&_S(MS,LS);var ty=new PS(new OS(2)),iy=tS(MS.setInt8);ty.setInt8(0,2147483648),ty.setInt8(1,2147483649),!ty.getInt8(0)&&ty.getInt8(1)||aS(MS,{setInt8:function(e,t){iy(this,e,t<<24>>24)},setUint8:function(e,t){iy(this,e,t<<24>>24)}},{unsafe:!0})}else NS=(OS=function(e){lS(this,NS);var t=hS(e);DS(this,{type:IS,bytes:US(VS(t),0),byteLength:t}),iS||(this.byteLength=t,this.detached=!1)})[CS],MS=(PS=function(e,t,i){lS(this,MS),lS(e,NS);var r=bS(e),n=r.byteLength,o=uS(t);if(o<0||o>n)throw xS("Wrong offset");if(o+(i=void 0===i?n-o:dS(i))>n)throw xS("Wrong length");DS(this,{type:RS,buffer:e,byteLength:i,byteOffset:o,bytes:r.bytes}),iS||(this.buffer=e,this.byteLength=i,this.byteOffset=o)})[CS],iS&&(zS(OS,"byteLength",bS),zS(PS,"buffer",kS),zS(PS,"byteLength",kS),zS(PS,"byteOffset",kS)),aS(MS,{getInt8:function(e){return YS(this,1,e)[0]<<24>>24},getUint8:function(e){return YS(this,1,e)[0]},getInt16:function(e){var t=YS(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=YS(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return JS(YS(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return JS(YS(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return HS(YS(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return HS(YS(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){qS(this,1,e,jS,t)},setUint8:function(e,t){qS(this,1,e,jS,t)},setInt16:function(e,t){qS(this,2,e,WS,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){qS(this,2,e,WS,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){qS(this,4,e,GS,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){qS(this,4,e,GS,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){qS(this,4,e,KS,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){qS(this,8,e,QS,t,arguments.length>2?arguments[2]:void 0)}});vS(OS,IS),vS(PS,RS);var ry={ArrayBuffer:OS,DataView:PS},ny=Is,oy="ArrayBuffer",sy=ry[oy];Vn({global:!0,constructor:!0,forced:A[oy]!==sy},{ArrayBuffer:sy}),ny(oy);var ay=Vn,cy=_a,ly=t,uy=Ae,dy=xt,hy=Bt,py=aa,my=ry.ArrayBuffer,_y=ry.DataView,fy=_y.prototype,gy=cy(my.prototype.slice),Ty=cy(fy.getUint8),vy=cy(fy.setUint8);ay({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:ly((function(){return!new my(2).slice(1,void 0).byteLength}))},{slice:function(e,t){if(gy&&void 0===t)return gy(uy(this),e);for(var i=uy(this).byteLength,r=dy(e,i),n=dy(void 0===t?i:t,i),o=new(py(this,my))(hy(n-r)),s=new _y(this),a=new _y(o),c=0;r<n;)vy(a,c++,Ty(s,r++));return o}});var Sy,yy,Ey,Iy={},Ry={get exports(){return Iy},set exports(e){Iy=e}},Cy=Uv,Ay=ke,by=A,ky=ve,Dy=Ee,wy=W,Oy=Ms,Ny=qe,Py=Ki,My=en,Ly=Ts,Vy=We,xy=Jn,Uy=vo,Fy=_e,By=z,Hy=sr.enforce,jy=sr.get,Wy=by.Int8Array,Gy=Wy&&Wy.prototype,Jy=by.Uint8ClampedArray,Ky=Jy&&Jy.prototype,Qy=Wy&&xy(Wy),zy=Gy&&xy(Gy),Yy=Object.prototype,qy=by.TypeError,Xy=Fy("toStringTag"),$y=By("TYPED_ARRAY_TAG"),Zy="TypedArrayConstructor",eE=Cy&&!!Uy&&"Opera"!==Oy(by.opera),tE=!1,iE={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},rE={BigInt64Array:8,BigUint64Array:8},nE=function(e){var t=xy(e);if(Dy(t)){var i=jy(t);return i&&wy(i,Zy)?i[Zy]:nE(t)}},oE=function(e){if(!Dy(e))return!1;var t=Oy(e);return wy(iE,t)||wy(rE,t)};for(Sy in iE)(Ey=(yy=by[Sy])&&yy.prototype)?Hy(Ey)[Zy]=yy:eE=!1;for(Sy in rE)(Ey=(yy=by[Sy])&&yy.prototype)&&(Hy(Ey)[Zy]=yy);if((!eE||!ky(Qy)||Qy===Function.prototype)&&(Qy=function(){throw qy("Incorrect invocation")},eE))for(Sy in iE)by[Sy]&&Uy(by[Sy],Qy);if((!eE||!zy||zy===Yy)&&(zy=Qy.prototype,eE))for(Sy in iE)by[Sy]&&Uy(by[Sy].prototype,zy);if(eE&&xy(Ky)!==zy&&Uy(Ky,zy),Ay&&!wy(zy,Xy))for(Sy in tE=!0,Ly(zy,Xy,{configurable:!0,get:function(){return Dy(this)?this[$y]:void 0}}),iE)by[Sy]&&Py(by[Sy],$y,Sy);var sE={NATIVE_ARRAY_BUFFER_VIEWS:eE,TYPED_ARRAY_TAG:tE&&$y,aTypedArray:function(e){if(oE(e))return e;throw qy("Target is not a typed array")},aTypedArrayConstructor:function(e){if(ky(e)&&(!Uy||Vy(Qy,e)))return e;throw qy(Ny(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,i,r){if(Ay){if(i)for(var n in iE){var o=by[n];if(o&&wy(o.prototype,e))try{delete o.prototype[e]}catch(i){try{o.prototype[e]=t}catch(e){}}}zy[e]&&!i||My(zy,e,i?t:eE&&Gy[e]||t,r)}},exportTypedArrayStaticMethod:function(e,t,i){var r,n;if(Ay){if(Uy){if(i)for(r in iE)if((n=by[r])&&wy(n,e))try{delete n[e]}catch(e){}if(Qy[e]&&!i)return;try{return My(Qy,e,i?t:eE&&Qy[e]||t)}catch(e){}}for(r in iE)!(n=by[r])||n[e]&&!i||My(n,e,t)}},getTypedArrayConstructor:nE,isView:function(e){if(!Dy(e))return!1;var t=Oy(e);return"DataView"===t||wy(iE,t)||wy(rE,t)},isTypedArray:oE,TypedArray:Qy,TypedArrayPrototype:zy},aE=A,cE=t,lE=Au,uE=sE.NATIVE_ARRAY_BUFFER_VIEWS,dE=aE.ArrayBuffer,hE=aE.Int8Array,pE=!uE||!cE((function(){hE(1)}))||!cE((function(){new hE(-1)}))||!lE((function(e){new hE,new hE(null),new hE(1.5),new hE(e)}),!0)||cE((function(){return 1!==new hE(new dE(2),1,void 0).length})),mE=Ee,_E=Math.floor,fE=Number.isInteger||function(e){return!mE(e)&&isFinite(e)&&_E(e)===e},gE=Pt,TE=RangeError,vE=RangeError,SE=function(e,t){var i=function(e){var t=gE(e);if(t<0)throw TE("The argument can't be less than 0");return t}(e);if(i%t)throw vE("Wrong offset");return i},yE=Ms,EE=mt,IE=TypeError,RE=function(e){var t=EE(e,"number");if("number"==typeof t)throw IE("Can't convert number to bigint");return BigInt(t)},CE=va,AE=Fe,bE=ia,kE=B,DE=jt,wE=ru,OE=ql,NE=Gl,PE=function(e){var t=yE(e);return"BigInt64Array"==t||"BigUint64Array"==t},ME=sE.aTypedArrayConstructor,LE=RE,VE=Vn,xE=A,UE=Fe,FE=ke,BE=pE,HE=sE,jE=ry,WE=As,GE=Wi,JE=Ki,KE=fE,QE=Bt,zE=jv,YE=SE,qE=gt,XE=W,$E=Ms,ZE=Ee,eI=ze,tI=Di,iI=We,rI=vo,nI=tn.f,oI=function(e){var t,i,r,n,o,s,a,c,l=bE(this),u=kE(e),d=arguments.length,h=d>1?arguments[1]:void 0,p=void 0!==h,m=OE(u);if(m&&!NE(m))for(c=(a=wE(u,m)).next,u=[];!(s=AE(c,a)).done;)u.push(s.value);for(p&&d>2&&(h=CE(h,arguments[2])),i=DE(u),r=new(ME(l))(i),n=PE(r),t=0;i>t;t++)o=p?h(u[t],t):u[t],r[t]=n?LE(o):+o;return r},sI=$h.forEach,aI=Is,cI=Ts,lI=we,uI=ar,dI=od,hI=sr.get,pI=sr.set,mI=sr.enforce,_I=lI.f,fI=uI.f,gI=Math.round,TI=xE.RangeError,vI=jE.ArrayBuffer,SI=vI.prototype,yI=jE.DataView,EI=HE.NATIVE_ARRAY_BUFFER_VIEWS,II=HE.TYPED_ARRAY_TAG,RI=HE.TypedArray,CI=HE.TypedArrayPrototype,AI=HE.aTypedArrayConstructor,bI=HE.isTypedArray,kI="BYTES_PER_ELEMENT",DI="Wrong length",wI=function(e,t){AI(e);for(var i=0,r=t.length,n=new e(r);r>i;)n[i]=t[i++];return n},OI=function(e,t){cI(e,t,{configurable:!0,get:function(){return hI(this)[t]}})},NI=function(e){var t;return iI(SI,e)||"ArrayBuffer"==(t=$E(e))||"SharedArrayBuffer"==t},PI=function(e,t){return bI(e)&&!eI(t)&&t in e&&KE(+t)&&t>=0},MI=function(e,t){return t=qE(t),PI(e,t)?GE(2,e[t]):fI(e,t)},LI=function(e,t,i){return t=qE(t),!(PI(e,t)&&ZE(i)&&XE(i,"value"))||XE(i,"get")||XE(i,"set")||i.configurable||XE(i,"writable")&&!i.writable||XE(i,"enumerable")&&!i.enumerable?_I(e,t,i):(e[t]=i.value,e)};FE?(EI||(uI.f=MI,lI.f=LI,OI(CI,"buffer"),OI(CI,"byteOffset"),OI(CI,"byteLength"),OI(CI,"length")),VE({target:"Object",stat:!0,forced:!EI},{getOwnPropertyDescriptor:MI,defineProperty:LI}),Ry.exports=function(e,t,i){var r=e.match(/\d+/)[0]/8,n=e+(i?"Clamped":"")+"Array",o="get"+e,s="set"+e,a=xE[n],c=a,l=c&&c.prototype,u={},d=function(e,t){_I(e,t,{get:function(){return function(e,t){var i=hI(e);return i.view[o](t*r+i.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,n){var o=hI(e);i&&(n=(n=gI(n))<0?0:n>255?255:255&n),o.view[s](t*r+o.byteOffset,n,!0)}(this,t,e)},enumerable:!0})};EI?BE&&(c=t((function(e,t,i,n){return WE(e,l),dI(ZE(t)?NI(t)?void 0!==n?new a(t,YE(i,r),n):void 0!==i?new a(t,YE(i,r)):new a(t):bI(t)?wI(c,t):UE(oI,c,t):new a(zE(t)),e,c)})),rI&&rI(c,RI),sI(nI(a),(function(e){e in c||JE(c,e,a[e])})),c.prototype=l):(c=t((function(e,t,i,n){WE(e,l);var o,s,a,u=0,h=0;if(ZE(t)){if(!NI(t))return bI(t)?wI(c,t):UE(oI,c,t);o=t,h=YE(i,r);var p=t.byteLength;if(void 0===n){if(p%r)throw TI(DI);if((s=p-h)<0)throw TI(DI)}else if((s=QE(n)*r)+h>p)throw TI(DI);a=s/r}else a=zE(t),o=new vI(s=a*r);for(pI(e,{buffer:o,byteOffset:h,byteLength:s,length:a,view:new yI(o)});u<a;)d(e,u++)})),rI&&rI(c,RI),l=c.prototype=tI(CI)),l.constructor!==c&&JE(l,"constructor",c),mI(l).TypedArrayConstructor=c,II&&JE(l,II,n);var h=c!=a;u[n]=c,VE({global:!0,constructor:!0,forced:h,sham:!EI},u),kI in c||JE(c,kI,r),kI in l||JE(l,kI,r),aI(n)}):Ry.exports=function(){},Iy("Float32",(function(e){return function(t,i,r){return e(this,t,i,r)}}));var VI=Zv,xI=RE,UI=Ms,FI=Fe,BI=t,HI=sE.aTypedArray,jI=sE.exportTypedArrayMethod,WI=c("".slice);jI("fill",(function(e){var t=arguments.length;HI(this);var i="Big"===WI(UI(this),0,3)?xI(e):+e;return FI(VI,this,i,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}),BI((function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),1!==e})));var GI=A,JI=Fe,KI=sE,QI=jt,zI=SE,YI=B,qI=t,XI=GI.RangeError,$I=GI.Int8Array,ZI=$I&&$I.prototype,eR=ZI&&ZI.set,tR=KI.aTypedArray,iR=KI.exportTypedArrayMethod,rR=!qI((function(){var e=new Uint8ClampedArray(2);return JI(eR,e,{length:1,0:3},1),3!==e[1]})),nR=rR&&KI.NATIVE_ARRAY_BUFFER_VIEWS&&qI((function(){var e=new $I(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));iR("set",(function(e){tR(this);var t=zI(arguments.length>1?arguments[1]:void 0,1),i=YI(e);if(rR)return JI(eR,this,i,t);var r=this.length,n=QI(i),o=0;if(n+t>r)throw XI("Wrong length");for(;o<n;)this[t+o]=i[o++]}),!rR||nR);var oR=Y.match(/firefox\/(\d+)/i),sR=!!oR&&+oR[1],aR=/MSIE|Trident/.test(Y),cR=Y.match(/AppleWebKit\/(\d+)\./),lR=!!cR&&+cR[1],uR=_a,dR=t,hR=et,pR=s_,mR=sR,_R=aR,fR=ie,gR=lR,TR=sE.aTypedArray,vR=sE.exportTypedArrayMethod,SR=A.Uint16Array,yR=SR&&uR(SR.prototype.sort),ER=!(!yR||dR((function(){yR(new SR(2),null)}))&&dR((function(){yR(new SR(2),{})}))),IR=!!yR&&!dR((function(){if(fR)return fR<74;if(mR)return mR<67;if(_R)return!0;if(gR)return gR<602;var e,t,i=new SR(516),r=Array(516);for(e=0;e<516;e++)t=e%4,i[e]=515-e,r[e]=e-2*t+3;for(yR(i,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(i[e]!==r[e])return!0}));vR("sort",(function(e){return void 0!==e&&hR(e),IR?yR(this,e):pR(TR(this),function(e){return function(t,i){return void 0!==e?+e(t,i)||0:i!=i?-1:t!=t?1:0===t&&0===i?1/t>0&&1/i<0?1:-1:t>i}}(e))}),!IR||ER);var RR=qe,CR=TypeError,AR=Vn,bR=c,kR=et,DR=B,wR=jt,OR=function(e,t){if(!delete e[t])throw CR("Cannot delete property "+RR(t)+" of "+RR(e))},NR=hd,PR=t,MR=s_,LR=ep,VR=sR,xR=aR,UR=ie,FR=lR,BR=[],HR=bR(BR.sort),jR=bR(BR.push),WR=PR((function(){BR.sort(void 0)})),GR=PR((function(){BR.sort(null)})),JR=LR("sort"),KR=!PR((function(){if(UR)return UR<70;if(!(VR&&VR>3)){if(xR)return!0;if(FR)return FR<603;var e,t,i,r,n="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(r=0;r<47;r++)BR.push({k:t+r,v:i})}for(BR.sort((function(e,t){return t.v-e.v})),r=0;r<BR.length;r++)t=BR[r].k.charAt(0),n.charAt(n.length-1)!==t&&(n+=t);return"DGBEFHACIJK"!==n}}));AR({target:"Array",proto:!0,forced:WR||!GR||!JR||!KR},{sort:function(e){void 0!==e&&kR(e);var t=DR(this);if(KR)return void 0===e?HR(t):HR(t,e);var i,r,n=[],o=wR(t);for(r=0;r<o;r++)r in t&&jR(n,t[r]);for(MR(n,function(e){return function(t,i){return void 0===i?-1:void 0===t?1:void 0!==e?+e(t,i)||0:NR(t)>NR(i)?1:-1}}(e)),i=wR(n),r=0;r<i;)t[r]=n[r++];for(;r<o;)OR(t,r++);return t}}),Iy("Uint8",(function(e){return function(t,i,r){return e(this,t,i,r)}}));var QR=Vn,zR=Fh,YR=c([].reverse),qR=[1,2];QR({target:"Array",proto:!0,forced:String(qR)===String(qR.reverse())},{reverse:function(){return zR(this)&&(this.length=this.length),YR(this)}});var XR=Vn,$R=Cc,ZR=t,eC=je,tC=ve,iC=aa,rC=$u,nC=en,oC=$R&&$R.prototype;if(XR({target:"Promise",proto:!0,real:!0,forced:!!$R&&ZR((function(){oC.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=iC(this,eC("Promise")),i=tC(e);return this.then(i?function(i){return rC(t,e()).then((function(){return i}))}:e,i?function(i){return rC(t,e()).then((function(){throw i}))}:e)}}),tC($R)){var sC=eC("Promise").prototype.finally;oC.finally!==sC&&nC(oC,"finally",sC,{unsafe:!0})}var aC=Vn,cC=Fe,lC=c,uC=y,dC=ve,hC=T,pC=ld,mC=hd,_C=rt,fC=Sd,gC=Wp,TC=_e("replace"),vC=TypeError,SC=lC("".indexOf);lC("".replace);var yC=lC("".slice),EC=Math.max,IC=function(e,t,i){return i>e.length?-1:""===t?i:SC(e,t,i)};aC({target:"String",proto:!0},{replaceAll:function(e,t){var i,r,n,o,s,a,c,l,u=uC(this),d=0,h=0,p="";if(!hC(e)){if(pC(e)&&(i=mC(uC(fC(e))),!~SC(i,"g")))throw vC("`.replaceAll` does not allow non-global regexes");if(r=_C(e,TC))return cC(r,e,u,t)}for(n=mC(u),o=mC(e),(s=dC(t))||(t=mC(t)),a=o.length,c=EC(1,a),d=IC(n,o,0);-1!==d;)l=s?mC(t(o,d,n)):gC(o,n,d,[],void 0,t),p+=yC(n,h,d)+l,h=d+a,d=IC(n,o,d+c);return h<n.length&&(p+=yC(n,h)),p}});let RC=!0,CC=!0;function AC(e,t,i){const r=e.match(t);return r&&r.length>=i&&parseInt(r[i],10)}function bC(e,t,i){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,n=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return n.apply(this,arguments);const o=e=>{const t=i(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,o),n.apply(this,[e,o])};const o=r.removeEventListener;r.removeEventListener=function(e,i){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(i))return o.apply(this,arguments);const r=this._eventMap[t].get(i);return this._eventMap[t].delete(i),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function kC(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(RC=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function DC(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(CC=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function wC(){if("object"==typeof window){if(RC)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function OC(e,t){CC&&console.warn(e+" is deprecated, please use "+t+" instead.")}function NC(e){return"[object Object]"===Object.prototype.toString.call(e)}function PC(e){return NC(e)?Object.keys(e).reduce((function(t,i){const r=NC(e[i]),n=r?PC(e[i]):e[i],o=r&&!Object.keys(n).length;return void 0===n||o?t:Object.assign(t,{[i]:n})}),{}):e}function MC(e,t,i){t&&!i.has(t.id)&&(i.set(t.id,t),Object.keys(t).forEach((r=>{r.endsWith("Id")?MC(e,e.get(t[r]),i):r.endsWith("Ids")&&t[r].forEach((t=>{MC(e,e.get(t),i)}))})))}function LC(e,t,i){const r=i?"outbound-rtp":"inbound-rtp",n=new Map;if(null===t)return n;const o=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((t=>{e.forEach((i=>{i.type===r&&i.trackId===t.id&&MC(e,i,n)}))})),n}const VC=wC;function xC(e,t){const i=e&&e.navigator;if(!i.mediaDevices)return;const r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((i=>{if("require"===i||"advanced"===i||"mediaSource"===i)return;const r="object"==typeof e[i]?e[i]:{ideal:e[i]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const n=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[n("min",i)]=r.ideal,t.optional.push(e),e={},e[n("max",i)]=r.ideal,t.optional.push(e)):(e[n("",i)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[n("",i)]=r.exact):["min","max"].forEach((e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[n(e,i)]=r[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},n=function(e,n){if(t.version>=61)return n(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const s=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||s)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return i.mediaDevices.enumerateDevices().then((i=>{i=i.filter((e=>"videoinput"===e.kind));let s=i.find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!s&&i.length&&t.includes("back")&&(s=i[i.length-1]),s&&(e.video.deviceId=o.exact?{exact:s.deviceId}:{ideal:s.deviceId}),e.video=r(e.video),VC("chrome: "+JSON.stringify(e)),n(e)}))}e.video=r(e.video)}return VC("chrome: "+JSON.stringify(e)),n(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=function(e,t,r){n(e,(e=>{i.webkitGetUserMedia(e,t,(e=>{r&&r(o(e))}))}))}.bind(i),i.mediaDevices.getUserMedia){const e=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(t){return n(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(o(e))))))}}}function UC(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function FC(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(i=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===i.track.id)):{track:i.track};const n=new Event("track");n.track=i.track,n.receiver=r,n.transceiver={receiver:r},n.streams=[t.stream],this.dispatchEvent(n)})),t.stream.getTracks().forEach((i=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===i.id)):{track:i};const n=new Event("track");n.track=i,n.receiver=r,n.transceiver={receiver:r},n.streams=[t.stream],this.dispatchEvent(n)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else bC(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function BC(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let n=i.apply(this,arguments);return n||(n=t(this,e),this._senders.push(n)),n};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function HC(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const n=function(e){const t={};return e.result().forEach((e=>{const i={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{i[t]=e.stat(t)})),t[i.id]=i})),t},o=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const r=function(e){i(o(n(e)))};return t.apply(this,[r,e])}return new Promise(((e,i)=>{t.apply(this,[function(t){e(o(n(t)))},i])})).then(i,r)}}function jC(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>LC(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),bC(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>LC(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,i,r;return this.getSenders().forEach((i=>{i.track===e&&(t?r=!0:t=i)})),this.getReceivers().forEach((t=>(t.track===e&&(i?r=!0:i=t),t.track===e))),r||t&&i?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():i?i.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function WC(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){if(!i)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[i.id]?-1===this._shimmedLocalStreams[i.id].indexOf(r)&&this._shimmedLocalStreams[i.id].push(r):this._shimmedLocalStreams[i.id]=[i,r],r};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();i.apply(this,arguments);const r=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const i=this._shimmedLocalStreams[t].indexOf(e);-1!==i&&this._shimmedLocalStreams[t].splice(i,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),n.apply(this,arguments)}}function GC(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return WC(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=i.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}r.apply(this,[t])};const n=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let i=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],n=e._streams[r.id];i=i.replace(new RegExp(n.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:i})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,i){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const n=this._streams[i.id];if(n)n.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const r=new e.MediaStream([t]);this._streams[i.id]=r,this._reverseStreams[r.id]=i,this.addStream(r)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const i=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?i.apply(this,[t=>{const i=o(this,t);e[0].apply(null,[i])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):i.apply(this,arguments).then((e=>o(this,e)))}};e.RTCPeerConnection.prototype[t]=r[t]}));const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let i=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],n=e._streams[r.id];i=i.replace(new RegExp(r.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:i})}(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=a.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((i=>{this._streams[i].getTracks().find((t=>e.track===t))&&(t=this._streams[i])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function JC(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const i=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}))}function KC(e,t){bC(e,"negotiationneeded",(e=>{const i=e.target;if(!(t.version<72||i.getConfiguration&&"plan-b"===i.getConfiguration().sdpSemantics)||"stable"===i.signalingState)return e}))}var QC=Object.freeze({__proto__:null,shimMediaStream:UC,shimOnTrack:FC,shimGetSendersWithDtmf:BC,shimGetStats:HC,shimSenderReceiverGetStats:jC,shimAddTrackRemoveTrackWithNative:WC,shimAddTrackRemoveTrack:GC,shimPeerConnection:JC,fixNegotiationNeeded:KC,shimGetUserMedia:xC,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(i){return t(i).then((t=>{const r=i.video&&i.video.width,n=i.video&&i.video.height,o=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},r&&(i.video.mandatory.maxWidth=r),n&&(i.video.mandatory.maxHeight=n),e.navigator.mediaDevices.getUserMedia(i)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function zC(e,t){const i=e&&e.navigator,r=e&&e.MediaStreamTrack;if(i.getUserMedia=function(e,t,r){OC("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const e=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])},t=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(i){return"object"==typeof i&&"object"==typeof i.audio&&(i=JSON.parse(JSON.stringify(i)),e(i.audio,"autoGainControl","mozAutoGainControl"),e(i.audio,"noiseSuppression","mozNoiseSuppression")),t(i)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const i=t.apply(this,arguments);return e(i,"mozAutoGainControl","autoGainControl"),e(i,"mozNoiseSuppression","noiseSuppression"),i}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(i){return"audio"===this.kind&&"object"==typeof i&&(i=JSON.parse(JSON.stringify(i)),e(i,"autoGainControl","mozAutoGainControl"),e(i,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[i])}}}}function YC(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function qC(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const i=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,o]=arguments;return r.apply(this,[e||null]).then((e=>{if(t.version<53&&!n)try{e.forEach((e=>{e.type=i[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,r)=>{e.set(r,Object.assign({},t,{type:i[t.type]||t.type}))}))}return e})).then(n,o)}}function XC(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function $C(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),bC(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function ZC(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){OC("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function eA(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function tA(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const i=e.length>0;i&&e.forEach((e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const r=t.apply(this,arguments);if(i){const{sender:t}=r,i=t.getParameters();(!("encodings"in i)||1===i.encodings.length&&0===Object.keys(i.encodings[0]).length)&&(i.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(i).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return r})}function iA(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function rA(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function nA(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var oA=Object.freeze({__proto__:null,shimOnTrack:YC,shimPeerConnection:qC,shimSenderGetStats:XC,shimReceiverGetStats:$C,shimRemoveStream:ZC,shimRTCDataChannel:eA,shimAddTransceiver:tA,shimGetParameters:iA,shimCreateOffer:rA,shimCreateAnswer:nA,shimGetUserMedia:zC,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===i.video?i.video={mediaSource:t}:i.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(i)})}});function sA(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((i=>t.call(this,i,e))),e.getVideoTracks().forEach((i=>t.call(this,i,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...i){return i&&i.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const i=e.getTracks();this.getSenders().forEach((e=>{i.includes(e.track)&&this.removeTrack(e)}))})}}function aA(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const i=new Event("addstream");i.stream=t,e.dispatchEvent(i)}))}),t.apply(e,arguments)}}}function cA(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,i=t.createOffer,r=t.createAnswer,n=t.setLocalDescription,o=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],n=i.apply(this,[r]);return t?(n.then(e,t),Promise.resolve()):n},t.createAnswer=function(e,t){const i=arguments.length>=2?arguments[2]:arguments[0],n=r.apply(this,[i]);return t?(n.then(e,t),Promise.resolve()):n};let a=function(e,t,i){const r=n.apply(this,[e]);return i?(r.then(t,i),Promise.resolve()):r};t.setLocalDescription=a,a=function(e,t,i){const r=o.apply(this,[e]);return i?(r.then(t,i),Promise.resolve()):r},t.setRemoteDescription=a,a=function(e,t,i){const r=s.apply(this,[e]);return i?(r.then(t,i),Promise.resolve()):r},t.addIceCandidate=a}function lA(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,i=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>i(uA(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,i,r){t.mediaDevices.getUserMedia(e).then(i,r)}.bind(t))}function uA(e){return e&&void 0!==e.video?Object.assign({},e,{video:PC(e.video)}):e}function dA(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,i){if(e&&e.iceServers){const t=[];for(let i=0;i<e.iceServers.length;i++){let r=e.iceServers[i];void 0===r.urls&&r.url?(OC("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[i])}e.iceServers=t}return new t(e,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function hA(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function pA(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const i=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0!==e.offerToReceiveVideo||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function mA(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var _A=Object.freeze({__proto__:null,shimLocalStreamsAPI:sA,shimRemoteStreamsAPI:aA,shimCallbacksAPI:cA,shimGetUserMedia:lA,shimConstraints:uA,shimRTCIceServerUrls:dA,shimTrackEventTransceiver:hA,shimCreateOfferLegacy:pA,shimAudioContext:mA}),fA={},gA={get exports(){return fA},set exports(e){fA=e}};!function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const i=t.splitSections(e);return i&&i[0]},t.getMediaSections=function(e){const i=t.splitSections(e);return i.shift(),i},t.matchPrefix=function(e,i){return t.splitLines(e).filter((e=>0===e.indexOf(i)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const i={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":i.relatedAddress=t[e+1];break;case"rport":i.relatedPort=parseInt(t[e+1],10);break;case"tcptype":i.tcpType=t[e+1];break;case"ufrag":i.ufrag=t[e+1],i.usernameFragment=t[e+1];break;default:void 0===i[t[e]]&&(i[t[e]]=t[e+1])}return i},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const i=e.component;"rtp"===i?t.push(1):"rtcp"===i?t.push(2):t.push(i),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const i={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),i.name=t[0],i.clockRate=parseInt(t[1],10),i.channels=3===t.length?parseInt(t[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const i=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==i?"/"+i:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let i;const r=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<r.length;e++)i=r[e].trim().split("="),t[i[0].trim()]=i[1];return t},t.writeFmtp=function(e){let t="",i=e.payloadType;if(void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const r=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+i+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",i=e.payloadType;return void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+i+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),i={ssrc:parseInt(e.substring(7,t),10)},r=e.indexOf(":",t);return r>-1?(i.attribute=e.substring(t+1,r),i.value=e.substring(r+1)):i.attribute=e.substring(t+1),i},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const i=t.matchPrefix(e,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,i){return{role:"auto",fingerprints:t.matchPrefix(e+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let i="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{i+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),i},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,i){return t.matchPrefix(e+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,i){const r=t.matchPrefix(e+i,"a=ice-ufrag:")[0],n=t.matchPrefix(e+i,"a=ice-pwd:")[0];return r&&n?{usernameFragment:r.substring(12),password:n.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");i.profile=r[2];for(let n=3;n<r.length;n++){const o=r[n],s=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(s){const r=t.parseRtpMap(s),n=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(r.parameters=n.length?t.parseFmtp(n[0]):{},r.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),i.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(r.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{i.headerExtensions.push(t.parseExtmap(e))}));const n=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach((e=>{n.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),i},t.writeRtpDescription=function(e,i){let r="";r+="m="+e+" ",r+=i.codecs.length>0?"9":"0",r+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=i.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",i.codecs.forEach((e=>{r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));let n=0;return i.codecs.forEach((e=>{e.maxptime>n&&(n=e.maxptime)})),n>0&&(r+="a=maxptime:"+n+"\r\n"),i.headerExtensions&&i.headerExtensions.forEach((e=>{r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){const i=[],r=t.parseRtpParameters(e),n=-1!==r.fecMechanisms.indexOf("RED"),o=-1!==r.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),a=s.length>0&&s[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));l.length>0&&l[0].length>1&&l[0][0]===a&&(c=l[0][1]),r.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&c&&(t.rtx={ssrc:c}),i.push(t),n&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:a,mechanism:o?"red+ulpfec":"red"},i.push(t))}})),0===i.length&&a&&i.push({ssrc:a});let u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,i.forEach((e=>{e.maxBitrate=u}))),i},t.parseRtcpParameters=function(e){const i={},r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];r&&(i.cname=r.value,i.ssrc=r.ssrc);const n=t.matchPrefix(e,"a=rtcp-rsize");i.reducedSize=n.length>0,i.compound=0===n.length;const o=t.matchPrefix(e,"a=rtcp-mux");return i.mux=o.length>0,i},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let i;const r=t.matchPrefix(e,"a=msid:");if(1===r.length)return i=r[0].substring(7).split(" "),{stream:i[0],track:i[1]};const n=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return n.length>0?(i=n[0].value.split(" "),{stream:i[0],track:i[1]}):void 0},t.parseSctpDescription=function(e){const i=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");let n;r.length>0&&(n=parseInt(r[0].substring(19),10)),isNaN(n)&&(n=65536);const o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:i.fmt,maxMessageSize:n};const s=t.matchPrefix(e,"a=sctpmap:");if(s.length>0){const e=s[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:n}}},t.writeSctpDescription=function(e,t){let i=[];return i="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&i.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,i,r){let n;const o=void 0!==i?i:2;return n=e||t.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+n+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,i){const r=t.splitLines(e);for(let e=0;e<r.length;e++)switch(r[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[e].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const i=t.splitLines(e)[0].substring(2).split(" ");return{kind:i[0],port:parseInt(i[1],10),protocol:i[2],fmt:i.slice(3).join(" ")}},t.parseOLine=function(e){const i=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:i[0],sessionId:i[1],sessionVersion:parseInt(i[2],10),netType:i[3],addressType:i[4],address:i[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const i=t.splitLines(e);for(let e=0;e<i.length;e++)if(i[e].length<2||"="!==i[e].charAt(1))return!1;return!0},e.exports=t}(gA);var TA=fA,vA=function(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(i){if("default"!==i&&!(i in e)){var r=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,r.get?r:{enumerable:!0,get:function(){return t[i]}})}}))})),Object.freeze(e)}({__proto__:null,default:TA},[fA]);function SA(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const i=new t(e),r=TA.parseCandidate(e.candidate);for(const e in r)e in i||Object.defineProperty(i,e,{value:r[e]});return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,bC(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function yA(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||bC(e,"icecandidate",(e=>{if(e.candidate){const t=TA.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function EA(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=TA.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=TA.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const i=parseInt(t[1],10);return i!=i?-1:i}(arguments[0]),i=function(e){let i=65536;return"firefox"===t.browser&&(i=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),i}(e),r=function(e,i){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const n=TA.matchPrefix(e.sdp,"a=max-message-size:");return n.length>0?r=parseInt(n[0].substring(19),10):"firefox"===t.browser&&-1!==i&&(r=2147483637),r}(arguments[0],e);let n;n=0===i&&0===r?Number.POSITIVE_INFINITY:0===i||0===r?Math.max(i,r):Math.min(i,r);const o={};Object.defineProperty(o,"maxMessageSize",{get:()=>n}),this._sctp=o}return i.apply(this,arguments)}}function IA(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const i=e.send;e.send=function(){const r=arguments[0],n=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&n>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return i.apply(e,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=i.apply(this,arguments);return t(e,this),e},bC(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function RA(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const i=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const i=new Event("connectionstatechange",e);t.dispatchEvent(i)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}}))}function CA(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const i=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:i}):t.sdp=i}return i.apply(this,arguments)}}function AA(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.addIceCandidate;i&&0!==i.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function bA(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.setLocalDescription;i&&0!==i.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return i.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?i.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>i.apply(this,[e])))})}var kA=Object.freeze({__proto__:null,shimRTCIceCandidate:SA,shimRTCIceCandidateRelayProtocol:yA,shimMaxMessageSize:EA,shimSendThrowTypeError:IA,shimConnectionState:RA,removeExtmapAllowMixed:CA,shimAddIceCandidateNullOrEmpty:AA,shimParameterlessSetLocalDescription:bA});!function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const i=wC,r=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:i}=e;if(i.mozGetUserMedia)t.browser="firefox",t.version=AC(i.userAgent,/Firefox\/(\d+)\./,1);else if(i.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=AC(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!i.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=AC(i.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),n={browserDetails:r,commonShim:kA,extractVersion:AC,disableLog:kC,disableWarnings:DC,sdp:vA};switch(r.browser){case"chrome":if(!QC||!JC||!t.shimChrome)return i("Chrome shim is not included in this adapter release."),n;if(null===r.version)return i("Chrome shim can not determine version, not shimming."),n;i("adapter.js shimming chrome."),n.browserShim=QC,AA(e,r),bA(e),xC(e,r),UC(e),JC(e,r),FC(e),GC(e,r),BC(e),HC(e),jC(e),KC(e,r),SA(e),yA(e),RA(e),EA(e,r),IA(e),CA(e,r);break;case"firefox":if(!oA||!qC||!t.shimFirefox)return i("Firefox shim is not included in this adapter release."),n;i("adapter.js shimming firefox."),n.browserShim=oA,AA(e,r),bA(e),zC(e,r),qC(e,r),YC(e),ZC(e),XC(e),$C(e),eA(e),tA(e),iA(e),rA(e),nA(e),SA(e),RA(e),EA(e,r),IA(e);break;case"safari":if(!_A||!t.shimSafari)return i("Safari shim is not included in this adapter release."),n;i("adapter.js shimming safari."),n.browserShim=_A,AA(e,r),bA(e),dA(e),pA(e),cA(e),sA(e),aA(e),hA(e),lA(e),mA(e),SA(e),yA(e),EA(e,r),IA(e),CA(e,r);break;default:i("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var DA,wA=Object.create,OA=Object.defineProperty,NA=Object.defineProperties,PA=Object.getOwnPropertyDescriptor,MA=Object.getOwnPropertyDescriptors,LA=Object.getOwnPropertyNames,VA=Object.getOwnPropertySymbols,xA=Object.getPrototypeOf,UA=Object.prototype.hasOwnProperty,FA=Object.prototype.propertyIsEnumerable,BA=Reflect.get,HA=Math.pow,jA=(e,t,i)=>t in e?OA(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,WA=(e,t)=>{for(var i in t||(t={}))UA.call(t,i)&&jA(e,i,t[i]);if(VA)for(var i of VA(t))FA.call(t,i)&&jA(e,i,t[i]);return e},GA=(e,t)=>NA(e,MA(t)),JA=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),KA=(e,t)=>{for(var i in t)OA(e,i,{get:t[i],enumerable:!0})},QA=(e,t,i)=>(i=null!=e?wA(xA(e)):{},((e,t,i,r)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let i of LA(t))!UA.call(e,i)&&undefined!==i&&OA(e,i,{get:()=>t[i],enumerable:!(r=PA(t,i))||r.enumerable});return e})(!t&&e&&e.__esModule?i:OA(i,"default",{value:e,enumerable:!0}),e)),zA=(e,t,i,r)=>{for(var n,o=r>1?void 0:r?PA(t,i):t,s=e.length-1;s>=0;s--)(n=e[s])&&(o=(r?n(t,i,o):n(o))||o);return r&&o&&OA(t,i,o),o},YA=(e,t,i)=>(jA(e,"symbol"!=typeof t?t+"":t,i),i),qA=(e,t,i)=>BA(xA(e),i,t),XA=(e,t,i)=>new Promise(((r,n)=>{var o=e=>{try{a(i.next(e))}catch(e){n(e)}},s=e=>{try{a(i.throw(e))}catch(e){n(e)}},a=e=>e.done?r(e.value):Promise.resolve(e.value).then(o,s);a((i=i.apply(e,t)).next())})),$A=JA(((e,t)=>{var i=Object.prototype.hasOwnProperty,r="~";function n(){}function o(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function s(e,t,i,n,s){if("function"!=typeof i)throw new TypeError("The listener must be a function");var a=new o(i,n||e,s),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function c(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),c.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)i.call(e,t)&&n.push(r?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},c.prototype.listeners=function(e){var t=r?r+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,o=i.length,s=new Array(o);n<o;n++)s[n]=i[n].fn;return s},c.prototype.listenerCount=function(e){var t=r?r+e:e,i=this._events[t];return i?i.fn?1:i.length:0},c.prototype.emit=function(e,t,i,n,o,s){var a=r?r+e:e;if(!this._events[a])return!1;var c,l,u=this._events[a],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,i),!0;case 4:return u.fn.call(u.context,t,i,n),!0;case 5:return u.fn.call(u.context,t,i,n,o),!0;case 6:return u.fn.call(u.context,t,i,n,o,s),!0}for(l=1,c=new Array(d-1);l<d;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else{var h,p=u.length;for(l=0;l<p;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),d){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,i);break;case 4:u[l].fn.call(u[l].context,t,i,n);break;default:if(!c)for(h=1,c=new Array(d-1);h<d;h++)c[h-1]=arguments[h];u[l].fn.apply(u[l].context,c)}}return!0},c.prototype.on=function(e,t,i){return s(this,e,t,i,!1)},c.prototype.once=function(e,t,i){return s(this,e,t,i,!0)},c.prototype.removeListener=function(e,t,i,n){var o=r?r+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn===t&&(!n||s.once)&&(!i||s.context===i)&&a(this,o);else{for(var c=0,l=[],u=s.length;c<u;c++)(s[c].fn!==t||n&&!s[c].once||i&&s[c].context!==i)&&l.push(s[c]);l.length?this._events[o]=1===l.length?l[0]:l:a(this,o)}return this},c.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new n,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=r,c.EventEmitter=c,void 0!==t&&(t.exports=c)})),ZA=JA(((e,t)=>{var i=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"invalid",names:["value"]}]};Object.keys(i).forEach((function(e){i[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))}))})),eb=JA((e=>{var t=function(e){return String(Number(e))===e?Number(e):e},i=function(e,i,r){var n=e.name&&e.names;e.push&&!i[e.push]?i[e.push]=[]:n&&!i[e.name]&&(i[e.name]={});var o=e.push?{}:n?i[e.name]:i;(function(e,i,r,n){if(n&&!r)i[n]=t(e[1]);else for(var o=0;o<r.length;o+=1)null!=e[o+1]&&(i[r[o]]=t(e[o+1]))})(r.match(e.reg),o,e.names,e.name),e.push&&i[e.push].push(o)},r=ZA(),n=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},o=[],s=t;return e.split(/(\r\n|\r|\n)/).filter(n).forEach((function(e){var t=e[0],n=e.slice(2);"m"===t&&(o.push({rtp:[],fmtp:[]}),s=o[o.length-1]);for(var a=0;a<(r[t]||[]).length;a+=1){var c=r[t][a];if(c.reg.test(n))return i(c,s,n)}})),t.media=o,t};var o=function(e,i){var r=i.split(/=(.+)/,2);return 2===r.length?e[r[0]]=t(r[1]):1===r.length&&i.length>1&&(e[r[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var i=[],r=e.split(" ").map(t),n=0;n<r.length;n+=3)i.push({component:r[n],ip:r[n+1],port:r[n+2]});return i},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var i,r=!1;return"~"!==e[0]?i=t(e):(i=t(e.substring(1,e.length)),r=!0),{scid:i,paused:r}}))}))}})),tb=JA(((e,t)=>{var i=ZA(),r=/%[sdv%]/g,n=function(e){var t=1,i=arguments,n=i.length;return e.replace(r,(function(e){if(t>=n)return e;var r=i[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(r);case"%d":return Number(r);case"%v":return""}}))},o=function(e,t,i){var r=[e+"="+(t.format instanceof Function?t.format(t.push?i:i[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var s=t.names[o];t.name?r.push(i[t.name][s]):r.push(i[t.names[o]])}else r.push(i[t.name]);return n.apply(null,r)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],a=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||s,n=t.innerOrder||a,c=[];return r.forEach((function(t){i[t].forEach((function(i){i.name in e&&null!=e[i.name]?c.push(o(t,i,e)):i.push in e&&null!=e[i.push]&&e[i.push].forEach((function(e){c.push(o(t,i,e))}))}))})),e.media.forEach((function(e){c.push(o("m",i.m[0],e)),n.forEach((function(t){i[t].forEach((function(i){i.name in e&&null!=e[i.name]?c.push(o(t,i,e)):i.push in e&&null!=e[i.push]&&e[i.push].forEach((function(e){c.push(o(t,i,e))}))}))}))})),c.join("\r\n")+"\r\n"}})),ib=JA((e=>{var t=eb(),i=tb();e.write=i,e.parse=t.parse,e.parseFmtpConfig=t.parseFmtpConfig,e.parseParams=t.parseParams,e.parsePayloads=t.parsePayloads,e.parseRemoteCandidates=t.parseRemoteCandidates,e.parseImageAttributes=t.parseImageAttributes,e.parseSimulcastStreamList=t.parseSimulcastStreamList})),rb=QA($A()),nb=((DA=nb||{})[DA.INVALID_PARAMETER=4096]="INVALID_PARAMETER",DA[DA.INVALID_OPERATION=4097]="INVALID_OPERATION",DA[DA.NOT_SUPPORTED=4098]="NOT_SUPPORTED",DA[DA.DEVICE_NOT_FOUND=4099]="DEVICE_NOT_FOUND",DA[DA.INITIALIZE_FAILED=4100]="INITIALIZE_FAILED",DA[DA.SIGNAL_CHANNEL_SETUP_FAILED=16385]="SIGNAL_CHANNEL_SETUP_FAILED",DA[DA.SIGNAL_CHANNEL_ERROR=16386]="SIGNAL_CHANNEL_ERROR",DA[DA.ICE_TRANSPORT_ERROR=16387]="ICE_TRANSPORT_ERROR",DA[DA.JOIN_ROOM_FAILED=16388]="JOIN_ROOM_FAILED",DA[DA.CREATE_OFFER_FAILED=16389]="CREATE_OFFER_FAILED",DA[DA.SIGNAL_CHANNEL_RECONNECTION_FAILED=16390]="SIGNAL_CHANNEL_RECONNECTION_FAILED",DA[DA.UPLINK_RECONNECTION_FAILED=16391]="UPLINK_RECONNECTION_FAILED",DA[DA.DOWNLINK_RECONNECTION_FAILED=16392]="DOWNLINK_RECONNECTION_FAILED",DA[DA.REMOTE_STREAM_NOT_EXIST=16400]="REMOTE_STREAM_NOT_EXIST",DA[DA.CLIENT_BANNED=16448]="CLIENT_BANNED",DA[DA.SERVER_TIMEOUT=16449]="SERVER_TIMEOUT",DA[DA.SUBSCRIPTION_TIMEOUT=16450]="SUBSCRIPTION_TIMEOUT",DA[DA.PLAY_NOT_ALLOWED=16451]="PLAY_NOT_ALLOWED",DA[DA.DEVICE_AUTO_RECOVER_FAILED=16452]="DEVICE_AUTO_RECOVER_FAILED",DA[DA.START_PUBLISH_CDN_FAILED=16453]="START_PUBLISH_CDN_FAILED",DA[DA.STOP_PUBLISH_CDN_FAILED=16454]="STOP_PUBLISH_CDN_FAILED",DA[DA.START_MIX_TRANSCODE_FAILED=16455]="START_MIX_TRANSCODE_FAILED",DA[DA.STOP_MIX_TRANSCODE_FAILED=16456]="STOP_MIX_TRANSCODE_FAILED",DA[DA.NOT_SUPPORTED_H264=16457]="NOT_SUPPORTED_H264",DA[DA.SWITCH_ROLE_FAILED=16458]="SWITCH_ROLE_FAILED",DA[DA.API_CALL_TIMEOUT=16459]="API_CALL_TIMEOUT",DA[DA.SCHEDULE_FAILED=16460]="SCHEDULE_FAILED",DA[DA.API_CALL_ABORTED=16461]="API_CALL_ABORTED",DA[DA.UNKNOWN=65535]="UNKNOWN",DA),ob=nb,sb=class extends Error{constructor(e){let{name:t="RtcError",message:i,code:r=ob.UNKNOWN,extraCode:n=0,constraint:o}=e,s="<".concat(function(e){for(let t in ob)if(ob[t]===e)return t;return"UNKNOWN"}(r)," 0x").concat(r.toString(16),">"),a="".concat(i).concat(o?" constraint: ".concat(o):"").concat(null!=i&&i.includes(s)?"":" ".concat(s));super(a),YA(this,"code"),YA(this,"extraCode"),YA(this,"message"),YA(this,"originMessage"),YA(this,"name"),YA(this,"constraint"),this.code=r,this.extraCode=n,this.name=t,this.message=a,this.constraint=o,this.originMessage=i}getCode(){return this.code}getExtraCode(){return this.extraCode}toString(){return this.originMessage}},ab=sb,cb=((new Date).getTime(),0),lb=function(){return(new Date).getTime()+cb},ub=function(){let e=new Date;return e.setTime(lb()),e.toLocaleString()},db={};KA(db,{bytes2ms:()=>Vw,copyProperties:()=>Lw,deepMerge:()=>fO,env:()=>hb,fibonacci:()=>Ww,formatedTime:()=>vO,getConstructorName:()=>rO,getContainerFromElement:()=>gO,getEnv:()=>kw,getInternalVersion:()=>cO,getLoggerUrl:()=>ww,getMuteStateFromFlag:()=>dO,getNetworkQuality:()=>hO,getNetworkType:()=>Pw,getOSType:()=>Nw,getReconnectionTimeout:()=>Gw,getStringByteLength:()=>EO,getSysInfo:()=>Mw,getTerminalType:()=>Ow,getTurnServer:()=>pO,getValueType:()=>Jw,glog:()=>Bw,ipv4ToUint32:()=>mO,isArray:()=>$w,isArrayOrObject:()=>_O,isAudioWorkletSupported:()=>nO,isBoolean:()=>qw,isConstructor:()=>iO,isEmpty:()=>uO,isFunction:()=>Kw,isLangChinese:()=>Hw,isMediaStreamTrack:()=>Zw,isNumber:()=>Yw,isObject:()=>Xw,isOverseaSdkAppId:()=>Dw,isPlainObject:()=>jw,isPromise:()=>tO,isRemoteTrack:()=>eO,isString:()=>zw,isUndefined:()=>Qw,ms2bytes:()=>Uw,ms2samples:()=>Fw,performanceNow:()=>sO,promiseAny:()=>oO,samples2ms:()=>xw,stringify:()=>SO,stringifyIncludeValue:()=>yO});var hb={};KA(hb,{ANDROID_VERSION:()=>Cb,CHROME_MAJOR_VERSION:()=>Ak,CHROME_VERSION:()=>bk,EDGE_VERSION:()=>Nb,EDG_MAJOR_VERSION:()=>Lb,EDG_VERSION:()=>Mb,FIREFOX_MAJOR_VERSION:()=>wb,FIREFOX_VERSION:()=>Db,HUAWEI_VERSION:()=>_k,IE_VERSION:()=>Kb,IOS_MAIN_VERSION:()=>Pk,IOS_VERSION:()=>Nk,IPADQQB_VERSION:()=>rk,IS_ANDROID:()=>Rb,IS_ANDROID_WEBVIEW:()=>Ok,IS_ANY_SAFARI:()=>Dk,IS_CHROME:()=>Rk,IS_CHROME_OS:()=>ak,IS_CHROMIUM_BASE:()=>Ik,IS_EDG:()=>Pb,IS_EDGE:()=>Ob,IS_ELECTRON:()=>uk,IS_FIREFOX:()=>kb,IS_HEADLESS_CHROME:()=>Ck,IS_HUAWEI:()=>mk,IS_HUAWEIBROWSER:()=>pk,IS_IE:()=>Jb,IS_IE8:()=>Gb,IS_IOS:()=>Ib,IS_IOS_13_OR_14:()=>Vk,IS_IOS_15_1:()=>Lk,IS_IPAD:()=>vb,IS_IPADQQB:()=>ik,IS_IPAD_PRO:()=>Sb,IS_IPHONE:()=>yb,IS_IPOD:()=>Eb,IS_LINUX:()=>sk,IS_LOCAL:()=>xk,IS_MAC:()=>ok,IS_MACQQB:()=>ek,IS_MIBROWSER:()=>dk,IS_MQQB:()=>qb,IS_NATIVE_ANDROID:()=>bb,IS_OLD_ANDROID:()=>Ab,IS_OPPOBROWSER:()=>Tk,IS_SAFARI:()=>kk,IS_SAFARI_15_1:()=>Mk,IS_SAMSUNGBROWSER:()=>fk,IS_SOGOU:()=>Ub,IS_SOGOUM:()=>Vb,IS_TBS:()=>Bb,IS_UCBROWSER:()=>lk,IS_VIVOBROWSER:()=>Sk,IS_WECHAT:()=>Qb,IS_WIN:()=>nk,IS_WQQB:()=>$b,IS_WX:()=>ck,IS_X5MQQB:()=>Yb,IS_XWEB:()=>jb,MACQQB_VERSION:()=>tk,MI_VERSION:()=>hk,MQQB_VERSION:()=>Xb,OPPO_VERSION:()=>vk,SAFARI_VERSION:()=>wk,SAMSUNG_VERSION:()=>gk,SOGOUM_VERSION:()=>xb,SOGOU_VERSION:()=>Fb,TBS_VERSION:()=>Hb,USER_AGENT:()=>pb,VIVO_VERSION:()=>yk,WECHAT_VERSION:()=>zb,WQQB_VERSION:()=>Zb,XWEB_VERSION:()=>Wb,browserInfo:()=>Fk,getBrowserInfo:()=>Bk,getChromeMajorVersion:()=>Ek,getOSName:()=>Gk,getOSString:()=>Jk,getUserAgentData:()=>jk,isLocalStorageEnabled:()=>Uk});var pb="undefined"==typeof navigator?"":navigator.userAgent,mb=e=>new RegExp(e,"i").test(pb),_b=e=>{if(mb(e)){let t=new RegExp("".concat(e,"\\/([\\d.]+)")),i=pb.match(t);if(i&&i[1])return i[1]}return""},fb=e=>{if(mb(e)){let t=new RegExp("".concat(e,"\\/(\\d+)")),i=pb.match(t);if(i&&i[1])return parseFloat(i[1])}return NaN},gb=/AppleWebKit\/([\d.]+)/i.exec(pb),Tb=gb?parseFloat(gb[1]):NaN,vb=mb("iPad"),Sb="undefined"!=typeof navigator&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&mb("Macintosh"),yb=mb("iPhone")&&!vb,Eb=mb("iPod"),Ib=yb||vb||Eb||Sb,Rb=mb("Android"),Cb=function(){if(Rb){let e=pb.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(e){let t=e[1]&&parseFloat(e[1]),i=e[2]&&parseFloat(e[2]);if(t&&i)return parseFloat("".concat(e[1],".").concat(e[2]));if(t)return t}}return NaN}(),Ab=Rb&&mb("webkit")&&Cb<2.3,bb=Rb&&Cb<5&&Tb<537,kb=mb("Firefox"),Db=_b("Firefox"),wb=fb("Firefox"),Ob=mb("Edge"),Nb=_b("Edge"),Pb=mb("Edg"),Mb=_b("Edg"),Lb=fb("Edg"),Vb=mb("SogouMobileBrowser"),xb=_b("SogouMobileBrowser"),Ub=mb("MetaSr\\s"),Fb=_b("MetaSr\\s"),Bb=mb("TBS"),Hb=_b("TBS"),jb=mb("XWEB"),Wb=_b("XWEB"),Gb=mb("MSIE\\s8\\.0"),Jb=mb("MSIE\\/\\d+"),Kb=function(){if(Jb){let e=/MSIE\s(\d+)\.\d/.exec(pb),t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(pb)&&/rv:11.0/.test(pb)&&(t=11),t}return NaN}(),Qb=mb("(micromessenger|webbrowser)"),zb=_b("MicroMessenger"),Yb=!Bb&&mb("MQQBrowser")&&mb("COVC"),qb=!Bb&&mb("MQQBrowser")&&!mb("COVC"),Xb=qb||Yb?_b("MQQBrowser"):"",$b=!Bb&&mb(" QQBrowser"),Zb=_b(" QQBrowser"),ek=!Bb&&mb("QQBrowserLite"),tk=_b("QQBrowserLite"),ik=!Bb&&mb("MQBHD"),rk=_b("MQBHD"),nk=mb("Windows"),ok=!Ib&&mb("MAC OS X"),sk=!Rb&&mb("Linux"),ak=mb("CrOS"),ck=mb("MicroMessenger"),lk=mb("UCBrowser"),uk=mb("Electron"),dk=mb("MiuiBrowser"),hk=_b("MiuiBrowser"),pk=mb("HuaweiBrowser"),mk=mb("Huawei"),_k=_b("HuaweiBrowser"),fk=mb("SamsungBrowser"),gk=_b("SamsungBrowser"),Tk=mb("HeyTapBrowser"),vk=_b("HeyTapBrowser"),Sk=mb("VivoBrowser"),yk=_b("VivoBrowser"),Ek=()=>fb("Chrome"),Ik=mb("Chrome"),Rk=!Ob&&!Ub&&!Vb&&!Bb&&!jb&&!Pb&&!$b&&!dk&&!pk&&!fk&&!Tk&&!Sk&&Ik,Ck=mb("HeadlessChrome"),Ak=Ek(),bk=_b("Chrome"),kk=!Ik&&!qb&&!Yb&&!ek&&!ik&&mb("Safari"),Dk=kk||Ib,wk=_b("Version"),Ok=/Android.*(wv|.0.0.0)/.test(pb),Nk=(()=>{if(Sb)return wk;if(Ib){let e=pb.match(/OS (\d+)_(\d+)/i);if(e&&e[1]){let t=e[1];return e[2]&&(t+=".".concat(e[2])),t}}return""})(),Pk=Number(Nk.split(".")[0]),Mk="15.1"===wk,Lk="15.1"===Nk,Vk=(()=>{let e=Number(Nk.split(".")[0]);return 14===e||13===e})(),xk="undefined"!=typeof location&&("file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname),Uk=(()=>{let e;return()=>{if(Qw(e))try{e=!!window.localStorage}catch(t){e=!1}return e}})(),Fk=Bk();function Bk(){let e=new Map([[kb,["Firefox",Db]],[Pb,["Edg",Mb]],[Rk,["Chrome",bk]],[kk,["Safari",wk]],[Bb,["TBS",Hb]],[jb,["XWEB",Wb]],[Qb&&yb,["WeChat",zb]],[$b,["QQ(Win)",Zb]],[qb,["QQ(Mobile)",Xb]],[Yb,["QQ(Mobile X5)",Xb]],[ek,["QQ(Mac)",tk]],[ik,["QQ(iPad)",rk]],[dk,["MI",hk]],[pk,["HW",_k]],[fk,["Samsung",gk]],[Tk,["OPPO",vk]],[Sk,["VIVO",yk]],[Ob,["EDGE",Nb]],[Vb,["SogouMobile",xb]],[Ub,["Sogou",Fb]]]),t="unknown",i="unknown";return e.has(!0)&&([t,i]=e.get(!0)),{name:t,version:i}}var Hk=null;function jk(){return XA(this,null,(function*(){if(Hk)return Hk;if(!navigator.userAgentData||!Kw(navigator.userAgentData.getHighEntropyValues))return null;try{return Hk=yield navigator.userAgentData.getHighEntropyValues(["architecture","bitness","model","platformVersion","fullVersionList"])}catch(e){return null}}))}var Wk=new Map([[Rb,"Android"],[Ib,"iOS"],[nk,"Windows"],[ok,"MacOS"],[sk,"Linux"],[ak,"ChromeOS"]]),Gk=function(){return Wk.get(!0)?Wk.get(!0):Hk?Hk.platform:"unknown"},Jk=()=>{let e=Gk();return e+="/".concat(Fk.name,"/").concat(kk?Fk.version:Fk.version.split(".")[0]),null!=Hk&&Hk.platformVersion&&(e+="/".concat(Hk.platformVersion)),null!=Hk&&Hk.architecture&&(e+="/".concat(Hk.architecture)),e},Kk={};KA(Kk,{AUDIO_MUTE_BIT:()=>ND,AUDIO_STAT_BIT:()=>OD,AUX_STAT_BIT:()=>wD,AUX_STREAM_MSID:()=>LD,BACKEND_ENV:()=>AD,BASE_DOC_URL:()=>cD,BASE_HOST:()=>nD,CAPABILITIES_KEYS:()=>Aw,CLASS_NAME:()=>pw,CLOUD_CONSOLE_URL:()=>aD,DATA_FREEZE_TIMING:()=>sw,DOC_URL:()=>lD,DTLS_STATE_UNKNOWN:()=>JD,ENV_NAME:()=>mD,EXCHANGE_SDP_TIMEOUT:()=>tw,INTERVAL:()=>Rw,IS_WORKER:()=>Zk,IS_WORKLET:()=>eD,KIBANA_EVENT:()=>$D,LOCAL_STREAM_PUBLISH_STATE:()=>ow,LOGGER_CMD_TYPE:()=>pD,LOGGER_DOMAIN:()=>uD,LOGGER_DOMAIN_OVERSEA:()=>dD,LOG_LEVEL:()=>_D,LOG_LEVEL_NAME:()=>Tw,MAIN_STREAM_MSID:()=>MD,MICROPHONE_COMMUNICATIONS:()=>gw,MICROPHONE_DEFAULT:()=>_w,NAME:()=>RD,NETWORK_TYPE:()=>TD,NOT_SUPPORTED_H264:()=>nw,PAUSED_RETRY_COUNT:()=>mw,PEERCONNECTION_CONNECTING_TIMEOUT:()=>uw,PEER_CONNECTION_STATE:()=>KD,PEER_LEAVE_REASON:()=>vw,RAF:()=>Iw,RECOVER_CAPTURE_INTERVAL:()=>yw,REMOTE_STREAM_TYPE_AUX:()=>xD,REMOTE_STREAM_TYPE_MAIN:()=>VD,RENDER_FREEZE_TIMING:()=>aw,RIC:()=>Ew,SCHEDULE_DOMAIN:()=>dw,SCHEDULE_TIMEOUT:()=>hw,SDP_SEMANTICS_PLAN_B:()=>rw,SDP_SEMANTICS_UNIFIED_PLAN:()=>iw,SECOND_HOST:()=>oD,SIGNAL_PING_PONG_INTERVAL:()=>gD,SIGNAL_PING_TIMEOUT:()=>fD,SIGNAL_RECONNECTION_COUNT:()=>XD,SMALL_STAT_BIT:()=>DD,SPEAKER_DEFAULT:()=>fw,STORAGE_EXPIRES_TIME:()=>vD,STREAM_TYPE_BIG:()=>cw,STREAM_TYPE_SMALL:()=>lw,SUBSCRIBE_SMALL_RETRY_COUNT:()=>Sw,SYNC_USER_LIST_INTERVAL:()=>ZD,Scene:()=>bD,Switch:()=>SD,THIRD_HOST:()=>sD,TIMEOUT:()=>Cw,TRANSPORT_DIRECTION:()=>CD,TRTC_ERROR_ASSISTANCE:()=>hD,TRTC_QUALITY_BAD:()=>jD,TRTC_QUALITY_DISCONNECTED:()=>GD,TRTC_QUALITY_EXCELLENT:()=>FD,TRTC_QUALITY_GOOD:()=>BD,TRTC_QUALITY_POOR:()=>HD,TRTC_QUALITY_UNKNOWN:()=>UD,TRTC_QUALITY_VERY_BAD:()=>WD,UPDATE_OFFER_TIMEOUT:()=>ew,VIDEO_MUTE_BIT:()=>PD,VIDEO_STAT_BIT:()=>kD,audioProfileMap:()=>yD,getRetryCount:()=>YD,getScriptDir:()=>tD,innerVersion:()=>Qk,loggerProxy:()=>iD,screenProfileMap:()=>ID,setLoggerProxy:()=>rD,setRetryCount:()=>zD,setVersion:()=>Yk,version:()=>zk,videoProfileMap:()=>ED});var Qk="4.15.00.1600",zk="5.0.0";function Yk(e){zk=e;let[t,i,r]=e.split(".").map((e=>parseInt(e,10)));Qk="".concat(t,".").concat(Math.min(15,i),".").concat(Math.min(15,r),".").concat(i.toString().padStart(2,"0")).concat(r.toString().padStart(2,"0"))}var qk,Xk,$k,Zk="undefined"!=typeof importScripts,eD="undefined"!=typeof registerProcessor,tD=()=>{let e=Zk?self.location.href:document.currentScript.src;return e.substring(0,e.lastIndexOf("/")+1)},iD="",rD=e=>iD=e,nD="web.sdk.qcloud.com",oD="web.sdk.tencent.cn",sD="web.sdk.cloud.tencent.cn",aD="https://console.cloud.tencent.com/trtc",cD="https://".concat(nD,"/trtc/webrtc/v5/doc"),lD="".concat(cD,"/zh-cn/"),uD="https://yun.tim.qq.com",dD="https://apisgp.my-imcloud.com",hD="trtc_error_assistance",pD={LOG:"jssdk_log",EVENT:"jssdk_event",KEY_POINT:"jssdk_new_endreport"},mD={QCLOUD:"qcloud",OLD_CLOUD_LADDER:"trtc",WEBRTC:"webrtc"},_D=(($k=_D||{})[$k.TRACE=0]="TRACE",$k[$k.DEBUG=1]="DEBUG",$k[$k.INFO=2]="INFO",$k[$k.WARN=3]="WARN",$k[$k.ERROR=4]="ERROR",$k[$k.NONE=5]="NONE",$k),fD=18e3,gD=2e3,TD={unknown:0,wifi:1,"3g":2,"2g":3,"4g":4,wired:5},vD=6048e5,SD=((Xk=SD||{}).USEAINS="useAINS",Xk.ENABLEDEBUG="enableDebug",Xk.USEV2="useV2",Xk.USEWT="useWt",Xk),yD={standard:{sampleRate:48e3,channelCount:1,bitrate:40},"standard-stereo":{sampleRate:48e3,channelCount:2,bitrate:64},high:{sampleRate:48e3,channelCount:1,bitrate:192},"high-stereo":{sampleRate:48e3,channelCount:2,bitrate:192}},ED={"120p":{width:160,height:120,frameRate:15,bitrate:200},"120p_2":{width:160,height:120,frameRate:15,bitrate:100},"180p":{width:320,height:180,frameRate:15,bitrate:350},"180p_2":{width:320,height:180,frameRate:15,bitrate:150},"240p":{width:320,height:240,frameRate:15,bitrate:400},"240p_2":{width:320,height:240,frameRate:15,bitrate:200},"360p":{width:640,height:360,frameRate:15,bitrate:800},"360p_2":{width:640,height:360,frameRate:15,bitrate:400},"480p":{width:640,height:480,frameRate:15,bitrate:900},"480p_2":{width:640,height:480,frameRate:15,bitrate:500},"720p":{width:1280,height:720,frameRate:15,bitrate:1500},"1080p":{width:1920,height:1080,frameRate:15,bitrate:2e3},"1440p":{width:2560,height:1440,frameRate:30,bitrate:4860},"4K":{width:3840,height:2160,frameRate:30,bitrate:9e3}},ID={"480p":{width:640,height:480,frameRate:5,bitrate:900},"480p_2":{width:640,height:480,frameRate:30,bitrate:1e3},"720p":{width:1280,height:720,frameRate:5,bitrate:1200},"720p_2":{width:1280,height:720,frameRate:30,bitrate:3e3},"1080p":{width:1920,height:1080,frameRate:5,bitrate:1600},"1080p_2":{width:1920,height:1080,frameRate:30,bitrate:4e3}},RD={CANVAS:"canvas",AUDIO:"audio",VIDEO:"video",SCREEN:"screen",SMALL:"small",BIG:"big",AUXILIARY:"auxiliary",SMALL_VIDEO:"smallVideo",FACING_MODE_USER:"user",FACING_MODE_ENVIRONMENT:"environment",MUTE:"mute",UNMUTE:"unmute",ENDED:"ended",PLAYING:"playing",PAUSE:"pause",ERROR:"error",LOADEDDATA:"loadeddata",AUDIO_INPUT:"audioinput",VIDEO_INPUT:"videoinput",DETAIL:"detail",TEXT:"text",MAIN:"main",BACKUP:"backup",BANNED:"banned",KICK:"kick",USER_TIME_OUT:"user_time_out",ROOM_DISBAND:"room_disband",SEI_MESSAGE:"sei-message",ADD:"add",REMOVE:"remove",REPLACE:"replace",TRACK:"track",SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe",TRANSCEIVER_DIRECTION_SENDONLY:"sendonly",TRANSCEIVER_DIRECTION_RECVONLY:"recvonly",ENTER_PICTURE_IN_PICTURE:"enterpictureinpicture",LEAVE_PICTURE_IN_PICTURE:"leavepictureinpicture"},CD={INACTIVE:"inactive",SENDONLY:"sendonly",RECVONLY:"recvonly"},AD={OLD_CLOUD_LADDER:"wss://trtc.rtc.qq.com",WEBRTC:"wss://webrtc.qq.com"},bD=((qk=bD||{}).LIVE="live",qk.RTC="rtc",qk),kD=1,DD=2,wD=4,OD=8,ND=64,PD=16,MD="5Y2wZK8nANNAoVw6dSAHVjNxrD1ObBM2kBPV",LD="224d130c-7b5c-415b-aaa2-79c2eb5a6df2",VD=RD.MAIN,xD=RD.AUXILIARY,UD=0,FD=1,BD=2,HD=3,jD=4,WD=5,GD=6,JD="unknown",KD={NEW:"new",CONNECTING:"connecting",FAILED:"failed",CLOSED:"closed",DISCONNECTED:"disconnected",CONNECTED:"connected",COMPLETED:"completed"},QD=1/0;function zD(e){QD=e}function YD(){return QD}var qD,XD=30,$D={JOIN:"join",DELTA_JOIN:"delta-join",REJOIN:"rejoin",LEAVE:"leave",DELTA_LEAVE:"delta-leave",PUBLISH:"publish",DELTA_PUBLISH:"delta-publish",UNPUBLISH:"unpublish",SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe",UPLINK_CONNECTION:"uplink-connection",UPLINK_RECONNECTION:"uplink-reconnection",DOWNLINK_CONNECTION:"downlink-connection",DOWNLINK_RECONNECTION:"downlink-reconnection",ON_TRACK:"ontrack",ICE_CONNECTION_STATE:"iceConnectionState",LOCAL_STREAM_INITIALIZE:"stream-initialize",SIGNAL_CONNECTION:"websocketConnectionState",SIGNAL_RECONNECTION:"websocketReconnectionState",UPDATE_STREAM:"update-stream",RECOVER_LOCAL_AUDIO_TRACK:"recover-local-audio-track",RECOVER_LOCAL_VIDEO_TRACK:"recover-local-video-track",RECOVER_SUBSCRIPTION:"recover-subscription",START_MIX_TRANSCODE:"start-mix-transcode",STOP_MIX_TRANSCODE:"stop-mix-transcode",PLAYER_ERROR:"player-error",SCHEDULE:"schedule",LOAD_WORKLET:"load-worklet",VIDEO_FROZEN_COUNT:"videoFrozenCount",GET_USER_MEDIA_RETRY:"getUserMedia-retry"},ZD=1e4,ew=1e4,tw=1e4,iw="unified-plan",rw="plan-b",nw=1028,ow=((qD=ow||{})[qD.UNPUBLISH=-1]="UNPUBLISH",qD[qD.PUBLISHING=0]="PUBLISHING",qD[qD.PUBLISHED=1]="PUBLISHED",qD),sw=500,aw=1e3,cw=RD.BIG,lw=RD.SMALL,uw=1e4,dw={MAIN:"schedule.rtc.qq.com",BACKUP:"schedule.rtc.qcloud.com",MAIN_OVERSEA:"schedule.rtc.tencentcloud.com",BACKUP_OVERSEA:"schedule-ecdn.rtc.tencentcloud.com"},hw=2e3,pw={TRTC:"TRTC",CLIENT:"Client",LOCAL_STREAM:"LocalStream",REMOTE_STREAM:"RemoteStream",STREAM:"Stream"},mw=5,_w="default",fw=_w,gw="communications",Tw=Object.keys(_D),vw=["normal leave","timeout leave","kick","role change"],Sw=10,yw=2e3,Ew="ric",Iw="raf",Rw="interval",Cw="timeout",Aw=["width","height","frameRate","facingMode","sampleRate","sampleSize","channelCount","deviceId"],bw=1e8,kw=function(){return new URLSearchParams(location.search).get("trtc_env")||""},Dw=e=>Number(e)<14e8,ww=function(e,t){let i;i=iD||(Dw(e)?dD:uD);let r=Math.floor(Math.random()*HA(2,31));return"".concat(i,"/v5/AVQualityReportSvc/C2S?random=").concat(r,"&sdkappid=").concat(e,"&cmdtype=").concat(t)};function Ow(){return Rb?4:yb?2:vb?3:ok?12:nk?5:sk?13:1}function Nw(){return Rb?"Android":yb?"iPhone":vb?"iPad":ok?"Mac":nk?"Windows":sk?"Linux":"unknown"}function Pw(){let{userAgent:e,connection:t}=navigator,i=(e.match(/NetType\/\S+/)||[])[0]||"";i=i.toLowerCase().replace("nettype/",""),"3gnet"===i&&(i="3g");let r=t&&t.type&&t.type.toLowerCase(),n=t&&t.effectiveType&&t.effectiveType.toLowerCase();"slow-2"===n&&(n="2g");let o=i||"unknown";if(r)switch(r){case"cellular":case"wimax":o=n||"unknown";break;case"wifi":o="wifi";break;case"ethernet":o="wired";break;default:o="unknown"}return o}var Mw=function(e){return{AbilityOption:{AVLimit:e,GeneralLimit:{CPULimit:{uint32_CPU_num:navigator.hardwareConcurrency||0,str_CPU_name:String(navigator.platform),uint32_CPU_maxfreq:0,model:"",uint32_total_memory:0},uint32_terminal_type:Ow(),uint32_device_type:0,str_os_verion:Nw(),uint32_link_type:1,str_client_version:Qk,uint32_net_type:TD[Pw()],ua:navigator.userAgent,version:""}}}};function Lw(e,t){for(let i of Reflect.ownKeys(t))if("constructor"!==i&&"prototype"!==i&&"name"!==i){let r=Object.getOwnPropertyDescriptor(t,i)||"";Object.defineProperty(e,i,r)}return e}function Vw(e){return xw(e/4,arguments.length>1&&void 0!==arguments[1]?arguments[1]:48e3)}function xw(e){return 1e3*e/(arguments.length>1&&void 0!==arguments[1]?arguments[1]:48e3)}function Uw(e){return 4*Fw(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:48e3)}function Fw(e){return e*(arguments.length>1&&void 0!==arguments[1]?arguments[1]:48e3)/1e3}var Bw="undefined"!=typeof window&&"function"==typeof window.glog?window.glog:()=>{},Hw=()=>{let e=navigator.language;return e=e.substring(0,2),"zh"===e},jw=function(e){if(!e||"object"!=typeof e||"[object Object]"!=Object.prototype.toString.call(e))return!1;let t=Object.getPrototypeOf(e);if(null===t)return!0;let i=Object.prototype.hasOwnProperty.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&Function.prototype.toString.call(i)===Function.prototype.toString.call(Object)};function Ww(e){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e<=1?t:Ww(e-1,t,(arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)+t)}function Gw(e){return e>8?3e4:1e3*Ww(e)}function Jw(e){return Reflect.apply(Object.prototype.toString,e,[]).replace(/^\[object\s(\w+)\]$/,"$1").toLowerCase()}var Kw=e=>"function"==typeof e,Qw=e=>void 0===e,zw=e=>"string"==typeof e,Yw=e=>"number"==typeof e,qw=e=>"boolean"==typeof e,Xw=e=>"object"===Jw(e),$w=e=>"array"===Jw(e),Zw=e=>Jw(e)==="MediaStreamTrack".toLowerCase(),eO=e=>e.isRemote,tO=e=>"promise"===Jw(e),iO=e=>Kw(e)&&e.prototype.constructor===e,rO=e=>iO(e)?e.prototype.constructor.name:"",nO="undefined"!=typeof AudioWorkletNode;function oO(e){return new Promise(((t,i)=>{let r=[];e.forEach((n=>{n.then(t).catch((t=>{r.push(t),r.length===e.length&&i(r)}))}))}))}function sO(){return performance&&performance.now?Math.floor(performance.now()):Date.now()}var aO=e=>+e<10?"0".concat(e):e,cO=e=>{let t=e.match(/^\d+\.\d+\.\d+/)[0];if(!t)return e;let i=t.split("."),r=aO(i[1])+aO(i[2]);return i[1]-15>0&&(i[1]="15"),i[2]-15>0&&(i[2]="15"),"".concat(i.join("."),".").concat(r)},lO=Object.prototype.hasOwnProperty;function uO(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e||"function"==typeof e||Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(jw(e))switch(Object.prototype.toString.call(e)){case"[object File]":case"[object Map]":case"[object Set]":return 0===e.size;case"[object Object]":for(let t in e)if(lO.call(e,t))return!1;return!0}return!1}function dO(e,t){return{userId:t,hasAudio:!!(e&OD),hasVideo:!!(e&kD),hasAuxiliary:!!(e&wD),hasSmall:!!(e&DD),audioMuted:!!(e&ND),videoMuted:!!(e&PD),audioAvailable:!(!(e&OD)||e&ND),videoAvailable:!(!(e&kD)||e&PD)}}function hO(e,t){return e>50||t>500?5:e>30||t>350?4:e>20||t>200?3:e>10||t>100?2:e>=0||t>=0?1:0}function pO(e){let t={urls:"turn:".concat(e.url)};return!Qw(e.username)&&!Qw(e.credential)&&(t.username=e.username,t.credential=e.credential,t.credentialType="password",Qw(e.credentialType)||(t.credentialType=e.credentialType)),t}function mO(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!zw(e))return 0;let i=e.split(".");return t?(Number(i[0])<<24|Number(i[1])<<16|Number(i[2])<<8|Number(i[3]))>>>0:(Number(i[3])<<24|Number(i[2])<<16|Number(i[1])<<8|Number(i[0]))>>>0}var _O=function(e){return $w(e)||Xw(e)},fO=function(e,t,i,r){if(!_O(e)||!_O(t))return 0;let n,o=0,s=Object.keys(t);for(let a=0,c=s.length;a<c;a++)if(n=s[a],!(Qw(t[n])||i&&i.includes(n)))if(_O(e[n])&&_O(t[n]))o+=fO(e[n],t[n],i,r);else{if(r&&r.includes(t[n]))continue;e[n]!==t[n]&&(e[n]=t[n],o+=1)}return o},gO=e=>zw(e)?document.getElementById(e):e,TO=new Intl.DateTimeFormat("zh-CN",{dateStyle:"short",timeStyle:"medium"}),vO=()=>TO.format(new Date);function SO(e,t){let{keysToInclude:i,keysToExclude:r}=t;try{if($w(e))return"[".concat(e.map((e=>SO(e,{keysToInclude:i,keysToExclude:r}))).join(","),"]");if(!jw(e)||!$w(i)&&!$w(r))return JSON.stringify(e);let t={},n=new Set(i),o=new Set(r);return Object.keys(e).forEach((s=>{(0===o.size&&n.has(s)||0===n.size&&!o.has(s))&&(t[s]=jw(e[s])||$w(e[s])?JSON.parse(SO(e[s],{keysToExclude:r,keysToInclude:i})):e[s])})),JSON.stringify(t)}catch(e){return"{}"}}function yO(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=[];return Object.keys(e).forEach((r=>{t===e[r]&&i.push(r)})),SO(e,{keysToInclude:i})}function EO(e){return e.replace(/[\u4e00-\u9fa5]/g,"aa").length}function IO(e){let{url:t,body:i,method:r,timeout:n}=e,o=new XMLHttpRequest;return new Promise(((e,s)=>{o.onreadystatechange=()=>{if(4===o.readyState)if(o.status>=200&&o.status<300)try{let t=JSON.parse(o.response);e({data:t})}catch(t){e({data:o.response})}else s({status:o.status,statusText:o.statusText||"request failed!"})},o.timeout=n||5e3,o.open(r||"POST",t,!0),o.send(i)}))}var RO,CO=function(e){let{retryFunction:t,settings:i,onError:r,onRetrying:n,onRetryFailed:o,onRetrySuccess:s,context:a}=e;return function(){for(var e=arguments.length,c=new Array(e),l=0;l<e;l++)c[l]=arguments[l];let{retries:u=5,timeout:d=1e3}=i,h=0,p=-1,m=0,_=(e,i)=>XA(this,null,(function*(){let l=a||this;try{let i=yield t.apply(l,c);h>0&&s&&s.call(this,h),h=0,e(i)}catch(t){let s=()=>{clearTimeout(p),h=0,m=2,i(t)},a=()=>{2!==m&&h<(Kw(u)?u():u)?(h++,m=1,Kw(n)&&n.call(this,h,s),p=window.setTimeout((()=>{p=-1,_(e,i)}),Kw(d)?d(h):d)):(s(),Kw(o)&&o.call(this,t))};Kw(r)?r.call(this,{error:t,retry:a,reject:i,retryFuncArgs:c,retryCount:h}):a()}}));return new Promise(_)}},AO=new(QA($A(),1).default),bO=((RO=bO||{}).ROOM_DESTROY="1",RO.JOIN_START="21",RO.JOIN_SCHEDULE_SUCCESS="22",RO.JOIN_SIGNAL_CONNECTION_START="23",RO.JOIN_SIGNAL_CONNECTION_END="24",RO.JOIN_SEND_CMD="25",RO.JOIN_RECEIVED_CMD_RES="26",RO.JOIN_SUCCESS="27",RO.JOIN_FAILED="28",RO.LEAVE_START="51",RO.LEAVE_SEND_CMD="52",RO.LEAVE_SUCCESS="53",RO.PUBLISH_START="61",RO.SEND_FIRST_VIDEO_FRAME="62",RO.PUBLISH_FAILED="63",RO.SUBSCRIBE_START="81",RO.SUBSCRIBE_SUCCESS="82",RO.SUBSCRIBE_FAILED="84",RO.UNSUBSCRIBE_SUCCESS="83",RO.LOCAL_TRACK_CAPTURE_START="101",RO.LOCAL_TRACK_CAPTURE_SUCCESS="102",RO.LOCAL_TRACK_CAPTURE_FAILED="103",RO.LOCAL_TRACK_PUBLISHED="104",RO.LOCAL_TRACK_UNPUBLISHED="105",RO.LOCAL_TRACK_REPLACED="106",RO.SWITCH_DEVICE_SUCCESS="107",RO.TRACK_MUTED="108",RO.TRACK_UNMUTED="109",RO.REMOTE_TRACK_SUBSCRIBED="110",RO.REMOTE_TRACK_UNSUBSCRIBED="111",RO.PLAY_TRACK_START="151",RO.PLAYER_STATE_CHANGED="152",RO.VIDEO_LOADED_DATA="153",RO.AUTOPLAY_DIALOG_CLICK_CONFIRM="154",RO.WORKLET_LOADED_SUCCESS="155",RO.WORKLET_LOADED_FAILED="156",RO.SIGNAL_CONNECTION_STATE_CHANGED="201",RO.PEER_CONNECTION_STATE_CHANGED="202",RO.SINGLE_CONNECTION_STAT="203",RO.HEARTBEAT_REPORT="251",RO.RECEIVED_PUBLISHED_USER_LIST="252",RO.REMOTE_PUBLISH_STATE_CHANGED="253",RO.AUDIO_LEVEL_INTERVAL="260",RO.NETWORK_QUALITY="261",RO.API_SUCCESS_RATE="262",RO),kO=bO,DO=!(Ib||Rb||Ck),wO=new class{constructor(){YA(this,"_isEnableUploadLog",!0),YA(this,"_localJoinedUser",new Map),YA(this,"_queue",[]),YA(this,"_timeoutId",-1),YA(this,"_logLevel",1),YA(this,"_logLevelToUpload",2),!Zk&&!eD&&(this.checkURLParam(),this.installEvents())}get isAbleToUpload(){return this._isEnableUploadLog&&-1!==this._timeoutId}installEvents(){AO.on(kO.JOIN_SCHEDULE_SUCCESS,(e=>{let{schedule:t}=e;var i;(null==(i=null==t?void 0:t.config)?void 0:i.logLevelToUpload)&&_D[t.config.logLevelToUpload]&&(this._logLevelToUpload=t.config.logLevelToUpload)})),AO.on(kO.JOIN_SUCCESS,(e=>{let{room:t}=e;this.addJoinedUser({userId:t.userId,sdkAppId:t.sdkAppId}),this.startUpload()})),AO.once(kO.JOIN_FAILED,(()=>{this.startUpload()})),AO.on(kO.LEAVE_SUCCESS,(e=>{let{room:t}=e;this.deleteJoinedUser(t.userId)}))}startUpload(){-1===this._timeoutId&&this.uploadInterval()}addJoinedUser(e){this._localJoinedUser.set(e.userId,e),this.startUpload()}deleteJoinedUser(e){this._localJoinedUser.delete(e)}uploadInterval(){this.upload().catch((()=>{})),this._timeoutId=window.setTimeout((()=>this.uploadInterval()),2e3)}getLogsToUpload(){let e={map:new Map,splicedQueue:[]};if(this._queue[0].forAllJoinedClients&&0===this._localJoinedUser.size)return e;let t=0;for(;t<this._queue.length&&50!==t;t++){let i=this._queue[t];if(i.forAllJoinedClients)this._localJoinedUser.forEach((t=>{let{userId:r,sdkAppId:n}=t;e.map.has(r)?e.map.get(r).logs.push(i):e.map.set(r,{userId:r,sdkAppId:n,logs:[i]})}));else if(zw(i.userId)&&Yw(i.sdkAppId)){let{userId:t,sdkAppId:r}=i;e.map.has(t)?e.map.get(t).logs.push(i):e.map.set(t,{userId:t,sdkAppId:r,logs:[i]})}}return e.map.size>0&&(e.splicedQueue=this._queue.splice(0,t)),e}upload(){return XA(this,null,(function*(){if(0===this._queue.length||!this._isEnableUploadLog)return;let{map:e,splicedQueue:t}=this.getLogsToUpload();if(0===e.size)return;try{let t=[...e.values()];for(let e=0;e<t.length;e++){let{userId:i,sdkAppId:r,logs:n}=t[e];yield this.uploadLogWithRetry(JSON.stringify({timestamp:ub(),sdkAppId:String(r),userId:i,version:zk,log:n.map((e=>e.log)).join("\n")}),r),n.forEach((e=>e.uploaded=!0))}}catch(e){}let i=t.filter((e=>!e.uploaded));i.length>0&&(this._queue=i.concat(this._queue))}))}uploadLogWithRetry(e,t){return CO({retryFunction:()=>IO({url:ww(t,pD.LOG),body:e,timeout:5e3}),settings:{retries:3,timeout:1e3},onError:e=>{let{retry:t}=e;t()}})()}getPrefix(e){let t=new Date;t.setTime(lb());let i=String(t.getMilliseconds());return"padStart"in String.prototype&&(i=i.toString().padStart(3,"0")),"[".concat(t.toTimeString().replace(/.*(\d{2}:\d{2}:\d{2}).*/,"$1"),":").concat(i,"] <").concat(_D[e],">")}getLogLevel(){return this._logLevel}setLogLevel(e){Qw(_D[e])||(this._logLevel!==e&&this.info("setLogLevel",e),this._logLevel=e)}enableUploadLog(){this._isEnableUploadLog=!0}disableUploadLog(){this.warn("disableUploadLog"),this._isEnableUploadLog=!1}logChunkToString(e){if(zw(e))return e;try{return JSON.stringify(e)}catch(e){return""}}log(e,t){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0,n=arguments.length>4?arguments[4]:void 0;var o;if(t.unshift(this.getPrefix(e)),this._isEnableUploadLog&&e>=this._logLevelToUpload&&this._queue.push({log:t.reduce(((e,t)=>"".concat(e," ").concat(this.logChunkToString(t)).trim()),""),level:e,userId:r,sdkAppId:n,forAllJoinedClients:i}),e<this._logLevel)return;let s=(null==(o=_D[e])?void 0:o.toLowerCase())||"info";DO?console[s]("%cTRTC%c%s","padding: 1px 4px;border-radius: 3px;color: #fff;background: #1E88E5;","display: inline",...t):console[s](...t)}debug(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(1,t)}info(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(2,t)}warn(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(3,t)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(4,t)}createLogger(e){return new class{constructor(e){YA(this,"userId"),YA(this,"remoteUserId"),YA(this,"id"),YA(this,"sdkAppId"),YA(this,"type"),YA(this,"isLocal"),this.id=e.id,this.userId=e.userId,this.sdkAppId=e.sdkAppId,this.remoteUserId=e.remoteUserId,this.isLocal=!qw(e.isLocal)||e.isLocal,this.type=this.isLocal?"":e.type}createChild(e){return Object.setPrototypeOf(e,this)}setUserId(e){this.userId=e}setSdkAppId(e){this.sdkAppId=e}log(e,t){let i=this.isLocal?this.userId:this.remoteUserId;t.unshift("[".concat(this.isLocal?"↑":"↓").concat(this.type&&"main"!==this.type?"*":"").concat(this.id).concat(i?"|".concat(i):"","]")),wO.log(e,t,Qw(this.userId)||uO(this.userId),this.userId,this.sdkAppId)}info(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(2,t)}debug(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(1,t)}warn(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(3,t)}error(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.log(4,t)}}(e)}checkURLParam(){let e=new URLSearchParams(location.search).get("logLevelToUpload"),t=e?Number(e):-1;_D[t]&&(this._logLevelToUpload=t)}},OO=new class{constructor(){YA(this,"_prefix","TRTC"),YA(this,"_queue",new Map),this.checkStorage()}getRealKey(e){return"".concat(this._prefix,"_").concat(e)}checkStorage(){Uk()&&(setInterval(this.doFlush.bind(this),2e4),Object.keys(localStorage).filter((e=>{if(e.startsWith(this._prefix)){let t=JSON.parse(localStorage.getItem(e));if(t&&t.expiresIn<Date.now())return!0}return!1})).forEach((e=>localStorage.removeItem(e))))}doFlush(){if(Uk())try{for(let[e,t]of this._queue)localStorage.setItem(e,JSON.stringify(t))}catch(e){wO.warn(e)}}getItem(e){if(!Uk())return null;try{let t=JSON.parse(localStorage.getItem(this.getRealKey(e)));return t&&t.expiresIn>=Date.now()?t.value:null}catch(e){wO.warn(e)}}setItem(e,t){if(Uk())try{let i={expiresIn:Date.now()+vD,value:t};this._queue.set(this.getRealKey(e),i)}catch(e){wO.warn(e)}}deleteItem(e){if(!Uk())return!1;try{return e=this.getRealKey(e),this._queue.delete(e),localStorage.removeItem(e),!0}catch(e){return wO.warn(e),!1}}clear(){if(Uk())try{localStorage.clear()}catch(e){wO.warn(e)}}},NO={};KA(NO,{HTTPS_API:()=>VN,IS_GET_CAPABILITIES_SUPPORTED:()=>ZN,IS_GET_SETTINGS_SUPPORTED:()=>$N,IS_SEI_SUPPORTED:()=>eP,IS_SPC_SUPPORTED:()=>zN,basis:()=>oP,checkSystemRequirementsInternal:()=>PN,decodeSupportStatus:()=>NN,encodeSupportStatus:()=>ON,getBrowserInfo:()=>RN,getDisplayResolution:()=>UN,isAddTransceiverSupported:()=>QN,isBrowserSupported:()=>CN,isGetReceiversSupported:()=>GN,isGetSendersSupported:()=>JN,isGetTransceiversSupported:()=>KN,isGetUserMediaSupported:()=>FN,isMediaDevicesSupported:()=>bN,isMediaSessionSupported:()=>rP,isMediaStreamTrackProcessorSupported:()=>wN,isReplaceTrackSupported:()=>qN,isScreenCaptureApiAvailable:()=>LN,isSelectedCandidatePair:()=>xN,isSetParametersSupported:()=>XN,isSmallStreamAPISupported:()=>HN,isSmallStreamSupported:()=>jN,isStopTransceiverSupported:()=>YN,isTRTCSupported:()=>MN,isUnifiedPlanDefault:()=>WN,isUsedInHttpProtocol:()=>DN,isWebAudioSupported:()=>BN,isWebCodecSupported:()=>iP,isWebCodecsSupported:()=>AN,isWebRTCSupported:()=>tP,isWebTransportSupported:()=>nP});var PO="API_CALL_TIMEOUT",MO="SIGNAL_CHANNEL_RECONNECTION_FAILED",LO="SIGNAL_CHANNEL_SETUP_FAILED",VO="ERROR_MESSAGE",xO="DOWNLINK_RECONNECTION_FAILED",UO="EXCHANGE_SDP_FAILED",FO="UPLINK_RECONNECTION_FAILED",BO="INVALID_PURE_AUDIO",HO="INVALID_USER_DEFINE_RECORDID",jO="INVALID_USER_DEFINE_PUSH_ARGS",WO="INVALID_JOIN",GO="JOIN_ROOM_TIMEOUT",JO="JOIN_ROOM_FAILED",KO="REJOIN_ROOM_FAILED",QO="INVALID_DESTROY",zO="SUBSCRIBE_FAILED",YO="SWITCH_ROLE_TIMEOUT",qO="SWITCH_ROLE_FAILED",XO="REPEAT_JOIN",$O="CLIENT_DESTROYED",ZO="PLAY_FAILED",eN="NOT_SUPPORTED_HTTP",tN="NOT_SUPPORTED_WEBRTC",iN="NOT_SUPPORTED_H264ENCODE",rN="NOT_SUPPORTED_H264DECODE",nN="MICROPHONE_NOT_FOUND",oN="CAMERA_NOT_FOUND",sN="SIGNAL_RESPONSE_FAILED",aN="CATCH_HANDLER_ERROR",cN="CONNECTION_CLOSED",lN="SEI_DISABLED",uN="SEI_EMPTY",dN="SEI_OVERSIZE",hN="SEI_BEFORE_PUBLISH",pN="CALL_FREQUENCY_LIMIT",mN="CONNECTION_ABORTED",_N="API_CALL_ABORTED",fN={AVOID_REPEATED_CALL:e=>"previous ".concat(e.name,"() is ongoing, please avoid repeated calls."),INVALID_PARAMETER_REQUIRED(e){let{key:t,rule:i,fnName:r,value:n}=e;return"'".concat(t||i.name,"' is a required param when calling ").concat(r,"(), received: ").concat(n,".")},INVALID_PARAMETER_TYPE(e){let{key:t,rule:i,fnName:r,value:n}=e,o="".concat(t||i.name),s="";return s=Array.isArray(i.type)?i.type.join("|"):i.type,"'".concat(o,"' must be type of ").concat(s," when calling ").concat(r,"(), received type: ").concat(Jw(n),".")},INVALID_PARAMETER_EMPTY(e){let{key:t,rule:i,fnName:r,value:n}=e;return"'".concat(t||i.name,"' cannot be '").concat(n,"' when calling ").concat(r,"().")},INVALID_PARAMETER_INSTANCE(e){let{key:t,rule:i,fnName:r,value:n}=e,o="".concat(t||i.name),s="".concat(i.instanceOf.name||i.instanceOf);return"'".concat(o,"' must be instanceof ").concat(s," when calling ").concat(r,"(), received type: ").concat(Jw(n),".")},INVALID_PARAMETER_RANGE(e){let{key:t,rule:i,fnName:r,value:n}=e;return"'".concat(t||i.name,"' must be one of ").concat(i.values.join("|")," when calling ").concat(r,"(), received: ").concat(n,".")},INVALID_PARAMETER_MIN(e){let{key:t,rule:i,fnName:r,value:n}=e;return"the min value of ".concat(t||i.name," is ").concat(i.min,", received: ").concat(n,".")},INVALID_PARAMETER_MAX(e){let{key:t,rule:i,fnName:r,value:n}=e;return"the max value of ".concat(t||i.name," is ").concat(i.max,", received: ").concat(n,".")},API_CALL_TIMEOUT:e=>"".concat(e.commandDesc||e.command," timeout observed."),SIGNAL_CHANNEL_RECONNECTION_FAILED:"signal channel reconnection failed, please check your network.",SIGNAL_CHANNEL_SETUP_FAILED:e=>"SignalChannel setup failure: (errorCode: ".concat(e.errorCode,", errorMsg: ").concat(e.errorMsg," })."),ERROR_MESSAGE(e){let t="".concat(e.type," failed");return e.message&&(t="".concat(t,": ").concat(e.message,".")),t},EXCHANGE_SDP_TIMEOUT:"exchange sdp timeout.",DOWNLINK_RECONNECTION_FAILED:"downlink reconnection failed, please check your network and re-join room.",EXCHANGE_SDP_FAILED:e=>"exchange sdp failed ".concat(e.errMsg,"."),UPDATE_OFFER_TIMEOUT:"update offer timeout observed.",UPLINK_RECONNECTION_FAILED:"uplink reconnection failed, please check your network and publish again.",INVALID_RECORDID:"recordId must be an integer number.",INVALID_PURE_AUDIO:"pureAudioPushMode must be 1 or 2.",INVALID_STREAMID:"streamId must be a sting literal within 64 bytes, and not be empty.",INVALID_USER_DEFINE_RECORDID:"userDefineRecordId must be a sting literal contains (a-zA-Z),(0-9), underline and hyphen, within 64 bytes, and not be empty.",INVALID_USER_DEFINE_PUSH_ARGS:"userDefinePushArgs must be a sting literal within 256 bytes, and not be empty.",INVALID_PROXY:'proxy server url must start with "wss://".',INVALID_JOIN:"duplicate join() called.",INVALID_ROOMID_STRING:e=>"'".concat(e,"' must be validate string when useStringRoomId is true."),INVALID_ROOMID_INTEGER:e=>"'".concat(e,"' must be an integer between [1, 4294967294] when useStringRoomId is false."),INVALID_SIGNAL_CHANNEL:"SignalChannel is not ready yet.",JOIN_ROOM_TIMEOUT:"join room timeout.",JOIN_ROOM_FAILED(e){let{error:t,code:i}=e;return"Failed to join room - ".concat(t," code: ").concat(i)},REJOIN_ROOM_FAILED:e=>"reJoin room: ".concat(e.roomId," failed, please check your network."),INVALID_DESTROY:"please call leave() before destroy().",INVALID_PUBLISH:"please call join() before publish().",INVALID_UNPUBLISH:"stream has not been published yet.",INVALID_AUDIENCE:"no permission to publish() under live/".concat("audience",', please call switchRole("',"anchor",'") firstly before publish().'),INVALID_INITIALIZE:"cannot publish stream because stream is not initialized, is switching device, or has been closed.",INVALID_DUPLICATE_PUBLISHING:e=>"duplicate ".concat(e," stream publishing, please unpublish your prev ").concat(e," stream and then re-publish."),INVALID_SUBSCRIBE_UNDEFINED:"stream is undefined or null.",INVALID_SUBSCRIBE_LOCAL:"stream cannot be LocalStream.",INVALID_REMOTE_STREAM:"remoteStream does not exist because it has been unpublished by remote peer.",SUBSCRIBE_FAILED(e){let{message:t,userId:i,streamType:r}=e;return"failed to subscribe ".concat(i," ").concat(r," stream, reason: ").concat(t,".")},INVALID_ROLE:"switchRole can only be called in live mode.",INVALID_PARAMETER_SWITCH_ROLE:"role could only be set to a value as ".concat("anchor"," or ","audience","."),INVALID_OPERATION_SWITCH_ROLE:"please call join() before switchRole().",SWITCH_ROLE_TIMEOUT:"switchRole timeout.",SWITCH_ROLE_FAILED:e=>"switchRole failed, errCode: ".concat(e.code," errMsg: ").concat(e.message,"."),CLIENT_BANNED:e=>"client was banned because of ".concat(e.message,"."),INVALID_OPERATION_START_PUBLISH_CDN:"please call startPublishCDNStream() after join room and publish the local stream.",INVALID_OPERATION_STOP_PUBLISH_CDN:"please call startPublishCDNStream() before stopPublishCDNStream().",START_PUBLISH_CDN_FAILED:e=>"startPublishCDNStream failed, errMsg: ".concat(e.message,"."),STOP_PUBLISH_CDN_FAILED:e=>"stopPublishCDNStream failed, errMsg: ".concat(e.message,"."),INVALID_STREAM_ID:e=>"'".concat(e,"' can only consist of uppercase and lowercase english letters (a-zA-Z), numbers (0-9), hyphens and underscores."),START_MIX_TRANSCODE:"please call startMixTranscode() after join().",STOP_MIX_TRANSCODE:"please call stopMixTranscode() after startMixTranscode().",INVALID_AUDIO_VOLUME:"interval must be a number.",ENABLE_SMALL_STREAM_PUBLISHED:"Cannot enable small stream after localStream published.",DISABLE_SMALL_STREAM_PUBLISHED:"Cannot disable small stream after localStream published.",NOT_SUPPORTED_SMALL_STREAM:"your browser does not support opening small stream.",INVALID_SMALL_STREAM_PROFILE:"small stream profile is invalid.",INVALID_PARAMETER_REMOTE_STREAM:"remoteStream is invalid.",INVALID_OPERATION_CHANGE_SMALL:"cannot switch to the small stream without subscribing to the video of remoteStream.",REMOTE_NOT_PUBLISH_SMALL_STREAM:"remote peer does not publish small stream.",INVALID_SWITCH_DEVICE:"cannot switch device on current stream.",INVALID_SWITCH_DEVICE_PUBLISHING:"cannot switch device when publishing localStream.",INVALID_REPLACE_TRACK:"cannot replace track when publishing localStream.",INVALID_INITIALIZE_LOCAL_STREAM:"local stream has not initialized yet.",INVALID_ADD_TRACK_REPETITIVE:"previous addTrack is ongoing, please avoid repetitive execution.",INVALID_ADD_TRACK_REMOVING:"cannot add track when a track is removing.",INVALID_ADD_TRACK_PUBLISHING:"cannot add track when publishing localStream.",INVALID_STREAM_INITIALIZED:"your local stream haven't been initialized yet.",INVALID_ADD_TRACK_NUMBER:"a Stream has at most one audio track and one video track.",INVALID_REMOVE_AUDIO_TRACK:"remove audio track is not supported on your browser.",INVALID_REMOVE_AUDIO_ADDING:"cannot remove track when a track is adding.",INVALID_REMOVE_AUDIO_ON:"previous removeTrack is ongoing, please avoid repetitive execution.",INVALID_REMOVE_TRACK_PUBLISHING:"cannot remove track when publishing localStream.",INVALID_REMOVE_TRACK_NOT_TRACK:"localStream has not this track.",INVALID_REMOVE_TRACK_NUMBER:"remove the only video track is not supported, please use replaceTrack or muteVideo.",INVALID_REPLACE_TRACK_NO_TRACK:e=>"cannot replace ".concat(e.kind," track because stream has not ").concat(e.kind," track"),NOT_BUG_PACKAGE:"You need to buy packages, refer to tencent console.",START_MIX_TRANSCODE_FAILED:e=>"startMixTranscode failed, errMsg: ".concat(e.message,"."),STOP_MIX_TRANSCODE_FAILED:e=>"stopMixTranscode failed, errMsg: ".concat(e.message,"."),MIX_TRANSCODE_NOT_STARTED:"mixTranscode has not been started.",CANNOT_LESS_THAN_ZERO(e){let{key:t,rule:i,fnName:r,value:n}=e;return"'".concat(t||i.name,"' cannot be less than 0 when calling ").concat(r,"().")},MIX_PARAMS_VIDEO_FRAMERATE:"'config.videoFramerate' should be an integer between 0 and 30, excluding 0.",MIX_PARAMS_VIDEO_GOP:"'config.videoGOP' should be an integer between 1 and 8.",MIX_PARAMS_AUDIO_BITRATE:"'config.audioBitrate' should be an integer between 32 and 192.",MIX_PARAMS_USER_Z_ORDER:e=>"'".concat(e,"' is required and must be between 1 and 15."),MIX_PARAMS_NOT_SELF:"'config.mixUsers' must contain self.",MIX_PARAMS_USER_STREAM:"'config.videoWidth' and 'config.videoHeight' of output stream should be contain all mix stream.",INVALID_PLAY:"duplicate play() call observed, please stop() firstly.",INVALID_ELEMENT_ID:e=>{let{key:t,fnName:i}=e;return"'".concat(t,"' is not found in the document object when calling ").concat(i,"().")},INVALID_ELEMENT_ID_TYPE:e=>{let{key:t,fnName:i,type:r}=e;return"the element corresponding to '".concat(t,"' must be instanceof HTMLElement when calling ").concat(i,"(), received: ").concat(r,".")},PLAY_FAILED:e=>"".concat(e.media," play failed，browser exception: ").concat(e.error.toString()),INVALID_USERID:"userId cannot be all spaces.",INVALID_CREATE_STREAM_SOURCE:"LocalStream must be created by createStream() with either audio/video or audioSource/videoSource, but can not be mixed with audio/video and audioSource/videoSource.",INVALID_CREATE_STREAM_SCREEN:"screen/video cannot be both true.",INVALID_CREATE_STREAM_AUDIO:"audio/screenAudio cannot be both true.",INVALID_CREATE_STREAM_SCREEN_AUDIO:"when screen is true, screenAudio can be configured.",NOT_SUPPORTED_HTTP:"http protocol does not support the ability to capture microphone, camera and screen. please use https to deploy your page.",NOT_SUPPORTED_WEBRTC:"your browser or environment does not support full WebRTC capabilities.",NOT_SUPPORTED_PROFILE:"your browser does not support setVideoProfile.",NOT_SUPPORTED_MEDIA:"your browser or environment does not support navigator.mediaDevices.",NOT_SUPPORTED_H264ENCODE:"your device does not support H.264 encoding.",NOT_SUPPORTED_H264DECODE:"your device does not support H.264 decoding.",NOT_SUPPORTED_TRACK:e=>"".concat(e,"Track is not supported on your browser."),NOT_SUPPORTED_SWITCH_DEVICE:"switchDevice is not supported on your browser.",NOT_SUPPORTED_CAPTURE:"Your browser or environment does not support screen sharing, please check whether the browser version.",MICROPHONE_NOT_FOUND:"no microphone detected, please check your microphone.",CAMERA_NOT_FOUND:"no camera detected, please check your camera.",SIGNAL_RESPONSE_FAILED:e=>"".concat(e.signalResponse," failed, response code is ").concat(e.code," , errMsg: ").concat(e.message,"."),CATCH_HANDLER_ERROR(e){let{name:t,event:i}=e;return"an error was caught on ".concat(t,".on('").concat(i,"', handler), please check your code on 'handler'.")},API_NOT_EXIST(e){let{name:t}=e;return"experimental api ".concat(t," does not exist.")},REPEAT_JOIN:e=>"[".concat(e,"] is calling client.join api or has already joined room, please avoid repeated join."),CONNECTION_CLOSED:"remoteStream has been unsubscribed or unpublished by remote user.",SUBSCRIBE_ALL_FALSE:"cannot subscribe when both audio & video are false, use client.unsubscribe() instead",CLIENT_DESTROYED(e){let{funName:t}=e;return"failed to call ".concat(t,"() because client was destroyed.")},SEI_NOT_SUPPORT:e=>"not support to sendSEIMessage".concat(!1===e?" without using h264 codec":""),SEI_DISABLED:"SEI is disabled",SEI_EMPTY:"buffer cannot be empty",SEI_OVERSIZE:e=>"buffer size(".concat(e,") is over 1000 Bytes"),SEI_BEFORE_PUBLISH:"please call sendSEIMessage() after publish() success",SEI_NOT_VIDEO:"cannot send sei when localStream has not video.",CALL_FREQUENCY_LIMIT:e=>{let{isSize:t,name:i,timesInSecond:r,maxSizeInSecond:n}=e;return"api ".concat(i," call ").concat(t?"size":"times"," is over ").concat(t?"".concat(n," bytes"):r," in a second.")},CONNECTION_ABORTED:e=>"connection aborted due to: ".concat(e),API_CALL_ABORTED(e){let t;return t=e.message.includes("REMOTE_STREAM_NOT_EXIST")?"Subscribe ".concat(e.userId," ").concat(e.streamType," stream aborted, reason: remote user ").concat(e.userId," unpublished stream."):"API aborted, reason: ".concat(e.message),t},DUPLICATE_AUX:"only one auxiliary stream can be published in a room.",NOT_SUPPORTED_AUX:"publish auxiliary stream is not supported on your browser.",INVALID_PARAMETER_STREAMTYPE:e=>"'streamType' is required when 'userId' is not '*', calling ".concat(e,"()")};function gN(e){return Reflect.apply(Object.prototype.toString,e,[]).replace(/^\[object\s(\w+)\]$/,"$1").toLowerCase()}var TN={AVOID_REPEATED_CALL:e=>"前一个 ".concat(e.name,"() 调用正在进行中, 请避免重复调用。"),INVALID_PARAMETER_REQUIRED(e){let{key:t,rule:i,fnName:r,value:n}=e;return"调用 ".concat(r,"() 方法的时候 '").concat(t||i.name,"' 是必须的参数, 收到的值为: ").concat(n,"。")},INVALID_PARAMETER_TYPE(e){let{key:t,rule:i,fnName:r,value:n}=e,o="".concat(t||i.name),s="";return s=Array.isArray(i.type)?i.type.join("|"):i.type,"调用 ".concat(r,"() 方法的时候 '").concat(o,"' 必须是 ").concat(s," 类型, 收到的类型是: ").concat(gN(n),"。")},INVALID_PARAMETER_EMPTY(e){let{key:t,rule:i,fnName:r,value:n}=e;return"调用 ".concat(r,"() 的时候 '").concat(t||i.name,"' 不能是 '").concat(n,"'。")},INVALID_PARAMETER_INSTANCE(e){let{key:t,rule:i,fnName:r,value:n}=e,o="".concat(t||i.name),s="".concat(i.instanceOf.name||i.instanceOf);return"调用 ".concat(r,"() 的时候 '").concat(o,"' 原型必须是 ").concat(s," , 收到的是: ").concat(gN(n),"。")},INVALID_PARAMETER_RANGE(e){let{key:t,rule:i,fnName:r,value:n}=e;return"调用 ".concat(r,"() 的时候 '").concat(t||i.name,"' 必须是 ").concat(i.values.join("|")," 的其中一种, 收到的是: ").concat(n,"。")},API_CALL_TIMEOUT:e=>"".concat(e.commandDesc||e.command," 超时。"),SIGNAL_CHANNEL_RECONNECTION_FAILED:"信令通道重连失败，请检查你的网络。",SIGNAL_CHANNEL_SETUP_FAILED:e=>"信令通道建立失败: (错误码: ".concat(e.errorCode,", 错误信息: ").concat(e.errorMsg," })。"),ERROR_MESSAGE(e){let t="".concat(e.type," 失败。");return e.message&&(t="".concat(t,": ").concat(e.message,"。")),t},SUBSCRIPTION_TIMEOUT:"远程服务器不响应订阅行为。",EXCHANGE_SDP_TIMEOUT:"交换 sdp 超时，请刷新网络重试。",DOWNLINK_RECONNECTION_FAILED:"下行重连失败，请检查您的网络并重新加入房间。",EXCHANGE_SDP_FAILED:e=>"交换 SDP 失败，原因 ".concat(e.errMsg,"。"),REPLACE_TRACK_INVALID:"LocalStream 发布之后才可以调用 replaceTrack。",UPDATE_OFFER_TIMEOUT:"更新 offer 超时，请刷新网络重试。",UPLINK_RECONNECTION_FAILED:"上行重连失败，请检查您的网络并重新推流。",INVALID_RECORDID:"recordId 必须是数字。",INVALID_PURE_AUDIO:"pureAudioPushMode 必须是数字1或2。",INVALID_STREAMID:"streamId 必须是 64 字节以内的字符串，并且不能为空。",INVALID_USER_DEFINE_RECORDID:"userDefineRecordId 必须是包含 (a-zA-Z)、(0-9)、下划线和连字符的字符串字面量，64 个字节以内，且不为空。",INVALID_USER_DEFINE_PUSH_ARGS:"userDefinePushArgs 必须是 256 字节以内的字符串文字，并且不能为空。",INVALID_PROXY:"代理服务器 url 必须以“wss://”开头。",INVALID_JOIN:"join() 方法不能被重复调用。",INVALID_ROOMID_STRING:e=>"当 useStringRoomId 为 true 时，'".concat(e,"' 必须是合法字符串。"),INVALID_ROOMID_INTEGER:e=>"当 useStringRoomId 为 false 时，'".concat(e,"' 必须是合法整数在区间[1, 4294967294]。"),INVALID_SIGNAL_CHANNEL:"SignalChannel 还未初始化好。",JOIN_ROOM_TIMEOUT:"进房超时。",JOIN_ROOM_FAILED:e=>"进房失败，原因：".concat(e.error,"。"),REJOIN_ROOM_FAILED:e=>"重进房: ".concat(e.roomId," 失败，请检查网络状况。"),INVALID_LEAVE:"请在调用 destroy() 方法之前调用 leave()。",INVALID_PUBLISH:"请在调用 publish() 方法之前调用 join()。",INVALID_UNPUBLISH:"还没有被 publish。",INVALID_AUDIENCE:"在观众模式下不允许调用 publish()，请先切换成主播模式。",INVALID_INITIALIZE:"无法发布 stream，原因：localStream 未初始化、正在切换设备、已经调用 localStream.close() 关闭采集",INVALID_DUPLICATE_PUBLISHING:"重复发布，请先 unpublish 之后，再重新 publish。",INVALID_SUBSCRIBE_UNDEFINED:"stream 参数是 undefined 或者 null。",INVALID_SUBSCRIBE_LOCAL:"stream 参数不能为本地流。",INVALID_REMOTE_STREAM:"remoteStream 不存在，已被远端 client 取消发布。",SUBSCRIBE_FAILED(e){let t="订阅流失败，原因: ";return e.message.includes("REMOTE_STREAM_NOT_EXIST")?t+="远端用户已取消推流，无法订阅该远端流。":t+="".concat(e.message,"。"),t},INVALID_ROLE:"只有直播模式才可以进行角色切换。",INVALID_PARAMETER_SWITCH_ROLE:"role 只能设置为 anchor 或者 audience。",INVALID_OPERATION_SWITCH_ROLE:"请在使用 switchRole() 方法前先进房。",SWITCH_ROLE_TIMEOUT:"切换角色超时。",SWITCH_ROLE_FAILED:e=>"切换角色失败。错误码: ".concat(e.code," 错误信息: ").concat(e.message,"。"),CLIENT_BANNED:e=>"您被动退房了，原因为：".concat(e.reason,"。"),INVALID_OPERATION_START_PUBLISH_CDN:"请在进房前或者进房并成功发布本地流后调用 startPublishCDNStream() 方法。",INVALID_OPERATION_STOP_PUBLISH_CDN:"在调用 stopPublishCDNStream() 方法前需要先 startPublishCDNStream()。",INVALID_STREAM_ID:e=>"'".concat(e,"' 只能由大小写字母（a-zA-z）, 数字（0-9）, 连字符和下划线组成"),START_PUBLISH_CDN_FAILED:e=>"startPublishCDNStream 调用失败，错误信息: ".concat(e.message,"。"),STOP_PUBLISH_CDN_FAILED:e=>"stopPublishCDNStream 调用失败，错误信息: ".concat(e.message,"。"),START_MIX_TRANSCODE:"调用 startMixTranscode() 方法前需要先调用 join()。",STOP_MIX_TRANSCODE:"调用 stopMixTranscode 之前需要调用 startMixTranscode。",INVALID_AUDIO_VOLUME:"interval 必须是数字。",ENABLE_SMALL_STREAM_PUBLISHED:"发布 localStream 之后不允许开启小流。",DISABLE_SMALL_STREAM_PUBLISHED:"发布 localStream 之后不允许关闭小流。",NOT_SUPPORTED_SMALL_STREAM:"您的浏览器不支持开启小流。",INVALID_SMALL_STREAM_PROFILE:"小流参数不合法。",INVALID_PARAMETER_REMOTE_STREAM:"remoteStream 不合法。",REMOTE_NOT_PUBLISH_SMALL_STREAM:"远端用户没有发布小流。",INVALID_SWITCH_DEVICE:"当前的流不可以调用 switchDevice。",INVALID_SWITCH_DEVICE_PUBLISHING:"发布本地流时不能切换设备。",INVALID_REPLACE_TRACK:"client.publish 接口尚未调用完成，请等其调用完成后再调用 replaceTrack 接口。",INVALID_INITIALIZE_LOCAL_STREAM:"本地流还没有初始化。",INVALID_ADD_TRACK_REPETITIVE:"前一个 addTrack 正在进行，请避免重复调用。",INVALID_ADD_TRACK_REMOVING:"track 在移动的时候不能添加新的 track。",INVALID_ADD_TRACK_PUBLISHING:"在发布本地流的时候不能添加新的 track。",INVALID_STREAM_INITIALIZED:"您的本地流还没有初始化。",INVALID_ADD_TRACK_NUMBER:"一条流最多有一个音频轨道和一个视频轨道。",INVALID_REMOVE_AUDIO_TRACK:"remove audio track 是不允许的。",INVALID_REMOVE_AUDIO_ADDING:"当一个 track 被 addTrack 的时候不能对流进行 removeTrack 操作。",INVALID_REMOVE_AUDIO_ON:"前一次调用的 removeTrack 正在进行中，请避免重复操作。",INVALID_REMOVE_TRACK_PUBLISHING:"发布流的过程中不能进行 removeTrack 操作。",INVALID_REMOVE_TRACK_NOT_PUBLISHING:"被 remove 的 track 没有被发布。",INVALID_REMOVE_TRACK_NUMBER:"不支持移除唯一的视频轨道，请使用 replaceTrack 或者 muteVideo 方法。",INVALID_REPLACE_TRACK_NO_TRACK:e=>"LocalStream 没有 ".concat(e.kind," track，无法进行替换。"),START_MIX_TRANSCODE_FAILED:e=>"startMixTranscode 调用失败，错误信息: ".concat(e.message,"。"),STOP_MIX_TRANSCODE_FAILED:e=>"stopMixTranscode 调用失败，错误信息:  ".concat(e.message,"。"),MIX_TRANSCODE_NOT_STARTED:"还没有开始 mixTranscode。",CANNOT_LESS_THAN_ZERO(e){let{key:t,rule:i,fnName:r}=e;return"'当调用 ".concat(r,"() 函数时，要求参数 ").concat(t||i.name,"' 必须大于等于0")},MIX_PARAMS_VIDEO_FRAMERATE:"'config.videoFramerate' 应该是 (0, 30] 区间内的整数。",MIX_PARAMS_VIDEO_GOP:"'config.videoGOP' 应该是 [1, 8] 区间内的整数。",MIX_PARAMS_AUDIO_BITRATE:"'config.audioBitrate' 应该是 [32, 192] 区间内的整数。",MIX_PARAMS_USER_Z_ORDER:e=>"'".concat(e,"' 是必传的，且要求为 [1 ,15] 之间的整数。"),MIX_PARAMS_NOT_SELF:"'config.mixUsers' 必须包含发起混流的用户信息。",MIX_PARAMS_USER_STREAM:"输出流的 'config.videoWidth' 和 'config.videoHeight' 应该容纳所有混入流。",INVALID_PLAY:"play() 被重复调用，请先 stop()，然后再重新调用 play。",INVALID_ELEMENT_ID:e=>{let{key:t,fnName:i}=e;return"在调用 ".concat(i,"() 时，document 对象中找不到 ").concat(t," 对应的元素，请检查。")},INVALID_ELEMENT_ID_TYPE:e=>{let{key:t,type:i,fnName:r}=e;return"在调用 ".concat(r,"() 方法时，").concat(t," 参数对应的 HTML 标签元素必须是 HTMLElement 实例，您传入的是：").concat(i,"。")},PLAY_FAILED:e=>"".concat(e.media," 播放被中断，浏览器异常原因：").concat(e.error.toString()),INVALID_USERID:"userId 不能为空格。",INVALID_CREATE_STREAM_SOURCE:"createStream() 生成 LocalStream 可以使用 audio & video 或 audioSource & videoSource 创建，但不能混合使用。",INVALID_CREATE_STREAM_SCREEN:"screen 和 video 不能同时为 true。",INVALID_CREATE_STREAM_AUDIO:"audio 和 screenAudio 不能同时为 true。",INVALID_CREATE_STREAM_SCREEN_AUDIO:"screen 为 true 时，不能设置 screenAudio。",NOT_SUPPORTED_HTTP:"由于浏览器安全策略限制，不支持在 http 协议下使用采集、推流等能力，请使用 https 协议。",NOT_SUPPORTED_WEBRTC:"当前浏览器或环境不完全支持 WebRTC 能力，请检查浏览器版本和页面访问协议是否满足条件。",NOT_SUPPORTED_PROFILE:"您的浏览器不支持 setVideoProfile 方法。请检查浏览器版本是否满足条件。",NOT_SUPPORTED_MEDIA:"当前浏览器或环境不支持 navigator.mediaDevices，请检查浏览器版本和页面访问协议是否满足条件。",NOT_SUPPORTED_H264ENCODE:"当前的设备或环境不支持 H264 编码，不支持 H264 格式进行推流。",NOT_SUPPORTED_H264DECODE:"当前的设备或环境不支持 H264 解码，不支持 H264 格式进行拉流。",NOT_SUPPORTED_TRACK:e=>"您的浏览器不支持 ".concat(e,"Track 方法。"),NOT_SUPPORTED_REPLACE_TRACK:"您的浏览器不支持 replaceTrack 方法，请使用 switchDevice 或者 addTrack。",NOT_SUPPORTED_CAPTURE:"您当前的浏览器不支持屏幕分享，请检查浏览器版本和页面访问协议是否满足条件。",NOT_SUPPORTED_AUX:"您当前的浏览器不支持推辅流，请检查浏览器版本是否满足条件（Chrome 69+, Safari 11+, Firefox 59+）。",MICROPHONE_NOT_FOUND:"未检测到麦克风，请检查您的麦克风和 TRTC.createStream 上的配置。",CAMERA_NOT_FOUND:"未检测到摄像头，请检查您的摄像头和 TRTC.createStream 上的配置。",CATCH_HANDLER_ERROR:e=>{let{name:t,event:i}=e;return" 在 ".concat(t,".on('").concat(i,"', handler) 事件中捕获到业务侧错误，请根据下述错误信息，检查您在 handler 中的业务代码。")},REPEAT_JOIN:e=>"用户 [".concat(e,"] 正在调用进房接口或者已经在房间内，请勿重复创建相同 userId 的 client 进入同一个房间。"),CLIENT_DESTROYED:e=>{let{funName:t}=e;return"client 已经被销毁，调用 ".concat(t,"() 方法失败。")},API_CALL_ABORTED(e){let t;return t=e.message.includes("REMOTE_STREAM_NOT_EXIST")?"中断订阅用户 ".concat(e.userId," 的 ").concat(e.streamType," stream, 原因: 在您订阅过程中，远端用户 ").concat(e.userId," 取消了推流，您可以在下次远端推流时再进行订阅。"):"中断接口调用, 原因: ".concat(e.message,"。"),t},SEI_BEFORE_PUBLISH:"当前 client 没有推 localStream(主流，非屏幕分享流)，无法调用 client.sendSEIMessage() 接口。"},vN={INVALID_USER_DEFINE_RECORDID:"TRTC.html#createClient",INVALID_PROXY:"Client.html#setProxyServer",INVALID_JOIN:"Client.html#join",INVALID_ROOMID_STRING:"Client.html#join",INVALID_ROOMID_INTEGER:"Client.html#join",INVALID_PUBLISH:"Client.html#publish",INVALID_UNPUBLISH:"Client.html#unpublish",INVALID_AUDIENCE:"Client.html#switchRole",INVALID_INITIALIZE:"Client.html#publish",INVALID_DUPLICATE_PUBLISHING:"Client.html#publish",INVALID_SUBSCRIBE_UNDEFINED:"Client.html#subscribe",INVALID_SUBSCRIBE_LOCAL:"Client.html#subscribe",INVALID_REMOTE_STREAM:"Client.html#subscribe",INVALID_ROLE:"Client.html#switchRole",INVALID_PARAMETER_SWITCH_ROLE:"Client.html#switchRole",INVALID_OPERATION_SWITCH_ROLE:"Client.html#switchRole",CLIENT_BANNED:"module-ClientEvent.html#.CLIENT_BANNED",INVALID_OPERATION_START_PUBLISH_CDN:"Client.html#startPublishCDNStream",INVALID_OPERATION_STOP_PUBLISH_CDN:"Client.html#stopPublishCDNStream",START_MIX_TRANSCODE:"Client.html#startMixTranscode",STOP_MIX_TRANSCODE:"Client.html#stopMixTranscode",INVALID_AUDIO_VOLUME:"Client.html#enableAudioVolumeEvaluation",ENABLE_SMALL_STREAM_PUBLISHED:"Client.html#enableSmallStream",DISABLE_SMALL_STREAM_PUBLISHED:"Client.html#disableSmallStream",NOT_SUPPORTED_SMALL_STREAM:"tutorial-27-advanced-small-stream.html#h2-4",INVALID_SMALL_STREAM_PROFILE:"Client.html#setSmallStreamProfile",REMOTE_NOT_PUBLISH_SMALL_STREAM:"Client.html#setRemoteVideoStreamType",INVALID_SWITCH_DEVICE:"LocalStream.html#switchDevice",INVALID_SWITCH_DEVICE_PUBLISHING:"LocalStream.html#switchDevice",INVALID_REPLACE_TRACK:"LocalStream.html#replaceTrack",INVALID_INITIALIZE_LOCAL_STREAM:"LocalStream.html#replaceTrack",INVALID_ADD_TRACK_REPETITIVE:"LocalStream.html#addTrack",INVALID_ADD_TRACK_REMOVING:"LocalStream.html#addTrack",INVALID_ADD_TRACK_PUBLISHING:"LocalStream.html#addTrack",INVALID_STREAM_INITIALIZED:"LocalStream.html#addTrack",INVALID_ADD_TRACK_NUMBER:"LocalStream.html#addTrack",INVALID_REMOVE_AUDIO_TRACK:"LocalStream.html#removeTrack",INVALID_REMOVE_AUDIO_ADDING:"LocalStream.html#removeTrack",INVALID_REMOVE_AUDIO_ON:"LocalStream.html#removeTrack",INVALID_REMOVE_TRACK_PUBLISHING:"LocalStream.html#removeTrack",INVALID_REMOVE_TRACK_NOT_PUBLISHING:"LocalStream.html#removeTrack",INVALID_REMOVE_TRACK_NUMBER:"LocalStream.html#removeTrack",INVALID_REMOVE_TRACK_NOT_PUBLISHED:"LocalStream.html#removeTrack",START_MIX_TRANSCODE_TIMEOUT:"Client.html#startMixTranscode",START_MIX_TRANSCODE_FAILED:"Client.html#startMixTranscode",STOP_MIX_TRANSCODE_FAILED:"Client.html#stopMixTranscode",MIX_TRANSCODE_NOT_STARTED:"Client.html#startMixTranscode",MIX_PARAMS_VIDEO_FRAMERATE:"Client.html#startMixTranscode",MIX_PARAMS_VIDEO_GOP:"Client.html#startMixTranscode",MIX_PARAMS_AUDIO_BITRATE:"Client.html#startMixTranscode",MIX_PARAMS_USER_Z_ORDER:"Client.html#startMixTranscode",MIX_PARAMS_NOT_SELF:"Client.html#startMixTranscode",MIX_PARAMS_USER_STREAM:"Client.html#startMixTranscode",INVALID_PLAY:"Stream.html#play",PLAY_FAILED:"Stream.html#play",INVALID_USERID:"TRTC.html#createClient",INVALID_CREATE_STREAM_SOURCE:"TRTC.html#createStream",INVALID_CREATE_STREAM_SCREEN:"TRTC.html#createStream",INVALID_CREATE_STREAM_AUDIO:"TRTC.html#createStream",INVALID_CREATE_STREAM_SCREEN_AUDIO:"TRTC.html#createStream",NOT_SUPPORTED_HTTP:"tutorial-05-info-browser.html#h2-2",NOT_SUPPORTED_WEBRTC:"tutorial-05-info-browser.html",NOT_SUPPORTED_TRTC:"tutorial-05-info-browser.html",NOT_SUPPORTED_PROFILE:"tutorial-23-advanced-support-detection.html",NOT_SUPPORTED_MEDIA:"tutorial-05-info-browser.html",NOT_SUPPORTED_H264ENCODE:"tutorial-23-advanced-support-detection.html",NOT_SUPPORTED_H264DECODE:"tutorial-23-advanced-support-detection.html",NOT_SUPPORTED_TRACK:"LocalStream.html#addTrack",NOT_SUPPORTED_REPLACE_TRACK:"LocalStream.html#replaceTrack",NOT_SUPPORTED_CAPTURE:"tutorial-05-info-browser.html",MICROPHONE_NOT_FOUND:"TRTC.html#createStream",CAMERA_NOT_FOUND:"TRTC.html#createStream",SUBSCRIBE_FAILED:"Client.html#subscribe",API_CALL_ABORTED(e){let t;return t=e.message.includes("REMOTE_STREAM_NOT_EXIST")?"Client.html#subscribe":"module-ErrorCode.html#.API_CALL_ABORTED",t}};"undefined"!=typeof window&&(window.TRTC_ERROR_INFO=TN,window.TRTC_ERROR_LINK=vN);var SN=(e,t)=>t?"".concat(cD,"/").concat(e,"/").concat(t):"".concat(cD,"/").concat(e,"/index.html");function yN(e){let{key:t,data:i,link:r,addDocLink:n=!0}=e,o="",s="",a="";Kw(fN[t])?o=fN[t](i):zw(fN[t])&&(o=fN[t]);let{TRTC_ERROR_INFO:c,TRTC_ERROR_LINK:l}=(()=>{if(window.TRTC_ERROR_INFO&&window.TRTC_ERROR_LINK)return{TRTC_ERROR_INFO:window.TRTC_ERROR_INFO,TRTC_ERROR_LINK:window.TRTC_ERROR_LINK};let e=localStorage.getItem(hD);if(e){e=JSON.parse(e);let t=document.createElement("script");t.type="text/javascript",t.text=e.message,document.body.appendChild(t);let i=window.TRTC_ERROR_INFO,r=window.TRTC_ERROR_LINK;return document.body.removeChild(t),{TRTC_ERROR_INFO:i,TRTC_ERROR_LINK:r}}return{}})();r?a="".concat(r.className,".html#").concat(r.fnName):l&&l[t]&&(Kw(l[t])?a=l[t](i):zw(l[t])&&(a=l[t]));let u=o;return Hw()&&(c&&c[t]&&(Kw(c[t])?s=c[t](i):zw(c[t])&&(s=c[t])),s&&(u=n?"".concat(s,"\n请查看文档: ").concat(SN("zh-cn",a),"\n\n"):"".concat(s,"\n\n"),u+=o)),n&&(u+=" \nRefer to: ".concat(SN("en",a),"\n")),u}var EN={result:!1,detail:{isBrowserSupported:!1,isWebRTCSupported:!1,isWebCodecsSupported:!1,isMediaDevicesSupported:!1,isScreenShareSupported:!1,isSmallStreamSupported:!1,isH264EncodeSupported:!1,isVp8EncodeSupported:!1,isH264DecodeSupported:!1,isVp8DecodeSupported:!1}},IN=new Map([[kb,["Firefox",Db]],[Pb,["Edg",Mb]],[Rk,["Chrome",bk]],[kk,["Safari",wk]],[Bb,["TBS",Hb]],[jb,["XWEB",Wb]],[Qb&&yb,["WeChat",zb]],[$b,["QQ(Win)",Zb]],[qb,["QQ(Mobile)",Xb]],[Yb,["QQ(Mobile X5)",Xb]],[ek,["QQ(Mac)",tk]],[ik,["QQ(iPad)",rk]],[dk,["MI",hk]],[pk,["HW",_k]],[fk,["Samsung",gk]],[Tk,["OPPO",vk]],[Sk,["VIVO",yk]],[Ob,["EDGE",Nb]],[Vb,["SogouMobile",xb]],[Ub,["Sogou",Fb]]]);function RN(){let e=IN.get(!0);return{browserName:e?e[0]:"unknown",browserVersion:e?e[1]:"unknown"}}var CN=function(){return!(lk||Ob||Pb&&Lb<80||kb&&wb<56)},AN=function(){return["VideoDecoder","VideoEncoder","AudioEncoder","AudioDecoder","MediaStreamTrackGenerator"].every((e=>e in window))},bN=function(){if(!navigator.mediaDevices)return DN()||wO.error(fN.NOT_SUPPORTED_MEDIA),!1;let e=["getUserMedia","enumerateDevices"];return e.filter((e=>e in navigator.mediaDevices)).length===e.length},kN=!1;function DN(){return"http:"===location.protocol&&!xk&&(kN||wO.error(yN({key:eN})),kN=!0,!0)}var wN=function(){return(null==window?void 0:window.OffscreenCanvas)&&(null==window?void 0:window.MediaStreamTrackProcessor)&&(null==window?void 0:window.MediaStreamTrackGenerator)},ON=function(){return XA(this,null,(function*(){if(EN.detail.isH264EncodeSupported||EN.detail.isVp8EncodeSupported)return{isH264EncodeSupported:EN.detail.isH264EncodeSupported,isVp8EncodeSupported:EN.detail.isVp8EncodeSupported};let e,t=!1,i=!1;try{let r=new RTCPeerConnection,n=document.createElement(RD.CANVAS);n.getContext("2d");let o=n.captureStream(0);return r.addTrack(o.getVideoTracks()[0],o),e=yield r.createOffer(),-1!==e.sdp.toLowerCase().indexOf("h264")&&(t=!0),-1!==e.sdp.toLowerCase().indexOf("vp8")&&(i=!0),r.close(),EN.detail.isH264EncodeSupported=t,EN.detail.isVp8EncodeSupported=i,{isH264EncodeSupported:EN.detail.isH264EncodeSupported,isVp8EncodeSupported:EN.detail.isVp8EncodeSupported}}catch(e){return{isH264EncodeSupported:!1,isVp8EncodeSupported:!1}}}))},NN=function(){return XA(this,null,(function*(){if(EN.detail.isH264DecodeSupported&&EN.detail.isVp8DecodeSupported)return{isH264DecodeSupported:EN.detail.isH264DecodeSupported,isVp8DecodeSupported:EN.detail.isVp8DecodeSupported};let e,t=!1,i=!1;try{let r=new RTCPeerConnection;return e=yield r.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}),-1!==e.sdp.toLowerCase().indexOf("h264")&&(t=!0),-1!==e.sdp.toLowerCase().indexOf("vp8")&&(i=!0),r.close(),{isH264DecodeSupported:t,isVp8DecodeSupported:i}}catch(e){return{isH264DecodeSupported:!1,isVp8DecodeSupported:!1}}}))},PN=function(){return XA(this,null,(function*(){if(EN.result)return EN;let e=CN(),t=tP(),i=AN(),r=bN(),{isH264EncodeSupported:n,isVp8EncodeSupported:o}=yield ON(),{isH264DecodeSupported:s,isVp8DecodeSupported:a}=yield NN();return EN.result=e&&t&&r&&(n||o)&&(s||a),EN.detail.isBrowserSupported=e,EN.detail.isWebRTCSupported=t,EN.detail.isWebCodecsSupported=i,EN.detail.isMediaDevicesSupported=r,EN.detail.isScreenShareSupported=LN(),EN.detail.isSmallStreamSupported=jN(),EN.detail.isH264EncodeSupported=n,EN.detail.isVp8EncodeSupported=o,EN.detail.isH264DecodeSupported=s,EN.detail.isVp8DecodeSupported=a,EN.result||wO.error("".concat(navigator.userAgent," ").concat(yO(EN.detail,!1))),EN}))},MN=function(){return EN.result},LN=function(){return!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia)},VN=(e,t,i)=>{"http:"===location.protocol&&!xk&&(e[t]=()=>{throw new ab({code:ob.INVALID_OPERATION,message:fN.NOT_SUPPORTED_HTTP})})},xN=function(e){return!("candidate-pair"!==e.type||!e.nominated||"in-progress"!==e.state&&"succeeded"!==e.state||qw(e.selected)&&!e.selected)};function UN(){let e="";if(screen.width){let t=screen.width?screen.width*window.devicePixelRatio:"",i=screen.height?screen.height*window.devicePixelRatio:"";e+="".concat(t," * ").concat(i)}return e}function FN(){return navigator.getUserMedia||navigator.mediaDevices&&navigator.mediaDevices.getUserMedia}function BN(){let e={isSupported:!1},t=["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"];for(let i=0;i<t.length;i++)if(t[i]in window){e.isSupported=!0;break}return e.isSupported}function HN(){return"captureStream"in HTMLCanvasElement.prototype}function jN(){return!(Qb||Ib||Ak&&Ak<63||!CN()||!HN())}var WN=function(){if(Qw(window.RTCRtpTransceiver)||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let e=null,t=!1;try{e=new RTCPeerConnection({sdpSemantics:iw}),e.addTransceiver(RD.AUDIO),t=!0}catch(e){}return null==e||e.close(),t};function GN(){return"RTCPeerConnection"in window&&"getReceivers"in window.RTCPeerConnection.prototype}function JN(){return"RTCPeerConnection"in window&&"getSenders"in window.RTCPeerConnection.prototype}function KN(){return"RTCPeerConnection"in window&&"getTransceivers"in window.RTCPeerConnection.prototype}function QN(){return 11!==Pk&&"RTCPeerConnection"in window&&"addTransceiver"in window.RTCPeerConnection.prototype}var zN=!(!QN()||Ik&&Ak<74);function YN(){return"RTCRtpTransceiver"in window&&"stop"in window.RTCRtpTransceiver.prototype}function qN(){return"RTCRtpSender"in window&&"replaceTrack"in window.RTCRtpSender.prototype}function XN(){return"RTCRtpSender"in window&&"setParameters"in window.RTCRtpSender.prototype&&JN()}var $N=window.MediaStreamTrack&&"getSettings"in MediaStreamTrack.prototype,ZN=window.MediaStreamTrack&&"getCapabilities"in MediaStreamTrack.prototype,eP="RTCRtpSender"in window&&"createEncodedStreams"in window.RTCRtpSender.prototype&&Ek()>=86,tP=function(){return["RTCPeerConnection","webkitRTCPeerConnection","RTCIceGatherer"].filter((e=>e in window)).length>0};function iP(){let e={AudioDecoder:!1,AudioEncoder:!1,VideoDecoder:!1,VideoEncoder:!1,ImageDecoder:!1};return Qw(window.AudioDecoder)||(e.AudioDecoder=!0),Qw(window.AudioEncoder)||(e.AudioEncoder=!0),Qw(window.VideoDecoder)||(e.VideoDecoder=!0),Qw(window.VideoEncoder)||(e.VideoEncoder=!0),Qw(window.ImageDecoder)||(e.ImageDecoder=!0),e}function rP(){return"mediaSession"in navigator&&!Qw(navigator.mediaSession.setActionHandler)}function nP(){return!Qw(window.WebTransport)}function oP(){let e={browser:"".concat(Fk.name,"/").concat(Fk.version),os:Gk(),displayResolution:UN(),isScreenShareSupported:LN(),isWebRTCSupported:tP(),isGetUserMediaSupported:FN(),isWebAudioSupported:BN(),isWebSocketsSupported:"WebSocket"in window&&2===window.WebSocket.CLOSING,isWebCodecSupported:iP(),isMediaSessionSupported:rP(),isWebTransportSupported:nP()};return navigator.userAgent.includes("miniProgram")&&(e.browser="mini/".concat(e.browser)),e}var sP=QA($A(),1),aP=Symbol("instance"),cP=Symbol("cacheResult"),lP=class{constructor(e,t,i){this.oldState=e,this.newState=t,this.action=i,this.aborted=!1}abort(e){this.aborted=!0,mP.call(e,this.oldState,new Error("action '".concat(this.action,"' aborted")))}toString(){return"".concat(this.action,"ing")}},uP=class extends Error{constructor(e,t,i){super(t),this.state=e,this.message=t,this.cause=i}},dP=new Map;function hP(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(r,n,o)=>{let s=i.action||n;if(!i.context){let i=dP.get(r)||[];dP.has(r)||dP.set(r,i),i.push({from:e,to:t,action:s})}let a=o.value;o.value=function(){let r=this;for(var n=arguments.length,o=new Array(n),c=0;c<n;c++)o[c]=arguments[c];if(i.context&&(r=_P.get("function"==typeof i.context?i.context.call(this,...o):i.context)),r.state===t)return r[cP];r.state instanceof lP&&r.state.action==i.abortAction&&r.state.abort(r);let l=null;if(Array.isArray(e)?0==e.length?r.state instanceof lP&&r.state.abort(r):("string"!=typeof r.state||!e.includes(r.state))&&(l=new uP(r._state,"".concat(r.name," ").concat(s," to ").concat(t," failed: current state ").concat(r._state," not in from config"))):e!==r.state&&(l=new uP(r._state,"".concat(r.name," ").concat(s," to ").concat(t," failed: current state ").concat(r._state," not from ").concat(e))),l){if(!i.fail){if(i.ignoreError)return l;throw l}i.fail.call(this,l)}let u=r.state,d=new lP(u,t,s);mP.call(r,d);let h=e=>{var n;return r[cP]=e,d.aborted||(mP.call(r,t),null===(n=i.success)||void 0===n||n.call(this,r[cP])),e},p=e=>{let t=e instanceof Error?e.message:String(e);if(mP.call(r,u,e),!i.fail){if(i.ignoreError)return e;throw e}i.fail.call(this,new uP(r._state,"action '".concat(s,"' failed :").concat(t),e instanceof Error?e:new Error(t)))};try{let e=a.apply(this,o);return function(e){return"object"==typeof e&&e&&"then"in e}(e)?e.then(h).catch(p):h(e)}catch(e){p(e)}}}}var pP="undefined"!=typeof window&&window.__AFSM__?(e,t)=>{window.dispatchEvent(new CustomEvent(e,{detail:t}))}:"undefined"!=typeof importScripts?(e,t)=>{postMessage({type:e,payload:t})}:()=>{};function mP(e,t){let i=this._state;this._state=e;let r=e.toString();e&&this.emit(r,i),this.emit(_P.STATECHANGED,e,i,t),this.updateDevTools({value:e,old:i,err:t instanceof Error?t.message:String(t)})}var _P=class extends sP.default{constructor(e,t,i){super(),this.name=e,this.groupName=t,this._state=_P.INIT,e||(e=Date.now().toString(36)),i?Object.setPrototypeOf(this,i):i=Object.getPrototypeOf(this),t||(this.groupName=this.constructor.name);let r=i[aP];r?this.name=r.name+"-"+r.count++:i[aP]={name:this.name,count:0},this.updateDevTools({diagram:this.stateDiagram})}get stateDiagram(){let e=Object.getPrototypeOf(this),t=dP.get(e)||[],i=new Set,r=[],n=[],o=new Set,s=Object.getPrototypeOf(e);dP.has(s)&&(s.stateDiagram.forEach((e=>i.add(e))),s.allStates.forEach((e=>o.add(e)))),t.forEach((e=>{let{from:t,to:i,action:o}=e;"string"==typeof t?r.push({from:t,to:i,action:o}):t.length?t.forEach((e=>{r.push({from:e,to:i,action:o})})):n.push({to:i,action:o})})),r.forEach((e=>{let{from:t,to:r,action:n}=e;o.add(t),o.add(r),o.add(n+"ing"),i.add("".concat(t," --\x3e ").concat(n,"ing : ").concat(n)),i.add("".concat(n,"ing --\x3e ").concat(r," : ").concat(n," 🟢")),i.add("".concat(n,"ing --\x3e ").concat(t," : ").concat(n," 🔴"))})),n.forEach((e=>{let{to:t,action:r}=e;i.add("".concat(r,"ing --\x3e ").concat(t," : ").concat(r," 🟢")),o.forEach((e=>{e!==t&&i.add("".concat(e," --\x3e ").concat(r,"ing : ").concat(r))}))}));let a=[...i];return Object.defineProperties(e,{stateDiagram:{value:a},allStates:{value:o}}),a}static get(e){let t;return"string"==typeof e?(t=_P.instances.get(e),t||_P.instances.set(e,t=new _P(e,void 0,Object.create(_P.prototype)))):(t=_P.instances2.get(e),t||_P.instances2.set(e,t=new _P(e.constructor.name,void 0,Object.create(_P.prototype)))),t}static getState(e){var t;return null===(t=_P.get(e))||void 0===t?void 0:t.state}updateDevTools(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};pP(_P.UPDATEAFSM,Object.assign({name:this.name,group:this.groupName},e))}get state(){return this._state}set state(e){mP.call(this,e)}};_P.STATECHANGED="stateChanged",_P.UPDATEAFSM="updateAFSM",_P.INIT="[*]",_P.ON="on",_P.OFF="off",_P.instances=new Map,_P.instances2=new WeakMap;var fP=(null==window?void 0:window.requestIdleCallback)||function(e){let t=Date.now();return setTimeout((()=>{e({didTimeout:!1,timeRemaining:()=>Math.max(0,50-(Date.now()-t))})}),1e3)},gP=(null==window?void 0:window.cancelIdleCallback)||function(e){clearTimeout(e)},TP=(null==window?void 0:window.cancelAnimationFrame)||(null==window?void 0:window.mozCancelAnimationFrame),vP=class{static generateTaskID(){return this.currentTaskID++}static run(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Cw,t=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;i=WA(e===Rw?{delay:2e3,count:0,backgroundTask:!0}:e===Ew?{delay:1e4,count:0}:e===Iw?{fps:60,delay:16.6,count:0,backgroundTask:!0}:{delay:2e3,count:0,backgroundTask:!0},i),Xw(t)&&(i=WA(WA({},i),t)),Kw(e)&&(t=e,e=Cw);let r=WA({taskID:this.generateTaskID(),loopCount:0,intervalID:null,timeoutID:null,rafID:null,ricID:null,taskName:e,callback:t},i);return this.taskMap.set(r.taskID,r),this[e](r),r.taskID}static interval(e){return e.intervalID=setInterval((()=>{e.callback(),e.loopCount+=1,this.isBreakLoop(e)}),e.delay)}static intervalInWorker(e){e.delay=(1e3/e.fps).toFixed(2);let t=new Worker(URL.createObjectURL(new Blob(["\n        let timerID = null;\n        self.onmessage = function (e) {\n          if (e.data === 'start') {\n            timerID = setInterval(() => {\n              self.postMessage('tick');\n            }, ".concat(e.delay,");\n          } else if (e.data === 'stop') {\n            clearInterval(timerID);\n          }\n        };\n      ")])));t.onmessage=i=>{"tick"===i.data&&(e.callback(),e.loopCount+=1,this.isBreakLoop(e)&&t.postMessage("stop"))},e.worker=t,t.postMessage("start")}static timeout(e){let t=()=>{if(e.callback(),e.loopCount+=1,!this.isBreakLoop(e))return e.timeoutID=setTimeout(t,e.delay)};return e.timeoutID=setTimeout(t,e.delay)}static ric(e){let t,i=sO(),r=()=>{if(t=sO()-i,t>=e.delay&&(i=sO()-Math.floor(t%e.delay),e.callback(),e.loopCount+=1),!this.isBreakLoop(e))return e.ricID=fP(r,{timeout:e.delay})};return e.ricID=fP(r,{timeout:e.delay})}static raf(e){e.delay=(1e3/e.fps).toFixed(2);let t,i=sO(),r=()=>document.hidden&&e.backgroundTask?(t=sO()-i,i=sO(),e.callback(),e.loopCount+=1,this.isBreakLoop(e)?void 0:e.timeoutID=setTimeout(r,e.delay-Math.floor(t%e.delay))):(t=sO()-i,t>=e.delay&&(i=sO()-Math.floor(t%e.delay),e.callback(),e.loopCount+=1),this.isBreakLoop(e)?void 0:e.rafID=requestAnimationFrame(r));if(e.rafID=requestAnimationFrame(r),e.backgroundTask){let t=()=>{if(document.hidden){let t=sO()-i;t>=e.delay?r():e.timeoutID=setTimeout(r,e.delay-t)}};document.addEventListener("visibilitychange",t),e.onVisibilitychange=t,document.hidden&&t()}return e.taskID}static hasTask(e){return this.taskMap.has(e)}static clearTask(e){if(!this.taskMap.has(e))return!0;let{intervalID:t,timeoutID:i,rafID:r,ricID:n,onVisibilitychange:o,worker:s}=this.taskMap.get(e);return s&&s.terminate(),t&&clearInterval(t),i&&clearTimeout(i),r&&TP(r),n&&gP(n),o&&document.removeEventListener("visibilitychange",o),this.taskMap.delete(e),!0}static isBreakLoop(e){return!this.taskMap.has(e.taskID)||0!==e.count&&e.loopCount>=e.count&&(this.clearTask(e.taskID),!0)}};vP.taskMap=new Map,vP.currentTaskID=1;var SP=vP;RD.SEI_MESSAGE;var yP={LOADED_DATA:RD.LOADEDDATA,MEDIA_TRACK_CHANGED:"media-track-changed",PLAYER_STATE_CHANGED:"player-state-changed"},EP=new class{constructor(){YA(this,"_roomIdMap",new Map),YA(this,"_configs"),"undefined"==typeof registerProcessor&&(this._configs={sdkAppId:"",userId:"",version:zk,env:mD.QCLOUD,browserVersion:Fk.name+Fk.version,ua:navigator.userAgent})}setConfig(e){let{sdkAppId:t,env:i,userId:r,roomId:n}=e;t!==this._configs.sdkAppId&&(this._configs.sdkAppId=String(t)),this._configs.env=i,this._configs.userId=r,this._roomIdMap.set(r,String(n))}logSuccessEvent(e){xk||!wO.isAbleToUpload||this._configs.env===mD.QCLOUD&&this.uploadEventToKibana(GA(WA({},e),{result:"success"}))}logFailedEvent(e){if(xk||!wO.isAbleToUpload)return;let{eventType:t,code:i,error:r,userId:n}=e,o={roomId:this._roomIdMap.get(n||this._configs.userId),userId:n,eventType:t,result:"failed",code:i||(null==r?void 0:r.extraCode)||(null==r?void 0:r.code)||ob.UNKNOWN};this._configs.env===mD.QCLOUD&&this.uploadEventToKibana(GA(WA({},o),{error:r}))}uploadEventToKibana(e){let t="stat-".concat(e.eventType,"-").concat(e.result);("delta-join"===e.eventType||"delta-leave"===e.eventType||"delta-publish"===e.eventType)&&(t="".concat(e.eventType,":").concat(e.delta)),this.uploadEvent({log:t,userId:e.userId}),"failed"===e.result&&(t="stat-".concat(e.eventType,"-").concat(e.result,"-").concat(e.code),this.uploadEvent({log:t,userId:e.userId,error:e.error}))}uploadEvent(e){let{log:t,userId:i,error:r}=e,n={timestamp:ub(),sdkAppId:this._configs.sdkAppId,userId:i||this._configs.userId,version:zk,log:t};r&&(n.errorInfo=r.message),this.sendRequest(ww(this._configs.sdkAppId,pD.LOG),n)}sendRequest(e,t){wO.isAbleToUpload?IO({url:e,body:JSON.stringify(t)}).catch((()=>{})):setTimeout((()=>{this.sendRequest(e,t)}),1e3)}},IP="trtc_autoplay",RP="".concat(IP,"_mask"),CP="".concat(IP,"_wrapper"),AP="".concat(IP,"_header"),bP="".concat(IP,"_content"),kP="".concat(IP,"_action_wrapper"),DP="".concat(IP,"_question"),wP="".concat(IP,"_collapse"),OP="".concat(IP,"_action_confirm"),NP="".concat(IP,"_detail"),PP="#2473E8",MP="dialog",LP="".concat(MP,"-show"),VP="".concat(MP,"-1"),xP="".concat(MP,"-2"),UP=!1,FP=()=>!!document.querySelector(".".concat(CP)),BP="".concat(cD,"/").concat(Hw()?"zh-cn":"en","/tutorial-21-advanced-auto-play-policy.html"),HP="<br><a href='".concat(BP,"' target='_blank'>").concat(Hw()?"其他方案？":"Any other solution?","</a>"),jP="".concat(Hw()?"浏览器自动播放策略：在用户与页面产生交互（点击、触摸）之前，浏览器禁止播放有声媒体。该弹窗用于帮助用户恢复音视频播放。".concat(HP):"Autoplay Policy: Before user interacts with the web page (clicking, touching), page will not be allowed to play media with sound. This Dialog is used to help users resume playback. ".concat(HP)),WP={};KA(WP,{create:()=>JP,remove:()=>KP});var GP=new WeakMap;function JP(e,t){GP.has(e)||GP.set(e,[]);let i=GP.get(e),r={add:(e,n)=>("addEventListener"in t?(i.push(t.removeEventListener.bind(t,e,n)),t.addEventListener(e,n)):(i.push(t.off.bind(t,e,n)),t.on(e,n)),r)};return r}function KP(e){let t=GP.get(e);t&&(t.forEach((e=>e())),GP.delete(e))}var QP=class extends _P{constructor(e,t){super(e.id,"".concat(t,"-player")),this.kind=t,YA(this,"id"),YA(this,"element",null),YA(this,"container",null),YA(this,"mediaStream",new MediaStream),YA(this,"track"),YA(this,"url"),YA(this,"attr"),YA(this,"muted"),YA(this,"_log"),YA(this,"_pausedRetryCount"),YA(this,"_isElementPlayingFired",!1),YA(this,"_interval"),this.id=e.id,this._log=e.log,this.track=e.track,this.container=e.container,this.muted=e.muted,this._pausedRetryCount=mw,this._state="STOPPED",this.bindTrackEvents()}get isPlaying(){return"PLAYING"===this._state}get isStopped(){return"STOPPED"===this._state}setAttr(e){this.attr=e}setTrack(e){if(e!==this.track&&(this.unbindTrackEvents(),this.track=e,this.emit(yP.MEDIA_TRACK_CHANGED,e),null!==e&&(this.bindTrackEvents(),this.element))){let t=new MediaStream;t.addTrack(e),this.element.srcObject=t}}setUrl(e){this.track&&(this.unbindTrackEvents(),this.element&&(this.element.srcObject=null),this.track=null),e!==this.url&&(this.url=e,null!==e&&this.element&&(this.element.crossOrigin="anonymous",this.element.src=e))}setContainer(e){this.container=e,this.track&&this.element&&this.container&&this.container.appendChild(this.element)}play(){return XA(this,null,(function*(){if(this.element&&this.element.parentElement!==this.container&&this.container&&this.container.append(this.element),!this.isPlaying)try{this.bindAutoPlayEvent(),yield this.element.play()}catch(e){let t=yN({key:ZO,data:{media:this.kind,error:e}});if(this.track&&!this.track.muted&&this._log.warn(e),t.includes("NotAllowedError"))throw new ab({code:ob.PLAY_NOT_ALLOWED,message:t})}}))}stop(){this.unbindEvents(),this._isElementPlayingFired=!1,this.element&&(this.container&&this.container.removeChild(this.element),this.element.srcObject=null,this.element=null),this.handleStopped(RD.ENDED),this._interval>0&&SP.clearTask(this._interval)}pause(){var e;this.isPlaying&&(null==(e=this.element)||e.pause())}resume(){return this.isPlaying?Promise.resolve():Lk?this.replay():this.play().catch((()=>{}))}setMuted(e){this.element&&(this.element.muted=e),this.muted=e}setRect(e,t){this.element&&(this.element.style.width="".concat(e,"px"),this.element.style.height="".concat(t,"px"))}replay(){return this.stop(),this.play().catch((()=>{}))}bindElementEvents(){if(this.element){let e=this.handleElementEvent.bind(this);return JP(this.element,this.element).add(RD.PLAYING,e).add(RD.ENDED,e).add(RD.PAUSE,e).add(RD.ERROR,e).add(RD.LOADEDDATA,e)}}bindTrackEvents(){if(this.track){let e=this.handleTrackEvent.bind(this);null==WP||WP.create(this.track,this.track).add(RD.ENDED,e).add(RD.MUTE,e).add(RD.UNMUTE,e),this.track.readyState===RD.ENDED&&this.handleTrackEvent({type:RD.ENDED}),this.track.muted&&this.handleTrackEvent({type:RD.MUTE})}}bindAutoPlayEvent(){AO.on(kO.AUTOPLAY_DIALOG_CLICK_CONFIRM,this.resume,this)}unbindTrackEvents(){this.track&&KP(this.track)}unbindEvents(){this.element&&KP(this.element),this.unbindTrackEvents(),AO.off(kO.AUTOPLAY_DIALOG_CLICK_CONFIRM,this.resume,this)}handleElementEvent(e){var t;switch(e.type){case RD.PLAYING:this._isElementPlayingFired=!0,this._log.info("".concat(this.kind," player is playing")),this.handlePlaying(RD.PLAYING),this._interval&&(SP.clearTask(this._interval),this._interval=-1);break;case RD.ENDED:this._log.info("".concat(this.kind," player is ended")),this.handleStopped(RD.ENDED);break;case RD.PAUSE:this._log.info("".concat(this.kind," player is paused")),this.handlePaused(RD.PAUSE);let e=this.container&&document.getElementById(this.container.id);e||this._log.warn("".concat(this.kind," player has been remove, element ID: ").concat(null==(t=this.container)?void 0:t.id));let i=Ek();this._pausedRetryCount>0&&(this.kind===RD.VIDEO&&!FP()||this.kind===RD.AUDIO&&(Yw(i)&&i<=70||!e))&&(this._log.info("".concat(this.kind," player auto resume when paused")),this.resume(),this._pausedRetryCount--),Ib&&(this._interval=SP.run(Cw,(()=>{this.element&&"PAUSED"===this._state&&this.resume()}),{delay:3e3}));break;case RD.ERROR:if(this.element&&this.element.error){let{code:e,message:t}=this.element.error;this._log.error("".concat(this.kind," player error observed. code: ").concat(e," message: ").concat(t," userAgent: ").concat(navigator.userAgent)),EP.uploadEvent({log:"stat-".concat(this.kind,"-").concat($D.PLAYER_ERROR,"-").concat(e,"-").concat(navigator.userAgent),error:this.element.error})}break;case RD.LOADEDDATA:this.kind===RD.VIDEO&&this.emit(yP.LOADED_DATA)}}handleTrackEvent(e){switch(e.type){case RD.ENDED:this._log.info("".concat(this.kind," track is ended")),this.handleStopped(RD.ENDED);break;case RD.MUTE:this._log.info("".concat(this.kind," track is unable to provide media output")),this.handlePaused(RD.MUTE);break;case RD.UNMUTE:this._log.info("".concat(this.kind," track is able to provide media output")),this._isElementPlayingFired&&this.handlePlaying(RD.UNMUTE)}}handlePlaying(e){this.emit(yP.PLAYER_STATE_CHANGED,{type:this.kind,state:"PLAYING",reason:e})}handlePaused(e){this.emit(yP.PLAYER_STATE_CHANGED,{type:this.kind,state:"PAUSED",reason:e})}handleStopped(e){this.emit(yP.PLAYER_STATE_CHANGED,{type:this.kind,state:"STOPPED",reason:e})}getElement(){return this.element}};zA([hP([],"PLAYING")],QP.prototype,"handlePlaying",1),zA([hP("PLAYING","PAUSED",{ignoreError:!0})],QP.prototype,"handlePaused",1),zA([hP([],"STOPPED")],QP.prototype,"handleStopped",1);var zP=class extends QP{constructor(e){super(e,RD.VIDEO),YA(this,"mirror"),YA(this,"objectFit"),Qw(e.mirror)||(this.mirror=e.mirror),Qw(e.objectFit)||(this.objectFit=e.objectFit)}initializeElement(){var e;let t=document.createElement(RD.VIDEO);if(this.track){let e=new MediaStream;e.addTrack(this.track),t.srcObject=e}t.muted=!0;let i="width: 100%; height: 100%; object-fit: ".concat(this.objectFit,";background-color: black;");this.mirror&&(i+="transform: scaleX(-1);"),t.setAttribute("id","video_".concat(this.id)),t.setAttribute("style",i),t.setAttribute("autoplay","autoplay"),t.setAttribute("playsinline","playsinline"),null==(e=this.container)||e.appendChild(t),this.element=t,this.bindElementEvents()}bindElementEvents(){let e=super.bindElementEvents();this.handleElementEvent=this.handleElementEvent.bind(this),e&&e.add(RD.ENTER_PICTURE_IN_PICTURE,this.handleElementEvent).add(RD.LEAVE_PICTURE_IN_PICTURE,this.handleElementEvent)}handleElementEvent(e){super.handleElementEvent(e);let t=e.type;if(this.mirror&&this.element){let e=this.element.style.transform;t===RD.ENTER_PICTURE_IN_PICTURE?this.element.style.transform=e.replace("scaleX(-1)",""):t===RD.LEAVE_PICTURE_IN_PICTURE&&!e.includes("scaleX")&&(this.element.style.transform="".concat(e," scaleX(-1)"))}}setAttr(e){let t=Object.assign({autoplay:"autoplay",playsinline:"playsinline",muted:!0},e);t.style=Object.assign({width:"100%",height:"100%"},t.style),super.setAttr(t)}setMirror(e){this.element&&(this.element.style.transform=e?"scaleX(-1)":""),this.mirror=e}setObjectFit(e){this.element&&(this.element.style.objectFit="".concat(e)),this.objectFit=e}play(){return this.element||this.initializeElement(),super.play()}getVideoFrame(){if(!this.element)return"";let e=document.createElement("canvas");return e.width=this.element.videoWidth,e.height=this.element.videoHeight,e.getContext("2d").drawImage(this.element,0,0),e.toDataURL("image/png")}getElement(){return this.element}},YP=!1;"undefined"!=typeof window&&(window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext);var qP,XP,$P=0,ZP=(e,t)=>{let i=new window.AudioContext(t),r=++$P,n=()=>{"suspended"===i.state?(i.resume(),document.addEventListener("click",n)):"interrupted"===i.state?i.resume():document.removeEventListener("click",n)};return document.addEventListener("click",n),i.onstatechange=()=>{wO.info("".concat(e,"-").concat(r," context state: ").concat(i.state)),n()},i},eM=0,tM=null,iM=0,rM=class extends QP{constructor(e){super(e,RD.AUDIO),YA(this,"_volumeMeter"),YA(this,"_gainedTrack",null),YA(this,"_gainNode",null),YA(this,"_destination",null),YA(this,"_mediaStreamSource",null),YA(this,"_sourceElement",null),YA(this,"_outputDeviceId"),YA(this,"_volume",1),YA(this,"_loop",!1),e.gainedTrack&&(this._gainedTrack=e.gainedTrack),this._outputDeviceId=e.outputDeviceId,this.track&&this.initVolumeMeter(this.track)}setTrack(e){this.track!==e&&(this._volumeMeter&&(this._volumeMeter.destroy(),this._volumeMeter=null),null!==e&&this.initVolumeMeter(e)),super.setTrack(e)}initVolumeMeter(e){this._volumeMeter=new class{constructor(e){YA(this,"_volume"),YA(this,"_log"),YA(this,"_track"),YA(this,"_stream"),YA(this,"_audioCtx"),YA(this,"_destination"),YA(this,"_streamSource"),YA(this,"_scriptProcessorNode"),YA(this,"_audioWorkletNode"),YA(this,"_interval");let{track:t,log:i}=e;this._volume=0,this._log=i,this._track=t,qP||(qP=ZP("volume-meter")),this._audioCtx=qP,this._destination=this._audioCtx.destination;let r=new MediaStream;r.addTrack(this._track),this._streamSource=this._audioCtx.createMediaStreamSource(r),this._audioWorkletNode=null,this._scriptProcessorNode=null,this._interval=200,AO.on(kO.AUDIO_LEVEL_INTERVAL,this.handleAudioLevelInterval,this),nO?(AO.on(kO.WORKLET_LOADED_SUCCESS,this.initAudioWorklet,this),AO.on(kO.WORKLET_LOADED_FAILED,this.initScriptProcessor,this),this.preload()):this.initScriptProcessor(),eM+=1}preload(){XP?XP.initWorkletSuccess&&this.initAudioWorklet():XP=new class{constructor(e){YA(this,"context_"),YA(this,"blob_"),this.context_=e.context,this.blob_=new Blob(['class VolumeMeter extends AudioWorkletProcessor{constructor(){super(),this.volume=0,this.intervalTime=200,this.tick=this.intervalTime,this.isStop=!1,this.port.onmessage=t=>{let{data:e}=t;switch(e.name){case"setIntervalTime":this.intervalTime=e.intervalTime;break;case"stop":this.isStop=!0}}}process(t){let e=t[0];if(this.isStop)return!1;if(e.length>0){let i=e[0],s=0;for(let l=0;l<i.length;++l)s=Math.max(Math.abs(i[l]),s);this.volume=s,this.tick-=i.length,this.tick<0&&(this.tick+=this.intervalTime/1e3*sampleRate,this.port.postMessage({volume:this.volume}))}return!0}}registerProcessor("volume-meter",VolumeMeter);'],{type:"application/javascript"}),this.addModuleToContext()}addModuleToContext(){return XA(this,null,(function*(){try{yield this.context_.audioWorklet.addModule(URL.createObjectURL(this.blob_)),wO.info("worklet addModule success"),AO.emit(kO.WORKLET_LOADED_SUCCESS),YP=!0}catch(e){wO.info("worklet addModule catch error. ".concat(e.message)),AO.emit(kO.WORKLET_LOADED_FAILED)}}))}get initWorkletSuccess(){return YP}}({context:qP})}initAudioWorklet(){if(!this._audioWorkletNode)try{this._audioWorkletNode=new AudioWorkletNode(this._audioCtx,"volume-meter"),this._audioWorkletNode.port.onmessage=e=>{this._volume=e.data.volume||0},this._streamSource.connect(this._audioWorkletNode).connect(this._destination),this.handleAudioLevelInterval({interval:this._interval})}catch(e){EP.logFailedEvent({userId:this._log.userId,eventType:$D.LOAD_WORKLET,error:e}),this.initScriptProcessor()}}initScriptProcessor(){if(!this._scriptProcessorNode)try{this._scriptProcessorNode=this._audioCtx.createScriptProcessor(2048,1,1),this._scriptProcessorNode.onaudioprocess=e=>{let t=e.inputBuffer.getChannelData(0),i=0;for(let e=0;e<t.length;++e)i+=t[e]*t[e];this._volume=Math.sqrt(i/t.length)||0},this._streamSource.connect(this._scriptProcessorNode),this._scriptProcessorNode.connect(this._destination)}catch(e){this._log.error("volumeMeter init script processor error: ".concat(e))}}destroy(){this._streamSource&&this._streamSource.disconnect(),this._scriptProcessorNode&&(this._scriptProcessorNode.onaudioprocess=null,this._scriptProcessorNode.disconnect()),this._audioWorkletNode&&(this._audioWorkletNode.port.postMessage({name:"stop"}),this._audioWorkletNode.port.onmessage=null,this._audioWorkletNode.disconnect()),this._audioWorkletNode=null,this._scriptProcessorNode=null,this._audioCtx=null,AO.off(kO.AUDIO_LEVEL_INTERVAL,this.handleAudioLevelInterval,this),AO.off(kO.WORKLET_LOADED_SUCCESS,this.initAudioWorklet,this),AO.off(kO.WORKLET_LOADED_FAILED,this.initScriptProcessor,this),eM>0&&(eM-=1),0===eM&&(null==qP||qP.close(),qP=null,XP=null)}resume(){null==qP||qP.resume()}getInternalAudioLevel(){return this._volume}getCalculatedVolume(){return parseFloat(this._volume.toFixed(2))}handleAudioLevelInterval(e){var t;let{interval:i}=e;this._interval=i,null==(t=this._audioWorkletNode)||t.port.postMessage({name:"setIntervalTime",intervalTime:i})}}({track:this._gainedTrack||e,log:this._log})}initializeElement(){if(("15.2"===Nk||"15.3"===Nk||"15.4"===Nk)&&this.muted)return void this._log.info("audioElement is muted.");let e=document.createElement(RD.AUDIO);this.track&&(e.srcObject=new MediaStream([this._gainedTrack||this.track])),e.muted=this.muted,e.setAttribute("id","audio_".concat(this.id)),e.setAttribute("autoplay","autoplay"),e.setAttribute("playsinline","playsinline"),this.element=e,this.bindElementEvents()}play(){return XA(this,null,(function*(){this.element||this.initializeElement(),this._outputDeviceId&&(yield this.setSinkId(this._outputDeviceId)),!this._volumeMeter&&this.track&&this.initVolumeMeter(this.track),this.setVolume(this._volume),yield qA(rM.prototype,this,"play").call(this)}))}stop(){this._volumeMeter&&(this._volumeMeter.destroy(),this._volumeMeter=null),this.destroyGain(),super.stop()}resume(){return XA(this,null,(function*(){yield qA(rM.prototype,this,"resume").call(this),this._volumeMeter&&this._volumeMeter.resume()}))}setSinkId(e){return XA(this,null,(function*(){this._outputDeviceId!==e&&(this.element&&(yield this.element.setSinkId(e)),this._outputDeviceId=e)}))}setVolume(e){this._volume=e,this._gainNode?this._gainNode.gain.value=e:e>1?this.createGain(e):this.element&&(this.element.volume=e)}createGain(e){tM||(tM=ZP("player")),this._log.info("create gainNode ".concat(e));let t=tM.createMediaStreamSource(new MediaStream([this.track])),i=tM.createGain(),r=tM.createMediaStreamDestination();t.connect(i),i.connect(r),i.gain.value=e,this._gainNode=i,this._destination=r,this._mediaStreamSource=t,this._gainedTrack=r.stream.getAudioTracks()[0],iM+=1,this.element&&(KP(this.element),this._sourceElement=this.element,this.element.muted=!0,this.element=null),this.play()}destroyGain(){var e,t,i;!this._gainNode||(this._log.info("destroy gainNode"),null==(e=this._gainNode)||e.disconnect(),null==(t=this._destination)||t.disconnect(),null==(i=this._mediaStreamSource)||i.disconnect(),this._gainNode=null,this._destination=null,this._mediaStreamSource=null,this._sourceElement&&(this._sourceElement.srcObject=null,this._sourceElement=null),this._gainedTrack=null,0==(iM-=1)&&tM&&(this._log.info("destroy gain audioContext"),tM.close(),tM=null))}setLoop(e){!this.element||(this.element.loop=e,this._loop=e)}getAudioLevel(){var e;return(null==(e=this._volumeMeter)?void 0:e.getCalculatedVolume())||0}getInternalAudioLevel(){var e;return null==(e=this._volumeMeter)?void 0:e.getInternalAudioLevel()}},nM=class extends _P{constructor(e){let{userId:t,sdkAppId:i,mediaType:r,room:n,isInitPlayer:o=!0}=e;var s;super(),YA(this,"id","xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{let t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))),YA(this,"userId"),YA(this,"isRemote"),YA(this,"mediaType"),YA(this,"room"),YA(this,"user"),YA(this,"_log"),YA(this,"_inputTrack"),YA(this,"_outputTrack"),YA(this,"isPlayCalled"),YA(this,"container",null),YA(this,"player"),YA(this,"subVideoPlayerMap"),YA(this,"playerMuted",!1),YA(this,"abortCtrl"),YA(this,"audioOutputDeviceId"),YA(this,"audioVolume"),YA(this,"objectFit","cover"),YA(this,"mirror",!1),YA(this,"gain"),YA(this,"isScreen",!1),YA(this,"manager"),Qw(t)||(this.userId=t),this.mediaType=r,this._log=wO.createLogger({id:"".concat(this.kind[0],"t"),userId:null==(s=n||this.room)?void 0:s.userId,remoteUserId:this instanceof AM?void 0:this.userId,sdkAppId:i,type:2===this.mediaType?"auxiliary":"main",isLocal:this instanceof AM}),o&&this.initPlayer()}get log(){return this._log||wO}get kind(){return 1===this.mediaType?RD.AUDIO:RD.VIDEO}get muted(){return!(!this.outMediaTrack||this.outMediaTrack.enabled)}get strMediaType(){return 4===this.mediaType?RD.VIDEO:2===this.mediaType?RD.SCREEN:RD.AUDIO}play(e,t){return XA(this,null,(function*(){let i=$w(e)?e[0]:e;if(this.isPlayCalled)return this.log.info("play update options: ".concat(JSON.stringify(t))),t&&!Qw(t.muted)&&this.setPlayerMute(t.muted),t&&!Qw(t.objectFit)&&(this.objectFit=t.objectFit),this.isScreen?this.mirror=!1:t&&!Qw(t.mirror)&&(this.mirror=t.mirror),void(this.kind===RD.VIDEO&&(this.player.setObjectFit(this.objectFit),this.player.setMirror(this.mirror),this.container!==i&&i&&(this.container=i,this.player.setContainer(i)),$w(e)&&e.length>=1&&(yield this.playSubContainer(e.slice(1),t))));if(t&&!Qw(t.muted)?this.setPlayerMute(t.muted):(!this.isRemote||this.kind===RD.VIDEO)&&this.setPlayerMute(!0),t&&!Qw(t.objectFit)&&(this.objectFit=t.objectFit),this.isRemote||(this.mirror=!0),this.isScreen?this.mirror=!1:t&&!Qw(t.mirror)&&(this.mirror=t.mirror),this.kind===RD.VIDEO&&(this.player.setObjectFit(this.objectFit),this.player.setMirror(this.mirror)),this.isPlayCalled=!0,i&&(this.container=i,this.player.setContainer(i)),AO.emit(kO.PLAY_TRACK_START,{track:this}),this._outputTrack){this._log.info("play with options: ".concat(JSON.stringify(t)));try{this.player.setTrack(this._outputTrack),yield this.player.play(),$w(e)&&e.length>1&&(yield this.playSubContainer(e.slice(1),t))}catch(e){throw this.handleAutoPlayFailed(),this.emit("error",e),e}}else this.log.info("play has not mediaTrack, abort")}))}playSubContainer(e,t){return XA(this,null,(function*(){if(!this._outputTrack||this.kind===RD.AUDIO)return;this.subVideoPlayerMap||(this.subVideoPlayerMap=new Map),this.subVideoPlayerMap.forEach(((t,i)=>{var r;e.find((e=>i===e))||(t.stop(),t.setContainer(null),null==(r=this.subVideoPlayerMap)||r.delete(i))}));for(let[i,r]of e.entries()){let e=this.subVideoPlayerMap.get(r);e?t&&(Qw(t.mirror)||e.setMirror(t.mirror),Qw(t.objectFit)||e.setObjectFit(t.objectFit)):this.subVideoPlayerMap.set(r,new zP({id:this.userId||this.id,track:this.outMediaTrack,container:r,muted:this.playerMuted,objectFit:this.objectFit,mirror:this.mirror,log:this.log.createChild({id:"vp-sub".concat(i+1)})}))}let i=[...this.subVideoPlayerMap.values()];for(let e of i)yield e.play()}))}initPlayer(){var e;this.log.info("create ".concat(this.kind,"Player")),this.kind===RD.AUDIO?this.player=new rM({id:this.userId||this.id,track:this.outMediaTrack,gainedTrack:null==(e=this.gain)?void 0:e.audioTrack,container:this.container||null,muted:this.playerMuted,outputDeviceId:this.audioOutputDeviceId,log:this.log}):(this.player=new zP({id:this.userId||this.id,track:this.outMediaTrack,container:this.container||null,muted:this.playerMuted,objectFit:this.objectFit,mirror:this.mirror,log:this.log}),this.player.on(yP.LOADED_DATA,(()=>{AO.emit(kO.VIDEO_LOADED_DATA,{track:this})})),this.player.on(yP.MEDIA_TRACK_CHANGED,(e=>{var t;null==(t=this.subVideoPlayerMap)||t.forEach((t=>t.setTrack(e)))}))),this.player.on(yP.PLAYER_STATE_CHANGED,(e=>{AO.emit(kO.PLAYER_STATE_CHANGED,WA({track:this},e)),this.emit("player-state-changed",e)}))}setAudioOutput(e){return XA(this,null,(function*(){var t;this.audioOutputDeviceId=e,yield null==(t=this.player)?void 0:t.setSinkId(e)}))}setAudioVolume(e){var t;this.audioVolume=e,this.log.info("setAudioVolume to ".concat(e)),null==(t=this.player)||t.setVolume(e)}getAudioLevel(){var e;return(null==(e=this.player)?void 0:e.getAudioLevel())||0}getInternalAudioLevel(){var e;return(null==(e=this.player)?void 0:e.getInternalAudioLevel())||0}stop(){!this.isPlayCalled||(this.isPlayCalled=!1,this.player&&(this.log.info("stop ".concat(this.kind," player")),this.player.stop(),this.player.setContainer(null)),this.subVideoPlayerMap&&this.subVideoPlayerMap.size>0&&this.subVideoPlayerMap.forEach((e=>{e.stop(),e.setContainer(null)})),this.container=null)}resume(){return XA(this,null,(function*(){var e;!this.isPlayCalled||(yield null==(e=this.player)?void 0:e.resume())}))}close(){this.log.info("close"),this.isPlayCalled&&this.stop()}setMute(e){return!!this.outMediaTrack&&(this.outMediaTrack.enabled=!e,this.emit(e?"mute":"unmute",this),AO.emit(e?kO.TRACK_MUTED:kO.TRACK_UNMUTED,{track:this}),!0)}setPlayerMute(e){this.playerMuted=e,this.player.setMuted(e)}get mediaTrack(){return this._inputTrack||null}get outMediaTrack(){return this._outputTrack||null}setInputMediaStreamTrack(e){let t=this._inputTrack;if(e!==t)return this._inputTrack=e,this.emit("input-media-track-changed",e||null,t||null),this.manager?this.manager.changeInput(this,t):this.setOutputMediaStreamTrack(e)}setOutputMediaStreamTrack(e){var t;e!==this._outputTrack&&(this.isRemote?this.log.debug("setOutputMediaStreamTrack",e.label):this.log.info("setOutputMediaStreamTrack",(null==(t=e.getSettings)?void 0:t.call(e).deviceId)||e.label),this._outputTrack=e,e.enabled=!this.muted,this.updatePlayingState(!!e))}setMediaType(e){this.mediaType=e}updatePlayingState(e){if(this.isPlayCalled)if(e){if(this.player.setTrack(this.outMediaTrack),this.player.isStopped)return this.player.play().catch((()=>this.handleAutoPlayFailed())),void this.log.info("playing state updated, play ".concat(this.kind))}else if(!this.player.isStopped)return this.player.stop(),void this.log.info("playing state updated, stop ".concat(this.kind));this.log.debug("updatePlayingState abort ".concat(this.isPlayCalled," ").concat(e," ").concat(this.player.isStopped))}handleAutoPlayFailed(){if(this.room&&this.room.enableAutoPlayDialog)new class{constructor(){if(YA(this,"content","音视频播放被浏览器拦截，请点击“恢复播放”。"),YA(this,"_dialogNode",null),YA(this,"_bodyPosition",""),YA(this,"_showDetail",!1),YA(this,"_isCollapseClicked",!1),YA(this,"_isQuestionClicked",!1),Hw()||(this.content='Media playback failed. Click the "Resume" to resume playback.'),!UP){let e=document.createElement("style");e.innerHTML=".".concat(RP,"{position:fixed;top:0;left:0;right:0;bottom:0;width:100vw;height:100vh;display:flex;justify-content:center;align-items:center;background:rgba(0,0,0,0.5);z-index:1500;}.").concat(RP," div:not(.").concat(kP,"){display:block !important;}.").concat(CP,"{padding:14px;background:#fff;border-radius:3px;box-shadow:0px 3px 15px #434343;border:1px solid #d1cfcf;max-width:500px;}.").concat(CP," a{color:").concat(PP,";}.").concat(AP,"{overflow:hidden;text-overflow:ellipsis;font-size:16px;font-weight:600;}.").concat(bP,"{margin:8px 0;}.").concat(kP,"{width:100%;display:flex !important;align-items:center;justify-content:right;float:right;}.").concat(wP,"{margin-right:auto;cursor:pointer}.").concat(DP,"{height:100%;line-height:16px;cursor:pointer;}.").concat(OP,"{margin-left:8px;color:#fff;background:").concat(PP,";padding:4px 12px;outline:none;border:1px solid;border-radius:3px;font-weight:bold;}.").concat(OP,":hover{opacity:0.9;}.").concat(wP,",.").concat(OP,",.").concat(bP,",.").concat(DP,"{font-size:14px;}@media screen and (max-width:750px){.").concat(CP,"{width:80vw;}}"),document.head.appendChild(e),UP=!0}this.addDiaLog()}createDiaLog(){let e=document.createElement("template");e.innerHTML='<div class="'.concat(RP,"\"><div class='").concat(CP,"'><div class='").concat(AP,"'>").concat(location.host,"</div><div class='").concat(bP,"'>").concat(this.content,"</div><div class='").concat(NP,'\' style="visibility:hidden;width:100%;height:0;font-size:12px;color:gray;">').concat(jP,"</div><div class='").concat(kP,"'></div></div></div>").trim();let t=document.createElement("button");t.className=OP,t.innerText=Hw()?"恢复播放":"Resume",t.onclick=this.onConfirm.bind(this);let i=document.createElement("div");i.className=DP,i.innerHTML='<?xml version="1.0" encoding="UTF-8"?>\n    <svg class="icon" width="18" height="18" p-id="2030" t="1639646523624" version="1.1" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">\n    <path d="m464 784.35c0 26.51 21.49 48 48 48s48-21.49 48-48-21.49-48-48-48-48 21.49-48 48z" p-id="2031"/>\n    <path d="m512 960c-247.04 0-448-200.96-448-448s200.96-448 448-448 448 200.96 448 448-200.96 448-448 448zm0-831.71c-211.58 0-383.71 172.13-383.71 383.71 0 211.55 172.13 383.71 383.71 383.71 211.55 0 383.71-172.16 383.71-383.71 0-211.58-172.16-383.71-383.71-383.71z" p-id="2032"/>\n    <path d="m512 673.7c-17.665 0-32.001-14.336-32.001-31.999v-54.112c0-52.353 40-92.352 75.328-127.65 25.887-25.92 52.672-52.672 52.672-74.017 0-53.343-43.072-96.735-95.999-96.735-53.823 0-95.999 41.536-95.999 94.559 0 17.665-14.336 31.999-32.001 31.999s-32.001-14.336-32.001-31.999c0-87.424 71.775-158.56 160-158.56s160 72.095 160 160.74c0 47.904-36.32 84.192-71.424 119.3-27.84 27.776-56.576 56.512-56.576 82.336v54.112c0 17.665-14.336 32.032-32.001 32.032z" p-id="2033"/>\n    </svg>\n    ',i.onclick=this.onQuestionClick.bind(this);let r=document.createElement("div");r.className=wP,r.innerText="".concat(Hw()?"详情 >":"Detail >"),r.onclick=this.onCollapseClick.bind(this);let n=e.content.firstChild,o=n.querySelector(".".concat(kP));return o.appendChild(r),o.appendChild(i),o.appendChild(t),n}addDiaLog(){FP()||(this._dialogNode=this.createDiaLog(),document.body.appendChild(this._dialogNode),this._dialogNode.onclick=this.onConfirm.bind(this),this._dialogNode.querySelector(".".concat(CP)).onclick=e=>e.stopPropagation(),this._bodyPosition=document.body.style.position,document.body.style.position="fixed",wO.info("show autoplay dialog"),EP.uploadEvent({log:LP}))}deleteDiaLog(){this._dialogNode&&(document.body.removeChild(this._dialogNode),document.body.style.position=this._bodyPosition,this._dialogNode=null)}onConfirm(){wO.warn("confirm clicked, try resume stream"),AO.emit(kO.AUTOPLAY_DIALOG_CLICK_CONFIRM),this.deleteDiaLog()}onCollapseClick(){let e=this._dialogNode.querySelector(".".concat(NP));e.style.visibility="".concat(this._showDetail?"hidden":"visible"),e.style.height="".concat(this._showDetail?0:"fit-content"),this._showDetail=!this._showDetail,this._isCollapseClicked||EP.uploadEvent({log:VP}),this._isCollapseClicked=!0}onQuestionClick(){window.open(BP,"_blank"),this._isQuestionClicked||EP.uploadEvent({log:xP}),this._isQuestionClicked=!0}};else{let e=()=>{this.resume().then((()=>{document.removeEventListener("click",e,!0),document.removeEventListener("touchstart",e,!0)}))};document.addEventListener("click",e,!0),document.addEventListener("touchstart",e,!0)}}};zA([hP([],_P.INIT)],nM.prototype,"close",1);var oM=Object.prototype.hasOwnProperty,sM=function(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e||"function"==typeof e||Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(jw(e))switch(Object.prototype.toString.call(e)){case"[object File]":case"[object Map]":case"[object Set]":return 0===e.size;case"[object Object]":for(let t in e)if(oM.call(e,t))return!1;return!0}return!1},aM=QA($A(),1),cM=e=>t=>t.deviceId===e,lM=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Input";YA(this,"kind"),YA(this,"type"),YA(this,"devices",[]),this.kind=e,this.type=t}update(e,t){let i=e.filter((e=>e.kind==="".concat(this.kind).concat(this.type.toLocaleLowerCase())));t&&(i.forEach((e=>{if(e.deviceId&&!this.devices.find(cM(e.deviceId))){let i="".concat(this.kind).concat(this.type,"Added");wO.warn("".concat(i,": ").concat(JSON.stringify(e))),t.emit(i,e)}})),this.devices.forEach((e=>{if(e.deviceId&&!i.find(cM(e.deviceId))){let i="".concat(this.kind).concat(this.type,"Removed");wO.warn("".concat(i,": ").concat(JSON.stringify(e))),t.emit(i,e)}}))),this.devices=i}hasDevice(e){return!!this.devices.find((t=>t.deviceId===e))}},uM=class extends aM.EventEmitter{constructor(){super(),YA(this,"audioInputs",new lM(RD.AUDIO)),YA(this,"videoInputs",new lM(RD.VIDEO)),YA(this,"audioOutputs",new lM(RD.AUDIO,"Output")),this.init(),navigator.mediaDevices&&navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.update.bind(this))}init(){hM().then((e=>{this.audioInputs.update(e),this.videoInputs.update(e),this.audioOutputs.update(e)}))}update(){return XA(this,null,(function*(){let e=yield hM();return this.audioInputs.update(e,this),this.videoInputs.update(e,this),this.audioOutputs.update(e,this),this}))}},dM=eD||Zk?null:new uM;function hM(){return XA(this,null,(function*(){return DN()||!bN()?[]:(yield navigator.mediaDevices.enumerateDevices()).map(((e,t)=>{let i={kind:e.kind,deviceId:e.deviceId,groupId:e.groupId,label:e.label||"".concat(e.kind,"_").concat(t)};return e.deviceId.length>0&&fM.add("".concat(e.deviceId,"_").concat(e.kind)),e.getCapabilities&&(i.getCapabilities=()=>e.getCapabilities()),i}))}))}function pM(){return dM.update().then((e=>e.audioInputs.devices))}function mM(){return dM.update().then((e=>e.videoInputs.devices))}function _M(){return XA(this,null,(function*(){return dM.update().then((e=>e.audioOutputs.devices))}))}var fM=new Set;function gM(e,t){return XA(this,null,(function*(){let i=(yield pM()).find((e=>e.deviceId===_w));return(null==i?void 0:i.groupId)===e&&i.label===t}))}var TM=CO({retryFunction:function(e){return XA(this,null,(function*(){let t=function(e){return{audio:SM(e),video:yM(e)}}(e);wO.info("getUserMedia with constraints: ".concat(JSON.stringify(t)));let i=[],r=[],n=["label","deviceId"];t.audio&&(i=yield pM(),wO.info("microphones: ".concat(SO(i,{keysToInclude:n})))),t.video&&(r=yield mM(),wO.info("cameras: ".concat(SO(r,{keysToInclude:n}))));try{let e=yield navigator.mediaDevices.getUserMedia(t);return ZN&&e.getTracks().forEach((e=>{wO.info("".concat(e.kind," capabilities: ").concat(SO(e.getCapabilities(),{keysToInclude:Aw})))})),e}catch(t){if("NotFoundError"===t.name){if(e.video&&r&&0===r.length)throw new ab({code:ob.DEVICE_NOT_FOUND,message:yN({key:oN})});if(e.audio&&i&&0===i.length)throw new ab({code:ob.DEVICE_NOT_FOUND,message:yN({key:nN})})}throw new ab({code:ob.INITIALIZE_FAILED,name:t.name,message:t.message,constraint:t.constraint})}}))},settings:{retries:3,timeout:500},onError:e=>{let{error:t,retry:i,reject:r,retryFuncArgs:n,retryCount:o}=e;"NotReadableError"===t.name?(n[0].video&&(n[0].maxResolution=!1,n[0].frameRate&&(n[0].frameRate=n[0].frameRate>10?10:5)),2===o&&(n[0].useTrueAsConstraint=!0),i()):r(t),n[0].microphoneId&&vM(n[0].microphoneId,!1),n[0].cameraId&&vM(n[0].cameraId,!0)},onRetrying:e=>{wO.warn("getUserMedia NotReadableError observed, retrying [".concat(e,"/3]"))},onRetryFailed:e=>{EP.logFailedEvent({eventType:$D.GET_USER_MEDIA_RETRY,error:e})},onRetrySuccess:e=>{EP.logSuccessEvent({eventType:$D.GET_USER_MEDIA_RETRY}),EP.uploadEvent({log:"stat-".concat($D.GET_USER_MEDIA_RETRY,"-success-").concat(e)})}});function vM(e,t){return XA(this,null,(function*(){let i=(t?yield mM():yield pM()).find((t=>t.deviceId===e));i&&Kw(i.getCapabilities)&&wO.warn(SO(i.getCapabilities(),{keysToInclude:Aw}))}))}function SM(e){if(!e.audio)return!1;if(e.useTrueAsConstraint)return!0;let t={};return sM(e.microphoneId)||(t.deviceId=e.useExact?{exact:e.microphoneId}:e.microphoneId),Yw(e.channelCount)&&e.channelCount>1&&(t.channelCount=e.channelCount),qw(e.echoCancellation)&&!e.echoCancellation&&(t.echoCancellation=!1),qw(e.noiseSuppression)&&!e.noiseSuppression&&(t.noiseSuppression=!1),qw(e.autoGainControl)&&!e.autoGainControl&&(t.autoGainControl=!1),!!sM(t)||t}function yM(e){if(!e.video)return!1;if(e.useTrueAsConstraint)return!0;let{maxResolution:t=!0}=e,i={};return e.cameraId?i.deviceId=e.useExact?{exact:e.cameraId}:e.cameraId:e.facingMode&&(i.facingMode=e.facingMode),e.width&&(i.width={ideal:e.width},t&&!kb&&(i.width.max=e.width)),e.height&&(i.height={ideal:e.height},t&&!kb&&(i.height.max=e.height)),kb&&ok&&e.width&&e.height&&e.width*e.height<101376&&(i.width=e.width,i.height=e.height),e.frameRate&&(i.frameRate=e.frameRate),!!sM(i)||i}var EM=TM;function IM(e){return CM(((t,i)=>function(){for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return XA(this,null,(function*(){return yield e.apply(this,r),t.apply(this,r)}))}))}function RM(e){return CM(((t,i)=>function(){for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return XA(this,null,(function*(){return e.call(this,t.apply(this,r))}))}))}function CM(e){return function(t,i,r){return r.value=e(r.value,i),r}}var AM=class extends nM{constructor(e){super({mediaType:e,isInitPlayer:!(arguments.length>1&&void 0!==arguments[1])||arguments[1]}),YA(this,"isRemote",!1),YA(this,"deviceId"),YA(this,"groupId",""),YA(this,"label",""),YA(this,"_isRecapturing",!1),YA(this,"_lastRecaptureTime",0),YA(this,"_onMuteTimeoutId",-1),YA(this,"profile"),this.onTrackMuted=this.onTrackMuted.bind(this),this.onTrackUnmuted=this.onTrackUnmuted.bind(this),this.onTrackEnded=this.onTrackEnded.bind(this)}installTrackEvent(e){JP(e,e).add(RD.MUTE,this.onTrackMuted).add(RD.UNMUTE,this.onTrackUnmuted).add(RD.ENDED,this.onTrackEnded),e.muted&&this.onTrackMuted(),e.readyState===RD.ENDED&&this.onTrackEnded()}uninstallTrackEvent(e){KP(e)}setStateToCapture(){}capture(e){return XA(this,null,(function*(){try{let t;AO.emit(kO.LOCAL_TRACK_CAPTURE_START,{track:this}),e.customSource?(t=new MediaStream,t.addTrack(e.customSource)):t=yield EM(e);let i=t.getTracks()[0];return yield this.setInputMediaStreamTrack(i),e.customSource||(this.updateDeviceIdInUse(),this.listenDeviceChange()),AO.emit(kO.LOCAL_TRACK_CAPTURE_SUCCESS,{track:this}),t}catch(e){throw AO.emit(kO.LOCAL_TRACK_CAPTURE_FAILED,{track:this,error:e}),this.log.error("getUserMedia error observed ".concat(e)),e}}))}setInputMediaStreamTrack(e){this.state===_P.INIT&&this.setStateToCapture(),this._inputTrack&&this.uninstallTrackEvent(this._inputTrack);let t=super.setInputMediaStreamTrack(e);return this.installTrackEvent(e),t}publish(e,t){return this.room=e,this.emit("4",{mediaType:this.strMediaType,state:"starting",prevState:"stopped"}),this.userId=e.userId,this._log.setUserId(e.userId),this._log.setSdkAppId(e.sdkAppId),AO.emit(kO.LOCAL_TRACK_PUBLISHED,{track:this}),t}unpublish(){this.room&&this.room.localTracks.delete(this),AO.emit(kO.LOCAL_TRACK_UNPUBLISHED,{track:this}),2===this.mediaType&&(this.mediaType=4)}updateDeviceIdInUse(){return XA(this,null,(function*(){if(this.mediaTrack&&$N){let{deviceId:e,groupId:t}=this.mediaTrack.getSettings(),{label:i}=this.mediaTrack;(yield function(e){return XA(this,arguments,(function(e){let{newDeviceId:t,oldDeviceId:i,oldGroupId:r,oldLabel:n,kind:o}=e;return function*(){return t===i&&(o!==RD.AUDIO||t!==_w||(yield gM(r,n)))}()}))}({newDeviceId:e,oldDeviceId:this.deviceId,oldGroupId:this.groupId,oldLabel:this.label,kind:this.kind}))||(this.deviceId=e,this.label=i,t&&(this.groupId=t),hM().then((t=>{let i=t.find((t=>t.deviceId===e));i&&this.emit("2",i)})))}}))}setProfile(e){this.log.info("setProfile",e),Object.assign(this.profile,e)}isNeedToRecapture(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!(!this.deviceId||!this.mediaTrack||this.kind===RD.AUDIO&&!function(e){if(e instanceof CanvasCaptureMediaStreamTrack||!(e instanceof MediaStreamTrack))return!1;let t=e.label.toLocaleLowerCase();if(t.includes("mic")||t.includes("麦克风"))return!0;let i="".concat(((null==e?void 0:e.getSettings())||{}).deviceId,"_").concat(RD.AUDIO_INPUT);return!!fM.has(i)}(this.mediaTrack)||this.kind===RD.VIDEO&&!function(e){if(e instanceof CanvasCaptureMediaStreamTrack||!(e instanceof MediaStreamTrack))return!1;let t=e.label.toLocaleLowerCase();if(t.includes("camera")||t.includes("webcam"))return!0;let i="".concat(((null==e?void 0:e.getSettings())||{}).deviceId,"_").concat(RD.VIDEO_INPUT);return!!fM.has(i)}(this.mediaTrack)||this._isRecapturing||e&&ok&&kk)}onTrackMuted(){if(this.isNeedToRecapture(!0)){if(Date.now()-this._lastRecaptureTime<yw)return void setTimeout((()=>this.onTrackMuted()),yw);this._onMuteTimeoutId=setTimeout((()=>XA(this,null,(function*(){var e;(null==(e=this.mediaTrack)?void 0:e.muted)&&"visible"===document.visibilityState&&this.recapture(yield this.getRecoverCaptureDeviceId())}))),5e3)}}onTrackUnmuted(){this._onMuteTimeoutId>0&&clearTimeout(this._onMuteTimeoutId)}onTrackEnded(){return XA(this,null,(function*(){if(this.isNeedToRecapture()){if(Date.now()-this._lastRecaptureTime<yw)return void setTimeout((()=>this.onTrackEnded()),yw);this.recapture(yield this.getRecoverCaptureDeviceId())}}))}recapture(e){return XA(this,null,(function*(){var t;if(this._isRecapturing||!this._inputTrack)return;let i;return this.log.warn("recapture trying"),null==(t=this._inputTrack)||t.stop(),this._isRecapturing=!0,this._lastRecaptureTime=Date.now(),("audio"===this.kind?yield pM():yield mM()).find((t=>t.deviceId===e))&&(i=e),this.capture({deviceId:i,useExact:!0}).then((()=>{this._isRecapturing=!1,this.log.warn("recapture success"),this.emit("1",{deviceId:this.deviceId})})).catch((e=>{this._isRecapturing=!1,this.log.warn("recapture failed ".concat(e.message)),this.emit("5",e)}))}))}getRecoverCaptureDeviceId(){return XA(this,null,(function*(){let{deviceId:e}=this;if(e){let t=(bM.get(e)||0)+1;if(bM.set(e,t),t>=3){let i="video"===this.kind?(yield mM()).find((e=>!bM.has(e.deviceId))):(yield pM()).find((e=>!bM.has(e.deviceId)));i&&(this.log.warn("".concat(e," capture fail ").concat(t," times, change new ").concat(i.deviceId)),e=i.deviceId)}}return e}))}close(){var e;super.close(),this._inputTrack&&(this._inputTrack.stop(),this.uninstallTrackEvent(this._inputTrack)),null==(e=this.manager)||e.removeInput(this)}};zA([hP(_P.INIT,"capture",{ignoreError:!0})],AM.prototype,"setStateToCapture",1),zA([hP("capture","publish",{ignoreError:!0,success(){this.room.localTracks.add(this),this.emit("4",{mediaType:this.strMediaType,state:"started",prevState:"starting"})},fail(e){let t="error",i=e.cause;i.message.includes("timeout")?t="timeout":i.code===ob.API_CALL_ABORTED&&(t="api-call"),this.emit("4",{mediaType:this.strMediaType,state:"stopped",prevState:"starting",reason:t,error:i})}})],AM.prototype,"publish",1),zA([CM((e=>function(){return XA(this,null,(function*(){let t="publish"===this.state?"started":"starting";e.call(this),this.emit("4",{mediaType:this.strMediaType,state:"stopped",prevState:t,reason:"api-call"})}))})),hP([],"capture")],AM.prototype,"unpublish",1);var bM=new Map;AO.on(kO.SWITCH_DEVICE_SUCCESS,(e=>{e.track.deviceId&&bM.delete(e.track.deviceId)}));var kM=class extends AM{constructor(e){super(1),YA(this,"mediaType",1),YA(this,"volume",0),YA(this,"profile",{echoCancellation:!0,autoGainControl:!0,noiseSuppression:!0,sampleRate:48e3,channelCount:1,bitrate:40}),YA(this,"playerMuted",!0),this.manager=e}getAudioLevel(){return this.volume||super.getAudioLevel()}capture(){let{deviceId:e,customSource:t,useExact:i=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.capture({video:!1,audio:!0,microphoneId:e,echoCancellation:this.profile.echoCancellation,autoGainControl:this.profile.autoGainControl,noiseSuppression:this.profile.noiseSuppression,sampleRate:this.profile.sampleRate,channelCount:this.profile.channelCount,useExact:i,customSource:t})}switchDevice(e){return XA(this,null,(function*(){if(this.mediaTrack){if(this.deviceId===e){if(e!==_w)return;if(yield gM(this.groupId,this.label))return}try{this.log.info("switchDevice audio to: ".concat(e)),this.mediaTrack&&this.mediaTrack.stop(),yield this.capture({deviceId:e,useExact:!0}),this.room&&(yield this.room.replaceTrack(this)),AO.emit(kO.SWITCH_DEVICE_SUCCESS,{track:this}),this.log.info("switch microphone success")}catch(e){throw this.log.error("switch microphone failed ".concat(e)),this.deviceId&&this.recapture(this.deviceId),e}}}))}listenDeviceChange(){dM&&!dM.listeners("audioInputRemoved").includes(this.handleMicrophoneRemoved)&&dM.on("audioInputRemoved",this.handleMicrophoneRemoved,this)}handleMicrophoneRemoved(e){return XA(this,null,(function*(){if(e.deviceId===this.deviceId){this.log.warn("current microphone is lost: ".concat(JSON.stringify(e)));let t=yield pM();t[0]?this.recapture(t[0].deviceId):dM.on("audioInputAdded",this.handleMicrophoneAdded,this)}}))}handleMicrophoneAdded(e){return XA(this,null,(function*(){this.log.warn("microphone added: ".concat(JSON.stringify(e))),this.recapture(e.deviceId)}))}close(){dM.off("audioInputAdded",this.handleMicrophoneAdded,this),dM.off("audioInputRemoved",this.handleMicrophoneRemoved,this),super.close()}},DM=class extends AM{constructor(e){super(4),YA(this,"mediaType",4),YA(this,"profile",{width:640,height:480,frameRate:15,bitrate:500}),YA(this,"states",{bytesSent:0,packetsSent:0,framesEncoded:0,framesSent:0,frameWidth:0,frameHeight:0}),YA(this,"small"),YA(this,"facingMode"),YA(this,"isNeedToSetBandwidth"),this.manager=e;let t=()=>{this.isAllowed2k4k(this.profile)?this.room&&this.settings.height>=1440&&"publish"===this.state&&this.room.sendAbilityStatus({"2k4k":1}):(this.log.warn("Resolution is reset to 1080p, need to upgrade ability here https://cloud.tencent.com/document/product/647/85386"),this.setProfile(GA(WA({},this.profile),{width:1920,height:1080})),this.applyProfile())};this.on("input-media-track-changed",t),this.on("publish",t)}capture(){let{deviceId:e,facingMode:t,useExact:i=!1,customSource:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.capture({audio:!1,video:!0,facingMode:t||this.facingMode,cameraId:e,width:this.profile.width,height:this.profile.height,frameRate:this.profile.frameRate,useExact:i,customSource:r})}setOutputMediaStreamTrack(e){var t;return super.setOutputMediaStreamTrack(e),null==(t=this.room)?void 0:t.replaceTrack(this)}setProfile(e){!e||(e.bitrate&&(this.isNeedToSetBandwidth=e.bitrate!==this.profile.bitrate),this.isAllowed2k4k(this.profile)?super.setProfile(e):(this.log.warn("Resolution is reset to 1080p, need to upgrade ability here https://cloud.tencent.com/document/product/647/85386"),super.setProfile(GA(WA({},this.profile),{width:1920,height:1080}))))}applyProfile(){var e;if(!this.mediaTrack)return;let t=this.settings;return t.height!==this.profile.height||t.width!==this.profile.width||t.frameRate!==this.profile.frameRate?null==(e=this.mediaTrack)?void 0:e.applyConstraints({width:this.profile.width,height:this.profile.height,frameRate:this.profile.frameRate}).then((()=>{if(this.manager&&this.manager.changeInput(this),this.room&&this.settings.height>=1440&&"publish"===this.state&&this.room.sendAbilityStatus({"2k4k":1}),this.isNeedToSetBandwidth&&this.room&&this.room.setBandWidth)return this.isNeedToSetBandwidth=!1,this.room.setBandWidth({bandwidth:this.profile.bitrate,type:RD.VIDEO,videoType:RD.BIG})})):void 0}get settings(){let e={width:this.profile.width,height:this.profile.height,frameRate:this.profile.frameRate};return $N&&this.mediaTrack&&Object.assign(e,this.mediaTrack.getSettings()),e}isAllowed2k4k(e){var t;return!(this.room&&this.room.scheduleResult&&!this.isScreen&&!(e.height*e.width<3686400))||1===(null==(t=this.room.scheduleResult.trtcAutoConf)?void 0:t["2k4k"])}isNeedToSwitchDevice(e){return!(!this.mediaTrack||this.deviceId===e||this.facingMode===e)}switchDevice(e){return XA(this,null,(function*(){let t=e;try{if(!this.isNeedToSwitchDevice(t))return;(t===RD.FACING_MODE_USER||t===RD.FACING_MODE_ENVIRONMENT)&&(this.facingMode=e,t=void 0),this.mediaTrack.stop(),yield this.capture({deviceId:t,useExact:!0}),AO.emit(kO.SWITCH_DEVICE_SUCCESS,{track:this}),this.log.info("switch camera success")}catch(e){throw this.log.error("switch camera failed ".concat(e)),this.deviceId&&this.recapture(this.deviceId),e}}))}listenDeviceChange(){dM&&!dM.listeners("audioInputRemoved").includes(this.handleCameraRemoved)&&dM.on("videoInputRemoved",this.handleCameraRemoved,this)}handleCameraRemoved(e){return XA(this,null,(function*(){if(e.deviceId===this.deviceId){this.log.warn("current camera is lost: ".concat(JSON.stringify(e)));let t=yield mM();t[0]?this.recapture(t[0].deviceId):dM.on("videoInputAdded",this.handleCameraAdded,this)}}))}handleCameraAdded(e){return XA(this,null,(function*(){this.log.warn("camera added: ".concat(JSON.stringify(e))),this.recapture(e.deviceId)}))}close(){dM.off("videoInputAdded",this.handleCameraAdded,this),dM.off("videoInputRemoved",this.handleCameraRemoved,this),super.close()}},wM=function(e){return XA(this,null,(function*(){let t=null,i=function(e){let t={systemAudio:"include",selfBrowserSurface:"include",surfaceSwitching:"include"},i={width:kk?{max:e.width}:{ideal:e.width,max:e.width},height:kk?{max:e.height}:{ideal:e.height,max:e.height},frameRate:e.frameRate,displaySurface:"monitor"};if(t.video=i,e.systemAudio){let{echoCancellation:i=!0,noiseSuppression:r=!1,autoGainControl:n=!1}=e;t.audio={echoCancellation:i,noiseSuppression:r,autoGainControl:n,sampleRate:48e3}}return t}(e);wO.info("getDisplayMedia with constraints: ".concat(JSON.stringify(i)));let r=yield navigator.mediaDevices.getDisplayMedia(i);if(e.systemAudio&&0===r.getAudioTracks().length&&(Rk&&Ak<74||kk||kb)&&wO.warn("Your browser not support capture system audio"),e.frameRate&&r.getVideoTracks()[0]&&r.getVideoTracks()[0].applyConstraints({frameRate:{min:e.frameRate,ideal:e.frameRate},width:e.width,height:e.height}).catch((e=>{wO.warn("screen applyConstraints failed: ".concat(e))})),e.audio){let i=function(e){let t={echoCancellation:e.echoCancellation,autoGainControl:e.autoGainControl,noiseSuppression:e.noiseSuppression,sampleRate:e.sampleRate,channelCount:e.channelCount};return Qw(e.microphoneId)||(t.deviceId=e.microphoneId),{audio:t,video:!1}}(e);wO.info("getUserMedia with constraints: ".concat(JSON.stringify(i))),t=yield navigator.mediaDevices.getUserMedia(i),r.addTrack(t.getAudioTracks()[0])}return r}))},OM=class extends DM{constructor(e){super(e),YA(this,"profile",{width:1920,height:1080,frameRate:5,bitrate:1600}),YA(this,"objectFit","contain"),YA(this,"isScreen",!0),this._log.id="s-".concat(this._log.id)}capture(){return XA(this,arguments,(function(){var e=this;let{systemAudio:t=!1,autoGainControl:i,echoCancellation:r,noiseSuppression:n,audioTrack:o,videoTrack:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function*(){try{let a;return s||o?(a=new MediaStream,s&&a.addTrack(s),o&&a.addTrack(o)):a=yield wM({audio:!1,systemAudio:t,width:e.profile.width,height:e.profile.height,frameRate:e.profile.frameRate,autoGainControl:i,echoCancellation:r,noiseSuppression:n}),yield e.setInputMediaStreamTrack(a.getVideoTracks()[0]),a}catch(t){throw e.log.error("getDisplayMedia error observed ".concat(t)),t instanceof ab?t:new ab({code:ob.INITIALIZE_FAILED,name:t.name,message:t.message})}}()}))}switchDevice(e){return XA(this,null,(function*(){throw new Error("Method not implemented.")}))}},NM=class extends kM{constructor(e){super(e),this._log.id="s-".concat(this._log.id)}},PM=class extends kM{constructor(e){super(e),YA(this,"_inputs",new Map),YA(this,"_destination"),YA(this,"audioContext",ZP("audio-mixer")),this._log.id="m-".concat(this._log.id),"running"!==this.audioContext.state&&this._log.warn("audio mixer context state: ".concat(this.audioContext.state)),this._destination=this.audioContext.createMediaStreamDestination(),this._destination.channelCount=1}setInputMediaStreamTrack(e){this._inputTrack=e;let t=this.audioContext.createMediaStreamSource(new MediaStream([e]));this._inputs.set(e,t),t.connect(this._destination),this._outputTrack||(this._outputTrack=this._destination.stream.getAudioTracks()[0],this.setStateToCapture())}publish(e,t){return this.room=e,t}unpublish(){delete this.room}replaceTrack(e,t){var i;!this.hasMix||(t&&(null==(i=this._inputs.get(t))||i.disconnect(),this._inputs.delete(t)),this.setInputMediaStreamTrack(e.outMediaTrack))}removeTrack(e){var t;null==(t=this._inputs.get(e))||t.disconnect(),this._inputs.delete(e),0===this._inputs.size&&(delete this._outputTrack,this.unpublish())}close(){this.stop(),this.audioContext.close()}get hasMix(){return!!this._outputTrack}set channelCount(e){this._destination.channelCount=e}};zA([hP("capture","publish",{ignoreError:!0})],PM.prototype,"publish",1),zA([hP([],"capture")],PM.prototype,"unpublish",1);var MM=class extends AM{constructor(e,t){super(1),YA(this,"musicId"),YA(this,"mediaType",1),YA(this,"volume",0),YA(this,"profile",{echoCancellation:!0,autoGainControl:!0,noiseSuppression:!0,sampleRate:48e3,channelCount:1,bitrate:40}),YA(this,"playerMuted",!1),YA(this,"audio"),YA(this,"_audioContext"),YA(this,"_destination"),YA(this,"_source",null),this.manager=e,this.initAudioContext(),this._destination=this._audioContext.createMediaStreamDestination(),this._destination.channelCount=1,this.audio=document.createElement("audio"),this.audio.src=t.url,this.audio.crossOrigin="anonymous",qw(t.loop)&&this.loop(t.loop),Yw(t.volume)&&this.setVolume(t.volume),t.id&&(this.musicId=t.id),this._source=this._audioContext.createMediaElementSource(this.audio),this._source.connect(this._destination),this.setInputMediaStreamTrack(this._destination.stream.getAudioTracks()[0]),this.installPlayerEvent()}play(){return XA(this,null,(function*(){try{yield this.audio.play(),yield qA(MM.prototype,this,"play").call(this,null,{muted:!1}),this._log.info("music ".concat(this.musicId," play success"))}catch(e){this._log.error("music ".concat(this.musicId," play error"),e)}}))}installPlayerEvent(){this.audio.addEventListener("error",this.handleAudioError.bind(this))}uninstallPlayerEvent(){this.audio.removeEventListener("error",this.handleAudioError.bind(this))}handleAudioError(e){this._log.warn("local music ".concat(this.musicId," audio error"),e)}initAudioContext(){this._audioContext=ZP("music"),"running"!==this._audioContext.state&&this._log.warn("local music ".concat(this.musicId," context state: ").concat(this._audioContext.state))}destroy(){var e,t;null==(e=this._source)||e.disconnect(),null==(t=this._destination)||t.disconnect(),this.uninstallPlayerEvent(),this.player.stop(),this._audioContext.close().then((()=>{this._source=null,this._destination=null,this._audioContext=null}))}getStream(){var e;return(null==(e=this._destination)?void 0:e.stream)||null}seek(e){e<0&&e>this.duration()?this._log.warn("Time beyond song duration."):this.audio.currentTime=e}getPosition(){return this.audio.currentTime||0}setVolume(e){e>1&&e<0?this.log.warn("volume is out of range"):this.audio.volume=e}getVolume(){return this.audio.volume||0}setPlayBackRate(e){e>8&&e<0?this.log.warn("rate is out of range"):this.audio.playbackRate=e}getPlayBackRate(){return this.audio.playbackRate||0}duration(){return this.audio.duration||0}loop(e){return this.audio&&qw(e)&&(this.audio.loop=e),this.audio.loop||!1}setOperation(e){"pause"===e&&this.audio.pause(),"resume"===e&&(this.audio.pause(),this.audio.play()),"stop"===e&&(this.audio.pause(),this.seek(0))}listenDeviceChange(){}},LM="input",VM="output",xM=e=>(e=Number(e))>0&&e<14e8;var UM=QA($A(),1);function FM(e,t,i){for(let r=0;r<i.length;r++)e.setUint8(t+r,i.charCodeAt(r))}var BM=class{constructor(e){YA(this,"audioContext_"),YA(this,"inputPCM_",new Float32Array),YA(this,"outputPCM_",new Float32Array),this.audioContext_=e}onDump(e,t){if(t===LM){let t=this.inputPCM_.length,i=new Float32Array(t+e[0].length);i.set(this.inputPCM_),i.set(e[0],t),this.inputPCM_=i}if(t===VM){let t=this.outputPCM_.length,i=new Float32Array(t+e[0].length);i.set(this.outputPCM_),i.set(e[0],t),this.outputPCM_=i}}getBlob(e){let t=e===LM?this.inputPCM_:this.outputPCM_,i=this.audioContext_.createBuffer(2,t.length,48e3);i.copyToChannel(t,0,0),i.copyToChannel(t,1,0);let r=function(e,t){t=t||{};let i,r=e.numberOfChannels,{sampleRate:n}=e,o=t.float32?3:1,s=3===o?32:16;return i=2===r?function(e,t){let i=e.length+t.length,r=new Float32Array(i),n=0,o=0;for(;n<i;)r[n++]=e[o],r[n++]=t[o],o++;return r}(e.getChannelData(0),e.getChannelData(1)):e.getChannelData(0),function(e,t,i,r,n){let o=n/8,s=r*o,a=new ArrayBuffer(44+e.length*o),c=new DataView(a);return FM(c,0,"RIFF"),c.setUint32(4,36+e.length*o,!0),FM(c,8,"WAVE"),FM(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,t,!0),c.setUint16(22,r,!0),c.setUint32(24,i,!0),c.setUint32(28,i*s,!0),c.setUint16(32,s,!0),c.setUint16(34,n,!0),FM(c,36,"data"),c.setUint32(40,e.length*o,!0),1===t?function(e,t,i){for(let r=0;r<i.length;r++,t+=2){let n=Math.max(-1,Math.min(1,i[r]));e.setInt16(t,n<0?32768*n:32767*n,!0)}}(c,44,e):function(e,t,i){for(let r=0;r<i.length;r++,t+=4)e.setFloat32(t,i[r],!0)}(c,44,e),a}(i,o,n,r,s)}(i);return i=null,new window.Blob([new DataView(r)],{type:"audio/wav"})}reset(){this.inputPCM_=new Float32Array,this.outputPCM_=new Float32Array}destroy(){this.reset()}},HM=class extends nM{constructor(e,t,i){super({userId:t.userId,sdkAppId:e.sdkAppId,mediaType:i,room:e}),this.room=e,this.user=t,YA(this,"tinyId"),YA(this,"isRemote",!0),this.tinyId=t.tinyId}setMute(e){return this.hasFlag&&super.setMute(e)}setInputMediaStreamTrack(e){super.setInputMediaStreamTrack(e),this.hasFlag&&this.isSubscribed&&this.player.setTrack(this.outMediaTrack)}waitHasMediaTrack(){return new Promise((e=>{this.mediaTrack?e():this.once("input-media-track-changed",e)}))}get isSubscribing(){return"subscribeing"===this.state.toString()}get isSubscribed(){return this.state===HM.STATE_SUBSCRIBE}get streamType(){return 0==(2&this.mediaType)?"main":"auxiliary"}subscribe(e){return e}unsubscribe(){this.player.setTrack(null),"main"===this.streamType&&"video"===this.kind&&this.room.changeType(!1,this.user)}updatePlayingState(e){if(this.isPlayCalled&&this.player.isStopped===e){if(e&&(!this.isSubscribed||!this.hasFlag||!this.outMediaTrack))return void this.log.info("abort play, isSubscribed:".concat(this.isSubscribed," hasFlag:").concat(this.hasFlag," hasTrack:").concat(!!this.outMediaTrack));super.updatePlayingState(e)}}onFlagChanged(){this.updatePlayingState(this.hasFlag)}},jM=HM;YA(jM,"STATE_SUBSCRIBE","subscribe"),zA([hP(_P.INIT,jM.STATE_SUBSCRIBE,{success(){this.log.info("subscribed"),AO.emit(kO.REMOTE_TRACK_SUBSCRIBED,{track:this}),this.updatePlayingState(!0)},ignoreError:!0})],jM.prototype,"subscribe",1),zA([hP(jM.STATE_SUBSCRIBE,_P.INIT,{success(){this.log.info("unsubscribed"),this.updatePlayingState(!1),AO.emit(kO.REMOTE_TRACK_UNSUBSCRIBED,{track:this})}})],jM.prototype,"unsubscribe",1);var WM=class extends jM{constructor(e,t){super(e,t,1),YA(this,"volume",0),YA(this,"mediaType",1),YA(this,"stat",{bytesReceived:0,packetsReceived:0,packetsLost:0,end2EndDelay:0,jitterBufferDelay:0}),this.manager=e.audioManager}getAudioLevel(){return this.volume||super.getAudioLevel()}get hasFlag(){return this.user.muteState.hasAudio&&!this.user.muteState.audioMuted}isFlagChanged(e){let t=e.hasAudio&&!e.audioMuted;return this.hasFlag||(this.volume=0),this.hasFlag!==t}},GM=class extends jM{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:4),YA(this,"mediaType",4),YA(this,"stat",{bytesReceived:0,packetsReceived:0,packetsLost:0,framesReceived:0,framesDecoded:0,frameWidth:0,frameHeight:0,end2EndDelay:0,jitterBufferDelay:0}),this.manager=e.videoManager}changeType(e){this.room.changeType(e,this.user)}get hasFlag(){return this.user.muteState.hasVideo&&!this.user.muteState.videoMuted}isFlagChanged(e){let t=e.hasVideo&&!e.videoMuted;return this.hasFlag!==t}},JM=class extends GM{constructor(e,t){super(e,t,2),YA(this,"mediaType",2),YA(this,"objectFit","contain")}get hasFlag(){return this.user.muteState.hasAuxiliary}isFlagChanged(e){let t=e.hasAuxiliary;return this.hasFlag!==t}};function KM(){}var QM=e=>e(),zM=1,YM=class extends Function{toString(){return"".concat(this.name,"(").concat(this.args.length?[...this.args].join(", "):"",")")}subscribe(e){let t=new tL(e,this,this.streamId++);return iL.subscribe({id:this.id,end:!1},{nodeId:t.sourceId,streamId:t.id}),this(t),t}},qM=class{constructor(){this.defers=new Set,this.disposed=!1}next(e){}complete(){this.dispose()}error(e){this.dispose()}get bindDispose(){return()=>this.dispose()}dispose(){this.disposed=!0,this.complete=KM,this.error=KM,this.next=KM,this.dispose=KM,this.subscribe=KM,this.doDefer()}subscribe(e){return e instanceof YM?e.subscribe(this):e(this),this}get bindSubscribe(){return e=>this.subscribe(e)}doDefer(){this.defers.forEach(QM),this.defers.clear()}defer(e){this.defers.add(e)}removeDefer(e){this.defers.delete(e)}reset(){this.disposed=!1,delete this.complete,delete this.next,delete this.dispose,delete this.next,delete this.subscribe}resetNext(){delete this.next}resetComplete(){delete this.complete}resetError(){delete this.error}},XM=class extends qM{constructor(e){super(),this.sink=e,e.defer(this.bindDispose)}next(e){this.sink.next(e)}complete(){this.sink.complete()}error(e){this.sink.error(e)}};function $M(e,t,i){if("undefined"!=typeof __FASTRX_DEVTOOLS__){let r=Object.defineProperties(Object.setPrototypeOf(e,YM.prototype),{streamId:{value:0,writable:!0,configurable:!0},name:{value:t,writable:!0,configurable:!0},args:{value:i,writable:!0,configurable:!0},id:{value:0,writable:!0,configurable:!0}});iL.create(r);for(let e=0;e<i.length;e++){let t=i[e];"function"==typeof t&&t instanceof YM&&iL.addSource(r,t)}return r}return e}function ZM(e,t){window.postMessage({source:"fastrx-devtools-backend",payload:{event:e,payload:t}})}var eL,tL=class extends XM{constructor(e,t,i){super(e),this.source=t,this.id=i,this.sourceId=e.sourceId,this.defer((()=>{iL.defer(this.source,this.id)}))}next(e){iL.next(this.source,this.id,e),this.sink.next(e)}complete(){iL.complete(this.source,this.id),this.sink.complete()}error(e){iL.complete(this.source,this.id,e),this.sink.error(e)}},iL={addSource(e,t){ZM("addSource",{id:e.id,name:e.toString(),source:{id:t.id,name:t.toString()}})},next(e,t,i){ZM("next",{id:e.id,streamId:t,data:i&&i.toString()})},subscribe(e,t){let{id:i,end:r}=e;ZM("subscribe",{id:i,end:r,sink:{nodeId:t&&t.nodeId,streamId:t&&t.streamId}})},complete(e,t,i){ZM("complete",{id:e.id,streamId:t,err:i?i.toString():null})},defer(e,t){ZM("defer",{id:e.id,streamId:t})},pipe(e){ZM("pipe",{name:e.toString(),id:e.id,source:{id:e.source.id,name:e.source.toString()}})},update(e){ZM("update",{id:e.id,name:e.toString()})},create(e){e.id||(e.id=zM++),ZM("create",{name:e.toString(),id:e.id})}},rL=class extends qM{constructor(e){super(),this.source=e,this.sinks=new Set}add(e){e.defer((()=>this.remove(e))),1===this.sinks.add(e).size&&(this.reset(),this.subscribe(this.source))}remove(e){this.sinks.delete(e),0===this.sinks.size&&this.dispose()}next(e){this.sinks.forEach((t=>t.next(e)))}complete(){this.sinks.forEach((e=>e.complete())),this.sinks.clear()}error(e){this.sinks.forEach((t=>t.error(e))),this.sinks.clear()}},nL=(eL=class extends XM{constructor(e,t,i){super(e),this.mapper=t,this.thisArg=i}next(e){super.next(this.mapper.call(this.thisArg,e))}},"map",function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return e=>{if(e instanceof YM){let i=$M((r=>{let n=new eL(r,...t);n.sourceId=i.id,n.subscribe(e)}),"map",arguments);return i.source=e,iL.pipe(i),i}return i=>e(new eL(i,...t))}});!function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];i.reduce(((e,t)=>t(e)),e)}(function(e){return $M((t=>{let i=0,r=setInterval((()=>t.next(i++)),e);return t.defer((()=>{clearInterval(r)})),"interval"}),"interval",arguments)}(250),nL((()=>performance.now())),function(){return e=>{let t=new rL(e);if(e instanceof YM){let i=$M((e=>{t.add(e)}),"share",arguments);return t.sourceId=i.id,i.source=e,iL.pipe(i),i}return $M(t.add.bind(t),"share",arguments)}}());var oL=new Map;function sL(e,t){let i=GA(WA({},t),{timestamp:lb()});oL.has(e)?oL.get(e).push(i):oL.set(e,[i])}AO.on(kO.JOIN_SUCCESS,(e=>{let{room:t}=e;sL(t.userId,{eventId:32788,eventDesc:"join room"})})),AO.on(kO.LEAVE_START,(e=>{let{room:t}=e;sL(t.userId,{eventId:32789,eventDesc:"leave room"})})),AO.on(kO.LOCAL_TRACK_PUBLISHED,(e=>{let{track:t}=e;if(t.room){let e=32769;4===t.mediaType?e=32768:2===t.mediaType&&(e=32805),sL(t.room.userId,{eventId:e,eventDesc:"publish ".concat(t.kind)})}})),AO.on(kO.LOCAL_TRACK_UNPUBLISHED,(e=>{let{track:t}=e;if(t.room){let e=32771;4===t.mediaType?e=32770:2===t.mediaType&&(e=32806),sL(t.room.userId,{eventId:e,eventDesc:"unpublish ".concat(t.kind)})}})),AO.on(kO.TRACK_MUTED,(e=>{let{track:t}=e;t.room&&(t.kind===RD.AUDIO?sL(t.room.userId,{eventId:t.isRemote?32785:32772,eventDesc:"mute audio",remoteUserId:t.isRemote?t.userId:void 0}):sL(t.room.userId,{eventId:t.isRemote?32784:32773,eventDesc:"mute video",remoteUserId:t.isRemote?t.userId:void 0}))})),AO.on(kO.TRACK_UNMUTED,(e=>{let{track:t}=e;t.room&&(t.kind===RD.AUDIO?sL(t.room.userId,{eventId:t.isRemote?32787:32774,eventDesc:"unmute audio",remoteUserId:t.isRemote?t.userId:void 0}):sL(t.room.userId,{eventId:t.isRemote?32786:32775,eventDesc:"unmute video",remoteUserId:t.isRemote?t.userId:void 0}))})),AO.on(kO.REMOTE_TRACK_SUBSCRIBED,(e=>{let{track:t}=e;!t.room||(1===t.mediaType&&sL(t.room.userId,{eventId:32777,eventDesc:"".concat(RD.SUBSCRIBE," ").concat(t.kind),remoteUserId:t.userId}),4===t.mediaType&&sL(t.room.userId,{eventId:32776,eventDesc:"".concat(RD.SUBSCRIBE," ").concat(t.kind),remoteUserId:t.userId}),8===t.mediaType&&sL(t.room.userId,{eventId:32803,eventDesc:"".concat(RD.SUBSCRIBE," ").concat(RD.SMALL_VIDEO),remoteUserId:t.userId}))})),AO.on(kO.REMOTE_TRACK_UNSUBSCRIBED,(e=>{let{track:t}=e;!t.room||(1===t.mediaType&&sL(t.room.userId,{eventId:32779,eventDesc:"".concat(RD.UNSUBSCRIBE," ").concat(t.kind),remoteUserId:t.userId}),4===t.mediaType&&sL(t.room.userId,{eventId:32778,eventDesc:"".concat(RD.UNSUBSCRIBE," ").concat(t.kind),remoteUserId:t.userId}),8===t.mediaType&&sL(t.room.userId,{eventId:32804,eventDesc:"".concat(RD.UNSUBSCRIBE," ").concat(RD.SMALL_VIDEO),remoteUserId:t.userId}))})),AO.on(kO.SWITCH_DEVICE_SUCCESS,(e=>{let{track:t}=e;t.room&&sL(t.room.userId,{eventId:t.kind===RD.VIDEO?32780:32781,eventDesc:"switch ".concat(t.kind===RD.VIDEO?"camera":"microphone")})})),AO.on(kO.LOCAL_TRACK_REPLACED,(e=>{let{track:t}=e;t.room&&sL(t.room.userId,{eventId:t.kind===RD.VIDEO?32782:32783,eventDesc:"replace ".concat(t.kind)})})),AO.on(kO.SIGNAL_CONNECTION_STATE_CHANGED,(e=>{let t,i,{room:r,prevState:n,state:o}=e;switch(o){case"CONNECTED":"RECONNECTING"===n?(t=32795,i="signal reconnected"):(t=32791,i="signal connected");break;case"DISCONNECTED":"RECONNECTING"===n?(t=32796,i="signal reconnect fail"):(t=32790,i="signal disconnected");break;case"RECONNECTING":t=32794,i="signal reconnecting"}t&&i&&sL(r.userId,{eventId:t,eventDesc:i})})),AO.on(kO.PEER_CONNECTION_STATE_CHANGED,(e=>{let t,i,{room:r,prevState:n,state:o,remoteUserId:s}=e,a=!!s,c=a?"downlink":"uplink";switch(o){case"CONNECTED":"RECONNECTING"===n?(t=a?32801:32798,i="".concat(c," reconnected")):(t=a?32793:32792,i="".concat(c," connected"));break;case"DISCONNECTED":"RECONNECTING"===n&&(t=a?32802:32799,i="".concat(c," reconnect fail"));break;case"RECONNECTING":t=a?32800:32797,i="".concat(c," reconnecting")}t&&i&&sL(r.userId,{eventId:t,eventDesc:i,remoteUserId:s})}));var aL,cL=QA($A(),1),lL=class extends cL.EventEmitter{constructor(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"userId";super(),this.mySelfId=e,this._log=t,this.key=i,YA(this,"userMap",new Map),YA(this,"remotePublishedUserMap",new Map)}getPublishedUser(e){return this.remotePublishedUserMap.get(e)}addUser(e){let t=e[this.key],{userId:i,tinyId:r,role:n}=e;if(this.userMap.has(t))return;let o={userId:i,tinyId:r,role:20===n?"anchor":"audience"};this.userMap.set(t,o),this.emit("1",o)}deleteUser(e,t){let i=this.userMap.get(e);if(!i)return;let r="peer leave [".concat(e,"]");Qw(t)||(r+=":".concat(vw[t])),this._log.info(r);let n=this.remotePublishedUserMap.get(e);if(n){let t=n.muteState;n.flag=0,this.emit("5",n.userId),this.deleteRemotePublishedUser(e),this.emit("6",{prevMuteState:t,muteState:n.muteState,flag:0})}this.userMap.delete(e),this.emit("2",i.userId)}setUserList(e){this.userMap.forEach((t=>{e.findIndex((e=>e[this.key]===t[this.key]))<0&&this.deleteUser(t[this.key],0)})),e.forEach((e=>{!this.userMap.has(e[this.key])&&e[this.key]!==this.mySelfId&&this.addUser(e)}))}addRemotePublishedUser(e){this.remotePublishedUserMap.has(e[this.key])||this.remotePublishedUserMap.set(e[this.key],e)}deleteRemotePublishedUser(e){!this.remotePublishedUserMap.has(e)||this.remotePublishedUserMap.delete(e)}setRemotePublishedUserList(e){this.remotePublishedUserMap.forEach((t=>{let i=t[this.key];if(e.findIndex((e=>e[this.key]===t[this.key]))<0){this._log.info("remote [".concat(i,"] unpublish"));let e=t.muteState;t.flag=0,this.emit("5",t.userId),this.deleteRemotePublishedUser(i),this.emit("6",{prevMuteState:e,muteState:t.muteState,flag:0})}})),e.forEach((e=>{var t;let i=e[this.key];if(i===this.mySelfId)return;let{flag:r,userId:n,tinyId:o}=e,s=dO(r,n),a=null==(t=this.remotePublishedUserMap.get(i))?void 0:t.muteState;if(a){let e=this.remotePublishedUserMap.get(i);e&&e.flag!==r&&(e.flag=r,this._log.info("remote publish updated: ".concat(JSON.stringify(e.muteState))),this.emit("6",{prevMuteState:a,muteState:s,flag:r}))}else this._log.info("remote publish. state: ".concat(JSON.stringify(s))),this.addUser({userId:n,tinyId:o,role:20}),this.emit("3",e),this.emit("6",{prevMuteState:dO(0,n),muteState:s,flag:r})}))}clear(){this.userMap.clear(),this.remotePublishedUserMap.clear()}},uL=!0,dL={SCENE_LIVE:"live",SCENE_RTC:"rtc",ROLE_ANCHOR:"anchor",ROLE_AUDIENCE:"audience",STREAM_TYPE_MAIN:"main",STREAM_TYPE_SUB:"sub",AUDIO_PROFILE_STANDARD:"standard",AUDIO_PROFILE_STANDARD_STEREO:"standard-stereo",AUDIO_PROFILE_HIGH:"high",AUDIO_PROFILE_HIGH_STEREO:"high-stereo",QOS_PREFERENCE_SMOOTH:"smooth",QOS_PREFERENCE_CLEAR:"clear"},hL={INVALID_PARAMETER:5e3,INVALID_OPERATION:5100,ENV_NOT_SUPPORTED:5200,DEVICE_ERROR:5300,SERVER_ERROR:5400,OPERATION_FAILED:5500,OPERATION_ABORT:5998,UNKNOWN_ERROR:5999},pL=((aL=pL||{})[aL.INVALID_PARAMETER=5e3]="INVALID_PARAMETER",aL[aL.INVALID_PARAMETER_REQUIRED=5001]="INVALID_PARAMETER_REQUIRED",aL[aL.INVALID_PARAMETER_TYPE=5002]="INVALID_PARAMETER_TYPE",aL[aL.INVALID_PARAMETER_EMPTY=5003]="INVALID_PARAMETER_EMPTY",aL[aL.INVALID_PARAMETER_INSTANCE=5004]="INVALID_PARAMETER_INSTANCE",aL[aL.INVALID_PARAMETER_RANGE=5005]="INVALID_PARAMETER_RANGE",aL[aL.INVALID_PARAMETER_LESS_THAN_ZERO=5006]="INVALID_PARAMETER_LESS_THAN_ZERO",aL[aL.INVALID_PARAMETER_MIN=5007]="INVALID_PARAMETER_MIN",aL[aL.INVALID_PARAMETER_MAX=5008]="INVALID_PARAMETER_MAX",aL[aL.INVALID_ELEMENT_ID=5009]="INVALID_ELEMENT_ID",aL[aL.INVALID_ELEMENT_ID_TYPE=5010]="INVALID_ELEMENT_ID_TYPE",aL[aL.INVALID_STREAM_ID=5011]="INVALID_STREAM_ID",aL[aL.INVALID_ROOM_ID_STRING=5012]="INVALID_ROOM_ID_STRING",aL[aL.INVALID_ROOM_ID_INTEGER=5013]="INVALID_ROOM_ID_INTEGER",aL[aL.INVALID_STREAM_TYPE=5014]="INVALID_STREAM_TYPE",aL[aL.INVALID_ROOM_ID_REQUIED=5015]="INVALID_ROOM_ID_REQUIED",aL[aL.INVALID_ROOM_ID_INTEGER_STRING=5016]="INVALID_ROOM_ID_INTEGER_STRING",aL[aL.INVALID_OPERATION=5100]="INVALID_OPERATION",aL[aL.INVALID_OPERATION_NOT_JOINED=5101]="INVALID_OPERATION_NOT_JOINED",aL[aL.INVALID_OPERATION_REMOTE_USER_NOT_EXIST=5102]="INVALID_OPERATION_REMOTE_USER_NOT_EXIST",aL[aL.INVALID_OPERATION_STREAM_TYPE_NOT_EXIST=5103]="INVALID_OPERATION_STREAM_TYPE_NOT_EXIST",aL[aL.INVALID_OPERATION_REPEAT_CALL=5104]="INVALID_OPERATION_REPEAT_CALL",aL[aL.ENV_NOT_SUPPORTED=5200]="ENV_NOT_SUPPORTED",aL[aL.NOT_SUPPORTED_HTTP=5201]="NOT_SUPPORTED_HTTP",aL[aL.NOT_SUPPORTED_WEBRTC=5202]="NOT_SUPPORTED_WEBRTC",aL[aL.NOT_SUPPORTED_H264_ENCODE=5203]="NOT_SUPPORTED_H264_ENCODE",aL[aL.NOT_SUPPORTED_H264_DECODE=5204]="NOT_SUPPORTED_H264_DECODE",aL[aL.NOT_SUPPORTED_SCREEN_SHARE=5205]="NOT_SUPPORTED_SCREEN_SHARE",aL[aL.NOT_SUPPORTED_SMALL_VIDEO=5206]="NOT_SUPPORTED_SMALL_VIDEO",aL[aL.NOT_SUPPORTED_SEI=5207]="NOT_SUPPORTED_SEI",aL[aL.DEVICE_ERROR=5300]="DEVICE_ERROR",aL[aL.DEVICE_NOT_FOUND_ERROR=5301]="DEVICE_NOT_FOUND_ERROR",aL[aL.DEVICE_NOT_ALLOWED_ERROR=5302]="DEVICE_NOT_ALLOWED_ERROR",aL[aL.DEVICE_NOT_READABLE_ERROR=5303]="DEVICE_NOT_READABLE_ERROR",aL[aL.DEVICE_OVERCONSTRAINED_ERROR=5304]="DEVICE_OVERCONSTRAINED_ERROR",aL[aL.DEVICE_INVALID_STATE_ERROR=5305]="DEVICE_INVALID_STATE_ERROR",aL[aL.DEVICE_SECURITY_ERROR=5306]="DEVICE_SECURITY_ERROR",aL[aL.DEVICE_ABORT_ERROR=5307]="DEVICE_ABORT_ERROR",aL[aL.CAMERA_RECOVER_FAILED=5308]="CAMERA_RECOVER_FAILED",aL[aL.MICROPHONE_RECOVER_FAILED=5309]="MICROPHONE_RECOVER_FAILED",aL[aL.SERVER_ERROR=5400]="SERVER_ERROR",aL[aL.ACCOUNT_NO_MONEY=-100013]="ACCOUNT_NO_MONEY",aL[aL.OPERATION_FAILED=5500]="OPERATION_FAILED",aL[aL.FIREWALL_RESTRICTION=5501]="FIREWALL_RESTRICTION",aL[aL.REJOIN_FAILED=5502]="REJOIN_FAILED",aL[aL.EVENT_HANDLER_ERROR=5503]="EVENT_HANDLER_ERROR",aL[aL.VIDEO_CONTEXT_ERROR=5504]="VIDEO_CONTEXT_ERROR",aL[aL.OPERATION_ABORT=5998]="OPERATION_ABORT",aL[aL.UNKNOWN_ERROR=5999]="UNKNOWN_ERROR",aL),mL=GA(WA({},fN),{INVALID_PARAMETER(e){let{fnName:t}=e;return"the parameters of the '".concat(t,"' you called does not meet the requirements, please check the API documentation.")},INVALID_PARAMETER_REQUIRED(e){let{key:t,rule:i,fnName:r,value:n}=e;return"'".concat(t||i.name,"' is a required param when calling ").concat(r,"(), received: ").concat(n,".")},INVALID_PARAMETER_TYPE(e){let{key:t,rule:i,fnName:r,value:n}=e,o="".concat(t||i.name),s="";return s=Array.isArray(i.type)?i.type.join("|"):i.type,"'".concat(o,"' must be type of ").concat(s," when calling ").concat(r,"(), received type: ").concat(Jw(n),".")},INVALID_PARAMETER_EMPTY(e){let{key:t,rule:i,fnName:r,value:n}=e;return"'".concat(t||i.name,"' cannot be '").concat(n,"' when calling ").concat(r,"().")},INVALID_PARAMETER_INSTANCE(e){let{key:t,rule:i,fnName:r,value:n}=e,o="".concat(t||i.name),s="".concat(i.instanceOf.name||i.instanceOf);return"'".concat(o,"' must be instanceof ").concat(s," when calling ").concat(r,"(), received type: ").concat(Jw(n),".")},INVALID_PARAMETER_RANGE(e){let{key:t,rule:i,fnName:r,value:n}=e;return"'".concat(t||i.name,"' must be one of ").concat(i.values.join("|")," when calling ").concat(r,"(), received: ").concat(n,".")},INVALID_PARAMETER_LESS_THAN_ZERO(e){let{key:t,rule:i,fnName:r}=e;return"'".concat(t||i.name,"' cannot be less than 0 when calling ").concat(r,"().")},INVALID_PARAMETER_MIN(e){let{key:t,rule:i,value:r}=e;return"the min value of ".concat(t||i.name," is ").concat(i.min,", received: ").concat(r,".")},INVALID_PARAMETER_MAX(e){let{key:t,rule:i,value:r}=e;return"the max value of ".concat(t||i.name," is ").concat(i.max,", received: ").concat(r,".")},INVALID_ELEMENT_ID(e){let{key:t,fnName:i}=e;return"'".concat(t,"' is not found in the document object when calling ").concat(i,"().")},INVALID_ELEMENT_ID_TYPE(e){let{key:t,fnName:i,type:r}=e;return"the element corresponding to '".concat(t,"' must be instanceof HTMLElement when calling ").concat(i,"(), received: ").concat(r,".")},INVALID_STREAM_ID(e){let{key:t}=e;return"'".concat(t,"' can only consist of uppercase and lowercase english letters (a-zA-Z), numbers (0-9), hyphens and underscores.")},INVALID_ROOM_ID_STRING(e){let{key:t}=e;return"'".concat(t,"' must be a valid string.")},INVALID_ROOM_ID_INTEGER(e){let{key:t}=e;return"'".concat(t,"' must be an integer between [1, 4294967294].")},INVALID_ROOM_ID_INTEGER_STRING(e){let{key:t}=e;return"'".concat(t,"' must be an integer but go a string, use 'parseInt' to convert it or use 'strRoomId' instead.")},INVALID_ROOM_ID_REQUIED:()=>"at least one of 'roomId'(between [1, 4294967294]) and 'strRoomId'(not empty) is required.",INVALID_STREAM_TYPE:e=>{let{fnName:t}=e;return"'streamType' is required when 'userId' is not '*', calling ".concat(t,"()")},MIX_PARAMS_USER_Z_ORDER(e){let{key:t}=e;return"'".concat(t,"' is required and must be between 1 and 15.")},MIX_PARAMS_VIDEO_FRAMERATE:"'config.videoFramerate' should be an integer between 0 and 30, excluding 0.",MIX_PARAMS_VIDEO_GOP:"'config.videoGOP' should be an integer between 1 and 8.",MIX_PARAMS_AUDIO_BITRATE:"'config.audioBitrate' should be an integer between 32 and 192.",MIX_PARAMS_NOT_SELF:"'config.mixUsers' must contain self.",MIX_PARAMS_USER_STREAM:"'config.videoWidth' and 'config.videoHeight' of output stream should be contain all mix stream.",INVALID_OPERATION(e){let{fnName:t}=e;return"the API '".concat(t,"' you called does not meet the requirements, please check the API documentation.")},INVALID_OPERATION_NOT_JOINED(e){let{fnName:t}=e;return"cannot ".concat(t," because you are not enter room yet.")},INVALID_OPERATION_REMOTE_USER_NOT_EXIST(e){let{fnName:t,value:i}=e;return"cannot ".concat(t," because remote user(userId: ").concat(i.userId,") does not publishing stream.")},INVALID_OPERATION_STREAM_TYPE_NOT_EXIST(e){let{fnName:t,value:i}=e;return"cannot ".concat(t," because remote user(userId: ").concat(i.userId,") does not publishing ").concat(i.streamType," video.")},INVALID_OPERATION_REPEAT_CALL(e){let{fnName:t}=e;return"you are already ".concat(t,"(), cannot repeated call '").concat(t,"'.")},ENV_NOT_SUPPORTED(e){let{fnName:t}=e;return"the current browser does not support the capability of the function '".concat(t,"' you are calling, please check the API documentation.")},NOT_SUPPORTED_WEBRTC:"the current browser does not support WebRTC capability, please check the SDK documentation.",NOT_SUPPORTED_H264_ENCODE:"this browser does not support H264 encode.",NOT_SUPPORTED_H264_DECODE:"this browser does not support H264 decode.",NOT_SUPPORTED_SCREEN_SHARE:"this browser does not support screen share, please check the browser version.",NOT_SUPPORTED_SMALL_VIDEO:"this browser does not support small video, please check the browser version.",NOT_SUPPORTED_SEI:"this browser does not support SEI, please check the browser version.",DEVICE_ERROR(e){let{fnName:t,error:i}=e;return"'".concat(t,"' got device exception").concat(i?", error: ".concat(i.toString(),"."):".")},DEVICE_NOT_FOUND_ERROR(e){let{fnName:t,deviceType:i=_L(t),error:r}=e;return"NotFoundError, no ".concat(i," detected, please check your device and the configuration on '").concat(t,"'").concat(r?", error: ".concat(r.toString(),"."):".")},DEVICE_NOT_ALLOWED_ERROR(e){let{fnName:t,deviceType:i=_L(t),error:r}=e;return"NotAllowedError, you have disabled ".concat(i," access, please allow the current application to use the ").concat(i).concat(r?", error: ".concat(r.toString(),"."):".")},DEVICE_NOT_READABLE_ERROR(e){let{fnName:t,deviceType:i=_L(t),error:r}=e;return"NotReadableError, the ".concat(i," maybe in use by another APP, please check if the device is pre-occupied by another APP.")},DEVICE_OVERCONSTRAINED_ERROR(e){let{fnName:t,deviceType:i=_L(t),error:r}=e;return"OverconstrainedError, the device ID is incorrect, please check whether the device ID passed in is correct".concat(r?", error: ".concat(r.toString(),"."):".")},DEVICE_INVALID_STATE_ERROR(e){let{fnName:t,deviceType:i=_L(t),error:r}=e;return"InvalidStateError, after the user clicks and interacts with the page, turn on the ".concat(i).concat(r?", error: ".concat(r.toString(),"."):".")},DEVICE_SECURITY_ERROR(e){let{fnName:t,deviceType:i=_L(t),error:r}=e;return"SecurityError, check whether the system security policy restricts the use of the ".concat(i,", and it is recommended to turn on the ").concat(i," after the user interacts with the page").concat(r?", error: ".concat(r.toString(),"."):".")},DEVICE_ABORT_ERROR(e){let{fnName:t,deviceType:i=_L(t),error:r}=e;return"AbortError, an unknown exception in the system makes the device unusable, recommended to change the device or browser and re-check whether the device is normal".concat(r?" error: ".concat(r.toString(),"."):".")},CAMERA_RECOVER_FAILED(e){let{error:t}=e;return"camera recover capture failed ".concat((null==t?void 0:t.name)||"",": ").concat((null==t?void 0:t.originMessage)||(null==t?void 0:t.message))},MICROPHONE_RECOVER_FAILED(e){let{error:t}=e;return"microphone recover capture failed ".concat((null==t?void 0:t.name)||"",": ").concat((null==t?void 0:t.originMessage)||(null==t?void 0:t.message))},OPERATION_FAILED(e){let{fnName:t,error:i}=e;return"'".concat(t,"' failed, reason: ").concat(null==i?void 0:i.toString())},FIREWALL_RESTRICTION:()=>"media connection failure due to firewall restrictions, please try to change your network.",EVENT_HANDLER_ERROR(e){let{eventName:t}=e;return"an error was caught on trtc.on('".concat(t,"', handler), please check your code on 'handler'.")},VIDEO_CONTEXT_ERROR(e){let{reason:t,error:i}=e;return"video context error ".concat(t," ").concat((null==i?void 0:i.name)||""," ").concat((null==i?void 0:i.message)||"")},SERVER_ERROR(e){let{fnName:t,error:i}=e;return"'".concat(t,"' got server error: ").concat(null==i?void 0:i.toString(),", please check the SDK documentation.")},ACCOUNT_NO_MONEY:e=>{let{fnParams:t}=e;return"your TRTC account run out of credit, please recharge.".concat(t.sdkAppId?" SDKAppId: ".concat(t.sdkAppId):"")},OPERATION_ABORT(e){let{fnName:t}=e;return"'".concat(t,"' abort")},UNKNOWN_ERROR(e){let{fnName:t,error:i}=e;return"'".concat(t,"' throw unknown exception").concat(i?", error: ".concat(i.toString(),"."):".")}});function _L(e){if(!e)return"camera";let t=e.toLowerCase();return t.includes("screen")?"screen share":t.includes("audio")?"microphone":"camera"}var fL=class extends Error{constructor(e){let{code:t,extraCode:i,message:r="",messageParams:n,fnName:o="",originError:s}=e;var a;let c;c=r||function(e){let t,{code:i,params:r,enableDocLink:n=!1}=e,o="",s=pL[i];try{t=mL[s]}catch(e){t=mL.UNKNOWN_ERROR}return Kw(t)?o=t(r):zw(t)&&(o=t),n&&(o+=" doc:"),o}({code:i||t,params:WA({fnName:o,error:s},n)}),super(c),YA(this,"name","RtcError"),YA(this,"code"),YA(this,"extraCode"),YA(this,"functionName"),YA(this,"message"),YA(this,"handler"),YA(this,"originError"),this.name=pL[t],this.code=t,this.extraCode=i,this.functionName=o,this.originError=s,this.message=c,5302===this.extraCode&&(null==(a=this.originError)?void 0:a.message.includes("system"))&&(this.handler=()=>{let e=document.createElement("a");nk?e.href="ms-settings:privacy-".concat({startLocalVideo:"webcam",startLocalAudio:"microphone"}[this.functionName]):ok&&(e.href="x-apple.systempreferences:com.apple.preference.security?Privacy_".concat({startLocalVideo:"Camera",startLocalAudio:"Microphone",startScreenShare:"ScreenCapture"}[this.functionName])),e.href.length>0&&e.click()})}static convertFrom(e,t,i){let r=e;if(e instanceof ab){let{stack:n}=e,o={code:hL.UNKNOWN_ERROR,fnName:t,originError:e};switch(e.getCode()){case ob.INVALID_PARAMETER:o.code=hL.INVALID_PARAMETER;break;case ob.INVALID_OPERATION:o.code=hL.INVALID_OPERATION;break;case ob.NOT_SUPPORTED:case ob.NOT_SUPPORTED_H264:o.code=hL.ENV_NOT_SUPPORTED,e.getCode()===ob.NOT_SUPPORTED_H264&&(o.extraCode=e.message.includes(fN.NOT_SUPPORTED_H264ENCODE)?5203:5204);break;case ob.DEVICE_NOT_FOUND:case ob.DEVICE_AUTO_RECOVER_FAILED:o.code=hL.DEVICE_ERROR;break;case ob.JOIN_ROOM_FAILED:o.messageParams={fnParams:i};case ob.SERVER_TIMEOUT:case ob.SWITCH_ROLE_FAILED:o.code=hL.SERVER_ERROR,o.extraCode=e.getExtraCode();break;case ob.API_CALL_ABORTED:o.code=hL.OPERATION_ABORT;break;case ob.INITIALIZE_FAILED:o.code=5300,o.extraCode=function(e){let t;switch(e){case"NotFoundError":t=5301;break;case"NotAllowedError":t=5302;break;case"NotReadableError":t=5303;break;case"OverconstrainedError":t=5304;break;case"InvalidStateError":t=5305;break;case"SecurityError":t=5306;break;case"AbortError":t=5307;break;default:t=5300}return t}(e.name);break;case ob.UNKNOWN:break;default:o.code=hL.OPERATION_FAILED}r=new fL(o),n&&(r.stack+=n.substr(n.indexOf("\n")))}else r=new fL({code:hL.UNKNOWN_ERROR,fnName:t,originError:e});return r}},gL=fL,TL={type:"object",properties:{cameraId:{type:"string"},useFrontCamera:{type:"boolean"},fillMode:{type:"string",values:["contain","cover","fill"]},mirror:{type:"boolean"},small:{properties:{width:{type:"number"},height:{type:"number"},frameRate:{type:"number"},bitrate:{type:"number"}}},videoTrack:{instanceOf:MediaStreamTrack}}},vL={type:"object",properties:{systemAudio:{type:"boolean"},fillMode:{type:"string",values:["contain","cover","fill"]},profile:{type:["string","object"],properties:{width:{type:"number"},height:{type:"number"},frameRate:{type:"number"},bitrate:{type:"number"}}},videoTrack:{instanceOf:MediaStreamTrack},audioTrack:{instanceOf:MediaStreamTrack}}},SL={type:["string",HTMLElement,null,"array"],arrayItem:{instanceOf:HTMLElement},validate(e,t,i){if(zw(e)){let r=document.getElementById(e);if(!r)throw new gL({code:hL.INVALID_PARAMETER,extraCode:5009,fnName:i,messageParams:{key:t}});if(!(r instanceof HTMLElement))throw new gL({code:hL.INVALID_PARAMETER,extraCode:5010,fnName:i,messageParams:{key:t,type:Jw(r)}})}}},yL={name:"userId",required:!0,type:"string"},EL={type:"object",properties:{microphoneId:{type:"string"},audioTrack:{instanceOf:MediaStreamTrack},captureVolume:{type:"number",min:0,max:100},earMonitorVolume:{type:"number",min:0,max:100},echoCancellation:{type:"boolean"},autoGainControl:{type:"boolean"},noiseSuppression:{type:"boolean"}}};function IL(e,t){if(!e)throw new gL({code:hL.INVALID_OPERATION,extraCode:5101,fnName:t})}function RL(e,t,i){if(!e)throw new gL({code:hL.INVALID_OPERATION,extraCode:5102,fnName:t,messageParams:{value:i}})}var CL={create:[{name:"RoomConfig",instanceOf:Function},{name:"CreateConfig",type:"object",properties:{plugins:{type:"array",arrayItem:{instanceOf:Function}}}}],enterRoom:{name:"EnterRoomConfig",type:"object",required:!0,validate(e,t,i){if(this._room.isJoined)throw new gL({code:hL.INVALID_OPERATION,extraCode:5104,fnName:i});if(e.roomId){if(zw(e.roomId))throw new gL({code:hL.INVALID_PARAMETER,extraCode:5016,fnName:i,messageParams:{key:t}});if(!(/^[1-9]\d*$/.test(String(e.roomId))&&e.roomId<4294967295))throw new gL({code:hL.INVALID_PARAMETER,extraCode:5013,fnName:i,messageParams:{key:t}})}else{if(!e.strRoomId)throw new gL({code:hL.INVALID_PARAMETER,extraCode:5015,fnName:i});if(!/^[A-Za-z\d\s!#$%&()+\-:;<=.>?@[\]^_{}|~,]{1,64}$/.test(e.strRoomId))throw new gL({code:hL.INVALID_PARAMETER,extraCode:5012,fnName:i,messageParams:{key:t}})}},properties:{sdkAppId:{required:!0,type:"number",allowEmpty:!1},userId:{required:!0,type:"string",allowEmpty:!1},userSig:{required:!0,type:"string",allowEmpty:!1},scene:{type:"string",values:["live","rtc"]},role:{type:"string",values:["audience","anchor"]},roomId:{type:["string","number"]},strRoomId:{type:"string"},proxy:{type:["object","string"],properties:{websocketProxy:{type:"string"},turnServer:{type:["object","array"],properties:{url:{required:!0,type:"string"},username:{type:"string"},credential:{type:"string"},credentialType:{type:"string",values:["password"]}}},loggerProxy:{type:"string"},webtransportProxy:{type:"string"}}},enableAutoPlayDialog:{type:"boolean"},userDefineRecordId:{type:"string"}}},startLocalVideo:{name:"LocalVideoConfig",type:"object",properties:{view:SL,publish:{type:"boolean"},option:TL},validate(e){var t;if((null==(t=null==e?void 0:e.option)||!t.videoTrack)&&DN())throw new gL({code:hL.ENV_NOT_SUPPORTED,extraCode:5201})}},updateLocalVideo:{name:"updateLocalVideoConfig",type:"object",required:!0,properties:{view:GA(WA({},SL),{required:!1}),publish:{type:"boolean"},mute:{type:"boolean"},option:TL}},startLocalAudio:{name:"LocalAudioConfig",type:"object",properties:{publish:{type:"boolean"},option:EL},validate(e){var t;if((null==(t=null==e?void 0:e.option)||!t.audioTrack)&&DN())throw new gL({code:hL.ENV_NOT_SUPPORTED,extraCode:5201})}},updateLocalAudio:{name:"updateLocalAudioConfig",type:"object",required:!0,properties:{publish:{type:"boolean"},mute:{type:"boolean"},option:EL}},startScreenShare:{name:"ScreenShareConfig",type:"object",properties:{view:SL,publish:{type:"boolean"},option:vL},validate(e,t,i,r,n){var o;if((null==(o=null==e?void 0:e.option)||!o.videoTrack)&&DN())throw new gL({code:hL.ENV_NOT_SUPPORTED,extraCode:5201});if(!LN())throw new gL({code:hL.ENV_NOT_SUPPORTED,fnName:i,extraCode:5205})}},updateScreenShare:{name:"updateScreenShareConfig",type:"object",required:!0,properties:{view:SL,publish:{type:"boolean"},option:vL}},muteRemoteAudio:[yL,{name:"mute",required:!0,type:"boolean"}],setRemoteAudioVolume:[yL,{name:"volume",required:!0,type:"number",min:0}],startRemoteVideo:{name:"startRemoteVideoConfig",type:"object",required:!0,properties:{view:SL,userId:{type:"string",required:!0},streamType:{values:["main","sub"],required:!0},option:{type:"object",properties:{fillMode:{type:"string",values:["contain","cover","fill"]},mirror:{type:"boolean"}}}},validate(e,t,i){IL(this._room.isJoined,i);let r=this._room.remotePublishedUserMap.get(e.userId);if(RL(!!r,i,e),r&&("main"===e.streamType&&!r.muteState.videoAvailable||"sub"===e.streamType&&!r.muteState.hasAuxiliary))throw new gL({code:hL.INVALID_OPERATION,extraCode:5103,fnName:i,messageParams:{value:e}})}},updateRemoteVideo:{name:"updateRemoteVideoConfig",type:"object",required:!0,properties:{view:GA(WA({},SL),{required:!1}),userId:{type:"string",required:!0},streamType:{values:["main","sub"],required:!0},option:{type:"object",properties:{fillMode:{type:"string",values:["contain","cover","fill"]},mirror:{type:"boolean"}}}},validate(e,t,i){IL(this._room.isJoined,i);let r=this._room.remotePublishedUserMap.get(e.userId);if(RL(!!r,i,e),r&&("main"===e.streamType&&!r.muteState.videoAvailable||"sub"===e.streamType&&!r.muteState.hasAuxiliary))throw new gL({code:hL.INVALID_OPERATION,extraCode:5103,fnName:i,messageParams:{value:e}})}},stopRemoteVideo:{name:"stopRemoteVideoConfig",type:"object",required:!0,properties:{userId:{type:"string",required:!0},streamType:{values:["main","sub"]}},validate(e,t,i){if("*"!==e.userId&&Qw(e.streamType))throw new gL({code:hL.INVALID_PARAMETER,extraCode:5014,fnName:i})}},switchRole:{name:"role",required:!0,values:["anchor","audience"],validate(e,t,i){IL(this._room.isJoined,i)}},enableAudioVolumeEvaluation:[{name:"interval",type:"number"},{name:"enableInBackground",type:"boolean"}],sendSEIMessage:[{name:"buffer",required:!0,instanceOf:ArrayBuffer,validate(e,t,i,r){if(!eP)throw new gL({code:hL.ENV_NOT_SUPPORTED,fnName:i,extraCode:5207});if(!this._room.enableSEI)throw new gL({code:hL.INVALID_OPERATION,messageParams:{key:lN}});if(e.byteLength>1e3)throw new gL({code:hL.INVALID_PARAMETER,messageParams:{key:dN,data:e.byteLength}});if(0===e.byteLength)throw new gL({code:hL.INVALID_PARAMETER,messageParams:{key:uN}});if(IL(this._room.isJoined,i),!this._room.isMainStreamPublished)throw new gL({code:hL.INVALID_PARAMETER,messageParams:{key:hN}})}},{name:"options",type:"object",properties:{seiPayloadType:{type:"number",values:[5,243]}}}]},AL={TRTC:CL},bL=class extends Error{};function kL(e,t){let i=[];return fO(i,e),fO(i,t),i}function DL(e){this._resolve=Promise.resolve(e)}function wL(e){this._reject=Promise.reject(e)}var OL=class{constructor(e,t){this.instance=e,this.group=t,YA(this,"started",!1),YA(this,"ops",[]),YA(this,"startSame",(()=>!0)),YA(this,"mergeUpdate",kL);let i=OL.instances.get(e);i?i.set(t,this):OL.instances.set(e,new Map([[t,this]]))}static get(e,t){let i=OL.instances.get(e);return i&&i.get(t)||new OL(e,t)}action(e,t,i){let r=t=>{var i;return 0===e?this.started=!0:3===e&&(this.started=!1),this.ops.shift(),null==(i=this.currentOp)||i.action(),t},n=t=>{var i,r;throw this.ops.shift(),0===e&&2===(null==(i=this.currentOp)?void 0:i.type)&&this.ops.shift().reject(new bL("start failed")),null==(r=this.currentOp)||r.action(),t},o={type:e,action:()=>t(...o.args).then(r,n),args:i,resolve:DL,reject:wL};try{switch(this.state){case 1:if(0===e)throw new bL("already started");break;case 4:if(2===e)throw new bL("not started");break;default:return this.cacheOp(o)}}catch(e){return Promise.reject(e)}return this.ops.push(o),o.promise=t(...o.args).then(r,n)}cacheOp(e){if(1===this.ops.length)switch(this.state){case 0:case 2:if(0===e.type)throw new bL("already start");break;case 3:switch(e.type){case 2:throw new bL("update not allowed when stopping");case 3:return this.currentOp.promise}break;default:throw new bL("unknown state")}else switch(e.type){case 3:if(3===this.lastOpType)return this.lastOp.promise;{let e=new bL("keep stop");if(this.ops.slice(1).forEach((t=>t.reject(e))),this.ops=this.ops.slice(0,1),3===this.state)return this.currentOp.promise}break;case 2:switch(this.lastOpType){case 2:return this.lastOp.args=this.mergeUpdate(this.lastOp.args,e.args),this.lastOp.promise;case 3:throw new bL("update not allowed after stop")}break;case 0:switch(this.lastOpType){case 2:throw new bL("start not allowed after update");case 0:throw new bL("duplicate start");case 3:if(this.startSame(this.currentOp.args,e.args))throw this.ops.pop().reject(new bL("keep start")),new bL("already start")}}e.promise=new Promise(((t,i)=>{e._resolve?e._resolve.then(t):e.resolve=t,e._reject?e._reject.catch(i):e.reject=i}));let{action:t}=e;return e.action=()=>t().then(e.resolve,e.reject),this.ops.push(e),e.promise}get lastOp(){return this.ops[this.ops.length-1]}get lastOpType(){return this.lastOp.type}get currentOp(){return this.ops[0]}get state(){return this.currentOp?this.currentOp.type:this.started?1:4}},NL=OL;YA(NL,"instances",new WeakMap);var PL=(e,t)=>{if(t instanceof bL){let{stack:i}=t;t=new gL({code:hL.OPERATION_ABORT,message:"".concat(e," abort: ").concat(t.message),fnName:e}),i&&(t.stack+=i.substr(i.indexOf("\n")))}throw t};function ML(e,t){return CM(((i,r)=>function(){for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];let a=NL.get(this,"string"==typeof e?e:e.call(this,...o));return t&&(a.startSame=t.bind(this)),a.action(0,i.bind(this),o).catch(PL.bind(null,r))}))}function LL(e,t){return CM(((i,r)=>function(){for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];let a=NL.get(this,"string"==typeof e?e:e.call(this,...o));return t&&(a.mergeUpdate=t.bind(this)),a.action(2,i.bind(this),o).catch(PL.bind(null,r))}))}function VL(e){return CM(((t,i)=>function(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return NL.get(this,"string"==typeof e?e:e.call(this,...n)).action(3,t.bind(this),n).catch(PL.bind(null,i))}))}var xL={ERROR:"error",AUTOPLAY_FAILED:"autoplay-failed",KICKED_OUT:"kicked-out",REMOTE_USER_ENTER:"remote-user-enter",REMOTE_USER_EXIT:"remote-user-exit",REMOTE_AUDIO_AVAILABLE:"remote-audio-available",REMOTE_AUDIO_UNAVAILABLE:"remote-audio-unavailable",REMOTE_VIDEO_AVAILABLE:"remote-video-available",REMOTE_VIDEO_UNAVAILABLE:"remote-video-unavailable",AUDIO_VOLUME:"audio-volume",NETWORK_QUALITY:"network-quality",CONNECTION_STATE_CHANGED:"connection-state-changed",AUDIO_PLAY_STATE_CHANGED:"audio-play-state-changed",VIDEO_PLAY_STATE_CHANGED:"video-play-state-changed",SCREEN_SHARE_STOPPED:"screen-share-stopped",DEVICE_CHANGED:"device-changed",PUBLISH_STATE_CHANGED:"publish-state-changed",SEI_MESSAGE:"sei-message",STATISTICS:"statistics"};function UL(e){return e===dL.QOS_PREFERENCE_CLEAR?"detail":e===dL.QOS_PREFERENCE_SMOOTH?"motion":""}function FL(e){return{room:e,innerEmitter:AO,constants:Kk,environment:hb,utils:db,eventLogger:EP,log:e.getLogger(),clearStarted(t,i){let r=t.getAlias(),n=NL.instances.get(e);if(n)if(i){let e=n.get(r+i);if(!e)return;e.started=!1}else n.forEach(((e,t)=>{t.startsWith(r)&&(e.started=!1)}))}}}var BL=new WeakMap;function HL(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return CM(((e,i)=>function(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];try{WL.call(this,t,n,i,this._name)}catch(e){return Promise.reject(e)}return e.apply(this,n)}))}function jL(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return CM(((e,i)=>function(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];try{WL.call(this,t,n,i,this._name)}catch(e){throw e}return e.apply(this,n)}))}function WL(e,t,i,r){if($w(e))for(let n=0;n<e.length;n++)GL.call(this,{rule:e[n],value:t[n],key:e[n].name,fnName:i,className:r});else GL.call(this,{rule:e,value:t[0],key:e.name,fnName:i,className:r})}function GL(e){let{rule:t,value:i,key:r,fnName:n,className:o}=e;function s(e){return{code:hL.INVALID_PARAMETER,extraCode:e,fnName:n,messageParams:{key:r,rule:t,value:i}}}if(Qw(i)){if(t.required)throw new gL(s(5001));if(Qw(t.defaultValue))return void(Kw(t.validate)&&t.validate.call(this,i,r,n,o,this));i=t.defaultValue}if(Array.isArray(t.type)){let e=!1;for(let r=0;r<t.type.length;r++)null===t.type[r]&&null===i&&(e=!0),Kw(t.type[r])&&i instanceof t.type[r]&&(e=!0),zw(t.type[r])&&Jw(i)===t.type[r].toLowerCase()&&(e=!0);if(!e)throw new gL({code:hL.INVALID_PARAMETER,extraCode:5002,fnName:n,messageParams:{key:r,rule:{type:t.type.map((e=>iO(e)?rO(e):zw(e)?e:Jw(e)))},value:i}})}else if(!Qw(t.type)&&Jw(i)!==t.type)throw new gL(s(5002));if(!1===t.allowEmpty){let e=Yw(i)&&(0===i||Number.isNaN(i)),t=zw(i)&&""===i.trim();if(e||t)throw new gL(s(5003))}if(t.notLessThanZero&&Yw(i)&&i<0)throw new gL(s(5006));if(!Qw(t.min)&&Yw(i)&&i<t.min)throw new gL(s(5007));if(!Qw(t.max)&&Yw(i)&&i>t.max)throw new gL(s(5008));if(zw(t.instanceOf)){if(!i||i._name!==t.instanceOf)throw new gL(s(5004))}else if(Kw(t.instanceOf)&&!(i instanceof t.instanceOf))throw new gL(s(5004));if(Array.isArray(t.values)&&!t.values.includes(i))throw new gL(s(5005));let{properties:a}=t;jw(a)&&Xw(i)&&Object.keys(a).forEach((e=>{GL.call(this,{rule:a[e],value:i&&i[e],key:"".concat(e),fnName:n,className:o})}));let{arrayItem:c}=t;jw(c)&&$w(i)&&i.forEach(((e,t)=>{GL.call(this,{rule:c,value:e,key:"".concat(r,"[").concat(t,"]"),fnName:n,className:o})})),Kw(t.validate)&&t.validate.call(this,i,r,n,o,this)}function JL(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{namePrefix:t=(()=>""),getRemoteId:i=(()=>"")}=e;return CM(((e,r)=>function(){for(var n=arguments.length,o=new Array(n),s=0;s<n;s++)o[s]=arguments[s];function a(e,t,i){if(i&&i.includes(e))return"hided";if(t===o||e in o)return t;try{return t instanceof HTMLElement?"id: ".concat(t.id," type:").concat(Jw(t)):(JSON.stringify(t),t)}catch(e){return"type:".concat(Jw(t))}}let c=this._log||loggerManager,l=t.call(this,...o),u=""!==l?"".concat(l,".").concat(r):r;o.length>0?c.info("".concat(u,"() ").concat(JSON.stringify(o,((e,t)=>a(e,t,["userSig","privateMapKey"]))))):c.info("".concat(u,"()"));try{let t=e.apply(this,o),r=sO();return tO(t)?t.then((e=>(c.info("".concat(u,"() success ").concat(i.call(this,...o))),AO.emit(kO.API_SUCCESS_RATE,{room:this._room,apiName:u,cost:sO()-r}),e))).catch((e=>{throw e=gL.convertFrom.call(this,e,u,1===o.length?o[0]:o),c.error("".concat(u,"() failed ").concat(i.call(this,...o)," ").concat(e," params: ").concat(JSON.stringify(o,a))),AO.emit(kO.API_SUCCESS_RATE,{room:this._room,apiName:u,error:e}),e})):(AO.emit(kO.API_SUCCESS_RATE,{room:this._room,apiName:u,cost:sO()-r}),t)}catch(e){throw e=gL.convertFrom.call(this,e,u),c.error("".concat(u,"() failed ").concat(e," params: ").concat(JSON.stringify(o,a))),AO.emit(kO.API_SUCCESS_RATE,{room:this._room,apiName:u,error:e}),e}}))}var KL=e=>CM(((t,i)=>function(r,n){return XA(this,null,(function*(){let o=this._plugins.get(r);if(o)return WL.call(this,o.getValidateRule(e),[n],i,"TRTC"),t.call(this,o,n);this._log.warn("plugin ".concat(r," is not found"))}))})),QL=0,zL=class{constructor(e){this.core=e,YA(this,"log"),QL+=1,this.log=e.log.createChild({id:"".concat(this.getAlias()).concat(QL)}),this.log.info("[audioMixer] created id=".concat(this.getAlias()).concat(QL)),this.core=e}getName(){return"AudioMixer"}getAlias(){return"ax"}getGroup(e){return null==e?void 0:e.id}getValidateRule(e){switch(e){case"start":return zL.startValidateRule;case"update":return zL.updateValidateRule;case"stop":return zL.stopValidateRule}}start(e){return XA(this,null,(function*(){let{room:t}=this.core;yield t.audioManager.addMusicSource(e)}))}update(e){return XA(this,null,(function*(){let{room:t}=this.core;yield t.audioManager.updateMusicSource(e)}))}stop(e){return XA(this,null,(function*(){let{room:t}=this.core;yield t.audioManager.removeMusicSource(e)}))}},YL=zL;YA(YL,"startValidateRule",{name:"options",required:!0,type:"object",properties:{id:{type:"string",required:!0},url:{type:"string",required:!0},loop:{type:"boolean"},volume:{type:"number"}},validate(e,t,i){if("*"!==e.url){let t=["mp3","ogg","wav","flac"],r=e.url.split(".").pop(),n=t.indexOf(r)>=0,o=e.url.startsWith("blob"),s=e.url.startsWith("data");if(!(n||o||s))throw new gL({code:hL.INVALID_PARAMETER,message:"start audioMixer plugin: music url is invalid, please check your file format.",fnName:i})}}}),YA(YL,"updateValidateRule",{name:"options",required:!0,type:"object",properties:{id:{type:"string",required:!0},loop:{type:"boolean"},volume:{type:"number"},seekFrom:{type:"number"},operation:{type:"string",values:["pause","resume","stop"]}}}),YA(YL,"stopValidateRule",{name:"options",type:"object",required:!0,properties:{id:{type:"string",required:!0}}});var qL=0,XL=class{constructor(e){this.core=e,YA(this,"log"),qL+=1,this.log=e.log.createChild({id:"".concat(this.getAlias()).concat(qL)}),this.log.info("[audioDenoiser] created id=".concat(this.getAlias()).concat(qL))}getName(){return"AIDenoiser"}getAlias(){return"ad"}getGroup(e){return"AIDenoiser_".concat(Date.now())}getValidateRule(e){switch(e){case"start":return XL.startValidateRule;case"update":return XL.updateValidateRule;case"stop":return XL.stopValidateRule}}start(e){return XA(this,null,(function*(){let{room:t}=this.core,{assetsPath:i,sdkAppId:r,userId:n,userSig:o}=e;if(i&&!t.audioManager.isDenoiserInit)try{yield t.audioManager.initDenoiser({assetsPath:i,sdkAppId:r,userId:n,userSig:o})}catch(e){if(e.message)throw new ab({code:ob.INVALID_PARAMETER,message:e.message})}yield t.audioManager.enableDenoiser(e),t.sendAbilityStatus({ai_denoise:1})}))}update(e){return XA(this,null,(function*(){}))}stop(e){return XA(this,null,(function*(){let{room:e}=this.core;yield e.audioManager.disableDenoiser()}))}},$L=XL;YA($L,"startValidateRule",{name:"options",required:!0,type:"object",properties:{assetsPath:{type:"string",required:!0},sdkAppId:{type:"number",required:!0},userId:{type:"string",required:!0},userSig:{type:"string",required:!0}}}),YA($L,"updateValidateRule",{type:"object"}),YA($L,"stopValidateRule",{type:"object"});var ZL=0,eV=new Set,tV=null;Yk("5.2.0");var iV=class extends rb.EventEmitter{constructor(e,t){super(),YA(this,"_room"),YA(this,"_eventListened",new Set),YA(this,"_localVideoTrack",null),YA(this,"_localAudioTrack",null),YA(this,"_localScreenTrack",null),YA(this,"_localScreenAudioTrack",null),YA(this,"_localVideoConfig",null),YA(this,"_localScreenConfig",null),YA(this,"_localAudioConfig",null),YA(this,"_remoteVideoConfigMap",new Map),YA(this,"_remoteAudioConfigMap",new Map),YA(this,"_remoteAudioMuteMap",new Map),YA(this,"_log",wO.createLogger({id:"t".concat(++ZL)})),YA(this,"_plugins",new Map),YA(this,"_networkQuality",null),this._room=new e(WA({logger:this._log,frameWorkType:iV.frameWorkType},t)),t.plugins&&t.plugins.forEach((e=>{let t=new e(FL(this._room));this._plugins.set(t.getName(),t)}));let i=new YL(FL(this._room));this._plugins.set(i.getName(),i);let r=new $L(FL(this._room));this._plugins.set(r.getName(),r),this._room.on("audio-volume",(e=>{!e.find((e=>""===e.userId))&&this._localAudioTrack&&e.push({userId:"",volume:Math.floor(100*this._localAudioTrack.getAudioLevel())}),this.emit(xL.AUDIO_VOLUME,{result:e.sort(((e,t)=>t.volume-e.volume))})})),this._room.videoManager.on("error",(e=>{let{reason:t,error:i}=e;this._log.error(new gL({code:hL.OPERATION_FAILED,extraCode:5504,messageParams:{reason:t,error:i}}))})),this.on(xL.REMOTE_AUDIO_UNAVAILABLE,(e=>{let{userId:t}=e;this._stopRemoteAudio({userId:t},!1).catch((()=>{}))})),this.on(xL.REMOTE_VIDEO_UNAVAILABLE,(e=>{let{userId:t,streamType:i}=e;this._stopRemoteVideo({userId:t,streamType:i},!1).catch((()=>{}))})),JP(dM,dM).add("audioInputAdded",(e=>{this.emit(xL.DEVICE_CHANGED,{type:"microphone",action:"add",device:e})})).add("audioInputRemoved",(e=>{this.emit(xL.DEVICE_CHANGED,{type:"microphone",action:"remove",device:e})})).add("videoInputAdded",(e=>{this.emit(xL.DEVICE_CHANGED,{type:"camera",action:"add",device:e})})).add("videoInputRemoved",(e=>{this.emit(xL.DEVICE_CHANGED,{type:"camera",action:"remove",device:e})})).add("audioOutputAdded",(e=>XA(this,null,(function*(){if(this.emit(xL.DEVICE_CHANGED,{type:"speaker",action:"add",device:e}),tV&&tV.deviceId===fw){let e=(yield _M()).find((e=>e.deviceId===fw));e&&tV.groupId!==e.groupId&&(tV=e,this.emit(xL.DEVICE_CHANGED,{type:"speaker",action:"active",device:e}))}})))).add("audioOutputRemoved",(e=>XA(this,null,(function*(){this.emit(xL.DEVICE_CHANGED,{type:"speaker",action:"remove",device:e});let t=(yield _M())[0];t&&tV&&(tV.deviceId===e.deviceId||tV.deviceId===fw&&tV.groupId!==t.groupId)&&(tV=t,this.emit(xL.DEVICE_CHANGED,{type:"speaker",action:"active",device:t}))})))),((e,t)=>{let{emit:i}=e;e.emit=function(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];try{return i.apply(e,n)}catch(e){let i=yN({key:aN,data:{name:t,event:n[0]},addDocLink:!1});return wO.warn("".concat(i,"\n\n").concat(e.stack)),!1}}})(this,"trtc")}static create(e){}static _create(e,t){!function(){var e;uL&&(uL=!1,5!==wO.getLogLevel()&&(console.info("******************************************************************************"),console.info("*   TRTC Web SDK"),console.info("*   API Document: ".concat(cD,"/en/index.html")),console.info("*   Changelog: ".concat(cD,"/en/tutorial-01-info-changelog.html")),console.info("*   Report issues: https://github.com/LiteAVSDK/TRTC_Web/issues"),console.info("******************************************************************************")),wO.info("TRTC Web SDK Version:",zk),wO.info("UA:",navigator.userAgent),wO.info("URL: ".concat(location.href).concat("IFRAME"===(null==(e=self.frameElement)?void 0:e.tagName)?" in iframe":"")),jk().then((e=>{if(e){let t="UAData: ".concat(e.platform,"/").concat(e.platformVersion);e.architecture&&e.bitness&&(t+=" ".concat(e.architecture,"/").concat(e.bitness)),e.mobile&&(t+=" mobile"),e.model&&(t+=" model: ".concat(e.model)),e.fullVersionList&&(t+=" ".concat(e.fullVersionList.filter((e=>"Not/A)Brand"!==e.brand)).map((e=>"".concat(e.brand,"/").concat(e.version))).join(","))),wO.info(t)}})))}();let i=new iV(e,t||{});return eV.add(i),tV?i.emit(xL.DEVICE_CHANGED,{type:"speaker",action:"active",device:tV}):_M().then((e=>{e[0]&&(tV=e[0],i.emit(xL.DEVICE_CHANGED,{type:"speaker",action:"active",device:e[0]}))})),i}enterRoom(e){return XA(this,null,(function*(){var t,i;let{scene:r="rtc",enableAutoPlayDialog:n=!0,autoReceiveAudio:o=!0,autoReceiveVideo:s=!0}=e;e.proxy&&(this._room.setProxyServer(e.proxy),!zw(e.proxy)&&e.proxy.turnServer&&(null==(i=(t=this._room).setTurnServer)||i.call(t,e.proxy.turnServer,e.proxy.iceTransportPolicy))),this._room.enableAutoPlayDialog=n,this._room.autoReceiveAudio=o,this._room.autoReceiveVideo=s,qw(e.enableHWEncoder)&&(this._room.enableHWEncoder=e.enableHWEncoder);let a={sdkAppId:e.sdkAppId,userId:e.userId,userSig:e.userSig,privateMapKey:e.privateMapKey||null,role:"audience"===e.role?21:20,roomId:e.roomId||0,strRoomId:e.strRoomId||"",businessInfo:e.businessInfo||null,streamId:null,userDefineRecordId:e.userDefineRecordId||null,frameWorkType:e.frameWorkType,component:e.component,language:e.language};e.strRoomId&&!e.roomId&&(this._room.useStringRoomId=!0),JP(this,this._room).add("peer-join",(e=>{let{userId:t}=e;this.emit(xL.REMOTE_USER_ENTER,{userId:t})})).add("peer-leave",(e=>{this.emit(xL.REMOTE_USER_EXIT,{userId:e})})).add("banned",(e=>{this._exitRoom().then((()=>{this.emit(xL.KICKED_OUT,{reason:e.reason})}))})).add("error",(e=>{this._exitRoom().then((()=>{this.emit(xL.ERROR,gL.convertFrom(e))}))})).add("signal-connection-state-changed",(e=>{this.emit(xL.CONNECTION_STATE_CHANGED,e)})).add("network-quality",(e=>{this._networkQuality=e,this.emit(xL.NETWORK_QUALITY,e)})).add("remote-published",(e=>{[e.remoteAudioTrack,e.remoteVideoTrack,e.remoteAuxiliaryTrack].forEach((t=>{JP(t,t).add("player-state-changed",(i=>{let r=GA(WA({},i),{userId:e.userId});t.kind===RD.VIDEO&&(r.streamType=function(e){return"sub"===e?"auxiliary":"auxiliary"===e?"sub":"main"}(t.streamType)),this.emit(t.kind===RD.AUDIO?xL.AUDIO_PLAY_STATE_CHANGED:xL.VIDEO_PLAY_STATE_CHANGED,r)})).add("error",(e=>{e.getCode()===ob.PLAY_NOT_ALLOWED&&this.emit(xL.AUTOPLAY_FAILED,{userId:t.userId})}))}))})).add("remote-unpublished",(e=>{[e.remoteAudioTrack,e.remoteVideoTrack,e.remoteAuxiliaryTrack].forEach((e=>{KP(e)}))})).add("remote-publish-state-changed",(e=>{let{prevMuteState:t,muteState:i}=e,{userId:r}=i;this._room.remotePublishedUserMap.get(r);let n=t.audioAvailable,o=t.videoAvailable,{audioAvailable:s,videoAvailable:a}=i;s||this._remoteAudioConfigMap.delete(r),a||this._remoteVideoConfigMap.delete("".concat(r,"_","main")),i.hasAuxiliary||this._remoteVideoConfigMap.delete("".concat(r,"_","sub")),n!==s&&this.emit(s?xL.REMOTE_AUDIO_AVAILABLE:xL.REMOTE_AUDIO_UNAVAILABLE,{userId:r}),o!==a&&this.emit(a?xL.REMOTE_VIDEO_AVAILABLE:xL.REMOTE_VIDEO_UNAVAILABLE,{userId:r,streamType:"main"}),t.hasAuxiliary!==i.hasAuxiliary&&this.emit(i.hasAuxiliary?xL.REMOTE_VIDEO_AVAILABLE:xL.REMOTE_VIDEO_UNAVAILABLE,{userId:r,streamType:"sub"})})).add("firewall-restriction",(()=>{this.emit(xL.ERROR,new gL({code:hL.OPERATION_FAILED,extraCode:5501}))})).add("sei-message",(e=>{this.emit(xL.SEI_MESSAGE,e)})).add("heartbeat-report",(e=>{var t,i,r,n,o,s,a;let c={2:"big",3:"small",7:"sub"},l={rtt:e.msg_up_stream_info.msg_network_status.uint32_rtt||(null==(t=e.msg_down_stream_info[0])?void 0:t.msg_network_status.uint32_rtt)||(null==(i=this._networkQuality)?void 0:i.uplinkRTT)||(null==(r=this._networkQuality)?void 0:r.downlinkRTT)||0,upLoss:(null==(n=this._networkQuality)?void 0:n.uplinkLoss)||0,downLoss:(null==(o=this._networkQuality)?void 0:o.downlinkLoss)||0,bytesSent:e.bytes_sent||0,bytesReceived:e.bytes_received||0,localStatistics:{audio:{bitrate:((null==(s=e.msg_up_stream_info.msg_audio_status)?void 0:s.uint32_audio_codec_bitrate)||0)/1e3,audioLevel:((null==(a=e.msg_up_stream_info.msg_audio_status)?void 0:a.uint32_audio_level)||0)/bw},video:e.msg_up_stream_info.msg_video_status.filter((e=>c[e.uint32_video_stream_type])).map((e=>({bitrate:(e.uint32_video_codec_bitrate||0)/1e3,width:e.uint32_video_width,height:e.uint32_video_height,frameRate:e.uint32_video_enc_fps,videoType:c[e.uint32_video_stream_type]})))},remoteStatistics:e.msg_down_stream_info.map((e=>({userId:e.msg_user_info.str_identifier,audio:{bitrate:(e.msg_audio_status.uint32_audio_codec_bitrate||0)/1e3,audioLevel:(e.msg_audio_status.uint32_audio_level||0)/bw},video:e.msg_video_status.map((e=>({bitrate:(e.uint32_video_codec_bitrate||0)/1e3,width:e.uint32_video_width,height:e.uint32_video_height,frameRate:e.uint32_video_dec_fps,videoType:c[e.uint32_video_stream_type]})))})))};this.emit(xL.STATISTICS,l)})),this._handleReceiveMode(),yield this._room.join(a,r,iV.frameWorkType),this._checkTrackToPublish()}))}exitRoom(){return XA(this,null,(function*(){return yield this._exitRoom()}))}switchRole(e){return XA(this,null,(function*(){yield this._room.switchRole(e),"anchor"===e&&this._checkTrackToPublish()}))}destroy(){KP(dM),this.removeAllListeners(),this._room.destroy(),eV.delete(this),this._localAudioTrack&&this.stopLocalAudio(),this._localVideoTrack&&this.stopLocalVideo(),this._localScreenTrack&&this.stopScreenShare()}startLocalAudio(){return XA(this,arguments,(function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{publish:!0};return function*(){if(e._localAudioTrack)return void e._log.warn("local audio is already started");let{publish:i=!0,option:r}=t,n=new kM(e._room.audioManager),o={},s={muted:!0};r&&(Qw(r.microphoneId)?Qw(r.audioTrack)||(o.customSource=r.audioTrack):o.deviceId=r.microphoneId,Qw(r.captureVolume),Qw(r.profile)||(zw(r.profile)?yD[r.profile]&&n.setProfile(yD[r.profile]):n.setProfile(r.profile)),Yw(r.earMonitorVolume)&&(s.muted=!(r.earMonitorVolume>0),s.volume=r.earMonitorVolume),Qw(r.echoCancellation)||(n.profile.echoCancellation=r.echoCancellation),Qw(r.noiseSuppression)||(n.profile.noiseSuppression=r.noiseSuppression),Qw(r.autoGainControl)||(n.profile.autoGainControl=r.autoGainControl)),n.on("5",(t=>{e.emit(xL.ERROR,new gL({code:hL.DEVICE_ERROR,extraCode:5309,messageParams:{error:t}}))})),n.on("2",(t=>{e.emit(xL.DEVICE_CHANGED,{type:"microphone",action:"active",device:t})})),n.on("4",(t=>{let i;t.error&&(i=gL.convertFrom(t.error)),e.emit(xL.PUBLISH_STATE_CHANGED,GA(WA({},t),{error:i}))})),yield n.capture(o),JP(n,n).add("player-state-changed",(t=>{e.emit(xL.AUDIO_PLAY_STATE_CHANGED,GA(WA({},t),{userId:""}))})),i&&e._room.isJoined&&e._room.publish(n).catch((()=>{})),yield e._updateAudioPlayOption({playOption:s,track:n}),e._localAudioTrack=n,e._localAudioConfig=GA(WA({},t),{publish:i})}()}))}updateLocalAudio(e){return XA(this,null,(function*(){if(!this._localAudioTrack||!this._localAudioConfig)return;let{publish:t,mute:i,option:r}=e,n={};r&&(r.microphoneId?yield this._localAudioTrack.switchDevice(r.microphoneId):Qw(r.audioTrack)||(yield this._localAudioTrack.setInputMediaStreamTrack(r.audioTrack)),Qw(r.captureVolume),Qw(r.earMonitorVolume)||(n.muted=!(r.earMonitorVolume>0),n.volume=r.earMonitorVolume)),this._room.isJoined&&!Qw(t)&&(t&&!this._localAudioConfig.publish&&this._room.publish(this._localAudioTrack).catch((()=>{})),this._localAudioConfig.publish&&!t&&this._room.unpublish(this._localAudioTrack).catch((()=>{}))),Qw(i)||this._localAudioTrack.setMute(i),yield this._updateAudioPlayOption({playOption:n,track:this._localAudioTrack,prevConfig:this._localAudioConfig}),fO(this._localAudioConfig,e)}))}stopLocalAudio(){return XA(this,null,(function*(){!this._localAudioTrack||(this._room.isJoined&&(yield this._room.unpublish(this._localAudioTrack).catch((()=>{}))),this._localAudioTrack.stop(),this._localAudioTrack.close(),KP(this._localAudioTrack),this._localAudioTrack=null,this._localAudioConfig=null)}))}startLocalVideo(){return XA(this,arguments,(function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{publish:!0,view:null};return function*(){if(e._localVideoTrack)return void e._log.warn("local video is already started");let{view:i,publish:r=!0,option:n}=t,o=new DM(e._room.videoManager),s={},a={};if(n&&(n.cameraId?s.deviceId=n.cameraId:Qw(n.useFrontCamera)?Qw(n.videoTrack)||(s.customSource=n.videoTrack):s.facingMode=n.useFrontCamera?RD.FACING_MODE_USER:RD.FACING_MODE_ENVIRONMENT,Qw(n.profile)||(zw(n.profile)?ED[n.profile]&&o.setProfile(ED[n.profile]):o.setProfile(n.profile)),Qw(n.fillMode)||(a.objectFit=n.fillMode),Qw(n.mirror)||(a.mirror=n.mirror),Qw(n.small)||(jN()?zw(n.small)?o.small=ED[n.small]:o.small=n.small:e._log.warn("small stream is not supported"))),o.on("5",(t=>{e.emit(xL.ERROR,new gL({code:hL.DEVICE_ERROR,extraCode:5308,messageParams:{error:t}}))})),o.on("2",(t=>{e.emit(xL.DEVICE_CHANGED,{type:"camera",action:"active",device:t})})),o.on("4",(t=>{let i;t.error&&(i=gL.convertFrom(t.error)),e.emit(xL.PUBLISH_STATE_CHANGED,GA(WA({},t),{error:i}))})),yield o.capture(s),(null==n?void 0:n.qosPreference)&&o.mediaTrack){let e=UL(n.qosPreference);o.mediaTrack.contentHint=e}JP(o,o).add("player-state-changed",(t=>{e.emit(xL.VIDEO_PLAY_STATE_CHANGED,GA(WA({},t),{userId:"",streamType:"main"}))})),r&&e._room.isJoined&&e._room.publish(o).catch((()=>{})),yield e._updateVideoPlayOption({view:i,playOption:a,track:o}),e._localVideoTrack=o,e._localVideoConfig=GA(WA({},t),{view:i,publish:r})}()}))}updateLocalVideo(e){return XA(this,null,(function*(){if(!this._localVideoTrack||!this._localVideoConfig)return;let{view:t,publish:i,mute:r,option:n}=e,o={};if(n&&(Qw(n.profile)||(zw(n.profile)?ED[n.profile]&&this._localVideoTrack.setProfile(ED[n.profile]):this._localVideoTrack.setProfile(n.profile),(!n.cameraId||!this._localVideoTrack.isNeedToSwitchDevice(n.cameraId))&&Qw(n.useFrontCamera)&&this._localVideoTrack.applyProfile()),n.cameraId?yield this._localVideoTrack.switchDevice(n.cameraId):Qw(n.useFrontCamera)?Qw(n.videoTrack)||(yield this._localVideoTrack.setInputMediaStreamTrack(n.videoTrack)):yield this._localVideoTrack.switchDevice(n.useFrontCamera?RD.FACING_MODE_USER:RD.FACING_MODE_ENVIRONMENT),Qw(n.fillMode)||(o.objectFit=n.fillMode),Qw(n.mirror)||(o.mirror=n.mirror),n.qosPreference&&this._localVideoTrack.mediaTrack)){let e=UL(n.qosPreference);this._localVideoTrack.mediaTrack.contentHint=e}this._room.isJoined&&!Qw(i)&&(i&&!this._localVideoConfig.publish&&this._room.publish(this._localVideoTrack).catch((()=>{})),this._localVideoConfig.publish&&!i&&this._room.unpublish(this._localVideoTrack).catch((()=>{}))),Qw(r)||this._localVideoTrack.setMute(r),yield this._updateVideoPlayOption({view:t,playOption:o,track:this._localVideoTrack,prevConfig:this._localVideoConfig}),fO(this._localVideoConfig,e)}))}stopLocalVideo(){return XA(this,null,(function*(){!this._localVideoTrack||(this._room.isJoined&&(yield this._room.unpublish(this._localVideoTrack).catch((()=>{}))),this._localVideoTrack.stop(),this._localVideoTrack.close(),KP(this._localVideoTrack),this._localVideoTrack=null,this._localVideoConfig=null)}))}startScreenShare(){return XA(this,arguments,(function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{publish:!0,view:null};return function*(){if(e._localScreenTrack)return void e._log.warn("screen share is already started");let{view:i=null,publish:r=!0,option:n}=t,o=new OM(e._room.videoManager);o.on("4",(t=>{let i;t.error&&(i=gL.convertFrom(t.error)),e.emit(xL.PUBLISH_STATE_CHANGED,GA(WA({},t),{error:i}))}));let s=null;o.setMediaType(2);let a={},c={};n&&(Qw(n.profile)||(zw(n.profile)?ID[n.profile]&&o.setProfile(ID[n.profile]):o.setProfile(n.profile)),n.systemAudio&&(a.systemAudio=!0,a.echoCancellation=n.echoCancellation,a.noiseSuppression=n.noiseSuppression,a.autoGainControl=n.autoGainControl),Qw(n.fillMode)||(c.objectFit=n.fillMode),n.videoTrack&&(a.videoTrack=n.videoTrack),n.audioTrack&&(a.audioTrack=n.audioTrack));let l=yield o.capture(a);if(null!=n&&n.qosPreference){let e=UL(n.qosPreference);o.mediaTrack.contentHint=e}if(o.mediaTrack.addEventListener(RD.ENDED,(()=>{e._stopScreenShare(),e.emit(xL.SCREEN_SHARE_STOPPED)})),l.getAudioTracks()[0]&&(s=new NM(e._room.audioManager),s.setInputMediaStreamTrack(l.getAudioTracks()[0])),JP(o,o).add("player-state-changed",(t=>{e.emit(xL.VIDEO_PLAY_STATE_CHANGED,GA(WA({},t),{userId:"",streamType:"sub"}))})),r&&e._room.isJoined){let t=[o];s&&t.push(s),e._room.publish(...t).catch((()=>{}))}yield e._updateVideoPlayOption({view:i,playOption:c,track:o}),e._localScreenTrack=o,e._localScreenAudioTrack=s,e._localScreenConfig=GA(WA({},t),{view:i,publish:r})}()}))}updateScreenShare(e){return XA(this,null,(function*(){if(!this._localScreenTrack||!this._localScreenConfig)return;let{view:t,publish:i,option:r}=e,n={};if(r&&(Qw(r.fillMode)||(n.objectFit=r.fillMode),r.qosPreference)){let e=UL(r.qosPreference);this._localScreenTrack.mediaTrack.contentHint=e}this._room.isJoined&&!Qw(i)&&(i&&!this._localScreenConfig.publish&&this._room.publish(this._localScreenTrack).catch((()=>{})),this._localScreenConfig.publish&&!i&&this._room.unpublish(this._localScreenTrack).catch((()=>{}))),yield this._updateVideoPlayOption({view:t,playOption:n,track:this._localScreenTrack,prevConfig:this._localScreenConfig}),fO(this._localScreenConfig,e)}))}stopScreenShare(){return XA(this,null,(function*(){return yield this._stopScreenShare()}))}startRemoteVideo(e){return XA(this,null,(function*(){let{view:t,userId:i,streamType:r,option:n}=e,o="".concat(i,"_").concat(r);if(this._remoteVideoConfigMap.has(o))return void this._log.warn("remote video has already started. userId:".concat(i,", streamType:").concat(r));let s=this._room.remotePublishedUserMap.get(i);if(!s)return;let a={},c="main"===r?s.remoteVideoTrack:s.remoteAuxiliaryTrack;n&&(Qw(n.fillMode)||(a.objectFit=n.fillMode),Qw(n.mirror)||(a.mirror=n.mirror),"main"===r&&!Qw(n.small)&&this._room.changeType(n.small,c.user)),yield this._room.subscribe(c),yield this._updateVideoPlayOption({view:t,playOption:a,track:c}),this._remoteVideoConfigMap.set(o,e)}))}updateRemoteVideo(e){return XA(this,null,(function*(){let{view:t,userId:i,streamType:r,option:n}=e,o="".concat(i,"_").concat(r);if(!this._remoteVideoConfigMap.has(o)||!this._room.remotePublishedUserMap.has(i))return;let s={};n&&(Qw(n.fillMode)||(s.objectFit=n.fillMode),Qw(n.mirror)||(s.mirror=n.mirror));let a=null,c=this._room.remotePublishedUserMap.get(i);"main"===r&&(null==c?void 0:c.muteState.hasVideo)&&(a=c.remoteVideoTrack),"sub"===r&&(null==c?void 0:c.muteState.hasAuxiliary)&&(a=c.remoteAuxiliaryTrack);let l=this._remoteVideoConfigMap.get(o);a&&("main"===r&&n&&!Qw(n.small)&&this._room.changeType(n.small,a.user),yield this._updateVideoPlayOption({view:t,playOption:s,track:a,prevConfig:l})),fO(l,e)}))}stopRemoteVideo(e){return XA(this,null,(function*(){return this._stopRemoteVideo(e)}))}_stopRemoteVideo(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return XA(this,null,(function*(){let i=[],r=this._room.remotePublishedUserMap.get(e.userId);if(r){let{muteState:t,remoteVideoTrack:n,remoteAuxiliaryTrack:o}=r;"main"===e.streamType&&(n.stop(),t.hasVideo&&i.push(n)),"sub"===e.streamType&&(o.stop(),t.hasAuxiliary&&i.push(o))}for(let e of i)t&&(yield this._room.unsubscribe(e));this._remoteVideoConfigMap.delete("".concat(e.userId,"_").concat(e.streamType))}))}muteRemoteAudio(e,t){return XA(this,null,(function*(){if("*"===e)if(t)yield this._stopRemoteAudio({userId:e});else{let e=[...this._room.remotePublishedUserMap.values()];for(let t of e)t.muteState.hasAudio&&(yield this._startRemoteAudio({userId:t.userId}))}else t?yield this._stopRemoteAudio({userId:e}):yield this._startRemoteAudio({userId:e});this._remoteAudioMuteMap.set(e,t)}))}setRemoteAudioVolume(e,t){if("*"===e){let e=[...this._room.remotePublishedUserMap.values()];for(let i of e)this._updateAudioPlayOption({playOption:{volume:t},track:i.remoteAudioTrack})}else if(e){let i=this._room.remotePublishedUserMap.get(e);i&&this._updateAudioPlayOption({playOption:{volume:t},track:i.remoteAudioTrack})}}startPlugin(e,t){return XA(this,null,(function*(){return e.start(t)}))}updatePlugin(e,t){return XA(this,null,(function*(){return e.update(t)}))}stopPlugin(e,t){return XA(this,null,(function*(){return e.stop(t)}))}enableAudioVolumeEvaluation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._room.enableAudioVolumeEvaluation(e,t)}on(e,t,i){return super.on(e,t,i),this._eventListened.add(e),this}off(e,t,i){return"*"===e?(this._eventListened.clear(),this.removeAllListeners()):super.off(e,t,i),this}getVideoTrack(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{userId:"",streamType:"main"},{userId:t="",streamType:i="main"}=e;if(""===t){if("main"===i&&this._localVideoTrack)return this._localVideoTrack.mediaTrack;if("sub"===i&&this._localScreenTrack)return this._localScreenTrack.mediaTrack}else{let e=this._room.remotePublishedUserMap.get(t);if(e)return"main"===i?e.remoteVideoTrack.mediaTrack:e.remoteAuxiliaryTrack.mediaTrack}return null}getAudioTrack(e){if(e){let t=this._room.remotePublishedUserMap.get(e);if(t)return t.remoteAudioTrack.mediaTrack}else if(this._localAudioTrack)return this._localAudioTrack.mediaTrack;return null}setCurrentSpeaker(e){var t;null==(t=this._localAudioTrack)||t.setAudioOutput(e),this._room.remotePublishedUserMap.forEach((t=>t.remoteAudioTrack.setAudioOutput(e)))}_startRemoteAudio(e){return XA(this,null,(function*(){let{userId:t,option:i}=e;if(this._remoteAudioConfigMap.has(t))return void this._log.warn("remote audio has already started. userId:".concat(t));let r=this._room.remotePublishedUserMap.get(t);if(!r)return;let n={};i&&(Qw(i.volume)||(n.volume=i.volume));let o=r.remoteAudioTrack;yield this._room.subscribe(o),yield this._updateAudioPlayOption({playOption:n,track:o}),this._remoteAudioConfigMap.set(t,e)}))}_stopRemoteAudio(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return XA(this,null,(function*(){let i=this._room.remotePublishedUserMap.get(e.userId);i&&(i.remoteAudioTrack.stop(),i.muteState.hasAudio&&t&&(yield this._room.unsubscribe(i.remoteAudioTrack))),this._remoteAudioConfigMap.delete("".concat(e.userId))}))}_updateVideoPlayOption(e){return XA(this,arguments,(function(e){let{view:t,playOption:i,track:r,prevConfig:n}=e;return function*(){if(Qw(t)&&n&&n.view&&!uO(i)){let e;e=$w(n.view)?n.view:gO(n.view),e&&(yield r.play(e,i))}if(!Qw(t)){let e;e=$w(t)?t:gO(t),e?yield r.play(e,i):r.stop()}}()}))}_updateAudioPlayOption(e){return XA(this,arguments,(function(e){let{playOption:t={},track:i,prevConfig:r}=e;return function*(){if(!i.isPlayCalled)try{yield i.play(null,t)}catch(e){}Qw(t.muted)||i.setPlayerMute(t.muted),Qw(t.volume)||i.setAudioVolume(t.volume/100)}()}))}_checkTrackToPublish(){var e,t,i;let r=[];if((null==(e=this._localAudioConfig)?void 0:e.publish)&&this._localAudioTrack&&r.push(this._localAudioTrack),(null==(t=this._localVideoConfig)?void 0:t.publish)&&this._localVideoTrack&&r.push(this._localVideoTrack),null!=(i=this._localScreenConfig)&&i.publish&&(this._localScreenTrack&&r.push(this._localScreenTrack),this._localScreenAudioTrack&&r.push(this._localScreenAudioTrack)),0!==r.length)return this._room.publish(...r).catch((()=>{}))}_handleReceiveMode(){this._room.autoReceiveAudio&&JP(this,this).add(xL.REMOTE_AUDIO_AVAILABLE,(e=>XA(this,[e],(function(e){var t=this;let{userId:i}=e;return function*(){if(t._remoteAudioMuteMap.get("*")||t._remoteAudioMuteMap.get(i))return;let e=t._room.remotePublishedUserMap.get(i);e&&(yield t._room.subscribe(e.remoteAudioTrack).catch((()=>{})),yield t._updateAudioPlayOption({track:e.remoteAudioTrack}).catch((()=>{})),t._remoteAudioConfigMap.set(i,{userId:i}))}()})))),this._room.autoReceiveVideo&&JP(this,this).add(xL.REMOTE_VIDEO_AVAILABLE,(e=>{let{userId:t,streamType:i}=e,r=this._room.remotePublishedUserMap.get(t);r&&("main"===i?this._room.subscribe(r.remoteVideoTrack).catch((()=>{})):"sub"===i&&this._room.subscribe(r.remoteAuxiliaryTrack).catch((()=>{})))}))}_exitRoom(){return XA(this,null,(function*(){this._room.isJoined&&(yield this._room.leave()),[...this._remoteAudioConfigMap.keys()].forEach((e=>{this._stopRemoteAudio({userId:e}).catch()})),[...this._remoteVideoConfigMap.keys()].forEach((e=>{let t=e.includes("main")?"main":"sub",i=e.split("_".concat(t))[0];i&&this._stopRemoteVideo({userId:i,streamType:t}).catch()})),this._remoteVideoConfigMap.clear(),this._remoteAudioConfigMap.clear(),this._remoteAudioMuteMap.clear(),this._room.remotePublishedUserMap.forEach((e=>{KP(e.remoteAudioTrack),KP(e.remoteVideoTrack),KP(e.remoteAuxiliaryTrack)})),KP(this)}))}_stopScreenShare(){return XA(this,null,(function*(){var e,t,i;if(this._localScreenTrack){if(this._room.isJoined){let t=[this._localScreenTrack];this._localScreenAudioTrack&&t.push(this._localScreenAudioTrack),yield null==(e=this._room)?void 0:e.unpublish(...t).catch((()=>{}))}this._localScreenTrack.stop(),this._localScreenTrack.close(),null==(t=this._localScreenAudioTrack)||t.stop(),null==(i=this._localScreenAudioTrack)||i.close(),KP(this._localScreenTrack),this._localScreenTrack=null,this._localScreenAudioTrack=null,this._localScreenConfig=null}}))}sendSEIMessage(e,t){this._room.sendSEI(e,t||{seiPayloadType:243})}static setLogLevel(e,t){wO.setLogLevel(e),Qw(t)||(t?wO.enableUploadLog():wO.disableUploadLog())}static isSupported(){return PN()}static getCameraList(){return mM()}static getMicrophoneList(){return pM()}static getSpeakerList(){return _M()}static setCurrentSpeaker(e){return XA(this,null,(function*(){(yield _M()).forEach((t=>{t.deviceId===e&&(eV.forEach((i=>{i.setCurrentSpeaker(e),i.emit(xL.DEVICE_CHANGED,{type:"speaker",action:"active",device:t})})),tV=t)}))}))}},rV=iV;YA(rV,"_loggerManager",wO),YA(rV,"EVENT",xL),YA(rV,"ERROR_CODE",hL),YA(rV,"TYPE",dL),YA(rV,"frameWorkType",30),zA([HL(AL.TRTC.enterRoom),ML("room",((e,t)=>{let[i]=e,[r]=t;return(i.roomId||i.strRoomId)===(r.roomId||r.strRoomId)&&i.userId===r.userId&&i.sdkAppId===r.sdkAppId})),CM((e=>function(t){return this._log.setUserId(t.userId),this._log.setSdkAppId(t.sdkAppId),e.call(this,t).catch((e=>{throw KP(this),e}))})),JL()],rV.prototype,"enterRoom",1),zA([JL()],rV.prototype,"exitRoom",1),zA([HL(AL.TRTC.switchRole),LL("room",((e,t)=>t)),JL()],rV.prototype,"switchRole",1),zA([JL()],rV.prototype,"destroy",1),zA([HL(AL.TRTC.startLocalAudio),ML("audio",((e,t)=>{let[i]=e,[r]=t;var n,o;return(null==(n=null==i?void 0:i.option)?void 0:n.microphoneId)===(null==(o=null==r?void 0:r.option)?void 0:o.microphoneId)})),JL()],rV.prototype,"startLocalAudio",1),zA([HL(AL.TRTC.updateLocalAudio),LL("audio"),JL()],rV.prototype,"updateLocalAudio",1),zA([VL("audio"),JL()],rV.prototype,"stopLocalAudio",1),zA([HL(AL.TRTC.startLocalVideo),ML("video",((e,t)=>{let[i]=e,[r]=t;var n,o;return(null==(n=null==i?void 0:i.option)?void 0:n.cameraId)===(null==(o=null==r?void 0:r.option)?void 0:o.cameraId)})),JL()],rV.prototype,"startLocalVideo",1),zA([HL(AL.TRTC.updateLocalVideo),LL("video"),JL()],rV.prototype,"updateLocalVideo",1),zA([VL("video"),JL()],rV.prototype,"stopLocalVideo",1),zA([HL(AL.TRTC.startScreenShare),ML("screen",(()=>!0)),JL()],rV.prototype,"startScreenShare",1),zA([HL(AL.TRTC.updateScreenShare),LL("screen"),JL()],rV.prototype,"updateScreenShare",1),zA([JL()],rV.prototype,"stopScreenShare",1),zA([HL(AL.TRTC.startRemoteVideo),ML((e=>"v".concat(e.userId).concat(e.streamType)),(()=>!0)),JL({getRemoteId:e=>"".concat(e.userId,"_").concat(e.streamType)})],rV.prototype,"startRemoteVideo",1),zA([HL(AL.TRTC.updateRemoteVideo),LL((e=>"v".concat(e.userId).concat(e.streamType))),JL({getRemoteId:e=>"".concat(e.userId,"_").concat(e.streamType)})],rV.prototype,"updateRemoteVideo",1),zA([HL(AL.TRTC.stopRemoteVideo),CM((e=>function(t){return XA(this,null,(function*(){if("*"===t.userId){let e=[];return this._room.remotePublishedUserMap.forEach((t=>{this._remoteVideoConfigMap.has("".concat(t.userId,"_","main"))&&e.push(this.stopRemoteVideo({streamType:"main",userId:t.userId}).catch((()=>{}))),this._remoteVideoConfigMap.has("".concat(t.userId,"_","sub"))&&e.push(this.stopRemoteVideo({streamType:"sub",userId:t.userId}).catch((()=>{})))})),Promise.all(e)}return e.call(this,t)}))})),JL({getRemoteId:e=>"".concat(e.userId,"_").concat(e.streamType)})],rV.prototype,"stopRemoteVideo",1),zA([VL((e=>"v".concat(e.userId).concat(e.streamType)))],rV.prototype,"_stopRemoteVideo",1),zA([HL(...AL.TRTC.muteRemoteAudio),JL({getRemoteId:e=>e})],rV.prototype,"muteRemoteAudio",1),zA([jL(...AL.TRTC.setRemoteAudioVolume),CM(((e,t)=>function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];var n,o;let s=null==(n=BL.get(this))?void 0:n.get(...i);s&&s>0&&clearTimeout(s);let a=window.setTimeout((()=>{e.apply(this,i)}),200);BL.has(this)?null==(o=BL.get(this))||o.set(...i,a):BL.set(this,new Map([[...i,a]]))})),JL({getRemoteId:e=>e})],rV.prototype,"setRemoteAudioVolume",1),zA([KL("start"),ML(((e,t)=>e.getAlias()+e.getGroup(t))),JL({namePrefix:e=>e.getName()})],rV.prototype,"startPlugin",1),zA([KL("update"),LL(((e,t)=>e.getAlias()+e.getGroup(t))),JL({namePrefix:e=>e.getName()})],rV.prototype,"updatePlugin",1),zA([KL("stop"),VL(((e,t)=>e.getAlias()+e.getGroup(t))),JL({namePrefix:e=>e.getName()})],rV.prototype,"stopPlugin",1),zA([jL(...AL.TRTC.enableAudioVolumeEvaluation)],rV.prototype,"enableAudioVolumeEvaluation",1),zA([ML((e=>"a".concat(e.userId)),(()=>!0))],rV.prototype,"_startRemoteAudio",1),zA([CM((e=>function(t){return XA(this,null,(function*(){return"*"===t.userId?Promise.all([...this._room.remotePublishedUserMap.values()].map((e=>this._stopRemoteAudio(GA(WA({},t),{userId:e.userId})).catch((()=>{}))))):e.call(this,t)}))})),VL((e=>"a".concat(e.userId)))],rV.prototype,"_stopRemoteAudio",1),zA([VL("room")],rV.prototype,"_exitRoom",1),zA([VL("screen")],rV.prototype,"_stopScreenShare",1),zA([HL(AL.TRTC.sendSEIMessage),function(e){let{timesInSecond:t,maxSizeInSecond:i,getSize:r}=e;return CM(((e,n)=>{let o=new Map;return AO.on(kO.ROOM_DESTROY,(e=>{let{room:t}=e;return o.delete(t)})),function(){let s=o.get(this);for(var a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];if(s||(s={callCountInSecond:0,timestamp:0,totalSizeInSecond:0},o.set(this,s)),0===s.timestamp?s.timestamp=Date.now():Date.now()-s.timestamp>1e3&&(s.timestamp=Date.now(),s.callCountInSecond=0,s.totalSizeInSecond=0),r&&(s.totalSizeInSecond+=r(...c)),0!==s.timestamp&&Date.now()-s.timestamp<1e3&&(s.callCountInSecond>=t||s.totalSizeInSecond>i))throw new ab({code:ob.INVALID_OPERATION,message:yN({key:pN,data:{isTimes:s.callCountInSecond>=t,isSize:s.totalSizeInSecond>i,name:n,timesInSecond:t,maxSizeInSecond:i}})});s.callCountInSecond++,e.call(this,...c)}}))}({timesInSecond:30,maxSizeInSecond:8e3,getSize:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return t[0].byteLength}})],rV.prototype,"sendSEIMessage",1),zA([HL(AL.TRTC.create)],rV,"_create",1);var nV=rV;function oV(){return XA(this,null,(function*(){let e,t;try{let t=yield pM();e=t&&t.length}catch(e){}try{let e=yield mM();t=e&&e.length}catch(e){}let i={microphone:e,camera:t},{isH264EncodeSupported:r,isVp8EncodeSupported:n,isH264DecodeSupported:o,isVp8DecodeSupported:s}=this.checkSystemResult.detail,a=NO.basis(),c={webRTC:a.isWebRTCSupported,getUserMedia:a.isGetUserMediaSupported,webSocket:a.isWebSocketsSupported,screenShare:a.isScreenShareSupported,webAudio:a.isWebAudioSupported,h264Encode:r,h264Decode:o,vp8Encode:n,vp8Decode:s},l={browser:a.browser,os:a.os,trtc:c,devices:i},u={isWebCodecSupported:a.isWebCodecSupported,isMediaSessionSupported:a.isMediaSessionSupported,isWebTransportSupported:a.isWebTransportSupported};EP.uploadEvent({log:"trtcstats-".concat(JSON.stringify(l)),userId:this.userId}),this._log.info("TrtcStats-".concat(JSON.stringify(l))),EP.uploadEvent({log:"trtcadvancedstats-".concat(JSON.stringify(u)),userId:this.userId})}))}var sV=QA($A()),aV="3",cV="DISCONNECTED",lV="CONNECTING",uV="CONNECTED",dV={CLIENT_BANNED:9,CHANNEL_SETUP_RESULT:19,CHANNEL_RECONNECT_RESULT:514,JOIN_ROOM_RESULT:20,PEER_JOIN:4134,PEER_LEAVE:4135,STREAM_ADDED:16,STREAM_REMOVED:18,UPLINK_NETWORK_STATS:22,UPDATE_REMOTE_MUTE_STAT:23,PUBLISH_RESULT:4098,PUBLISH_STATE_CHANGE_RESULT:4112,UNPUBLISH_RESULT:4100,SUBSCRIBE_RESULT:4102,UNSUBSCRIBE_RESULT:4104,SUBSCRIBE_CHANGE_RESULT:4106,MUTE_RESULT:4108,UPDATE_OFFER_RESULT:4128,START_PUBLISH_TENCENT_CDN_RES:1286,STOP_PUBLISH_TENCENT_CDN_RES:1288,START_PUBLISH_GIVEN_CDN_RES:777,STOP_PUBLISH_GIVEN_CDN_RES:779,START_MIX_TRANSCODE_RES:781,STOP_MIX_TRANSCODE_RES:783,USER_LIST_RES:4137,SWITCH_ROLE_RES:4110,UPDATE_CONSTRAINT_CONFIG_RES:772,REBUILD_PEER_CONNECTION_RES:4150,SPC_PUBLISH_RESULT:4146,SPC_SUBSCRIBE_RESULT:4156,ABILITY_STATUS_REPORT_RESULT:4158},hV=[dV.UPDATE_REMOTE_MUTE_STAT,dV.UPLINK_NETWORK_STATS,dV.USER_LIST_RES,dV.MUTE_RESULT],pV={CLIENT_BANNED:"client-banned",CHANNEL_SETUP_RESULT:"channel-setup-result",CHANNEL_RECONNECT_RESULT:"channel-reconnect-result",JOIN_ROOM_RESULT:"join-room-result",PEER_JOIN:"peer-join",PEER_LEAVE:"peer-leave",STREAM_ADDED:"stream-added",STREAM_REMOVED:"stream-removed",UPLINK_NETWORK_STATS:"uplink-network-stats",UPDATE_REMOTE_MUTE_STAT:"update-remote-mute-stat",PUBLISH_RESULT:"publish-result",PUBLISH_STATE_CHANGE_RESULT:"publish-state-change-result",UNPUBLISH_RESULT:"unpublish-result",SUBSCRIBE_RESULT:"subscribe-result",SUBSCRIBE_CHANGE_RESULT:"subscribe-change-result",UNSUBSCRIBE_RESULT:"unsubscribe-result",UPDATE_OFFER_RESULT:"update-offer-result",START_PUBLISH_TENCENT_CDN_RES:"start-publish-tencent-cdn-res",STOP_PUBLISH_TENCENT_CDN_RES:"stop-publish-tencent-cdn-res",START_PUBLISH_GIVEN_CDN_RES:"start-publish-given-cdn-res",STOP_PUBLISH_GIVEN_CDN_RES:"stop-publish-given-cdn-res",START_MIX_TRANSCODE_RES:"start-mix-transcode-res",STOP_MIX_TRANSCODE_RES:"stop-mix-transcode-res",USER_LIST_RES:"user-list-res",SWITCH_ROLE_RES:"switch_role_res",MUTE_RESULT:"mute-result",UPDATE_CONSTRAINT_CONFIG_RES:"update-contraint-config-res",REBUILD_PEER_CONNECTION_RES:"rebuild-pc-res",SPC_PUBLISH_RESULT:"spc-publish-result",SPC_SUBSCRIBE_RESULT:"spc-subscribe-result",ABILITY_STATUS_REPORT_RESULT:"ability-status-report"},mV="mute_uplink",_V="publish_state_change",fV="unpublish",gV="unsubscribe",TV="subscribe_change",vV="update_constraint_config",SV="subscribe/v3",yV=new Set,EV=class extends sV.default{constructor(e){var t,i;super(),YA(this,"room"),YA(this,"url"),YA(this,"backupUrl"),YA(this,"_socketInUse"),YA(this,"_socket"),YA(this,"_backupSocket"),YA(this,"_backupTimer",-1),YA(this,"_signalInfo",{tinyId:void 0,clientIp:"",signalIp:"",relayIp:"",relayInnerIp:"",relayPort:0}),YA(this,"_currentState",cV),YA(this,"_reconnectionCount",0),YA(this,"_reconnectionTimer",-1),YA(this,"_seq",0),YA(this,"_log"),YA(this,"_lastMessageTime",-1),YA(this,"_prevTime",-1),YA(this,"bytesSent",0),YA(this,"bytesReceived",0),YA(this,"keepAlive",!1),this.room=e.room,((null==(i=null==(t=this.room.scheduleResult)?void 0:t.config)?void 0:i.keepAliveClient)||0)-yV.size>0&&this.room.enableSPC&&(this.keepAlive=!0,yV.add(this)),this.url=e.url,this.backupUrl=e.backupUrl,this._seq=0,this._log=wO.createLogger({id:"ws",userId:this.userId,sdkAppId:this.sdkAppId})}get urlParam(){return"?sdkAppId=".concat(encodeURIComponent(this.sdkAppId),"&userId=").concat(encodeURIComponent(this.userId),"&userSig=").concat(encodeURIComponent(this.userSig),"&keepAlive=").concat(encodeURIComponent(Number(this.keepAlive)))}get _urlWithParam(){return"".concat(this.url).concat(this.urlParam)}get _backupUrlWithParam(){return"".concat(this.backupUrl).concat(this.urlParam)}get isConnected(){return this._currentState===uV}get isConnecting(){return this._currentState===lV}get sdkAppId(){return this.room.sdkAppId}get userId(){return this.room.userId}get userSig(){return this.room.userSig}get isOnline(){return this._currentState===uV&&Date.now()-this._lastMessageTime<12e3}connect(e){return this.isConnected?Promise.resolve():new Promise(((t,i)=>{this._prevTime<0&&(this._prevTime=sO()),this._log.info("connect to ".concat(this.url).concat(e?" timeout: ".concat(e):""," keepAlive: ").concat(Number(this.keepAlive))),this.emitConnectionStateChanged(lV),this._socket=new WebSocket(this._urlWithParam),this.bindSocket(this._socket),this._backupTimer=setTimeout((()=>{this.isConnected||(this._log.info("trying to connect to backupUrl"),this.tryConnectBackup())}),5e3);let r=-1;e&&(r=setTimeout((()=>{this.close(),i(new ab({code:ob.JOIN_ROOM_FAILED,message:"join room timeout"}))}),e)),this.once(aV,(()=>{clearTimeout(r),t()})),this.once("4",(e=>{clearTimeout(r),i(e)}))}))}tryConnectBackup(){this._backupSocket||(this.unbindAndCloseSocket(RD.MAIN),this._log.debug("try to connect to url: ".concat(this._backupUrlWithParam)),this._backupSocket=new WebSocket(this._backupUrlWithParam),this.bindSocket(this._backupSocket))}bindSocket(e){e.onopen=this.onopen.bind(this),e.onclose=this.onclose.bind(this),e.onerror=this.onerror.bind(this),e.onmessage=this.onmessage.bind(this)}unbindSocket(e){this.clearBackupTimer(),e.onopen=()=>{},e.onclose=()=>{},e.onerror=()=>{},e.onmessage=()=>{}}unbindAndCloseSocket(e){if(e===RD.MAIN){if(this._socket){this.unbindSocket(this._socket);try{this._socket.close(1e3)}catch(e){}this._socket=null}}else if(this._backupSocket){this.unbindSocket(this._backupSocket);try{this._backupSocket.close(1e3)}catch(e){}this._backupSocket=null}}clearBackupTimer(){-1!==this._backupTimer&&(clearTimeout(this._backupTimer),this._backupTimer=-1)}clearReconnectionTimer(){-1!==this._reconnectionTimer&&(clearTimeout(this._reconnectionTimer),this._reconnectionTimer=-1)}onopen(e){this.isConnected||(this.isReconnecting&&!this._signalInfo.tinyId&&this.stopReconnection(),this.clearBackupTimer(),e.target===this._socket?(this.unbindAndCloseSocket(RD.BACKUP),this._socketInUse=this._socket):(this.unbindAndCloseSocket(RD.MAIN),this._socketInUse=this._backupSocket),this.emitConnectionStateChanged(uV),this.emit(aV))}onclose(e){let{url:t}=e.target,i=e.target===this._socketInUse;if(this._log.info("websocket[".concat(t," InUse: ").concat(i,"] is closed with code: ").concat(e.code)),i&&(this.emitConnectionStateChanged(cV),!e.wasClean||1e3!==e.code)){this._log.warn("onclose code:".concat(e.code," reason:").concat(e.reason)),this._log.warn("close current websocket and schedule a reconnect timeout"),this._socketInUse.onclose=()=>{},this._socketInUse.close(4011);let t=this._socketInUse===this._socket;this._socket=null,this._backupSocket=null,this._socketInUse=null,this.reconnect(t?RD.BACKUP:RD.MAIN)}}onerror(e){let{url:t}=e.target;if(this._log.error("websocket[".concat(t,"] error observed")),this.isConnected){if(e.target===this._socketInUse){this.unbindAndCloseSocket(RD.MAIN),this.unbindAndCloseSocket(RD.BACKUP);let e=this._socketInUse===this._socket;this._socketInUse=null,this.reconnect(e?RD.BACKUP:RD.MAIN)}}else this.isReconnecting||AO.emit(kO.API_SUCCESS_RATE,{room:this.room,apiName:"WebsocketConnect",error:new Error("ws onerror")}),e.target==this._socket?(this.unbindAndCloseSocket(RD.MAIN),this.reconnect(RD.BACKUP)):(this.unbindAndCloseSocket(RD.BACKUP),this.reconnect(RD.MAIN))}onmessage(e){if(!this.isConnected)return;this._lastMessageTime=Date.now(),this.bytesReceived+=EO(e.data);let t=JSON.parse(e.data),{cmd:i,data:r}=t,n=Object.values(dV),o=Object.keys(dV)[n.indexOf(i)],s=pV[o];switch(hV.includes(i)||(this._log.debug("received ".concat(i," msg: ").concat(e.data)),s&&this._log.info("Received event: [ ".concat(s," ]"))),i){case dV.CHANNEL_SETUP_RESULT:if(0===t.code)this._signalInfo.clientIp=r.clientIp,this._signalInfo.signalIp=r.signalInnerIp,this._signalInfo.tinyId=t.tinyId,r.svrTime&&function(e){cb=e-(new Date).getTime();let t=new Date;t.setTime(e),wO.info("baseTime from server: ".concat(t," offset: ").concat(cb))}(r.svrTime),this._log.info("ChannelSetup Success"),AO.emit(kO.API_SUCCESS_RATE,{room:this.room,apiName:"WebsocketConnect",cost:sO()-this._prevTime}),this._prevTime=-1,this.emit("1",{signalInfo:this._signalInfo});else{let e=new ab({code:ob.SIGNAL_CHANNEL_SETUP_FAILED,extraCode:t.code,message:yN({key:LO,data:{errorCode:t.code,errorMsg:t.message}})});this._log.error("".concat(t.code,", ").concat(t.message)),this.close(),AO.emit(kO.API_SUCCESS_RATE,{room:this.room,apiName:"WebsocketConnect",error:e}),this.emit("5",e)}break;case dV.JOIN_ROOM_RESULT:0===t.code&&(this._signalInfo.relayIp=r.relayOuterIp,this._signalInfo.relayInnerIp=r.relayInnerIp,this._signalInfo.relayPort=r.relayPort,this._log.info("signalIp:".concat(this._signalInfo.signalIp," clientIp:").concat(this._signalInfo.clientIp," relayIp: ").concat(this._signalInfo.relayIp))),this.emit(s,{data:t});break;case dV.CHANNEL_RECONNECT_RESULT:0===t.code?(this._log.warn("reconnect success"),this.stopReconnection(),AO.emit(kO.API_SUCCESS_RATE,{room:this.room,apiName:"WebsocketReconnect",cost:sO()-this._prevTime}),this._prevTime=-1,this.room.syncUserList(),this.room.checkConnectionsToReconnect()):(this._log.warn("reconnect failed, ".concat(t.code," ").concat(t.message)),this.room.reJoin());break;default:this.emit(s,{data:t})}}reconnect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:RD.MAIN;if(!this.room.isJoined&&this.keepAlive)return void this.close();if(this.isReconnecting)return;if(this._reconnectionCount>=XD){this._log.warn("SDK has tried reconnect signal channel for ".concat(XD," times, but all failed. please check your network"));let e=new ab({code:ob.SIGNAL_CHANNEL_RECONNECTION_FAILED,message:yN({key:MO})});return AO.emit(kO.API_SUCCESS_RATE,{room:this.room,apiName:"WebsocketReconnect",error:e}),void this.emit("4",e)}this._reconnectionCount++,this._log.warn("reconnect ".concat(e," [").concat(this._reconnectionCount,"/").concat(XD,"]"));let t=this.getReconnectionUrl(e);this.emitConnectionStateChanged(lV),this._prevTime<0&&(this._prevTime=sO()),e===RD.MAIN?(this._socket=new WebSocket(t),this.bindSocket(this._socket)):(this._backupSocket=new WebSocket(t),this.bindSocket(this._backupSocket));let i=Gw(this._reconnectionCount);this._reconnectionTimer=setTimeout((()=>{this._log.warn("reconnect ".concat(e," timeout(").concat(i/1e3,"s), try again")),this.clearReconnectionTimer(),this.unbindAndCloseSocket(RD.MAIN),this.unbindAndCloseSocket(RD.BACKUP),this.reconnect(e===RD.MAIN?RD.BACKUP:RD.MAIN)}),i)}get isReconnecting(){return-1!==this._reconnectionTimer}getReconnectionUrl(e){let t=e===RD.MAIN?this._urlWithParam:this._backupUrlWithParam;if(this._signalInfo.tinyId&&-1===t.indexOf("&rc=1")){let{roomId:e,useStringRoomId:i}=this.room;t+="&rc=1&relayInnerIp=".concat(this._signalInfo.relayInnerIp,"&relayOuterIp=").concat(this._signalInfo.relayIp,"&relayPort=").concat(this._signalInfo.relayPort,"&roomId=").concat(e,"&useStringRoomId=").concat(i)}return t}send(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.isConnected&&!this.room.isLeft){let i={cmd:e,data:t,userId:this.userId,tinyId:this._signalInfo.tinyId,seq:++this._seq},r=JSON.stringify(i);return this._socketInUse.send(r),this.bytesSent+=EO(r),i.seq}}sendWaitForResponse(e){let{command:t,data:i,timeout:r=5e3,responseCommand:n,commandDesc:o,enableLog:s=!0}=e;return new Promise(((e,a)=>{let c=setTimeout((()=>{this.off(n,l);let e=new ab({code:ob.API_CALL_TIMEOUT,message:yN({key:PO,data:{commandDesc:o,command:t}})});s&&this._log.warn(e),a(e)}),r),l=t=>{t.data.seq===u&&(clearTimeout(c),this.off(n,l),e(t))};this.on(n,l);let u=this.send(t,i)}))}sendWaitForResponseWithRetry(e){let{commandDesc:t,command:i,retries:r=0,retryTimeout:n=0}=e;return CO({retryFunction:this.sendWaitForResponse,onRetrying:e=>{this._log.warn("".concat(t||i," timeout observed, retrying [").concat(e,"/").concat(r,"]"))},settings:{retries:r,timeout:n},context:this})(e)}getCurrentState(){return this._currentState}getSignalInfo(){return this._signalInfo}stopReconnection(){this.isReconnecting&&(this._reconnectionCount=0,this.clearReconnectionTimer())}close(){this._log.info("closed"),yV.delete(this),this.clearBackupTimer(),this.stopReconnection(),this._signalInfo={tinyId:void 0,clientIp:"",signalIp:"",relayIp:"",relayInnerIp:"",relayPort:0},this._socketInUse=null,this.bytesSent=0,this.bytesReceived=0,this.unbindAndCloseSocket(RD.MAIN),this.unbindAndCloseSocket(RD.BACKUP),this.emitConnectionStateChanged(cV)}stopKeepAliveIn(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3600;if(this.keepAlive){this._log.info("stopKeepAlive in ".concat(e,"s"));let t=setTimeout((()=>{this.keepAlive=!1,this._log.info("close due to not used ".concat(e,"s")),this.close()}),1e3*e),i=e=>{e instanceof lP&&"join"===e.action&&(this._log.info("stopKeepAlive clear timeout"),clearTimeout(t),this.room.off(_P.STATECHANGED,i))};this.room.on(_P.STATECHANGED,i)}}emitConnectionStateChanged(e){e!==this._currentState&&(this._log.info("".concat(this._currentState," -> ").concat(e)),this.emit("2",{prevState:this._currentState,state:e}),this._currentState=e)}},IV=QA($A()),RV=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.dataView=e,this.isSEI&&(t?this.addPreventionByte():this.removePreventionByte())}addPreventionByte(){let e=this.seiPayloadStartIndex,t=this.dataView.byteLength-2,i=[],r=0;for(let n=e;n<=t;n++){let e=this.dataView.getInt8(n);switch(e){case 0:case 1:case 2:case 3:2===r&&(i.push(3),r=0),0==e?r++:r=0,i.push(e);break;default:r=0,i.push(e)}}i.push(this.dataView.getInt8(this.dataView.byteLength-1));let n=new DataView(new Uint8Array([...new Uint8Array(this.dataView.buffer).slice(0,e),...i]).buffer);this.dataView=n}removePreventionByte(){let e=this.seiPayloadStartIndex,t=this.dataView.byteLength-1,i=[],r=0;for(let n=e;n<=t;n++)switch(this.dataView.getInt8(n)){case 0:r++,i.push(this.dataView.getInt8(n));break;case 3:2!==r&&i.push(this.dataView.getInt8(n)),r=0;break;default:i.push(this.dataView.getInt8(n)),r=0}let n=new DataView(new Uint8Array([...new Uint8Array(this.dataView.buffer).slice(0,e),...i]).buffer);this.dataView=n}get isSEI(){return 6===this.dataView.getUint8(4)}get seiPayloadStartIndex(){let e=6;for(let t=6;t<this.dataView.buffer.byteLength&&(e++,255===this.dataView.getUint8(t));t++);return e}get seiPayloadType(){return this.isSEI?this.dataView.getUint8(5):null}get seiPayload(){if(!this.isSEI)return null;let e=0,t=6;for(let i=6;i<this.dataView.buffer.byteLength;i++){let r=this.dataView.getUint8(i);if(t++,255!==r){e+=r;break}e+=255}let i=new ArrayBuffer(e),r=new DataView(i);for(let e=0;e<i.byteLength;e++,t++)r.setInt8(e,this.dataView.getInt8(t));return r}},CV=class{constructor(e,t,i){this._connection=e,this._log=t,this._isUplink=i,YA(this,"_seiMessageList",[]),YA(this,"_seiPayloadType",243),YA(this,"_mainVideoSenderOrReceiver",null),YA(this,"_mainVideoAbortController",null),YA(this,"_abortMap",new Map),YA(this,"onSEIMessage")}get isRunning(){return!!this._mainVideoAbortController}start(e){this._mainVideoSenderOrReceiver=e;let t=e.createEncodedStreams(),i=t.readable,r=t.writable,n=new TransformStream({transform:this._isUplink?this.encodeVideoFrame.bind(this):this.decodeVideoFrame.bind(this)});this._mainVideoAbortController=new AbortController,i.pipeThrough(n).pipeTo(r,this._mainVideoAbortController).catch((()=>{}))}restart(e){this.stop(),this.start(e)}stop(){var e;null==(e=this._mainVideoAbortController)||e.abort(),this._mainVideoAbortController=null}destroy(){this.stop(),this._abortMap.forEach((e=>e.abort())),this._abortMap.clear(),this._log=null,this.onSEIMessage=null,this._mainVideoSenderOrReceiver=null,this._connection=null}handleEncodedStreams(){try{let e=this._connection.getPeerConnection();this.clearUnusedSenderOrReceiver(e),this._isUplink?e.getSenders().forEach(((e,t)=>{if(1===t){if(e===this._mainVideoSenderOrReceiver)return;this.isRunning?this.restart(e):this.start(e)}else{if(this._abortMap.has(e))return;this.pipeSenderOrReceiver(e)}})):e.getReceivers().forEach(((e,t)=>{var i;this._abortMap.has(e)||e===this._mainVideoSenderOrReceiver||(1===t&&(null==(i=e.track)?void 0:i.kind)===RD.VIDEO?this.isRunning?this.restart(e):this.start(e):this.pipeSenderOrReceiver(e))}))}catch(e){this._log.warn(e)}}pipeSenderOrReceiver(e){let{readable:t,writable:i}=e.createEncodedStreams(),r=new AbortController;this._abortMap.set(e,r),t.pipeTo(i,r).catch((()=>{}))}clearUnusedSenderOrReceiver(e){this._abortMap.forEach(((t,i)=>{(this._isUplink?e.getSenders():e.getReceivers()).find((e=>e===i))||(t.abort(),this._abortMap.delete(i))}))}push(e,t){t&&t.seiPayloadType&&(this._seiPayloadType=t.seiPayloadType),this._seiMessageList.push(e)}hasSEI(e){let t=new DataView(e);return 1===t.getInt32(0)&&6===t.getInt8(4)}isEmptyFrame(e){return"empty"===e.type||0===e.data.byteLength}getNaluCount(e){let t=0,i=0,r=new DataView(e);for(let n=0;n<e.byteLength;n++)switch(r.getUint8(n)){case 0:t++;break;case 1:(2===t||3===t)&&i++,t=0;break;default:t=0}return i}encodeVideoFrame(e,t){try{if(this._connection.isH264&&this._seiMessageList.length>0&&!this.isEmptyFrame(e)){let t=9-this.getNaluCount(e.data);if(t<=0)return;let i=this._seiMessageList.splice(0,t).reverse().map(this.encodeSEINalu.bind(this)),r=i.reduce(((e,t)=>e+t.dataView.byteLength),0),n=new ArrayBuffer(r+e.data.byteLength),o=new DataView(n),s=new DataView(e.data),a=0;for(let e=0;e<i.length;e++)for(let t=0;t<i[e].dataView.byteLength;t++)o.setInt8(a++,i[e].dataView.getInt8(t));for(let t=0;t<e.data.byteLength;t++)o.setInt8(a++,s.getInt8(t));e.data=n,this._log.debug("".concat(i.length," sei sent"))}}catch(e){this._log.warn(e)}t.enqueue(e)}decodeVideoFrame(e,t){try{if(this._connection.isH264&&!this.isEmptyFrame(e)&&this.hasSEI(e.data)){let t=[],i=new DataView(e.data),r=0,n=-1,o=-1;for(let s=0;s<e.data.byteLength;s++){let a=i.getUint8(s);if(0===a)r++;else if(1===a){if(2===r||3===r){let a=s-r;if(-1===n?n=a:-1===o&&(o=a,t.push(new RV(new DataView(i.buffer.slice(n,o)))),n=a,o=-1),6!==i.getUint8(s+1)){e.data=new DataView(i.buffer.slice(a)).buffer;break}}r=0}else r=0}this._log.debug("".concat(t.length," sei received")),Kw(this.onSEIMessage)&&t.reverse().forEach((e=>{this.onSEIMessage({seiPayloadType:e.seiPayloadType,data:e.seiPayload.buffer})}))}}catch(e){this._log.warn(e)}t.enqueue(e)}encodeSEINalu(e){let t=e.byteLength,i=parseInt(t/255),r=t%255,n=[];n.push(0,0,0,1,6,this._seiPayloadType);for(let e=0;e<i;e++)n.push(255);n.push(r);let o=new DataView(e);return n.push(...new Uint8Array(o.buffer)),n.push(128),new RV(new DataView(new Uint8Array(n).buffer),!0)}},AV=0,bV=!1,kV=new Set,DV=!1,wV=class{constructor(e){YA(this,"userId"),YA(this,"tinyId"),YA(this,"_sdpSemantics"),YA(this,"_isUplink"),YA(this,"_room"),YA(this,"_log"),YA(this,"_signalChannel"),YA(this,"_isErrorObserved",!1),YA(this,"_waitForPeerConnectionConnectedPromise"),YA(this,"_waitForPeerConnectionConnectedPromiseReject",null),YA(this,"_peerConnection",null),YA(this,"_emitter",new IV.default),YA(this,"_currentState","DISCONNECTED"),YA(this,"_isReconnecting",!1),YA(this,"_reconnectionCount",0),YA(this,"_reconnectionTimer",-1),YA(this,"_isFirstConnection",!0),YA(this,"_prevTime",-1),YA(this,"_enableSEI"),YA(this,"_sei"),YA(this,"_localAddress"),YA(this,"_remoteAddress"),this.userId=e.userId,this.tinyId=e.tinyId,this._room=e.room,this._sdpSemantics=e.room.sdpSemantics,this._isUplink=e.isUplink,this._log=wO.createLogger({id:"n",userId:this._room.userId,remoteUserId:this.userId,sdkAppId:this._room.sdkAppId,isLocal:this._isUplink}),this._signalChannel=e.signalChannel,this._enableSEI=e.enableSEI,this._enableSEI&&eP&&(this._sei=new CV(this,this._log,this._isUplink))}beforeConnect(){this._prevTime<0&&(this._prevTime=sO())}afterConnect(e){return XA(this,null,(function*(){try{yield e,this._isFirstConnection?(this._isFirstConnection=!1,AO.emit(kO.API_SUCCESS_RATE,{room:this._room,apiName:"PeerConnectionConnect",cost:Math.min(sO()-this._prevTime,3e4)})):this._isReconnecting&&AO.emit(kO.API_SUCCESS_RATE,{room:this._room,apiName:"PeerConnectionReconnect",cost:sO()-this._prevTime}),this._prevTime=-1}catch(e){throw this._isFirstConnection?(this._isFirstConnection=!1,AO.emit(kO.API_SUCCESS_RATE,{room:this._room,apiName:"PeerConnectionConnect",error:e})):this._isReconnecting&&this._reconnectionCount>=3&&AO.emit(kO.API_SUCCESS_RATE,{room:this._room,apiName:"PeerConnectionReconnect",error:e}),e}}))}initialize(){let e={encodedInsertableStreams:this._enableSEI&&eP,iceServers:this._room.getIceServers(),iceTransportPolicy:this._room.getIceTransportPolicy(),sdpSemantics:this._sdpSemantics,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",tcpCandidatePolicy:"disable",IceTransportsType:"nohost"};this._peerConnection=new RTCPeerConnection(e),this._peerConnection.onconnectionstatechange=this.onConnectionStateChange.bind(this)}close(e){this._log.info("close connection"),this._emitter.emit("closed",e),this._isReconnecting&&this.stopReconnection(),this.closePeerConnection(),this._sei&&(this._sei.destroy(),this._sei=null),kV.delete(this)}closePeerConnection(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._peerConnection&&(this._log.info("close pc"),this._peerConnection.onconnectionstatechange=null,this._peerConnection.close(),this._peerConnection=null,e&&this.emitConnectionStateChangedEvent("DISCONNECTED")),this._waitForPeerConnectionConnectedPromiseReject&&this._waitForPeerConnectionConnectedPromiseReject(new ab({code:ob.API_CALL_ABORTED,message:"connection closed"}))}getDTLSTransportState(){if(!this._peerConnection)return JD;let e=null;if(this._isUplink){if(!JN()||0===this._peerConnection.getSenders().length)return JD;e=this._peerConnection.getSenders()[0].transport}else{if(!GN()||0===this._peerConnection.getReceivers().length)return JD;e=this._peerConnection.getReceivers()[0].transport}return e?e.state:JD}onConnectionStateChange(e){let t=this._peerConnection.iceConnectionState,i=this.getDTLSTransportState();if(this._log.info("connectionState: ".concat(e.target.connectionState,", ICE: ").concat(t,", DTLS: ").concat(i)),e.target.connectionState===KD.CONNECTING&&this.emitConnectionStateChangedEvent("CONNECTING"),e.target.connectionState===KD.FAILED||e.target.connectionState===KD.CLOSED){let r="connection ".concat(e.target.connectionState,". ICE Transport state: ").concat(t,", DTLS Transport state: ").concat(i),n=new ab({message:r,code:ob.ICE_TRANSPORT_ERROR});this.emitConnectionStateChangedEvent("DISCONNECTED"),this.startReconnection(),this._isErrorObserved||this._emitter.emit("error",n)}(e.target.connectionState===KD.CONNECTED||e.target.connectionState===KD.COMPLETED)&&(this.logSelectedCandidate(),EP.logSuccessEvent({userId:this._room.userId,eventType:$D.ICE_CONNECTION_STATE}),this.emitConnectionStateChangedEvent("CONNECTED"))}emitConnectionStateChangedEvent(e){return e!==this._currentState&&("CONNECTED"===e?(AV=0,bV=!1,DV=!0,kV.add(this)):kV.delete(this),AO.emit(kO.PEER_CONNECTION_STATE_CHANGED,{room:this._room,prevState:this._currentState,state:e,remoteUserId:this._isUplink?void 0:this.userId}),this._emitter.emit("connection-state-changed",{prevState:this._currentState,state:e}),this._currentState=e,!0)}getPeerConnection(){return this._peerConnection}getRoom(){return this._room}getUserId(){return this.userId}getTinyId(){return this.tinyId}logSelectedCandidate(){return XA(this,null,(function*(){if(!this._peerConnection)return;let e=yield this._peerConnection.getStats();for(let[,t]of e)if(xN(t)){let i=e.get(t.localCandidateId),r=e.get(t.remoteCandidateId);i&&(this._log.info("local candidate: ".concat(i.candidateType," ").concat(i.protocol,":").concat(i.ip||i.address,":").concat(i.port," ").concat(i.networkType||""," ").concat("relay"===i.candidateType?"relayProtocol:".concat(i.relayProtocol):"")),this._localAddress="".concat(i.ip||i.address,":").concat(i.port)),r&&(this._log.info("remote candidate: ".concat(r.candidateType," ").concat(r.protocol,":").concat(r.ip||r.address,":").concat(r.port)),this._remoteAddress="".concat(r.protocol,":").concat(r.ip||r.address));break}}))}getCurrentState(){return this._currentState}waitForPeerConnectionConnected(){return this._waitForPeerConnectionConnectedPromise||(this._waitForPeerConnectionConnectedPromise=new Promise(((e,t)=>{if("CONNECTED"===this._currentState)return e();this._waitForPeerConnectionConnectedPromiseReject=t;let i=t=>{"CONNECTED"===t.state&&(clearTimeout(o),n(),e())},r=e=>{let{room:i}=e;i===this._room&&(clearTimeout(o),n(),t(new ab({code:ob.API_CALL_ABORTED,message:yN({key:mN,data:"leave room"})})))},n=()=>{AO.off(kO.LEAVE_SUCCESS,r,this),this._emitter.off("connection-state-changed",i,this)},o=setTimeout((()=>{n();let e=new ab({code:ob.API_CALL_TIMEOUT,message:"connection timeout"});AV+=1,(e=>AV>2&&!bV&&0===kV.size&&e)(this._signalChannel.isConnected)&&(this._log.warn("firewall restrition"),bV=!0,this._emitter.emit("firewall-restriction")),t(e)}),uw);AO.on(kO.LEAVE_SUCCESS,r,this),this._emitter.on("connection-state-changed",i,this)})),this._waitForPeerConnectionConnectedPromise=this._waitForPeerConnectionConnectedPromise.finally((()=>{this._waitForPeerConnectionConnectedPromise=null,this._waitForPeerConnectionConnectedPromiseReject=null}))),this._waitForPeerConnectionConnectedPromise}getReconnectionCount(){return this._reconnectionCount}startReconnection(){this._isReconnecting=!0,this.reconnect()}clearReconnectionTimer(){-1!==this._reconnectionTimer&&(clearTimeout(this._reconnectionTimer),this._reconnectionTimer=-1)}stopReconnection(){this._log.info("stop reconnection"),this._isReconnecting=!1,this._reconnectionCount=0,this.clearReconnectionTimer(),this._signalChannel.off(aV,this.reconnect,this)}beforeReconnect(){if(-1!==this._reconnectionTimer)return this._log.warn("reconnect() is reconnecting, ignore"),-1;if(this._reconnectionCount>=YD()){this._log.warn("SDK has tried reconnect for ".concat(this._reconnectionCount," times, but all failed, please check your network")),this.stopReconnection();let e=new ab({code:this._isUplink?ob.UPLINK_RECONNECTION_FAILED:ob.DOWNLINK_RECONNECTION_FAILED,message:yN({key:this._isUplink?FO:xO})});return this.emitConnectionStateChangedEvent("DISCONNECTED"),this._emitter.emit("error",e),-1}return this._signalChannel.isConnected?(this._reconnectionCount+=1,this._log.warn("reconnect() trying [".concat(this._reconnectionCount,"]")),1):(this._log.warn("reconnect() signal channel is not connected, suspend reconnection until signal is connected"),this._signalChannel.once(aV,this.reconnect,this),-1)}on(e,t,i){this._emitter.on(e,t,i)}off(e,t,i){this._emitter.off(e,t,i)}getIsReconnecting(){return this._isReconnecting}get isH264(){var e,t;return!(null==(t=null==(e=this._peerConnection)?void 0:e.remoteDescription)||!t.sdp.includes("H264"))}},OV=QA(ib()),NV=function(e){return OV.default.parse(e)},PV=function(e){return OV.default.write(e)};function MV(e){return Object.keys(e).filter((t=>e[t]))}var LV=class extends wV{constructor(e){super(GA(WA({},e),{isUplink:!1})),YA(this,"_flag",0),YA(this,"role","anchor"),YA(this,"remoteAudioTrack"),YA(this,"remoteVideoTrack"),YA(this,"remoteAuxiliaryTrack"),YA(this,"ssrc",{audio:0,video:0,auxiliary:0}),YA(this,"_isSDPExchanging",!1),this.flag=e.flag,this.remoteAudioTrack=e.remoteAudioTrack||new WM(this._room,this),this.remoteVideoTrack=e.remoteVideoTrack||new GM(this._room,this),this.remoteAuxiliaryTrack=e.remoteAuxiliaryTrack||new JM(this._room,this)}get subscribeState(){let e={audio:!1,video:!1,auxiliary:!1,smallVideo:!1};return this.remoteVideoTrack.isSubscribed&&(8&this.remoteVideoTrack.mediaType?e.smallVideo=!0:e.video=!0),this.remoteAudioTrack.isSubscribed&&(e.audio=!0),this.remoteAuxiliaryTrack.isSubscribed&&(e.auxiliary=!0),e}get muteState(){return dO(this.flag,this.userId)}get flag(){return this._flag}set flag(e){var t,i,r;e!==this._flag&&(this._flag=e,null==(t=this.remoteAudioTrack)||t.onFlagChanged(),null==(i=this.remoteVideoTrack)||i.onFlagChanged(),null==(r=this.remoteAuxiliaryTrack)||r.onFlagChanged())}get hasMainStream(){return this.muteState.hasAudio||this.muteState.hasVideo||this.muteState.hasSmall}get hasAuxStream(){return this.muteState.hasAuxiliary}get isMainStreamSubscribed(){return(this.subscribeState.audio||this.subscribeState.video||this.subscribeState.smallVideo)&&(this.muteState.hasAudio||this.muteState.hasVideo||this.muteState.hasSmall)}get isAuxStreamSubscribed(){return this.subscribeState.auxiliary&&this.muteState.hasAuxiliary}get isSmallStreamSubscribed(){return this.subscribeState.smallVideo&&this.muteState.hasSmall}get isBigStreamSubscribed(){return this.subscribeState.video&&this.muteState.hasVideo}isStreamUnpublished(e){return e===RD.MAIN?!this.muteState.hasAudio&&!this.muteState.hasVideo:!this.muteState.hasAuxiliary}initialize(){super.initialize(),this.installEvents(),this._peerConnection.ontrack=this.onTrack.bind(this)}close(e){super.close(e),this.emitConnectionStateChangedEvent("DISCONNECTED"),this.remoteAudioTrack.close(),this.remoteVideoTrack.close(),this.remoteAuxiliaryTrack.close(),this.uninstallEvents()}installEvents(){}uninstallEvents(){this._emitter.removeAllListeners()}emitConnectionStateChangedEvent(e){var t,i;let r=this._currentState,n=super.emitConnectionStateChangedEvent(e);return n&&r!==e&&(null==(t=this.remoteVideoTrack)||t.emit("connection-state-changed",{prevState:r,state:e}),null==(i=this.remoteAuxiliaryTrack)||i.emit("connection-state-changed",{prevState:r,state:e})),n}onTrack(e){let t=e.streams[0],{track:i}=e,r=t.id===MD?RD.MAIN:RD.AUXILIARY;this._log.debug("ontrack ".concat(r," ").concat(i.kind));let n=RD.AUDIO;i.kind===RD.VIDEO&&(n=r===RD.MAIN?RD.VIDEO:RD.AUXILIARY);let o=this.remoteAudioTrack;n===RD.VIDEO?o=this.remoteVideoTrack:n===RD.AUXILIARY&&(o=this.remoteAuxiliaryTrack),o.setInputMediaStreamTrack(i)}addRRTRLine(e){let t=e.split("\r\n"),i=new Map;t.forEach(((e,r)=>{/^a=rtcp-fb:/.test(e)&&t[r+1]&&!/^a=rtcp-fb:/.test(t[r+1])&&i.set(r+1,"".concat(e.match(/^a=rtcp-fb:\d+/)[0]," rrtr"))}));let r=[...i];for(let e=0;e<r.length;e++){let[i,n]=r[e];t.splice(i+e,0,n)}return t.join("\r\n")}addSPSDescription(e){let t=NV(e);return t.media.forEach((e=>{e.type===RD.VIDEO&&e.fmtp.forEach((e=>{e.config+=";sps-pps-idr-in-keyframe=1"}))})),PV(t)}removeSDESDescription(e){let t=["urn:ietf:params:rtp-hdrext:sdes:mid","urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id","urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id"],i=NV(e);return i.media.forEach((e=>{!e.ext||(e.ext=e.ext.filter((e=>!t.includes(e.uri))))})),PV(i)}isSubscriptionStateNotChanged(e){return JSON.stringify(e)===JSON.stringify(this.subscribeState)}subscribe(e,t){return XA(this,null,(function*(){var i,r;try{if(((null==(i=this._peerConnection)?void 0:i.connectionState)===KD.NEW||(null==(r=this._peerConnection)?void 0:r.connectionState)===KD.CONNECTING)&&(yield this.waitForPeerConnectionConnected()),this.isSubscriptionStateNotChanged(e))return void(this._peerConnection||(this.initialize(),yield this.connect(e)));if(this._log.info("subscribe ".concat(t," ").concat(JSON.stringify(e))),this._peerConnection||this._isSDPExchanging){let t="subscribe_change";Object.values(e).find((e=>!0===e))||(t="unsubscribe"),yield this.sendSubscription(t,e)}else this.initialize(),yield this.connect(e)}catch(e){throw this._room.isJoined&&this.isStreamUnpublished(t)?(this._log.warn("".concat(e.message," ").concat(JSON.stringify(this.muteState))),new ab({code:ob.REMOTE_STREAM_NOT_EXIST,message:"remote user ".concat(this.userId," unpublished stream")})):e}}))}unsubscribe(e){return XA(this,arguments,(function(e){var t=this;let{remoteTracks:i,streamType:r}=e;return function*(){if("CONNECTED"===t._currentState&&("main"===r&&!t.isMainStreamSubscribed||"auxiliary"===r&&!t.isAuxStreamSubscribed))return void t._log.info("".concat(r," stream already unsubscribed"));let e=WA({},t.subscribeState);i.forEach((t=>{switch(t.mediaType){case 1:e.audio=!1;break;case 4:e.video=!1;break;case 8:e.smallVideo=!1;break;case 2:e.auxiliary=!1}}));let n="subscribe_change";Object.values(e).find((e=>!0===e))||(n="unsubscribe"),t._log.info("".concat("unsubscribe"===n?n:"subscribe"," ").concat(r," [").concat(MV(e),"]")),yield t.sendSubscription(n,e),"unsubscribe"===n&&(t.closePeerConnection(),t.emitConnectionStateChangedEvent("DISCONNECTED"))}()}))}sendSubscription(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.subscribeState,i={srcTinyId:this.tinyId,srcUserId:this.userId},r=gV,n=pV.UNSUBSCRIBE_RESULT;return"subscribe_change"===e&&(i={audio:t.audio,bigVideo:t.video,auxVideo:t.auxiliary,smallVideo:t.smallVideo,srcTinyId:this.tinyId},r=TV,n=pV.SUBSCRIBE_CHANGE_RESULT),this._signalChannel.sendWaitForResponse({command:r,data:i,responseCommand:n,timeout:1e4}).then((t=>{let{data:i}=t;if(0!==i.code){let t=new ab({code:i.code,message:yN({key:VO,data:{type:e,message:i.message}})});throw this._log.error(t),t}}))}connect(){return XA(this,arguments,(function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.subscribeState;return function*(){try{yield e.exchangeSDP(t),yield e.waitForPeerConnectionConnected()}catch(t){throw e.closePeerConnection(!0),t}}()}))}exchangeSDP(e){return XA(this,null,(function*(){try{this._isSDPExchanging=!0,yield this.createOffer(),this._log.info("createOffer success, sending offer");let{type:t,sdp:i}=this._peerConnection.localDescription,r={type:t,sdp:i,srcUserId:this.userId,srcTinyId:this.tinyId,audio:e.audio,bigVideo:e.video,auxVideo:e.auxiliary,smallVideo:e.smallVideo},n=yield this._signalChannel.sendWaitForResponse({command:"subscribe",commandDesc:"exchange sdp",data:r,responseCommand:pV.SUBSCRIBE_RESULT,timeout:tw});if(!this._peerConnection){let e=new ab({code:ob.INVALID_OPERATION,message:yN({key:cN})});throw this._log.warn(e),e}yield this.onSubscribeResult(n),this._isSDPExchanging=!1}catch(e){throw this._isSDPExchanging=!1,e}}))}createOffer(){return XA(this,null,(function*(){let e={voiceActivityDetection:!1};QN()&&this._sdpSemantics===iw?(this._peerConnection.addTransceiver(RD.AUDIO,{direction:CD.RECVONLY}),this._peerConnection.addTransceiver(RD.VIDEO,{direction:CD.RECVONLY}),this._peerConnection.addTransceiver(RD.VIDEO,{direction:CD.RECVONLY})):(e.offerToReceiveAudio=!0,e.offerToReceiveVideo=!0);let t=yield this._peerConnection.createOffer(e);if(t.sdp){let{isH264DecodeSupported:e}=yield NN();e||(this._log.warn("remove h264 desc from sdp"),t.sdp=function(e){let t=NV(e);return t.media.forEach((e=>{var t,i;if(e.type===RD.VIDEO){let r=new Set;e.rtp.forEach((e=>{let{payload:t,codec:i}=e;return"H264"===i&&r.add(t)})),e.fmtp.forEach((e=>{let{payload:t,config:i}=e,n=i.match(/apt=(\d+)/);n&&n[1]&&r.has(Number(n[1]))&&r.add(t)}));let n=e=>{let{payload:t}=e;return!r.has(t)};e.rtp=e.rtp.filter(n),e.rtcpFb=null==(t=e.rtcpFb)?void 0:t.filter(n),e.fmtp=e.fmtp.filter(n),e.payloads=null==(i=e.payloads)?void 0:i.split(" ").filter((e=>!r.has(Number(e)))).join(" ")}})),PV(t)}(t.sdp)),t.sdp=this.addRRTRLine(t.sdp),t.sdp=this.addSPSDescription(t.sdp),t.sdp=function(e){let t=NV(e);return t.media.forEach((e=>{e.type===RD.AUDIO&&e.fmtp.forEach((e=>{e.config+=";sprop-stereo=1;stereo=1"}))})),PV(t)}(t.sdp),this._sdpSemantics===iw&&(t.sdp=this.removeSDESDescription(t.sdp))}yield this._peerConnection.setLocalDescription(t)}))}onSubscribeResult(e){return XA(this,null,(function*(){let{code:t,message:i=""}=e&&e.data||{},{type:r,sdp:n}=e&&e.data&&e.data.data||{};if(t===nw)throw new ab({code:ob.NOT_SUPPORTED_H264,message:yN({key:rN})});try{if(0!==t)throw new ab({code:t,message:yN({key:UO,data:{errMsg:i}})});this._log.debug("accept remote answer: ".concat(n)),yield this._peerConnection.setRemoteDescription({type:r,sdp:n}),this._sei&&(this._sei.handleEncodedStreams(),this._sei.onSEIMessage=e=>{this._emitter.emit("sei-message",GA(WA({},e),{userId:this.userId}))}),this.updateSSRC(n)}catch(e){throw this._log.error(e),e}}))}updateSSRC(e){try{NV(e).media.forEach((e=>{if(e.ssrcs)if(e.type===RD.AUDIO){let t=e.ssrcs.find((e=>{var t;return null==(t=e.value)?void 0:t.includes(MD)}));t&&(this.ssrc.audio=Number(t.id))}else{let t=e.ssrcs.find((e=>{var t;return null==(t=e.value)?void 0:t.includes(MD)})),i=e.ssrcs.find((e=>{var t;return null==(t=e.value)?void 0:t.includes(LD)}));t&&(this.ssrc.video=Number(t.id)),i&&(this.ssrc.auxiliary=Number(i.id))}}))}catch(e){}}getMainStreamVideoTrackId(){return this.remoteVideoTrack&&this.remoteVideoTrack.mediaTrack?this.remoteVideoTrack.mediaTrack.id:""}getAuxStreamVideoTrackId(){return this.remoteAuxiliaryTrack&&this.remoteAuxiliaryTrack.mediaTrack?this.remoteAuxiliaryTrack.mediaTrack.id:""}reconnect(){return XA(this,null,(function*(){if(!(qA(LV.prototype,this,"beforeReconnect").call(this)<0))try{this.closePeerConnection(),this.initialize(),yield this.connect(),this.stopReconnection(),this._log.warn("reconnect() success")}catch(e){let t=Gw(this._reconnectionCount);this._log.warn("reconnect() timeout, try again after ".concat(t/1e3,"s")),this._reconnectionTimer=setTimeout((()=>{this.clearReconnectionTimer(),this.reconnect()}),t)}}))}getIsReconnecting(){return this._isReconnecting}clearReconnectionTimer(){-1!==this._reconnectionTimer&&(clearTimeout(this._reconnectionTimer),this._reconnectionTimer=-1)}getCurrentState(){return this._currentState}setDelay(e){let{audioDelay:t,videoDelay:i}=e;this.remoteAudioTrack.stat.end2EndDelay=t,this.remoteVideoTrack.stat.end2EndDelay=i}},VV=LV;zA([CM((e=>function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return new Promise(((t,r)=>{let n=e=>{this._emitter.off("closed",n),r(new ab({code:ob.API_CALL_ABORTED,message:yN({key:mN,data:e})}))};this._emitter.on("closed",n),e.apply(this,i).then(t,r).finally((()=>{this._emitter.off("closed",n)}))}))}))],VV.prototype,"subscribe",1),zA([RM(wV.prototype.afterConnect),IM(wV.prototype.beforeConnect)],VV.prototype,"connect",1);var xV=VV,UV={voiceActivityDetection:!1},FV=class extends wV{constructor(e){super(GA(WA({},e),{isUplink:!0})),YA(this,"localMainAudioTrack",null),YA(this,"localMainVideoTrack",null),YA(this,"localAuxAudioTrack",null),YA(this,"localAuxVideoTrack",null),YA(this,"ssrc",{audio:0,video:0,small:0,auxiliary:0}),YA(this,"_isPublishingAux",!1),YA(this,"_publishingLocalAudioTrack"),YA(this,"_publishingLocalVideoTrack"),YA(this,"_mediaSettings",{videoCodec:"",videoWidth:0,videoHeight:0,videoBps:0,videoFps:0,audioCodec:"opus",audioFs:0,audioChannel:0,audioBps:0,smallVideoWidth:0,smallVideoHeight:0,smallVideoFps:0,smallVideoBps:0,auxVideoWidth:0,auxVideoHeight:0,auxVideoFps:0,auxVideoBps:0}),YA(this,"_audioManager"),this._audioManager=e.audioManager}get isMainStreamPublished(){return!(!this.localMainAudioTrack&&!this.localMainVideoTrack)}get isAuxStreamPublished(){return!(!this.localAuxVideoTrack&&!this.localAuxAudioTrack)}get publishState(){var e,t,i,r;let n={audio:!1,bigVideo:!1,smallVideo:!1,auxVideo:!1};if(this._peerConnection){let o=this._peerConnection.getSenders();o&&(KN()?(n.audio=!(null==(e=o[0])||!e.track),n.bigVideo=!(null==(t=o[1])||!t.track),n.smallVideo=!(null==(i=o[2])||!i.track),n.auxVideo=!(null==(r=o[3])||!r.track)):o.forEach((e=>{e.track&&(e.track.kind===RD.AUDIO?n.audio=!0:(n.bigVideo=!0,this._room.videoManager.hasSmall&&(n.smallVideo=!0)))})))}return n}initialize(){super.initialize(),this.installEvents()}reset(){this._isReconnecting&&this.stopReconnection(),this.closePeerConnection(),this.uninstallEvents()}close(e){super.close(e),this.reset(),this.emitConnectionStateChangedEvent("DISCONNECTED")}installEvents(){this._emitter.listeners("connection-state-changed").includes(this.handleConnectionStateChange)||this._emitter.on("connection-state-changed",this.handleConnectionStateChange,this)}uninstallEvents(){this._emitter.off("connection-state-changed",this.handleConnectionStateChange,this)}emitConnectionStateChangedEvent(e,t){var i,r,n;let o=this._currentState,s=super.emitConnectionStateChangedEvent(e);return s&&o!==e&&(t?t.emit("connection-state-changed",{prevState:o,state:e}):(null==(i=this.localMainVideoTrack)||i.emit("connection-state-changed",{prevState:o,state:e}),null==(r=this.localAuxVideoTrack)||r.emit("connection-state-changed",{prevState:o,state:e}),null==(n=this._publishingLocalVideoTrack)||n.emit("connection-state-changed",{prevState:o,state:e}))),s}publish(e){return XA(this,arguments,(function(e){var t=this;let{localAudioTrack:i,localVideoTrack:r,isAuxiliary:n}=e;return function*(){var e;let o;t._peerConnection||t.initialize(),i&&(t._publishingLocalAudioTrack=i),r&&(t._publishingLocalVideoTrack=r),t._isPublishingAux=n,r&&!n&&r.small&&(o=t._room.videoManager.smallTrack),t.sendMediaSettings(),QN()?yield t.publishByTransceiver({localAudioTrack:i,localVideoTrack:r,smallTrack:o,isAuxiliary:n}):yield t.publishByAddTrack({localAudioTrack:i,localVideoTrack:r,smallTrack:o}),t._publishingLocalAudioTrack=null,t._publishingLocalVideoTrack=null,t._isPublishingAux=!1,n?(r&&(t.localAuxVideoTrack=r),i&&(t.localAuxAudioTrack=i)):(r&&(t.localMainVideoTrack=r),i&&(t.localMainAudioTrack=i)),null==(e=t._sei)||e.handleEncodedStreams(),t.installTrackMuteEvents(i,r),t.sendMutedFlag()}()}))}publishByTransceiver(e){return XA(this,arguments,(function(e){var t=this;let{localAudioTrack:i,localVideoTrack:r,smallTrack:n,isAuxiliary:o}=e;return function*(){t._log.info("publish by transceiver");let e=new MediaStream,s=null==r?void 0:r.outMediaTrack,a=t._audioManager.mixedAudioTrack;a&&e.addTrack(a),s&&e.addTrack(s);let c=t._peerConnection.getTransceivers();if(0===c.length)t._peerConnection.addTransceiver(a||RD.AUDIO,{direction:CD.SENDONLY,streams:[e]}),t._peerConnection.addTransceiver(o?RD.VIDEO:s||RD.VIDEO,{direction:CD.SENDONLY,streams:[e]}),t._peerConnection.addTransceiver(n||RD.VIDEO,{direction:CD.SENDONLY,streams:[e]}),t._peerConnection.addTransceiver(o&&s||RD.VIDEO,{direction:CD.SENDONLY,streams:[e]}),yield t.connect();else{let e=[];if(a&&(c[0].sender.track||e.push(0),yield c[0].sender.replaceTrack(a),yield t.setBandwidth({bandwidth:(null==i?void 0:i.profile.bitrate)||40,type:RD.AUDIO})),s){let i=o?3:1;yield c[i].sender.replaceTrack(s),yield t.setBandwidth({bandwidth:r.profile.bitrate,type:RD.VIDEO,videoType:o?RD.AUXILIARY:RD.BIG}),e.push(i),n&&(yield c[2].sender.replaceTrack(n),yield t.setBandwidth({bandwidth:r.small.bitrate,type:RD.VIDEO,videoType:RD.SMALL}),e.push(2))}yield t.setTransceiverDirection(CD.SENDONLY,e),yield t.doPublishChange(),null==r||r.emit("connection-state-changed",{prevState:"DISCONNECTED",state:"CONNECTING"}),null==r||r.emit("connection-state-changed",{prevState:"CONNECTING",state:"CONNECTED"})}}()}))}publishByAddTrack(e){return XA(this,arguments,(function(e){var t=this;let{localAudioTrack:i,localVideoTrack:r,smallTrack:n}=e;return function*(){t._log.info("publish by addtrack");let e=null==r?void 0:r.outMediaTrack,o=t._audioManager.mixedAudioTrack;if(t._peerConnection&&"new"!==t._peerConnection.connectionState)return o&&(yield t.addTrack(i)),void(e&&(yield t.addTrack(r)));let s=new MediaStream;if(o&&s.addTrack(o),e&&s.addTrack(e),o&&t._peerConnection.addTrack(o,s),e&&(t._peerConnection.addTrack(e,s),n)){let e=new MediaStream;e.addTrack(n),t._peerConnection.addTrack(n,e)}yield t.connect()}()}))}installTrackMuteEvents(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach((e=>{e&&(null==e||e.on("mute",this.sendMutedFlag,this),null==e||e.on("unmute",this.sendMutedFlag,this))}))}uninstallTrackMuteEvents(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach((e=>{e&&(null==e||e.off("mute",this.sendMutedFlag,this),null==e||e.off("unmute",this.sendMutedFlag,this))}))}unpublish(e){return XA(this,arguments,(function(e){var t=this;let{localAudioTrack:i,localVideoTrack:r}=e;return function*(){if(!KN())return i&&i.outMediaTrack&&!r&&t.localMainVideoTrack?(yield t.removeTrack(i),void(t.localMainAudioTrack=null)):r&&r.outMediaTrack&&!i&&t.localMainAudioTrack?(yield t.removeTrack(r),void(t.localMainVideoTrack=null)):(yield t.doUnpublish(),t.uninstallTrackMuteEvents(i,r),void t.emitConnectionStateChangedEvent("DISCONNECTED",r));let e=r&&r===t.localAuxVideoTrack,n=null==r?void 0:r.outMediaTrack,o=t._peerConnection.getSenders(),s=[];i&&(t._audioManager.mixedAudioTrack||(yield o[0].replaceTrack(null),s.push(0)),e?t.localAuxAudioTrack=null:t.localMainAudioTrack=null),n&&(e?(yield o[3].replaceTrack(null),t.localAuxVideoTrack=null,t._mediaSettings=GA(WA({},t._mediaSettings),{auxVideoBps:0,auxVideoFps:0,auxVideoWidth:0,auxVideoHeight:0}),s.push(3)):(yield o[1].replaceTrack(null),yield o[2].replaceTrack(null),t.localMainVideoTrack=null,t._mediaSettings=GA(WA({},t._mediaSettings),{videoWidth:0,videoHeight:0,videoBps:0,videoFps:0,audioFs:0,audioChannel:0,audioBps:0,smallVideoWidth:0,smallVideoHeight:0,smallVideoFps:0,smallVideoBps:0}),s.push(1,2))),t.isMainStreamPublished||t.isAuxStreamPublished?(yield t.setTransceiverDirection(CD.INACTIVE,s),yield t.doPublishChange(!1)):yield t.doUnpublish(),t.uninstallTrackMuteEvents(i,r),null==r||r.emit("connection-state-changed",{prevState:t._currentState,state:"DISCONNECTED"})}()}))}doPublishChange(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return XA(this,null,(function*(){let t={state:this.publishState,constraintConfig:this._mediaSettings},i=yield this._signalChannel.sendWaitForResponse({command:_V,data:t,responseCommand:pV.PUBLISH_STATE_CHANGE_RESULT,enableLog:e});this.checkPublishResultCode(i.data.code,i.data.message)}))}doUnpublish(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._signalChannel.sendWaitForResponse({command:fV,commandDesc:"unpublish",responseCommand:pV.UNPUBLISH_RESULT,enableLog:e}).catch((e=>{if(e.getCode()===ob.API_CALL_TIMEOUT)return Promise.resolve();throw e}))}updateMediaSettings(){let{detail:{isH264EncodeSupported:e,isVp8EncodeSupported:t}}=this._room.checkSystemResult;e?this._mediaSettings.videoCodec="H264":t&&(this._mediaSettings.videoCodec="VP8");let i=this._publishingLocalAudioTrack||this.localMainAudioTrack||this.localAuxAudioTrack,{localMainVideoTrack:r,localAuxVideoTrack:n}=this;if(this._publishingLocalVideoTrack&&(this._isPublishingAux?n=this._publishingLocalVideoTrack:r=this._publishingLocalVideoTrack),$N){if(i&&i.outMediaTrack){let e=i.outMediaTrack.getSettings();this._mediaSettings.audioChannel=e.channelCount||1,this._mediaSettings.audioBps=1e3*i.profile.bitrate,this._mediaSettings.audioFs=e.sampleRate||0}if(r&&r.outMediaTrack){let e=r.outMediaTrack.getSettings();this._mediaSettings.videoWidth=e.width||0,this._mediaSettings.videoHeight=e.height||0,this._mediaSettings.videoFps=e.frameRate||0,this._mediaSettings.videoBps=1e3*r.profile.bitrate,r.small&&(this._mediaSettings.smallVideoWidth=r.small.width,this._mediaSettings.smallVideoHeight=r.small.height,this._mediaSettings.smallVideoFps=r.small.frameRate,this._mediaSettings.smallVideoBps=1e3*r.small.bitrate)}if(n&&n.outMediaTrack){let e=n.outMediaTrack.getSettings();this._mediaSettings.auxVideoWidth=e.width||0,this._mediaSettings.auxVideoHeight=e.height||0,this._mediaSettings.auxVideoFps=e.frameRate||0,this._mediaSettings.auxVideoBps=1e3*n.profile.bitrate}}else i&&i.outMediaTrack&&(this._mediaSettings.audioChannel=i.profile.channelCount,this._mediaSettings.audioBps=1e3*i.profile.bitrate,this._mediaSettings.audioFs=i.profile.sampleRate),r&&r.outMediaTrack&&(this._mediaSettings.videoWidth=r.profile.width,this._mediaSettings.videoHeight=r.profile.height,this._mediaSettings.videoFps=r.profile.frameRate,this._mediaSettings.videoBps=1e3*r.profile.bitrate);this._log.info("updateMediaSettings: ".concat(JSON.stringify(this._mediaSettings)))}sendMediaSettings(){this.updateMediaSettings(),this._signalChannel.sendWaitForResponse({command:vV,data:this._mediaSettings,responseCommand:pV.UPDATE_CONSTRAINT_CONFIG_RES}).then((e=>{0!==e.data.code&&this._log.warn(e.data.message)})).catch((()=>{}))}addTrack(e){return XA(this,null,(function*(){var t;if(!this._peerConnection)return;let i=e===this.localAuxAudioTrack||e===this.localAuxVideoTrack;this._log.info("is adding ".concat(e.kind," track to current published local ").concat(i?RD.AUXILIARY:RD.MAIN," stream")),null==(t=this._sei)||t.handleEncodedStreams(),QN()?yield this.addTrackByTransceiver(e,i):yield this.addTrackBySender(e)}))}addTrackByTransceiver(e,t){return XA(this,null,(function*(){var i;if(!e.mediaTrack)return;let r=this._peerConnection.getTransceivers();if(e.kind===RD.AUDIO)yield r[0].sender.replaceTrack(this._audioManager.mixedAudioTrack);else{let n=t?3:1;yield r[n].sender.replaceTrack(e.outMediaTrack),1===n&&(null==(i=this.localMainVideoTrack)?void 0:i.small)&&(yield r[2].sender.replaceTrack(this._room.videoManager.smallTrack)),r[n].direction===CD.INACTIVE&&(yield this.setTransceiverDirection(CD.SENDONLY,[n]))}this.updateMediaSettings(),yield this.doPublishChange()}))}addTrackBySender(e){return XA(this,null,(function*(){if(!e.outMediaTrack)return;let t=e.outMediaTrack;KN()&&this._peerConnection.getTransceivers().findIndex((e=>"stopped"===e.direction))>=0&&(this._log.warn("transceiver is stopping, negotiate sdp first"),yield this.updateOffer("remove",t));let i=this._peerConnection.getSenders().find((e=>e.track&&e.track.kind===t.kind));if(i&&i.track){this._log.warn("sender already exists, remove sender first");let e=i.track;this.removeSender(i),yield this.updateOffer("remove",e)}let r=t.kind===RD.VIDEO?t:this._audioManager.mixedAudioTrack;if(r&&this._peerConnection.addTrack(t,new MediaStream([r])),t.kind===RD.VIDEO&&e instanceof DM&&e.small){let e=new MediaStream,t=this._room.videoManager.smallTrack;e.addTrack(t),this._peerConnection.addTrack(t,e)}yield this.updateOffer("add",t)}))}isNeedToResetOfferOrder(){if(this._sdpSemantics===rw||!this._peerConnection||!this._peerConnection.localDescription)return!1;let{sdp:e}=this._peerConnection.localDescription,t=NV(e);for(let e=0;e<t.media.length;e++)if(0===Number(t.media[e].mid)&&t.media[e].type===RD.VIDEO)return!0;return!1}removeSender(e){let t=null;KN()&&(t=this._peerConnection.getTransceivers().find((t=>t.sender&&t.sender.track===e.track))),this._peerConnection.removeTrack(e),t&&Kw(t.stop)&&(this._log.info("stop transceiver"),t.stop())}removeTrack(e){return XA(this,null,(function*(){if(!this._peerConnection)return;let t=e===this.localAuxAudioTrack||e===this.localAuxVideoTrack;this._log.info("is removing ".concat(e.kind," track from current published local ").concat(t?RD.AUXILIARY:RD.MAIN," stream")),QN()?yield this.removeTrackByTransceiver(e,t):yield this.removeTrackBySender(e)}))}removeTrackByTransceiver(e,t){return XA(this,null,(function*(){if(!e.outMediaTrack)return;let i=this._peerConnection.getTransceivers();if(e.kind===RD.AUDIO)this._audioManager.mixedAudioTrack||(yield i[0].sender.replaceTrack(null));else{let r=t?3:1;yield i[r].sender.replaceTrack(null),1===r&&e.small&&(yield i[2].sender.replaceTrack(null)),yield this.setTransceiverDirection(CD.INACTIVE,[r])}this.updateMediaSettings(),yield this.doPublishChange()}))}setTransceiverDirection(e,t){return XA(this,null,(function*(){if(!kb)return;let i=!1,r=!1;this._log.info("setting transceiver ".concat(t.join(",")," direction to ").concat(e));let n=this._peerConnection.getTransceivers();if(t.forEach((t=>{n[t].direction!==e&&(n[t].direction=e,i=!0)})),i){this._log.info("updating offer");let e=yield this._peerConnection.createOffer();yield this._peerConnection.setLocalDescription(e)}let o=-1,s=this._peerConnection.remoteDescription.sdp.split("\r\n").map((i=>{if(i.match(new RegExp("a=(".concat(CD.INACTIVE,"|").concat(CD.RECVONLY,"|").concat(CD.SENDONLY,")")))&&o++,t.includes(o)){if(e===CD.INACTIVE&&i.includes("a=".concat(CD.RECVONLY)))return r=!0,"a=".concat(e);if(e===CD.SENDONLY&&i.includes("a=".concat(CD.INACTIVE)))return r=!0,"a=".concat(CD.RECVONLY)}return i})).join("\r\n");r&&(this._log.info("updating answer"),yield this._peerConnection.setRemoteDescription({type:"answer",sdp:s}))}))}removeTrackBySender(e){return XA(this,null,(function*(){if(!e.outMediaTrack)return;if(e.kind===RD.VIDEO&&this.isNeedToResetOfferOrder()&&this.localMainAudioTrack)return this.reset(),this.initialize(),void(yield this.publish({localAudioTrack:this.localMainAudioTrack,isAuxiliary:!1}));let t=this._peerConnection.getSenders().find((t=>t.track===e.outMediaTrack));t&&(this.removeSender(t),e.kind===RD.VIDEO&&e.small&&this._peerConnection.getSenders().forEach((e=>{e.track&&e.track.kind===RD.VIDEO&&this.removeSender(e)}))),yield this.updateOffer("remove",e.outMediaTrack)}))}replaceTrack(e){return XA(this,null,(function*(){var t;let i,r=null==(t=this._peerConnection)?void 0:t.getSenders();if(!r||0===r.length||!e.mediaTrack)return;if(i=QN()?e.kind===RD.AUDIO?r[0]:r[1]:r.find((t=>t.track&&t.track.kind===e.kind)),!i)return;let n=e===this.localAuxAudioTrack||e===this.localAuxVideoTrack;this._log.info("is replacing ".concat(e.kind," track on ").concat(n?RD.AUXILIARY:RD.MAIN," stream")),e.kind===RD.AUDIO?yield i.replaceTrack(this._audioManager.mixedAudioTrack):e.kind===RD.VIDEO&&(n?r[3]&&(yield r[3].replaceTrack(e.outMediaTrack)):yield i.replaceTrack(e.outMediaTrack))}))}updateOffer(e,t){return XA(this,null,(function*(){try{let i=yield this._peerConnection.createOffer(UV);kb&&i.sdp&&(i.sdp=this.setSDPDirection(i.sdp,"sendrecv")),yield this._peerConnection.setLocalDescription(i);let r=this.updateMediaSettings(),n={action:e,trackId:t.id,kind:t.kind===RD.VIDEO?"bigVideo":t.kind,type:"offer",sdp:this._peerConnection.localDescription.sdp,constraintConfig:r,state:this.publishState};this._log.info("createOffer success, sending updated offer to remote server"),this._log.debug("updatedOffer: ".concat(n.sdp));let o=yield this._signalChannel.sendWaitForResponse({command:"publish_change",data:n,responseCommand:pV.UPDATE_OFFER_RESULT,timeout:ew,commandDesc:"update offer"}),{code:s,message:a}=o.data;0!==s&&this.checkPublishResultCode(s,a),yield this.acceptAnswer(o.data.data),i.sdp&&this.updateSSRC(i.sdp)}catch(e){throw this._log.error(e),e}}))}setBandwidth(e){return XA(this,arguments,(function(e){var t=this;let{bandwidth:i,type:r,videoType:n,sdp:o}=e;return function*(){if(!XN())return o?r===RD.VIDEO?t.updateVideoBandwidthRestriction(o,i,n):t.updateAudioBandwidthRestriction(o,i):void 0;let e=0;r===RD.VIDEO&&(e=n===RD.SMALL?2:n===RD.AUXILIARY?3:1);let s=t._peerConnection.getSenders()[e];if(s){let e=s.getParameters();(!e.encodings||0===e.encodings.length)&&(e.encodings=[{}]),e.encodings[0].maxBitrate=1e3*i;try{return yield s.setParameters(e),t._log.info("".concat(n||"").concat(r," bandwidth ").concat(i," kbps")),o}catch(e){if(t._log.info("failed to set bandwidth by setting maxBitrate: ".concat(e)),o)return r===RD.VIDEO?t.updateVideoBandwidthRestriction(o,i,n):t.updateAudioBandwidthRestriction(o,i)}}return o}()}))}updateVideoBandwidthRestriction(e,t,i){let r="AS";kb&&(r="TIAS",t*=1e3);let n=0,o=-1;return i===RD.SMALL?n=1:i===RD.AUXILIARY&&(n=2),e.replace(/m=video (.*)\r\nc=IN (.*)\r\n/g,(e=>(o+=1,o===n?"".concat(e,"b=").concat(r,":").concat(t,"\r\n"):e)))}updateAudioBandwidthRestriction(e,t){let i="AS";return kb&&(i="TIAS",t*=1e3),e.replace(/m=audio (.*)\r\nc=IN (.*)\r\n/,"m=audio $1\r\nc=IN $2\r\nb=".concat(i,":").concat(t,"\r\n"))}removeBandwidthRestriction(e){return e.replace(/b=AS:.*\r\n/,"").replace(/b=TIAS:.*\r\n/,"")}removeVideoOrientation(e){return e.replace(/urn:3gpp:video-orientation/,"")}connect(){return XA(this,null,(function*(){try{yield this.exchangeSDP(),yield this.waitForPeerConnectionConnected()}catch(e){throw this.closePeerConnection(!0),this.uninstallEvents(),e}}))}exchangeSDP(){return XA(this,null,(function*(){try{yield this.createOffer(),this._log.info("createOffer success, sending offer to remote server"),yield this.doExchangeSDP()}catch(e){throw e}}))}createOffer(){return XA(this,null,(function*(){try{let e=yield this._peerConnection.createOffer(UV);yield this._peerConnection.setLocalDescription(e),e.sdp&&this.updateSSRC(e.sdp)}catch(e){throw e}}))}doExchangeSDP(){let e={command:"publish",responseCommand:pV.PUBLISH_RESULT,data:{type:this._peerConnection.localDescription.type,sdp:this.removeVideoOrientation(this._peerConnection.localDescription.sdp),screen:this.localMainVideoTrack instanceof OM||this.localAuxVideoTrack instanceof OM,state:this.publishState,constraintConfig:this._mediaSettings},enableLog:!1};return this._log.debug("sending sdp offer: ".concat(e.data.sdp)),this._signalChannel.sendWaitForResponse(e).then((e=>{let{code:t,message:i,data:r}=e.data;return 0===t?this.acceptAnswer(r):this.checkPublishResultCode(t,i)}))}setSDPDirection(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"all",r=NV(e);return r.media.forEach((e=>{("all"===i||e.type===i)&&(e.direction=t)})),PV(r)}acceptAnswer(e){return XA(this,null,(function*(){var t,i,r,n,o;try{let s;if(this._publishingLocalAudioTrack||this._publishingLocalVideoTrack||this.isMainStreamPublished){let e=(null==(t=this._publishingLocalVideoTrack)?void 0:t.profile.bitrate)||(null==(i=this.localMainVideoTrack)?void 0:i.profile.bitrate),o=(null==(r=this._publishingLocalAudioTrack)?void 0:r.profile.bitrate)||(null==(n=this.localMainAudioTrack)?void 0:n.profile.bitrate);if(e){let t=this._isPublishingAux?RD.AUXILIARY:RD.BIG;s=yield this.setBandwidth({bandwidth:e,type:RD.VIDEO,sdp:s,videoType:t})}o&&(s=yield this.setBandwidth({bandwidth:o,type:RD.AUDIO,sdp:s}))}if(s=this.removeVideoOrientation(e.sdp),null!=(o=this._publishingLocalVideoTrack)&&o.small){let{smallStreamConfig:e}=this._room;s=yield this.setBandwidth({bandwidth:this._publishingLocalVideoTrack.small.bitrate||e.bitrate,type:RD.VIDEO,videoType:RD.SMALL,sdp:s})}let a={type:e.type,sdp:s};yield this._peerConnection.setRemoteDescription(a),this._log.debug("accepted answer: ".concat(s))}catch(e){throw this._log.error("failed to accept remote answer ".concat(e)),e}}))}sendMutedFlag(e){var t,i,r;if(e===this.localAuxAudioTrack||e===this.localAuxVideoTrack)return;let n={audio:!(null==(t=this.localMainAudioTrack)||!t.muted),bigVideo:!(null==(i=this.localMainVideoTrack)||!i.muted),auxVideo:!(null==(r=this.localAuxVideoTrack)||!r.muted)};this._log.info("send muted state: ".concat(JSON.stringify(n))),this._signalChannel.send(mV,n)}getIsReconnecting(){return this._isReconnecting}reconnect(){return XA(this,null,(function*(){if(!(qA(FV.prototype,this,"beforeReconnect").call(this)<0))try{yield this._signalChannel.sendWaitForResponse({command:fV,responseCommand:pV.UNPUBLISH_RESULT,enableLog:!1}),this.closePeerConnection(),this.initialize(),this.isMainStreamPublished&&(yield this.publish({localAudioTrack:this.localMainAudioTrack,localVideoTrack:this.localMainVideoTrack,isAuxiliary:!1})),this.isAuxStreamPublished&&(yield this.publish({localAudioTrack:this.localAuxAudioTrack,localVideoTrack:this.localAuxVideoTrack,isAuxiliary:!0})),this._log.warn("reconnect() uplink reconnect successfully"),this.stopReconnection()}catch(e){let t=Gw(this._reconnectionCount);this._log.warn("reconnect() timeout, try again after ".concat(t/1e3,"s")),this._reconnectionTimer=setTimeout((()=>{this.clearReconnectionTimer(),this.reconnect()}),t)}}))}handleConnectionStateChange(e){"CONNECTED"===e.state&&(this.localMainVideoTrack||this._publishingLocalVideoTrack&&!this._isPublishingAux)&&AO.emit(kO.SEND_FIRST_VIDEO_FRAME,{room:this._room})}updateSSRC(e){try{NV(e).media.forEach(((e,t)=>{if(e.type===RD.AUDIO){let t=e.ssrcs&&e.ssrcs[0];t&&(this.ssrc.audio=Number(t.id))}else{if(this._sdpSemantics===rw&&e.ssrcGroups)return void e.ssrcGroups.forEach(((e,t)=>{let i=Number(e.ssrcs.split(" ")[0]);0===t?this.ssrc.video=i:1===t&&(this.ssrc.small=i)}));let i=e.ssrcs&&e.ssrcs[0];if(!i)return;switch(t){case 1:this.ssrc.video=Number(i.id);break;case 2:this.ssrc.small=Number(i.id);break;case 3:this.ssrc.auxiliary=Number(i.id)}}}))}catch(e){}}getVideoTrackId(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:RD.VIDEO;if(this._peerConnection){let t=this._peerConnection.getSenders();if(e===RD.AUXILIARY&&t[3]&&t[3].track)return t[3].track.id;if(e===RD.VIDEO&&t[1]&&t[1].track)return t[1].track.id}if(this.localMainVideoTrack&&e===RD.VIDEO){let e=this.localMainVideoTrack.mediaTrack;if(e)return e.id}if(this.localAuxVideoTrack&&e===RD.AUXILIARY){let e=this.localAuxVideoTrack.mediaTrack;if(e)return e.id}return""}getSSRC(){return this.ssrc}checkPublishResultCode(e,t){if(0!==e)throw e===nw?(this._log.error(fN.NOT_SUPPORTED_H264ENCODE),new ab({code:ob.NOT_SUPPORTED_H264,message:yN({key:iN})})):new ab({code:ob.UNKNOWN,message:yN({key:sN,data:{signalResponse:pV.PUBLISH_RESULT,code:e,message:t}})})}sendSEI(e,t){var i;null==(i=this._sei)||i.push(e,t)}},BV=FV;zA([CM((e=>function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return new Promise(((t,r)=>{let n=e=>{this._emitter.off("closed",n),r(new ab({code:ob.API_CALL_ABORTED,message:yN({key:mN,data:e})}))};this._emitter.on("closed",n),e.apply(this,i).then(t,r).finally((()=>{this._emitter.off("closed",n)}))}))}))],BV.prototype,"publish",1),zA([RM(wV.prototype.afterConnect),IM(wV.prototype.beforeConnect)],BV.prototype,"connect",1);var HV=BV,jV=QA($A()),WV=class extends jV.default{constructor(e){let{signalChannel:t,room:i}=e;super(),YA(this,"_room"),YA(this,"_signalChannel"),YA(this,"_log"),YA(this,"_uplinkRTT",0),YA(this,"_uplinkLoss",0),YA(this,"_downlinkRTT",0),YA(this,"_downlinkLoss",0),YA(this,"_downlinkPrevStatMap",new Map),YA(this,"_downlinkLossAndRTTMap",new Map),YA(this,"_interval",-1),YA(this,"_uplinkNetworkQuality",0),YA(this,"_downlinkNetworkQuality",0),this._room=i,this._signalChannel=t,this._log=wO.createLogger({id:"q",userId:this._room.userId,sdkAppId:this._room.sdkAppId}),this.initialize()}get uplinkNetworkQuality(){return this._uplinkNetworkQuality}set uplinkNetworkQuality(e){e!==this._uplinkNetworkQuality&&this._log.info("uplink ".concat(this.uplinkNetworkQuality," -> ").concat(e,", rtt: ").concat(this._uplinkRTT,", loss: ").concat(this._uplinkLoss)),this._uplinkNetworkQuality=e}get downlinkNetworkQuality(){return this._downlinkNetworkQuality}set downlinkNetworkQuality(e){if(e!==this._downlinkNetworkQuality){let{rtt:t,loss:i}=this.getAverageLossAndRTT([...this._downlinkLossAndRTTMap.values()]);this._log.info("downlink ".concat(this.downlinkNetworkQuality," -> ").concat(e,", rtt: ").concat(t,", loss: ").concat(i))}this._downlinkNetworkQuality=e}initialize(){this._signalChannel.on(pV.UPLINK_NETWORK_STATS,(e=>{this.handleUplinkNetworkQuality(e)})),this._signalChannel.on("2",this.handleSignalConnectionStateChange.bind(this)),this.start()}handleUplinkNetworkQuality(e){var t,i;if(0!==e.data.code)return;let r=e.data.data;if(r.delay&&this.updateDelay(r.delay),!this._room.uplinkConnection)return this.uplinkNetworkQuality=0,this._uplinkLoss=0,void(this._uplinkRTT=0);let n=null==(i=null==(t=this._room)?void 0:t.uplinkConnection)?void 0:i.getPeerConnection();if(n&&this.isPeerConnectionDisconnected(n))return this.uplinkNetworkQuality=6,this._uplinkLoss=0,void(this._uplinkRTT=0);let o=r.expectAudPkg+r.expectVidPkg,s=r.recvAudPkg+r.recvVidPkg,a=o-s;0===o&&0===s||(this._uplinkLoss=a<=0?0:Math.round(a/o*100),this._uplinkRTT=r.rtt,this.uplinkNetworkQuality=this.getNetworkQuality(this._uplinkLoss,this._uplinkRTT))}handleDownlinkNetworkQuality(){return XA(this,null,(function*(){if(0===this._room.remotePublishedUserMap.size)return void(this.downlinkNetworkQuality=0);let e=[...this._room.remotePublishedUserMap.values()],t=e.filter((e=>{var t;return(null==(t=e.getPeerConnection())?void 0:t.connectionState)===KD.CONNECTED}));if(e.filter((e=>this.isPeerConnectionDisconnected(e.getPeerConnection()))).length===e.length)return void(this.downlinkNetworkQuality=6);for(let e=0;e<t.length;e++){let i=t[e].getPeerConnection();if(!i)return;let{rtt:r,totalPacketsLost:n,totalPacketsReceived:o}=yield this.getStat(i);if(!this._downlinkPrevStatMap.has(i)){this._downlinkPrevStatMap.set(i,{totalPacketsLost:n,totalPacketsReceived:o});continue}let s=0,a=this._downlinkPrevStatMap.get(i),c=n-a.totalPacketsLost,l=o-a.totalPacketsReceived;s=c<=0||l<0?0:Math.round(c/(c+l)*100),this._downlinkPrevStatMap.set(i,{totalPacketsLost:n,totalPacketsReceived:o}),this._downlinkLossAndRTTMap.set(i,{rtt:r,loss:s,userId:t[e].getUserId(),audioDelay:t[e].remoteAudioTrack.stat.end2EndDelay,videoDelay:t[e].remoteVideoTrack.stat.end2EndDelay})}if([...this._downlinkPrevStatMap.keys()].forEach((e=>{this.isPeerConnectionDisconnected(e)&&(this._downlinkPrevStatMap.delete(e),this._downlinkLossAndRTTMap.delete(e))})),0===this._downlinkLossAndRTTMap.size)return;let{rtt:i,loss:r}=this.getAverageLossAndRTT([...this._downlinkLossAndRTTMap.values()]);this._downlinkRTT=i,this._downlinkLoss=r,this.downlinkNetworkQuality=this.getNetworkQuality(r,i)}))}getStat(e){return XA(this,null,(function*(){let t={rtt:0,totalPacketsLost:0,totalPacketsReceived:0};if(!e||!GN())return t;let i=e.getReceivers();try{for(let e=0;e<i.length;e++)(yield i[e].getStats()).forEach((e=>{"candidate-pair"===e.type&&Yw(e.currentRoundTripTime)&&(t.rtt=Math.round(1e3*e.currentRoundTripTime)),"inbound-rtp"===e.type&&(e.mediaType===RD.AUDIO||e.mediaType===RD.VIDEO)&&(t.totalPacketsLost+=e.packetsLost,t.totalPacketsReceived+=e.packetsReceived)}));return t}catch(e){return t}}))}getAverageLossAndRTT(e){let t={rtt:0,loss:0};return Array.isArray(e)&&e.length>0&&(e.forEach((e=>{t.rtt+=e.rtt,t.loss+=e.loss})),Object.keys(t).forEach((i=>{t[i]=Math.round(t[i]/e.length)}))),t}getNetworkQuality(e,t){return e>50||t>500?5:e>30||t>350?4:e>20||t>200?3:e>10||t>100?2:e>=0||t>=0?1:0}handleSignalConnectionStateChange(e){e.state===cV?(this._uplinkRTT=0,this._uplinkLoss=0,this.uplinkNetworkQuality=6):e.state===uV&&6===this.uplinkNetworkQuality&&(this.uplinkNetworkQuality=5)}handleUplinkConnectionStateChange(e){let{state:t}=e;"DISCONNECTED"===t?(this._uplinkLoss=0,this._uplinkRTT=0,this.uplinkNetworkQuality=6):"CONNECTED"===t&&6===this.uplinkNetworkQuality&&(this.uplinkNetworkQuality=5)}isPeerConnectionDisconnected(e){return!(!e||e.connectionState!==KD.DISCONNECTED&&e.connectionState!==KD.FAILED&&e.connectionState!==KD.CLOSED)}setUplinkConnection(e){this._room.uplinkConnection=e,this._room.uplinkConnection?this._room.uplinkConnection.on("connection-state-changed",this.handleUplinkConnectionStateChange.bind(this)):(this.uplinkNetworkQuality=0,this._uplinkRTT=0,this._uplinkLoss=0)}start(){-1===this._interval?(this._log.debug("start network quality calculating"),this._interval=SP.run(Ew,(()=>{this.handleDownlinkNetworkQuality();let e=[...this._downlinkLossAndRTTMap.values()];AO.emit(kO.NETWORK_QUALITY,{room:this._room,uplink:{rtt:this._uplinkRTT,loss:this._uplinkLoss},downlinks:e}),this.emit(WV.EVENT_NETWORK_QUALITY,{uplinkNetworkQuality:this.uplinkNetworkQuality,downlinkNetworkQuality:this.downlinkNetworkQuality,uplinkRTT:this._uplinkRTT,uplinkLoss:this._uplinkLoss,downlinkRTT:this._downlinkRTT,downlinkLoss:this._downlinkLoss,downlinkInfo:e})}),{delay:2e3})):this._log.info("network quality calculating is already started")}stop(){this._log.debug("stopped"),-1!==this._interval&&(SP.clearTask(this._interval),this._interval=-1),this._downlinkLossAndRTTMap.clear(),this._downlinkPrevStatMap.clear()}updateDelay(e){let{tinyIdToUserIdMap:t}=this._room;e.forEach((e=>{let{srcTinyId:i,videoDelay:r,audioDelay:n}=e,o=t.get(i);if(o){let e=this._room.remotePublishedUserMap.get(o);null==e||e.setDelay({videoDelay:r,audioDelay:n})}}))}},GV=WV;YA(GV,"EVENT_NETWORK_QUALITY","0");var JV=new WeakMap;function KV(e){let{settings:t={retries:5,timeout:2e3},onError:i,onRetrying:r,onRetryFailed:n}=e;return function(e,o,s){let a=CO({retryFunction:s.value,settings:t,onError(t){let{error:r,retry:n,reject:s,retryFuncArgs:a}=t;i&&i.call(this,r,(()=>{var t;null!=(t=JV.get(e))&&t.has(o)?n():s(r)}),s,a)},onRetrying:(t,i)=>{var n;Kw(r)&&r(t,i),null!=(n=JV.get(e))&&n.has(o)&&(JV.get(e).get(o).stopRetry=i)},onRetryFailed:n});return s.value=function(){let t=JV.get(e);for(var i=arguments.length,r=new Array(i),n=0;n<i;n++)r[n]=arguments[n];return t?t.set(o,{args:r}):JV.set(e,new Map([[o,{args:r}]])),a.apply(this,r).finally((()=>{var t;return null==(t=JV.get(e))?void 0:t.delete(o)}))},s}}function QV(e){let{fnName:t,callback:i,validateArgs:r=!0}=e;return function(e,n,o){let s=o.value;return o.value=function(){for(var n,o,a=arguments.length,c=new Array(a),l=0;l<a;l++)c[l]=arguments[l];if(null!=(n=JV.get(e))&&n.has(t)){let{stopRetry:n,args:s}=JV.get(e).get(t),a=!0;if(r)for(let e of s)if(!c.find((t=>t===e))){a=!1;break}a&&(i&&i.apply(this,c),n&&n(),null==(o=JV.get(e))||o.delete(t))}return s.apply(this,c)},o}}var zV=class{constructor(e){this._signalInfo={tinyId:void 0,clientIp:"",signalIp:"",relayIp:"",relayInnerIp:"",relayPort:0},this._apiSuccessRateMap=new Map,this._eventMap=new Map,this._frameWorkType=e.frameWorkType||30,this._component=e.component||0,this.connectionType=e.connectionType||1,this._language=e.language||0,this._room=e.room,this._keyPrefix="key_point",this._log=wO.createLogger({id:"kpm",userId:this._room.userId,sdkAppId:this._room.sdkAppId}),Object.getOwnPropertyNames(this.__proto__).forEach((e=>{e.startsWith("handle")&&Kw(this[e])&&(this[e]=function(e){let{fn:t,context:i}=e;return function(){try{for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];let o=t.apply(i,r);return tO(o)?o.catch((e=>wO.error("".concat(t.name,"() error observed ").concat(e)))):o}catch(e){wO.error("".concat(t.name,"() error observed ").concat(e))}}}({fn:this[e],context:this}))})),this.initData(),this.installEvents(),this._intervalId=SP.run(Ew,this.setStorage.bind(this),{delay:2e4})}get _storageKey(){return"".concat(this._keyPrefix,"_").concat(this._room.userId)}initData(){this._firstPublishedUserList=[],this._networkQuality={totalUplinkRTT:0,totalUplinkLoss:0,count:0,totalDownlinkRTTAndLossMap:new Map},this._basicInfo={string_sdk_version:zk,uint32_os_type:15,string_device_name:"",string_http_user_agent:navigator.userAgent,string_os_version:"",uint32_avg_rtt:0,uint32_avg_up_loss:0,uint32_scene:"live"===this._room.scene?1:0,uint32_joining_duration:0,uint32_networkType:TD[Pw()],uint32_framework:this._frameWorkType,uint32_component:this._component,uint32_connection_type:this.connectionType,uint32_caller_coding_language:this._language,string_domain:location.hostname},this._pathJoinRoom={uint64_start_time:0,uint64_send_request_acc_ip_cmd_start_time:0,uint64_send_request_acc_ip_cmd_end_time:0,uint64_send_request_enter_room_cmd_start_time:0,uint64_send_request_enter_room_cmd_end_time:0,uint64_send_first_video_frame_time:0,uint64_recv_userlist_time:0,uint64_end_time:0,int32_send_request_acc_ip_cmd_ret:0,int32_send_request_enter_room_cmd_ret:0,int32_end_ret:0},this._pathLeaveRoom={uint64_start_time:0,uint64_send_request_exit_room_cmd_start_time:0,uint64_send_request_exit_room_cmd_end_time:0,uint64_end_time:0,int32_send_request_exit_room_cmd_ret:0,int32_end_ret:0},this._localStreamStat={totalVideoBitrate:0,totalVideoFPS:0,totalVideoHeight:0,totalVideoWidth:0,totalAudioLevel:0,videoCount:0,audioLevelCount:0,publishStartTime:0,statsToReport:{uint32_audio_capture_db:0,uint32_video_big_capture_fps:0,uint32_video_big_bitrate:0,uint32_video_big_resolution:0}},this._pathMainVideoMap=new Map,this._pathMainAudioMap=new Map,this._pathAuxiliaryMap=new Map,this._remoteStreamStatMap=new Map,this._apiSuccessRateMap.clear(),jk().then((e=>{this._basicInfo.string_os_version=Jk(),e&&(this._basicInfo.string_device_name=e.model)}))}addEvent(e,t){return this._eventMap.set(e,t),AO.on(e,t),this}installEvents(){this.handleUnload=this.handleUnload.bind(this),window.addEventListener("unload",this.handleUnload),this._room.once("banned",(()=>this.handleLeaveSuccess({room:this._room,roomId:this._room.roomId}))),this.addEvent(kO.JOIN_START,this.handleJoinStart).addEvent(kO.JOIN_SCHEDULE_SUCCESS,this.handleJoinScheduleSuccess).addEvent(kO.JOIN_SIGNAL_CONNECTION_START,this.handleSignalConnectionStart).addEvent(kO.JOIN_SIGNAL_CONNECTION_END,this.handleSignalConnectionEnd).addEvent(kO.JOIN_SEND_CMD,this.handleJoinSendCMD).addEvent(kO.JOIN_RECEIVED_CMD_RES,this.handleJoinReceivedCMDResponce).addEvent(kO.JOIN_SUCCESS,this.handleJoinSuccess).addEvent(kO.JOIN_FAILED,this.handleJoinFailed).addEvent(kO.LEAVE_START,this.handleLeaveStart).addEvent(kO.LEAVE_SUCCESS,this.handleLeaveSuccess).addEvent(kO.LEAVE_SEND_CMD,this.handleLeaveSendCMD).addEvent(kO.LOCAL_TRACK_CAPTURE_START,this.handleTrackCaptureStart).addEvent(kO.LOCAL_TRACK_CAPTURE_SUCCESS,this.handleTrackCaptureSuccess).addEvent(kO.LOCAL_TRACK_CAPTURE_FAILED,this.handleTrackCaptureFailed).addEvent(kO.PUBLISH_START,this.handlePublishStart).addEvent(kO.SEND_FIRST_VIDEO_FRAME,this.handleSendFirstVideoFrame).addEvent(kO.SUBSCRIBE_START,this.handleSubscribeStart).addEvent(kO.SUBSCRIBE_SUCCESS,this.handleSubscribed).addEvent(kO.PLAY_TRACK_START,this.handlePlayStart).addEvent(kO.VIDEO_LOADED_DATA,this.handleVideoLoadedData).addEvent(kO.PLAYER_STATE_CHANGED,(e=>{let{track:t,state:i,type:r}=e;!eO(t)||!this.hitTest(t.room)||"PLAYING"===i&&(r===RD.AUDIO?this.handleAudioPlaying(t):this.handleVideoPlaying(t))})).addEvent(kO.NETWORK_QUALITY,this.handleNetworkQuality).addEvent(kO.HEARTBEAT_REPORT,this.handleHeartbeatStats).addEvent(kO.RECEIVED_PUBLISHED_USER_LIST,this.handleReceivedPublishUserList).addEvent(kO.REMOTE_PUBLISH_STATE_CHANGED,(e=>{let{room:t,prevMuteState:i,muteState:r}=e;if(!this.hitTest(t))return;let n=i.hasAudio||i.hasVideo||i.hasSmall,o=i.hasAuxiliary,s=r.hasAudio||r.hasVideo||r.hasSmall,a=r.hasAuxiliary;!n&&s&&this.handleRemoteStreamAdded(r.userId,"main"),!o&&a&&this.handleRemoteStreamAdded(r.userId,"auxiliary")})).addEvent(kO.API_SUCCESS_RATE,this.handleAPISuccessRate).addEvent(kO.SINGLE_CONNECTION_STAT,(e=>{let{room:t,stat:i}=e;this.hitTest(t)&&(this._pathJoinRoom.int32_ice_cost=i.ice,this._pathJoinRoom.int32_dtls_cost=i.dtls,this._pathJoinRoom.int32_peer_connection_cost=i.peerConnection)}))}uninstallEvents(){window.removeEventListener("unload",this.handleUnload),this._eventMap.forEach(((e,t)=>AO.off(t,e))),this._eventMap.clear()}destroy(){this.uninstallEvents(),SP.clearTask(this._intervalId)}handleUnload(){this._room.isJoined&&this.handleLeaveSuccess({room:this._room,roomId:this._room.roomId})}handleJoinStart(e){this.hitTest(e.room)&&(0===this._pathJoinRoom.uint64_start_time&&(this._pathJoinRoom.uint64_start_time=Date.now(),this.checkStorage()),e.params&&(Qw(e.params.frameWorkType)||(this._frameWorkType=e.params.frameWorkType,this._basicInfo.uint32_framework=this._frameWorkType),Qw(e.params.component)||(this._component=e.params.component,this._basicInfo.uint32_component=this._component),Qw(e.params.language)||(this._language=e.params.language,this._basicInfo.uint32_caller_coding_language=this._language)))}handleJoinScheduleSuccess(e){let{room:t,detailCost:i}=e;if(this.hitTest(t)&&i){let{totalCost:e,local:t,dns:r,tcp:n,tls:o,request:s,response:a}=i;this._pathJoinRoom.int32_schedule_cost=e,this._pathJoinRoom.int32_schedule_local=t,this._pathJoinRoom.int32_schedule_dns=r,this._pathJoinRoom.int32_schedule_tcp=n,this._pathJoinRoom.int32_schedule_tls=o,this._pathJoinRoom.int32_schedule_request=s,this._pathJoinRoom.int32_schedule_response=a}}handleSignalConnectionStart(e){let{room:t}=e;this.hitTest(t)&&0===this._pathJoinRoom.uint64_send_request_acc_ip_cmd_start_time&&(this._pathJoinRoom.uint64_send_request_acc_ip_cmd_start_time=Date.now())}handleSignalConnectionEnd(e){let{room:t,error:i}=e;this.hitTest(t)&&0===this._pathJoinRoom.uint64_send_request_acc_ip_cmd_end_time&&(this._pathJoinRoom.uint64_send_request_acc_ip_cmd_end_time=Date.now(),i&&(this._pathJoinRoom.int32_send_request_acc_ip_cmd_ret=i instanceof ab?Number(i.getExtraCode()||i.getCode()):ob.UNKNOWN,this._pathJoinRoom.int32_end_ret=this._pathJoinRoom.int32_send_request_acc_ip_cmd_ret))}handleJoinSendCMD(e){this.hitTest(e.room)&&0===this._pathJoinRoom.uint64_send_request_enter_room_cmd_start_time&&(this._pathJoinRoom.uint64_send_request_enter_room_cmd_start_time=Date.now())}handleJoinReceivedCMDResponce(e){this.hitTest(e.room)&&0===this._pathJoinRoom.uint64_send_request_enter_room_cmd_end_time&&(this._pathJoinRoom.uint64_send_request_enter_room_cmd_end_time=Date.now(),this._pathJoinRoom.int32_send_request_enter_room_cmd_ret=e.code,0!==e.code&&(this._pathJoinRoom.int32_end_ret=this._pathJoinRoom.int32_send_request_enter_room_cmd_ret))}handleJoinSuccess(e){this.hitTest(e.room)&&0===this._pathJoinRoom.uint64_end_time&&(this._pathJoinRoom.uint64_end_time=Date.now(),this._pathJoinRoom.int32_end_ret=0,this._signalInfo=e.room.getSignalInfo())}handleJoinFailed(e){let{room:t,error:i}=e;this.hitTest(t)&&(this._pathJoinRoom.uint64_end_time=Date.now(),0===this._pathJoinRoom.int32_end_ret&&(this._pathJoinRoom.int32_end_ret=i.code||this._pathJoinRoom.int32_send_request_enter_room_cmd_ret||this._pathJoinRoom.int32_send_request_acc_ip_cmd_ret),setTimeout((()=>{this.report()})))}handleReceivedPublishUserList(e){this.hitTest(e.room)&&0===this._pathJoinRoom.uint64_recv_userlist_time&&(this._pathJoinRoom.uint64_recv_userlist_time=Date.now(),this._firstPublishedUserList=e.publishedUserList||[])}handleSendFirstVideoFrame(e){let{room:t}=e;!this.hitTest(t)||0===this._pathJoinRoom.uint64_send_first_video_frame_time&&0!==this._pathJoinRoom.uint64_start_time&&(this._pathJoinRoom.uint64_send_first_video_frame_time=Date.now())}handleLeaveStart(e){this.hitTest(e.room)&&(this._pathLeaveRoom.uint64_start_time=Date.now())}handleLeaveSuccess(e){this.hitTest(e.room)&&0===this._pathLeaveRoom.uint64_end_time&&(this._pathLeaveRoom.uint64_end_time=Date.now(),0!==this._pathJoinRoom.uint64_end_time?this._basicInfo.uint32_joining_duration=this._pathLeaveRoom.uint64_end_time-this._pathJoinRoom.uint64_end_time:this._log.warn("pathJoinRoom endTime is 0"),this.report())}handleLeaveSendCMD(e){this.hitTest(e.room)&&(this._pathLeaveRoom.uint64_send_request_exit_room_cmd_start_time=Date.now(),this._pathLeaveRoom.uint64_send_request_exit_room_cmd_end_time=Date.now())}handleRemoteStreamAdded(e,t){var i;let r="".concat(e,"_").concat(t);if(!this._remoteStreamStatMap.has(r)){let n={userId:e,totalVideoFPS:0,totalVideoBitrate:0,totalAudioLevel:0,totalAudioBitrate:0,totalLoss:0,audioCount:0,audioLevelCount:0,videoCount:0,networkQualityCount:0,streamAddedTime:Date.now(),subscribeStartTime:0,subscribedTime:0,playStreamTime:0,statsToReport:GA(WA({},XV),{msg_user_info:new $V({userId:e,tinyId:null==(i=this._room.remotePublishedUserMap.get(e))?void 0:i.tinyId,role:20})})};n.statsToReport.uint32_stream_type="main"===t?2:7,this._remoteStreamStatMap.set(r,n)}}handleSubscribeStart(e){let{room:t,remotePublishedUser:i,streamType:r,subscribeState:n}=e;if(!this.hitTest(t))return;let{userId:o,tinyId:s,role:a}=i,c=new $V({userId:o,tinyId:s,role:"anchor"===a?20:21}),l=Date.now(),u="".concat(o,"_").concat(r),d=this._remoteStreamStatMap.get(u);d&&0===d.subscribeStartTime&&(d.subscribeStartTime=l),"main"===r?(i.muteState.hasVideo&&(n.video||n.smallVideo)&&!this._pathMainVideoMap.has(u)&&this._pathMainVideoMap.set(u,{statsToReport:{msg_user_info:c,uint64_start_enter_time:this._pathJoinRoom.uint64_start_time,uint64_render_first_frame_time:0,uint64_combine_first_frame_time:0},userId:o,sendSubscribeCMDTime:l}),i.muteState.hasAudio&&n.audio&&!this._pathMainAudioMap.has(u)&&this._pathMainAudioMap.set(u,{statsToReport:{msg_user_info:c,uint64_start_enter_time:this._pathJoinRoom.uint64_start_time,uint64_play_first_frame_time:0},userId:o,sendSubscribeCMDTime:l})):i.muteState.hasAuxiliary&&n.auxiliary&&!this._pathAuxiliaryMap.has(u)&&this._pathAuxiliaryMap.set(u,{sendSubscribeCMDTime:l})}handleSubscribed(e){let{room:t,remotePublishedUser:i,streamType:r}=e;if(this.hitTest(t)){let e="".concat(i.userId,"_").concat(r),t=this._remoteStreamStatMap.get(e);t&&0===t.subscribedTime&&(t.subscribedTime=Date.now())}}handlePlayStart(e){let{track:t}=e;if(!eO(t)||!this.hitTest(t.room))return;let i="".concat(t.userId,"_").concat(t.streamType),r=this._remoteStreamStatMap.get(i);0===(null==r?void 0:r.playStreamTime)&&(r.playStreamTime=Date.now())}handleVideoLoadedData(e){let{track:t}=e;if(!eO(t)||!this.hitTest(t.room))return;let i="".concat(t.userId,"_").concat(t.streamType),r=this._pathMainVideoMap.get(i);r&&0===r.statsToReport.uint64_combine_first_frame_time&&(r.statsToReport.uint64_combine_first_frame_time=Date.now())}handleVideoPlaying(e){let t="".concat(e.userId,"_").concat(e.streamType),i=Date.now(),r=this._pathMainVideoMap.get(t),n=this._remoteStreamStatMap.get(t);if(r&&(0===r.statsToReport.uint64_render_first_frame_time&&(r.statsToReport.uint64_render_first_frame_time=i),n)){let{statsToReport:e,playStreamTime:t,subscribedTime:o}=n;0===e.uint32_video_render_first&&t-o<=100&&(e.uint32_video_render_first=i-r.sendSubscribeCMDTime)}let o=this._pathAuxiliaryMap.get(t);if(o&&n){let{statsToReport:e,playStreamTime:t,subscribedTime:r}=n;0===e.uint32_video_render_first&&t-r<=100&&(e.uint32_video_render_first=i-o.sendSubscribeCMDTime)}}handleAudioPlaying(e){let t="".concat(e.userId,"_").concat(e.streamType),i=this._pathMainAudioMap.get(t);i&&0===i.statsToReport.uint64_play_first_frame_time&&(i.statsToReport.uint64_play_first_frame_time=Date.now())}handleNetworkQuality(e){this.hitTest(e.room)&&(this._networkQuality.totalUplinkLoss+=e.uplink.loss,this._networkQuality.totalUplinkRTT+=e.uplink.rtt,this._networkQuality.count++,e.downlinks.forEach((e=>{let{rtt:t,loss:i,userId:r,videoDelay:n,audioDelay:o}=e,s=this._networkQuality.totalDownlinkRTTAndLossMap.get(r);if(s)s.totalRTT+=t,s.totalLoss+=i,n&&(s.totalVideoDelay=(s.totalVideoDelay||0)+n,s.videoDelayCount=(s.videoDelayCount||0)+1),o&&(s.totalAudioDelay=(s.totalAudioDelay||0)+o,s.audioDelayCount=(s.audioDelayCount||0)+1),s.count++;else{let e,s,a,c;n&&(s=n,a=1),o&&(e=o,c=1),this._networkQuality.totalDownlinkRTTAndLossMap.set(r,{totalRTT:t,totalLoss:i,count:1,totalAudioDelay:e,totalVideoDelay:s,audioDelayCount:c,videoDelayCount:a})}})))}handleHeartbeatStats(e){if(this.hitTest(e.room)){let{msg_up_stream_info:t,msg_down_stream_info:i}=e.report;if(t.msg_video_status[0]){let{uint32_video_codec_bitrate:e,uint32_video_enc_fps:i,uint32_video_width:r,uint32_video_height:n}=t.msg_video_status[0];this._localStreamStat.totalVideoBitrate+=e,this._localStreamStat.totalVideoFPS+=i,this._localStreamStat.totalVideoWidth+=r,this._localStreamStat.totalVideoHeight+=n,this._localStreamStat.videoCount++}if(t.msg_audio_status){let{uint32_audio_level:e}=t.msg_audio_status;Math.floor(e/bw*100)>0&&(this._localStreamStat.totalAudioLevel+=e/bw,this._localStreamStat.audioLevelCount++)}i.forEach((e=>{let{msg_user_info:t,msg_audio_status:i,msg_video_status:r}=e,n=t.str_identifier,o=this._room.remotePublishedUserMap.get(n);if(r.forEach((e=>{let t=2===e.uint32_video_stream_type,i=7===e.uint32_video_stream_type,r="".concat(n,"_").concat(t?"main":"auxiliary"),s=this._remoteStreamStatMap.get(r);if(s&&(t&&(null==o?void 0:o.remoteVideoTrack.isSubscribed)||i&&(null==o?void 0:o.remoteAuxiliaryTrack))){s.totalVideoFPS+=e.uint32_video_receive_fps,s.totalVideoBitrate+=e.uint32_video_codec_bitrate,s.videoCount++,0===s.statsToReport.uint32_video_width&&(s.statsToReport.uint32_video_width=e.uint32_video_width),0===s.statsToReport.uint32_video_height&&(s.statsToReport.uint32_video_height=e.uint32_video_height);let i=t?o.remoteVideoTrack:o.remoteAuxiliaryTrack;i.stat.jitterBufferDelay&&(s.videoJitterBufferDelay=i.stat.jitterBufferDelay),i.stat.framesReceived&&(s.statsToReport.uint32_video_consume_render_rate=Math.floor(i.stat.framesDecoded/i.stat.framesReceived*HA(10,6)))}})),i){let e="".concat(n,"_","main"),t=this._remoteStreamStatMap.get(e);this._remoteStreamStatMap.has(e)&&t&&(null==o?void 0:o.remoteAudioTrack.isSubscribed)&&(t.totalAudioBitrate+=i.uint32_audio_codec_bitrate,t.audioCount++,o.remoteAudioTrack.stat.jitterBufferDelay&&(t.audioJitterBufferDelay=o.remoteAudioTrack.stat.jitterBufferDelay),Math.floor(i.uint32_audio_level/bw*100)>0&&(t.totalAudioLevel+=i.uint32_audio_level/bw,t.audioLevelCount++))}}))}}handlePublishStart(e){let{room:t}=e;this.hitTest(t)&&0===this._localStreamStat.publishStartTime&&(this._localStreamStat.publishStartTime=Date.now())}handleTrackCaptureStart(e){let{track:t}=e;1===t.mediaType&&!this._pathJoinRoom.uint64_init_audio_start_time&&(this._pathJoinRoom.uint64_init_audio_start_time=Date.now()),4===t.mediaType&&!this._pathJoinRoom.uint64_init_camera_start_time&&(this._pathJoinRoom.uint64_init_camera_start_time=Date.now())}handleTrackCaptureSuccess(e){let{track:t}=e;1===t.mediaType&&!this._pathJoinRoom.uint64_init_audio_end_time&&(this._pathJoinRoom.int32_init_audio_ret=0,this._pathJoinRoom.uint64_init_audio_end_time=Date.now()),4===t.mediaType&&!this._pathJoinRoom.uint64_init_camera_end_time&&(this._pathJoinRoom.int32_init_camera_ret=0,this._pathJoinRoom.uint64_init_camera_end_time=Date.now())}handleTrackCaptureFailed(e){let{track:t,error:i}=e,r={NotFoundError:1,NotAllowedError:2,NotReadableError:3,OverConstrainedError:4,AbortError:5,InvalidStateError:6,SecurityError:7,TypeError:8}[i.name]||(i instanceof ab?i.getExtraCode()||i.getCode():ob.UNKNOWN);1===t.mediaType&&!this._pathJoinRoom.uint64_init_audio_end_time&&(this._pathJoinRoom.int32_init_audio_ret=r,this._pathJoinRoom.uint64_init_audio_end_time=Date.now()),4===t.mediaType&&!this._pathJoinRoom.uint64_init_camera_end_time&&(this._pathJoinRoom.int32_init_camera_ret=r,this._pathJoinRoom.uint64_init_camera_end_time=Date.now())}handleAPISuccessRate(e){let{room:t,apiName:i,error:r,cost:n}=e;if(!this.hitTest(t))return;let o=ZV[i],s={uint32_function_request_type:o,uint32_avg_value:0,uint32_max_value:0,uint32_request_count:1,uint32_success_count:0,msg_error_code:[]};if(r){let e=r.extraCode||r.code||ob.UNKNOWN;EP.logFailedEvent({eventType:i,code:e,userId:this._room.userId,error:r});let t={int32_error_code:e,error_count:1};s.msg_error_code.push(t)}else Yw(n)&&(EP.logSuccessEvent({eventType:i,userId:this._room.userId}),s.uint32_avg_value=n,s.uint32_max_value=n,s.uint32_success_count=1);let a=this._apiSuccessRateMap.get(o);a?(a.uint32_success_count+s.uint32_success_count>0&&(a.uint32_avg_value=(a.uint32_avg_value*a.uint32_success_count+s.uint32_avg_value)/(a.uint32_success_count+s.uint32_success_count)),a.uint32_max_value=Math.max(a.uint32_max_value,s.uint32_max_value),a.uint32_request_count+=1,a.uint32_success_count=a.uint32_success_count+s.uint32_success_count,s.msg_error_code.forEach((e=>{let t=a.msg_error_code.find((t=>t.int32_error_code===e.int32_error_code));t?t.error_count+=1:a.msg_error_code.push(e)}))):this._apiSuccessRateMap.set(o,s)}hasVideoFlag(e){return this._firstPublishedUserList.findIndex((t=>t.userId===e&&t.flag&kD))>=0}hasAudioFlag(e){return this._firstPublishedUserList.findIndex((t=>t.userId===e&&t.flag&OD))>=0}hasAuxFlag(e){return this._firstPublishedUserList.findIndex((t=>t.userId===e&&t.flag&wD))>=0}hitTest(e){return e===this._room}checkStorage(){return XA(this,null,(function*(){try{let e=OO.getItem(this._storageKey);e&&(yield this.upload(e),OO.deleteItem(this._storageKey))}catch(e){this._log.warn(e)}}))}setStorage(){this.prepareReport();let e=this.getReportData();0!==e.msg_path_enter_room.uint64_start_time&&OO.setItem(this._storageKey,e)}prepareReport(){if(this._networkQuality.count>0&&(this._basicInfo.uint32_avg_rtt=Math.floor(this._networkQuality.totalUplinkRTT/this._networkQuality.count),this._basicInfo.uint32_avg_up_loss=Math.floor(this._networkQuality.totalUplinkLoss/this._networkQuality.count)),this._localStreamStat.videoCount>0){this._localStreamStat.statsToReport.uint32_video_big_capture_fps=Math.floor(this._localStreamStat.totalVideoFPS/this._localStreamStat.videoCount),this._localStreamStat.statsToReport.uint32_video_big_bitrate=Math.floor(this._localStreamStat.totalVideoBitrate/this._localStreamStat.videoCount);let e=Math.floor(this._localStreamStat.totalVideoWidth/this._localStreamStat.videoCount),t=Math.floor(this._localStreamStat.totalVideoHeight/this._localStreamStat.videoCount);this._localStreamStat.statsToReport.uint32_video_big_resolution=e<<16|t}this._localStreamStat.audioLevelCount>0&&(this._localStreamStat.statsToReport.uint32_audio_capture_db=Math.floor(this._localStreamStat.totalAudioLevel/this._localStreamStat.audioLevelCount*100)),this._remoteStreamStatMap.forEach(((e,t)=>{let{userId:i}=e,r=this._networkQuality.totalDownlinkRTTAndLossMap.get(i);if(r){let{totalLoss:t,count:i,audioDelayCount:n,videoDelayCount:o,totalAudioDelay:s,totalVideoDelay:a}=r;e.statsToReport.uint32_avg_down_loss=Math.floor(t/i),n&&s&&(e.statsToReport.uint32_audio_network_p2p_delay=Math.floor(s/n),e.audioJitterBufferDelay&&(e.statsToReport.uint32_p2p_delay=Math.floor(e.statsToReport.uint32_audio_network_p2p_delay+e.audioJitterBufferDelay))),o&&a&&(e.statsToReport.uint32_video_network_p2p_delay=Math.floor(a/o))}e.videoCount>0&&(e.statsToReport.uint32_video_avg_fps=Math.floor(e.totalVideoFPS/e.videoCount),e.statsToReport.uint32_video_avg_bitrate=Math.floor(e.totalVideoBitrate/e.videoCount)),e.audioCount>0&&(e.statsToReport.uint32_audio_recv_bitrate=e.statsToReport.uint32_audio_bitrate=Math.floor(e.totalAudioBitrate/e.audioCount)),e.audioLevelCount>0&&(e.statsToReport.uint32_audio_play_db=Math.floor(e.totalAudioLevel/e.audioLevelCount*100));let{callDurationCalculator:n}=this._room;n&&(e.statsToReport.uint32_audio_play_time=n.getDuration(t,RD.AUDIO),e.statsToReport.uint32_video_play_time=n.getDuration(t,RD.VIDEO)),e.statsToReport.uint32_video_render_first=Math.min(e.statsToReport.uint32_video_render_first,qV);let{badCaseDetector:o}=this._room,{dataFreeze:s,count:a}=o.getDataFreezeDuration(t),{renderFreeze:c}=o.getRenderFreezeDuration(t);e.statsToReport.uint32_video_block_count=a,e.statsToReport.uint32_video_block_time=Math.min(s,e.statsToReport.uint32_video_play_time),e.statsToReport.uint32_video_external_block_time=Math.min(c,e.statsToReport.uint32_video_play_time),o.isBlackStream(t)&&0===e.statsToReport.uint32_video_avg_fps?e.statsToReport.uint32_video_black_screen_subjective=1:e.statsToReport.uint32_video_black_screen_subjective=0,(0===e.subscribeStartTime||e.subscribeStartTime-e.streamAddedTime>100||0===e.playStreamTime)&&(this._pathMainAudioMap.delete(t),this._pathMainVideoMap.delete(t),e.statsToReport.uint32_video_render_first=0)})),this._pathMainAudioMap.forEach(((e,t)=>{this.hasAudioFlag(e.userId)?e.statsToReport.uint64_play_first_frame_time-e.statsToReport.uint64_start_enter_time>qV&&(e.statsToReport.uint64_play_first_frame_time=e.statsToReport.uint64_start_enter_time+qV):this._pathMainAudioMap.delete(t)})),this._pathMainVideoMap.forEach(((e,t)=>{this.hasVideoFlag(e.userId)?e.statsToReport.uint64_render_first_frame_time-e.statsToReport.uint64_start_enter_time>qV&&(e.statsToReport.uint64_render_first_frame_time=e.statsToReport.uint64_start_enter_time+qV):this._pathMainVideoMap.delete(t)})),this._pathJoinRoom.uint64_end_time-this._pathJoinRoom.uint64_start_time>qV&&(this._pathJoinRoom.uint64_end_time=this._pathJoinRoom.uint64_start_time+qV)}getReportData(){return{uint32_sdk_app_id:Number(this._room.sdkAppId),msg_user_info:new $V({userId:this._room.userId,tinyId:this._room.tinyId,role:"anchor"===this._room.role?20:21}),msg_basic_info:this._basicInfo,uint32_acc_ip:mO(this._signalInfo.relayIp),uint32_client_ip:mO(this._signalInfo.clientIp,!1),uint32_acc_port:this._signalInfo.relayPort||0,uint64_timestamp:Date.now(),uint32_seq:Math.floor(2147483648*Math.random()),msg_path_enter_room:this._pathJoinRoom,msg_path_exit_room:this._pathLeaveRoom,msg_path_recv_video:[...this._pathMainVideoMap.values()].map((e=>e.statsToReport)),msg_quality_statistics:[...this._remoteStreamStatMap.values()].map((e=>e.statsToReport)),str_room_name:String(this._room.roomId||0),msg_path_recv_audio:[...this._pathMainAudioMap.values()].map((e=>e.statsToReport)),uint32_info_client_ip:mO(this._signalInfo.clientIp,!1),error_code:[],msg_local_statistics:this._localStreamStat.statsToReport,msg_function_request_stats:[...this._apiSuccessRateMap.values()]}}report(){try{this.prepareReport();let e=this.getReportData();this.upload(e),OO.deleteItem(this._storageKey),this.initData()}catch(e){this._log.warn(e)}}upload(e){if(xk||0===e.msg_path_enter_room.uint64_start_time||[nD,oD,sD].findIndex((e=>e===location.host))>=0)return;let t=Number(this._room.sdkAppId),i=ww(t,pD.KEY_POINT),r=!1;navigator.sendBeacon&&(r=navigator.sendBeacon(i,JSON.stringify(e))),r||IO({url:i,body:JSON.stringify(e)})}setConnectionType(e){this.connectionType=e,this._basicInfo.uint32_connection_type=e}};zA([KV({settings:{timeout:500,retries:3}})],zV.prototype,"upload",1);var YV,qV=5e3,XV={msg_user_info:null,uint32_video_avg_fps:0,uint32_video_width:0,uint32_video_height:0,uint32_video_avg_bitrate:0,uint32_video_block_time:0,uint32_video_play_time:0,uint32_audio_block_time:0,uint32_audio_play_time:0,uint32_audio_play_db:0,uint32_avg_down_loss:0,uint32_stream_type:0,uint32_video_render_first:0,uint32_video_block_count:0,uint32_audio_block_count:0,uint32_audio_bitrate:0,uint32_video_black_screen_subjective:0,uint32_audio_recv_bitrate:0,uint32_video_external_block_time:0,uint32_video_consume_render_rate:0},$V=class{constructor(e){this.str_identifier=String(e.userId),this.str_tinyid=String(e.tinyId||0),this.uint32_role=e.role}},ZV=((YV=ZV||{})[YV.enterRoom=50001]="enterRoom",YV[YV.exitRoom=50002]="exitRoom",YV[YV.switchRole=50003]="switchRole",YV[YV.destroy=50004]="destroy",YV[YV.startLocalAudio=50005]="startLocalAudio",YV[YV.updateLocalAudio=50006]="updateLocalAudio",YV[YV.stopLocalAudio=50007]="stopLocalAudio",YV[YV.startLocalVideo=50008]="startLocalVideo",YV[YV.updateLocalVideo=50009]="updateLocalVideo",YV[YV.stopLocalVideo=50010]="stopLocalVideo",YV[YV.startScreenShare=50011]="startScreenShare",YV[YV.updateScreenShare=50012]="updateScreenShare",YV[YV.stopScreenShare=50013]="stopScreenShare",YV[YV.enableAudioVolumeEvaluation=50014]="enableAudioVolumeEvaluation",YV[YV.startRemoteVideo=50015]="startRemoteVideo",YV[YV.updateRemoteVideo=50016]="updateRemoteVideo",YV[YV.stopRemoteVideo=50017]="stopRemoteVideo",YV[YV.muteRemoteAudio=50018]="muteRemoteAudio",YV[YV.setRemoteAudioVolume=50019]="setRemoteAudioVolume",YV[YV.startMixTranscode=50020]="startMixTranscode",YV[YV.stopMixTranscode=50021]="stopMixTranscode",YV[YV.startPublishCDNStream=50022]="startPublishCDNStream",YV[YV.stopPublishCDNStream=50023]="stopPublishCDNStream",YV[YV.PeerConnectionConnect=50024]="PeerConnectionConnect",YV[YV.PeerConnectionReconnect=50025]="PeerConnectionReconnect",YV[YV.WebsocketConnect=50026]="WebsocketConnect",YV[YV.WebsocketReconnect=50027]="WebsocketReconnect",YV[YV.schedule=50028]="schedule",YV[YV.SPCConnect=50029]="SPCConnect",YV[YV.SPCReconnect=50030]="SPCReconnect",YV[YV.videoCtxGl=50031]="videoCtxGl",YV[YV.videoCtxGlRecover=50032]="videoCtxGlRecover",YV[YV.videoCtx2d=50033]="videoCtx2d",YV[YV["CDNStreaming.startPlugin"]=50034]="CDNStreaming.startPlugin",YV[YV["CDNStreaming.updatePlugin"]=50035]="CDNStreaming.updatePlugin",YV[YV["CDNStreaming.stopPlugin"]=50036]="CDNStreaming.stopPlugin",YV[YV["AIDenoiser.startPlugin"]=50037]="AIDenoiser.startPlugin",YV[YV["AIDenoiser.updatePlugin"]=50038]="AIDenoiser.updatePlugin",YV[YV["AIDenoiser.stopPlugin"]=50039]="AIDenoiser.stopPlugin",YV[YV["AudioMixer.startPlugin"]=50040]="AudioMixer.startPlugin",YV[YV["AudioMixer.updatePlugin"]=50041]="AudioMixer.updatePlugin",YV[YV["AudioMixer.stopPlugin"]=50042]="AudioMixer.stopPlugin",YV),ex=zV,tx=class{constructor(){YA(this,"_startTime"),YA(this,"_endTime"),this._startTime=0,this._endTime=0,this.start()}start(){0===this._startTime&&(this._startTime=sO())}stop(){0===this._endTime&&(this._endTime=sO())}getDuration(){return 0===this._endTime?sO()-this._startTime:this._endTime-this._startTime}get endTime(){return this._endTime}},ix=null,rx=!0;function nx(e){qw(e)&&e!==rx&&(rx=e,wO.info("setIsNeedToSchedule ".concat(e)))}AO.on("28",(()=>nx(!0))),AO.on("63",(()=>nx(!0))),AO.on("84",(()=>nx(!0))),AO.on("201",(e=>{"RECONNECTING"===e.state&&nx(!0)})),AO.on("202",(e=>{"RECONNECTING"===e.state&&nx(!0)}));var ox={main:"",backup:""};function sx(e){$w(e)?(ox.main=e[0],ox.backup=e[1]):ox.main=e}function ax(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:RD.MAIN;return t=Dw(e)?i===RD.MAIN?dw.MAIN_OVERSEA:dw.BACKUP_OVERSEA:i===RD.MAIN?dw.MAIN:dw.BACKUP,"https://".concat(ox[i]||t,"/api/v1/config")}function cx(e,t,i){return new Promise(((r,n)=>{IO({url:e,body:t,timeout:i.timeout}).then((e=>{0===e.data.code?r(e.data.data):n({code:e.data.code,message:e.data.msg})})).catch(n)}))}var lx=(e,t)=>CO({retryFunction:cx,settings:{retries:3,timeout:0},onError:t,onRetrying:e}),ux=QA($A(),1),dx=[-1,-1,-1,1,1,-1,1,1],hx=[0,0,0,1,1,0,1,1],px=class extends _P{constructor(e,t){super(),this.context=e,YA(this,"name"),YA(this,"input"),YA(this,"output"),YA(this,"texture"),YA(this,"image"),YA(this,"ctx2d",null),YA(this,"fbo"),YA(this,"width",0),YA(this,"height",0),YA(this,"x",0),YA(this,"y",0),YA(this,"program"),YA(this,"vertexShader"),YA(this,"fragmentShader"),YA(this,"totalFrames",0),YA(this,"dropFrames",0),YA(this,"matchInputSize",!0),YA(this,"texCoordBuffer"),YA(this,"positionBuffer"),YA(this,"lastInfo",{timestamp:0,totalFrames:0,x:0,y:0,width:0,height:0,fps:0}),YA(this,"_canvas",null),this.context.once("disconnect",(()=>{"closed"!==this.state&&this.close()})),this.name=t.name,this.matchInputSize=!1!==t.matchInputSize,this.width=t.width||e.width,this.height=t.height||e.height;let i=e._gl;if(i)try{!1!==t.createTexture&&(this.texture=i.createTexture()),this.texCoordBuffer=this.createBuffer(hx),this.positionBuffer=this.createBuffer(dx),this.useTexture((()=>{i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)})),t.useFbo&&(this.fbo=i.createFramebuffer(),this.useBufferFrame((()=>{this.useTexture((()=>{i.texImage2D(i.TEXTURE_2D,0,i.RGBA,this.width,this.height,0,i.RGBA,i.UNSIGNED_BYTE,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0,i.TEXTURE_2D,this.texture,0)}))}))),t.useDefaultProgram&&(this.program=this.context.defaultProgam),t.vertexShaderSource&&t.fragmentShaderSource&&(this.vertexShader=e.createShader(i.VERTEX_SHADER,t.vertexShaderSource),this.fragmentShader=e.createShader(i.FRAGMENT_SHADER,t.fragmentShaderSource),this.program=e.createProgram(this.vertexShader,this.fragmentShader))}catch(e){this.context.destroy("".concat(this.name," init failed"),e)}else if(e.ctx2d&&t.create2d){let e=document.createElement("canvas"),t="function"==typeof e.transferControlToOffscreen?e.transferControlToOffscreen():e;t.width=this.width,t.height=this.height,this.ctx2d=t.getContext("2d"),this.image=t,this._canvas=t}}connect(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return e.addInput(this,...i),this.output=e,e}addInput(e){this.input=e,this.matchInputSize&&e.width&&e.height&&this.resize(e.width,e.height)}requestFrame(e){return!!(this.context._gl&&this.render(e)||this.context.ctx2d&&this.render2d(e))&&(this.totalFrames++,!0)}render2d(e){var t;return!(null==(t=this.input)||!t.requestFrame(e))&&this.draw2d(this.input.image,0,0,this.width,this.height)}disconnect(){for(var e,t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];null==(e=this.output)||e.removeInput(this,...i),delete this.output}removeInput(e){delete this.input}close(){var e,t;null==(e=this.output)||e.removeInput(this),delete this.output,null==(t=this.input)||t.disconnect();let i=this.context._gl;i&&(i.deleteBuffer(this.texCoordBuffer),i.deleteBuffer(this.positionBuffer),this.fbo&&i.deleteFramebuffer(this.fbo),this.texture&&i.deleteTexture(this.texture),this.vertexShader&&i.deleteShader(this.vertexShader),this.fragmentShader&&i.deleteShader(this.fragmentShader),this.program&&this.program!==this.context.defaultProgam&&i.deleteProgram(this.program)),this._canvas&&(this._canvas.width=0,this._canvas.height=0,this.ctx2d=null),this.removeAllListeners()}useTexture(e,t){this.texture&&this.context.useTexture(this.texture,e,t)}useInputTexture(e,t){this.context.useTexture(this.input.texture,e,t)}useProgram(){this.context._gl.useProgram(this.program)}useBufferFrame(e){let t=this.context._gl;t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),e(),t.bindFramebuffer(t.FRAMEBUFFER,null)}createBuffer(e){let t=this.context._gl,i=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW),i}setTexBuffer(e){let t=this.context._gl,i=this.texCoordBuffer;t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW)}setPosBuffer(e){let t=this.context._gl,i=this.positionBuffer;t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW)}changeBufferData(e,t){let i=this.context._gl;i.bindBuffer(i.ARRAY_BUFFER,e),i.bufferData(i.ARRAY_BUFFER,new Float32Array(t),i.STATIC_DRAW)}setAttributes(e){let t=this.context._gl;for(let i in e){let r=t.getAttribLocation(this.program,i);t.bindBuffer(t.ARRAY_BUFFER,e[i]),t.enableVertexAttribArray(r),t.vertexAttribPointer(r,2,t.FLOAT,!1,0,0)}}getVertexPoint(e,t){return[e/this.width*2-1,t/this.height*2-1]}layout2texCoords(e){return[...this.getVertexPoint(e.x,e.y),...this.getVertexPoint(e.x,e.y+e.height),...this.getVertexPoint(e.x+e.width,e.y),...this.getVertexPoint(e.x+e.width,e.y+e.height)]}resize(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this._canvas&&(this._canvas.width=e,this._canvas.height=t),this.texture&&this.fbo&&this.useTexture((i=>i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,null))),this.output&&this.output.matchInputSize&&this.output.resize(e,t))}draw2d(e,t,i,r,n){return!(!this.ctx2d||!e||(e instanceof ImageData?this.ctx2d.putImageData(e,t,i):this.ctx2d.drawImage(e,t,i,r,n),0))}getInfo(){var e;let{totalFrames:t,x:i,y:r,width:n,height:o}=this,s=Date.now(),a=(t-this.lastInfo.totalFrames)/((s-this.lastInfo.timestamp)/1e3)>>0;return this.lastInfo={totalFrames:t,x:i,y:r,width:n,height:o,timestamp:s,fps:a},WA({parent:null==(e=this.input)?void 0:e.getInfo()},this.lastInfo)}};zA([hP(_P.INIT,"connected")],px.prototype,"connect",1),zA([hP("connected",_P.INIT,{ignoreError:!0})],px.prototype,"disconnect",1),zA([hP([],"closed")],px.prototype,"close",1);var mx=[0,1,0,0,1,1,1,0],_x=class extends px{constructor(e,t){super(e,Object.assign({useDefaultProgram:!0,createTexture:!1,name:"destination"},t)),YA(this,"_intervalId",0),YA(this,"_sequence",0),e._gl?this.setTexBuffer(mx):e.ctx2d&&(this.ctx2d=e.ctx2d)}start(e){this._intervalId=SP.run("intervalInWorker",(()=>{e!==this.context.frameRate&&(SP.clearTask(this._intervalId),this.start(this.context.frameRate)),this.requestFrame(this._sequence++);let t=this.context._gl;t&&t.getError()!==t.NO_ERROR&&this.context.destroy("".concat(this.name," req ").concat(this._sequence," render ").concat(this.totalFrames," faild ").concat(t.getError()))}),{fps:this.context.frameRate})}render(e){var t;return!(null==(t=this.input)||!t.requestFrame(e)||(this.useProgram(),this.useInputTexture((e=>{this.setAttributes({a_position:this.positionBuffer,a_texCoord:this.texCoordBuffer}),e.drawArrays(e.TRIANGLE_STRIP,0,4)})),0))}addInput(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];super.addInput(e,...i),this.start(this.context.frameRate)}removeInput(e){super.removeInput(e),SP.clearTask(this._intervalId)}},fx=class extends _x{constructor(e,t){super(e,t),YA(this,"_videoTrack"),[this._videoTrack]=e._canvas.captureStream(e.frameRate).getVideoTracks();let i=e=>{let t=()=>this._videoTrack.removeEventListener(e,i),i=()=>{t(),this.context.destroy("video track ".concat(e))};this.once("closed",t),this._videoTrack.addEventListener(e,i)};e._gl&&i("mute"),i("ended")}get videoTrack(){return this._videoTrack}close(){super.close(),this._videoTrack.stop()}resize(e,t){super.resize(e,t),this.context.setSize(e,t)}},gx=class extends fx{constructor(e,t){super(e,{name:"smallDestination"}),this.resolution=t}resize(e,t){let i,r=e*t,n=this.resolution.width*this.resolution.height;wO.info("big res: ".concat(e,"*").concat(t," small res: ").concat(this.resolution.width,"*").concat(this.resolution.height," ")),r>n?i=r/n:(wO.warn("Small stream resolution is not smaller than big stream, which is invalid. big: ".concat(e," * ").concat(t," small: ").concat(this.resolution.width," * ").concat(this.resolution.height)),i=r/19200),super.resize(e/Math.sqrt(i),t/Math.sqrt(i))}},Tx=class extends px{constructor(e,t){super(e,{name:"imageSource"}),this.image=t,YA(this,"_image"),YA(this,"_totalFrames",0)}_render(e,t){let{width:i,height:r}=this;if(this.image instanceof HTMLVideoElement){if(Kw(this.image.getVideoPlaybackQuality)&&!Dk){let e=this.image.getVideoPlaybackQuality().totalVideoFrames;if(this._totalFrames===e)return!1;this._totalFrames=e,this.dropFrames=this._totalFrames-this.totalFrames}({videoWidth:i,videoHeight:r}=this.image)}else if(this.image instanceof HTMLImageElement||this.image instanceof ImageData||this.image instanceof ImageBitmap){if(({width:i,height:r}=this.image),this.image!==this._image)this._image=this.image;else if(i===this.width&&r===this.height)return!1}else(this.image instanceof HTMLCanvasElement||this.image instanceof OffscreenCanvas)&&(({width:i,height:r}=this.image),this._image=this.image);return this.width===i&&this.height===r&&this.totalFrames?t&&this.useTexture((e=>{e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,this.image)})):(t&&this.useTexture((e=>{e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.image)})),this.resize(i,r)),!0}render(e){return this._render(e,!0)}render2d(e){return this._render(e,!1)}},vx=class extends Tx{constructor(e,t){super(e,document.createElement("video")),this._videoTrack=t,YA(this,"_mediaStream"),this.name="videoTrackSource",this._mediaStream=new MediaStream([t]),this.image.srcObject=this._mediaStream,this.image.play()}replaceTrack(e){var t,i;this._videoTrack!==e&&(null==(t=this._mediaStream)||t.removeTrack(this._videoTrack),this._videoTrack=e,null==(i=this._mediaStream)||i.addTrack(this._videoTrack),this.image.play())}close(){super.close(),delete this._mediaStream,this.image.srcObject=null}},Sx=class extends _P{constructor(e){super(),YA(this,"frameRate"),YA(this,"_canvas"),YA(this,"_gl"),YA(this,"ctx2d"),YA(this,"defaultProgam"),YA(this,"log"),YA(this,"hasAlpha",!1),YA(this,"glFaild",!1),YA(this,"name"),this.name=e.name,this.log=e.logger.createChild({id:"vc-".concat(this.name)}),this.frameRate=e.frameRate}create(e){if(this.glFaild=!1,this.hasAlpha=e.alpha,this._canvas=document.createElement("canvas"),e.use2d)return this.ctx2d=this._canvas.getContext("2d",{alpha:e.alpha}),void this.log.info("video context created use 2d");let t=this._canvas.getContext("webgl",{alpha:e.alpha});if(t){this._gl=t;try{let e=this.createShader(t.VERTEX_SHADER,"\n// 顶点着色器\nattribute vec4 a_position;\nattribute vec2 a_texCoord;\nvarying vec2 v_texCoord;\n\nvoid main() {\n  gl_Position = a_position;\n  v_texCoord = a_texCoord;\n}\n"),i=this.createShader(t.FRAGMENT_SHADER,"\n// 片元着色器\nprecision mediump float;\nvarying vec2 v_texCoord;\nuniform sampler2D u_texture;\n\nvoid main() {\n  gl_FragColor = texture2D(u_texture, v_texCoord);\n} ");this.defaultProgam=this.createProgram(e,i),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),this._canvas.addEventListener("webglcontextlost",(()=>{this.destroy("webglcontextlost")})),this.log.info("video context created use webgl")}catch(e){return this.log.warn("video context create faild use webgl"),e}}else this.ctx2d=this._canvas.getContext("2d"),this.ctx2d&&this.log.info("video context created downgrade to 2d");!this.ctx2d&&!this._gl&&delete this._canvas}get available(){return!!this._canvas}createVideoTrackSource(e){return new vx(this,e)}createVideoTrackDestination(e){return new fx(this,e)}createVideoImageSource(e){return new Tx(this,e)}set width(e){var t;null==(t=this._gl)||t.viewport(0,0,e,this.height),this._canvas&&(this._canvas.width=e)}get width(){var e;return(null==(e=this._canvas)?void 0:e.width)||0}set height(e){var t;null==(t=this._gl)||t.viewport(0,0,this.width,e),this._canvas&&(this._canvas.height=e)}get height(){var e;return(null==(e=this._canvas)?void 0:e.height)||0}setSize(e,t){var i;null==(i=this._gl)||i.viewport(0,0,e,t),this._canvas&&(this._canvas.width=e,this._canvas.height=t)}disconnect(){this.emit("disconnect")}destroy(e,t){var i;return this.disconnect(),this.log.info("video context destroy ".concat(e?":".concat(e):"")),null==(i=this._gl)||i.deleteProgram(this.defaultProgam),delete this._gl,delete this.ctx2d,this._canvas&&(this._canvas.remove(),this._canvas.width=0,this._canvas.height=0,delete this._canvas),[e,t]}createShader(e,t){let i=this._gl,r=i.createShader(e);return i.shaderSource(r,t),i.compileShader(r),r}createProgram(e,t){let i=this._gl,r=i.createProgram();return i.attachShader(r,e),i.attachShader(r,t),i.linkProgram(r),r}useTexture(e,t,i){let r=this._gl;r.activeTexture(r.TEXTURE0+(i||0)),r.bindTexture(r.TEXTURE_2D,e),t(r),r.bindTexture(r.TEXTURE_2D,null)}};zA([hP(_P.INIT,"created")],Sx.prototype,"create",1),zA([hP("created",_P.INIT,{ignoreError:!0,success(e){e[0]&&(this.glFaild=!0,this.emit("unavailable",...e)),this.removeAllListeners()}})],Sx.prototype,"destroy",1);var yx=[1,0,1,1,0,0,0,1],Ex=class extends px{constructor(e){if(super(e,{useDefaultProgram:!0,useFbo:!0,create2d:!0,name:"mirror"}),e._gl)try{this.setTexBuffer(yx)}catch(t){e.destroy("mirror set texCoords faild",t)}else this.ctx2d&&setTimeout((e=>{e.scale(-1,1),e.translate(-this.width,0)}),0,this.ctx2d)}render(e){var t;return!(null==(t=this.input)||!t.requestFrame(e)||(this.useProgram(),this.useBufferFrame((()=>{this.useInputTexture((e=>{this.setAttributes({a_position:this.positionBuffer,a_texCoord:this.texCoordBuffer}),e.drawArrays(e.TRIANGLE_STRIP,0,4)}))})),0))}},Ix=class extends px{constructor(e){super(e,{useDefaultProgram:!0,useFbo:!0,name:"mix",create2d:!0}),YA(this,"inputs",[])}addInput(e,t){if(this.inputs[t.zIndex])throw new Error("input already exists");let i=new class{constructor(e,t){this.node=e,this.layout=t,YA(this,"positionBuffer")}get x(){return this.layout.x||this.node.x}get y(){return this.layout.y||this.node.y}get width(){return this.layout.width||this.node.width}get height(){return this.layout.height||this.node.height}get right(){return this.x+this.width}get bottom(){return this.y+this.height}}(e,t);this.inputs[t.zIndex]=i}resize(e,t){let i=this.inputs.reduce(((e,t)=>t?Object.assign(e,{width:Math.max(e.width,t.right),height:Math.max(e.height,t.bottom)}):e),{width:0,height:0});super.resize(i.width,i.height),this.context._gl&&this.inputs.forEach((e=>{if(e){let t=this.layout2texCoords(e);e.positionBuffer?this.changeBufferData(e.positionBuffer,t):e.positionBuffer=this.createBuffer(t)}}))}connect(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];return super.connect(e,...i),this.resize(0,0),e}removeInput(e){this.inputs[this.inputs.findIndex((t=>(null==t?void 0:t.node)===e))]=void 0}render(e){let t=this.context._gl;return!(this.inputs.reduce(((t,i)=>(!i||!i.node.requestFrame(e))&&t),!0)||!t||(this.useProgram(),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.setAttributes({a_texCoord:this.texCoordBuffer}),this.useBufferFrame((()=>{for(let e=0;e<this.inputs.length;e++){let t=this.inputs[e];t&&t.node.useTexture((e=>{this.setAttributes({a_position:t.positionBuffer}),e.drawArrays(e.TRIANGLE_STRIP,0,4)}))}})),0))}render2d(e){if(!this.inputs.reduce(((t,i)=>(!i||!i.node.requestFrame(e))&&t),!0)&&this.ctx2d){this.ctx2d.clearRect(0,0,this.width,this.height);for(let e=0;e<this.inputs.length;e++){let t=this.inputs[e];t&&this.draw2d(t.node.image,t.x,t.y,t.width,t.height)}return!0}return!1}getInfo(){let{totalFrames:e,x:t,y:i,width:r,height:n}=this,o=Date.now(),s=(e-this.lastInfo.totalFrames)/((o-this.lastInfo.timestamp)/1e3)>>0;return this.lastInfo={totalFrames:e,x:t,y:i,width:r,height:n,timestamp:o,fps:s},WA({parent:this.inputs.filter((e=>e)).map((e=>e.node.getInfo()))},this.lastInfo)}close(){super.close(),this.inputs.forEach((e=>{var t;if(e&&(null==(t=e.node)||t.disconnect(),e.positionBuffer&&this.context._gl))try{this.context._gl.deleteBuffer(e.positionBuffer)}catch(e){}}))}},Rx=class extends ux.EventEmitter{constructor(e){let{room:t}=e;super(),YA(this,"videoContext"),YA(this,"destination"),YA(this,"smallVideoContext"),YA(this,"smallDestination"),YA(this,"smallTrackSource"),YA(this,"smallImageSource"),YA(this,"_isMirror",!1),YA(this,"cameraTrack"),YA(this,"cameraNode"),YA(this,"waterMarkNode"),YA(this,"mirrorNode"),YA(this,"mixNode"),YA(this,"screenTrack"),YA(this,"screenNode"),YA(this,"_isMixScreen",!1),YA(this,"_hasWaterMark",!1),YA(this,"_log"),YA(this,"_checkId",0),YA(this,"_room"),YA(this,"_use2d",!0),YA(this,"_waterMarkOption"),YA(this,"_isOpenVirtualBackground",!1),YA(this,"_virtualBackgroundTrack"),YA(this,"virtualBackgroundInstance"),this._room=t,this._log=wO.createLogger({id:"vm",userId:t.userId,sdkAppId:t.sdkAppId}),this.videoContext=new Sx({frameRate:15,logger:this._log,name:"m"}),this.videoContext.on("unavailable",((e,t)=>{this.emit("error",{reason:e,error:t}),this._log.warn("video context unavailable",e,t,"glFaild:".concat(this.videoContext.glFaild)),AO.emit("262",{room:this._room,apiName:"videoCtxGl",error:t||new Error(e)}),this.update()})),this.smallVideoContext=new Sx({frameRate:15,logger:this._log,name:"s"}),this.enablePrintDetail()}get renderMode(){return this._use2d?"2d":"webgl"}set renderMode(e){let t="2d"===e;this._use2d!==t&&(this._use2d=t,this.videoContext&&(this.clear(),this.videoContext.destroy(),this.videoContext.create({alpha:this._hasWaterMark,use2d:this._use2d}),this.update()))}enablePrintDetail(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3;this._checkId=SP.run(Rw,(()=>{this.destination&&this._log.debug(this.destination.getInfo())}),{delay:e})}destroy(){this.videoContext.destroy(),this.smallVideoContext.destroy(),SP.clearTask(this._checkId)}get active(){return(Lk&&Mk||this._isMixScreen||this._isMirror||this._hasWaterMark)&&this.checkOrCreateVideoContext()}sendCreateResult(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"videoCtxGl",t=arguments.length>1?arguments[1]:void 0;AO.emit("262",{room:this._room,apiName:e,error:t})}checkOrCreateVideoContext(){if(this.videoContext.available){if(this.videoContext.hasAlpha||!this._hasWaterMark)return!0;this.clear(),this.videoContext.destroy()}else this.videoContext.glFaild&&(this.clear(),this._use2d=!0);let e=this.videoContext.create({alpha:this._hasWaterMark,use2d:this._use2d});return this.videoContext._gl?this.sendCreateResult():(this._use2d||(this.emit("error",{reason:"create",error:e}),this.sendCreateResult("videoCtxGl",e)),this.sendCreateResult("videoCtx2d",this.videoContext.ctx2d?void 0:new Error("create 2d context failed"))),this.videoContext.available}get smallTrack(){return this.smallDestination.videoTrack}get hasSmall(){return!!this.smallTrackSource||!!this.smallImageSource}get initialTrack(){var e;return this._isOpenVirtualBackground&&this._virtualBackgroundTrack?this._virtualBackgroundTrack:null==(e=this.cameraTrack)?void 0:e.mediaTrack}_setMainOutput(e){let t=this.cameraTrack,{small:i,settings:r}=t;return i&&(this.smallVideoContext.available||(this.smallVideoContext.create({alpha:!1,use2d:!0}),this.smallDestination=new gx(this.smallVideoContext,i)),this.smallVideoContext.frameRate=i.frameRate,this.smallDestination.resolution=i,e?(this.smallTrackSource&&(this.smallTrackSource.close(),delete this.smallTrackSource),this.smallImageSource?this.smallImageSource.image=e:(this.smallImageSource=this.smallVideoContext.createVideoImageSource(e),this.smallImageSource.connect(this.smallDestination))):(this.smallImageSource&&(this.smallImageSource.close(),delete this.smallImageSource),this.smallTrackSource?this.smallTrackSource.replaceTrack(this.initialTrack):(this.smallTrackSource=this.smallVideoContext.createVideoTrackSource(this.initialTrack),this.smallTrackSource.width=r.width,this.smallTrackSource.height=r.height,this.smallTrackSource.connect(this.smallDestination)))),t.setOutputMediaStreamTrack(e?this.destination.videoTrack:this.initialTrack)}update(){return XA(this,null,(function*(){var e,t;if(!this.cameraTrack||!this.cameraTrack.mediaTrack)return;if(!this.active)return this.cameraNode&&this.clear(),this._setMainOutput();{let{settings:e,profile:t}=this.cameraTrack;this.destination||(this.destination=this.videoContext.createVideoTrackDestination({name:"mainDestination"})),this.cameraNode?this.cameraNode.replaceTrack(this.initialTrack):(this.cameraNode=this.videoContext.createVideoTrackSource(this.initialTrack),this.cameraNode.resize(e.width,e.height)),this.videoContext.frameRate=t.frameRate}let i=this.cameraNode;return i.disconnect(),this._isMirror&&(this.mirrorNode||(this.mirrorNode=new Ex(this.videoContext)),i=i.connect(this.mirrorNode),i.disconnect(),this._log.info("start mirror")),this.mixNode&&this.mixNode.close(),delete this.mixNode,(this._isMixScreen||this._hasWaterMark)&&(this.mixNode=new Ix(this.videoContext),i.connect(this.mixNode,{zIndex:1}),this._hasWaterMark&&!this.waterMarkNode&&this._waterMarkOption&&(this.waterMarkNode=this.videoContext.createVideoImageSource(this._waterMarkOption.image),this.waterMarkNode.resize(this._waterMarkOption.width,this._waterMarkOption.height),this.waterMarkNode.x=this._waterMarkOption.x,this.waterMarkNode.y=this._waterMarkOption.y),null==(e=this.waterMarkNode)||e.connect(this.mixNode,{zIndex:2}),this.screenTrack&&!this.screenNode&&(this.screenNode=this.videoContext.createVideoTrackSource(this.screenTrack.mediaTrack)),null==(t=this.screenNode)||t.connect(this.mixNode,{zIndex:0}),i=this.mixNode,this._log.info("start mix","".concat(this.mixNode.width,"x").concat(this.mixNode.height))),i.connect(this.destination),this._setMainOutput(this.videoContext._canvas)}))}changeInput(e,t){return this._log.info("change input"),e instanceof OM?this.setScreenTrack(e):e instanceof DM?this.setCameraTrack(e):e instanceof GM?e.setOutputMediaStreamTrack(e.mediaTrack):void 0}removeInput(e){var t;e instanceof OM?(null==(t=this.screenNode)||t.close(),delete this.screenNode,delete this.screenTrack,this.update()):e instanceof DM&&(this.clear(),delete this.cameraTrack,this.smallImageSource&&(this.smallImageSource.close(),delete this.smallImageSource),this.smallTrackSource&&(this.smallTrackSource.close(),delete this.smallTrackSource))}setCameraTrack(e){return XA(this,null,(function*(){return this.cameraTrack=e,this._isOpenVirtualBackground&&(yield this.updateAr()),this.update()}))}setScreenTrack(e){return this.screenTrack=e,this._isMixScreen&&(this.screenNode?this.screenNode.replaceTrack(e.mediaTrack):this.update()),e.setOutputMediaStreamTrack(e.mediaTrack)}loadImage(e){return new Promise(((t,i)=>{let r=new Image;r.crossOrigin="anonymous",r.src=e,r.onload=()=>t(r),r.onerror=i}))}setWatermark(e){return XA(this,null,(function*(){let t=yield this.loadImage(e.imageUrl),{x:i=0,y:r=0,width:n=t.width,height:o=t.height}=e;this._hasWaterMark=!0,this._waterMarkOption={x:i,y:r,width:n,height:o,image:t},this._log.info("start watermark",JSON.stringify({x:i,y:r,width:n,height:o})),this.update()}))}stopWatermark(){var e;!this._hasWaterMark||(this._hasWaterMark=!1,this._log.info("stop watermark"),null==(e=this.waterMarkNode)||e.close(),delete this.waterMarkNode,this.update())}get mixScreen(){return this._isMixScreen}set mixScreen(e){var t;this._isMixScreen=e,this._isMixScreen||(null==(t=this.screenNode)||t.close(),delete this.screenNode),this.update()}set mirror(e){var t;this._isMirror=e,this._isMirror||(null==(t=this.mirrorNode)||t.close(),delete this.mirrorNode),this.update()}get mirror(){return this._isMirror}enableAr(e){return XA(this,null,(function*(){this.virtualBackgroundInstance=e,this._isOpenVirtualBackground=!0,this.virtualBackgroundInstance.ar.enable(this.cameraTrack.mediaTrack.clone()),this.virtualBackgroundInstance.ar.listen("output",this.handleArOutput.bind(this))}))}handleArOutput(e){this._virtualBackgroundTrack=e,this.update()}updateAr(){return XA(this,null,(function*(){var e;null==(e=this.cameraTrack)||!e.mediaTrack||(yield this.virtualBackgroundInstance.ar.updateInputTrack(this.cameraTrack.mediaTrack.clone()))}))}disableAr(){var e;!this._isOpenVirtualBackground||(this._isOpenVirtualBackground=!1,null==(e=this._virtualBackgroundTrack)||e.stop(),this._virtualBackgroundTrack=null,this.update())}clear(){this.videoContext.disconnect(),delete this.destination,delete this.cameraNode,delete this.mirrorNode,delete this.screenNode,delete this.waterMarkNode}},Cx=0,Ax=class extends _P{constructor(e){super("room"),this.seq=++Cx,this.role="anchor",this.localTracks=new Set,this.enableAutoPlayDialog=!0,this.autoReceiveAudio=!0,this.autoReceiveVideo=!0,this.scheduleResult={domains:null,iceServers:null,iceTransportPolicy:null,trtcAutoConf:null},this._isUsingCachedSchedule=!1,this._log=wO.createLogger({id:"r".concat(this.seq)}),this._joinedTimestamp=0,this._isDestroyed=!1,this.useStringRoomId=!!e.useStringRoomId,qw(e.autoReceiveAudio)&&(this.autoReceiveAudio=e.autoReceiveAudio),qw(e.autoReceiveVideo)&&(this.autoReceiveVideo=e.autoReceiveVideo),qw(e.enableAutoPlayDialog)&&(this.enableAutoPlayDialog=e.enableAutoPlayDialog),this.keyPointManager=new ex({room:this,frameWorkType:e.frameWorkType,component:e.component,language:e.language}),this.callDurationCalculator=new class{constructor(e){YA(this,"_room",null),YA(this,"_durationMap"),YA(this,"_eventMap",new Map),this._room=e.room,this._durationMap=new Map,this.installEvents()}installEvents(){this._eventMap.set(kO.SUBSCRIBE_SUCCESS,this.handleSubscribed).set(kO.UNSUBSCRIBE_SUCCESS,this.handleStreamStopped).set(kO.REMOTE_PUBLISH_STATE_CHANGED,(e=>{let{room:t,prevMuteState:i,muteState:r}=e;var n;let{userId:o}=r;if(!this.hitTest(t))return;i.hasAudio&&!r.hasAudio&&this.stopDurationItem("".concat(o,"_","main"),RD.AUDIO),i.hasVideo&&!r.hasVideo&&this.stopDurationItem("".concat(o,"_","main"),RD.VIDEO),i.hasAuxiliary&&!r.hasAuxiliary&&this.stopDurationItem("".concat(o,"_","auxiliary"),RD.VIDEO);let s=null==(n=this._room)?void 0:n.remotePublishedUserMap.get(o);!s||(!i.hasAudio&&r.hasAudio&&s.remoteAudioTrack.isSubscribed&&this.addDuractionItem(o,RD.AUDIO,"main"),!i.hasVideo&&r.hasVideo&&s.remoteVideoTrack.isSubscribed&&this.addDuractionItem(o,RD.VIDEO,"main"),!i.hasAuxiliary&&r.hasAuxiliary&&s.remoteAuxiliaryTrack.isSubscribed&&this.addDuractionItem(o,RD.VIDEO,"auxiliary"))})),this._eventMap.forEach(((e,t)=>AO.on(t,e,this)))}uninstallEvents(){this._eventMap.forEach(((e,t)=>AO.off(t,e,this))),this._eventMap.clear()}handleSubscribed(e){let{room:t,streamType:i,remotePublishedUser:r}=e;if(!this.hitTest(t))return;let{userId:n}=r,o="".concat(n,"_").concat(i);if(r.muteState.hasAudio&&"main"===i)if(r.remoteAudioTrack.isSubscribed){let e=new tx,t=this._durationMap.get(o);t?this.isRecording(t.audio)||t.audio.push(e):this._durationMap.set(o,{userId:n,type:i,audio:[e],video:[]})}else this.stopDurationItem(o,RD.AUDIO);if(r.muteState.hasVideo||r.muteState.hasAuxiliary)if(r.remoteVideoTrack.isSubscribed||r.remoteAuxiliaryTrack.isSubscribed){let e=new tx,t=this._durationMap.get(o);t?this.isRecording(t.video)||t.video.push(e):this._durationMap.set(o,{userId:n,type:i,audio:[],video:[e]})}else this.stopDurationItem(o,RD.VIDEO)}handleStreamStopped(e){let{room:t,streamType:i,remotePublishedUser:r}=e;if(!this.hitTest(t))return;let{userId:n}=r,o="".concat(n,"_").concat(i);this.stopDurationItem(o,RD.AUDIO),this.stopDurationItem(o,RD.VIDEO)}isRecording(e){return e.findIndex((e=>0===e.endTime))>=0}addDuractionItem(e,t,i){let r="".concat(e,"_").concat(i),n=new tx,o=this._durationMap.get(r);o?this.isRecording(o[t])||o[t].push(n):this._durationMap.set(r,{userId:e,type:i,audio:t===RD.AUDIO?[n]:[],video:t===RD.AUDIO?[]:[n]})}stopDurationItem(e,t){if(this._durationMap.has(e)){let i=this._durationMap.get(e)[t].find((e=>0===e.endTime));i&&i.stop()}}hitTest(e){return this._room===e}getDuration(e,t){return this._durationMap.has(e)?this._durationMap.get(e)[t].reduce(((e,t)=>e+t.getDuration()),0):0}getDurationMap(){return this._durationMap}reset(){this._durationMap.clear()}destroy(){this._room=null,this.uninstallEvents()}}({room:this}),this.badCaseDetector=new class{constructor(e){YA(this,"_room"),YA(this,"_renderFreezeMap",new Map),YA(this,"_isVideoPlayingEventFiredMap",new Map),YA(this,"_dataFreezeMap",new Map),YA(this,"_monitorFreezeData",new Map),YA(this,"_eventMap",new Map),this._room=e.room,this.installEvents()}installEvents(){this._eventMap.set(kO.LEAVE_SUCCESS,(e=>{let{room:t}=e;this.hitTest(t)&&this.stop()})).set(kO.PLAY_TRACK_START,this.onPlayTrackStart).set(kO.UNSUBSCRIBE_SUCCESS,(e=>{let{room:t,streamType:i,remotePublishedUser:r}=e;if(!this.hitTest(t))return;let{userId:n}=r,o="".concat(n,"_").concat(i);this.stopDataFreeze({key:o,userId:n,type:i})})).set(kO.REMOTE_PUBLISH_STATE_CHANGED,(e=>{let{room:t,prevMuteState:i,muteState:r}=e;if(!this.hitTest(t))return;let{userId:n}=r;if(i.hasVideo&&!r.hasVideo){let e="main",t="".concat(r.userId,"_").concat(e);this.stopDataFreeze({key:t,userId:n,type:e})}if(i.hasAuxiliary&&!r.hasAuxiliary){let e="auxiliary",t="".concat(r.userId,"_").concat(e);this.stopDataFreeze({key:t,userId:n,type:e})}})).set(kO.PLAYER_STATE_CHANGED,(e=>{let{track:t,state:i,reason:r,type:n}=e;if(eO(t)&&this.hitTest(t.room)&&n===RD.VIDEO){if("PLAYING"===i){let e="".concat(t.userId,"_").concat(t.streamType);this._isVideoPlayingEventFiredMap.set(e,!0)}r===RD.MUTE?this.onVideoTrackMuted(t):r===RD.UNMUTE&&this.onVideoTrackUnmuted(t)}})).set(kO.HEARTBEAT_REPORT,this.onHearBeatReport),this._eventMap.forEach(((e,t)=>AO.on(t,e,this)))}uninstallEvents(){this._eventMap.forEach(((e,t)=>AO.off(t,e,this))),this._eventMap.clear()}stop(){this._renderFreezeMap.clear(),this._dataFreezeMap.clear(),this._isVideoPlayingEventFiredMap.clear()}onVideoTrackMuted(e){if(!e.isSubscribed)return;let{userId:t,streamType:i}=e,r="".concat(t,"_").concat(i),n=this._dataFreezeMap.get(r),o=new tx;n?n.durationItemList.push(o):this._dataFreezeMap.set(r,{userId:t,type:i,durationItemList:[o],isFreezing(){let e=this.durationItemList[this.durationItemList.length-1];return e&&0===e.endTime}})}onVideoTrackUnmuted(e){if(!e.isSubscribed)return;let{userId:t,streamType:i}=e,r="".concat(t,"_").concat(i);this.stopDataFreeze({key:r,userId:t,type:i})}onHearBeatReport(e){let{room:t,report:i}=e;!this.hitTest(t)||i.msg_down_stream_info.forEach((e=>{let t=this._room.remotePublishedUserMap.get(e.msg_user_info.str_identifier);if(!t)return;let{userId:i,muteState:r}=t;e.msg_video_status.forEach((e=>{2===e.uint32_video_stream_type&&r.hasVideo&&!r.videoMuted&&t.remoteVideoTrack.isSubscribed&&this.handleRenderFreeze({userId:i,fps:e.uint32_video_dec_fps,type:"main"}),7===e.uint32_video_stream_type&&r.hasAuxiliary&&t.remoteAuxiliaryTrack.isSubscribed&&this.handleRenderFreeze({userId:i,fps:e.uint32_video_dec_fps,type:"auxiliary"})}))}))}stopDataFreeze(e){let{key:t,userId:i,type:r}=e,n=this._dataFreezeMap.get(t);if(!n||!n.isFreezing())return;let o=n.durationItemList[n.durationItemList.length-1];o.stop();let s=o.getDuration();s>sw?this._monitorFreezeData.set(t,{userId:i,type:r,duration:s}):n.durationItemList.pop()}getTotalDuration(e){return e.reduce(((e,t)=>{let i=t.getDuration();return e+Math.min(i,5e3)}),0)}handleRenderFreeze(e){return XA(this,arguments,(function(e){var t=this;let{userId:i,fps:r,type:n}=e;return function*(){let e="".concat(i,"_").concat(n),o=t._renderFreezeMap.get(e);if(r<=2){let r=sO();o&&!o.isFreeze&&(o.freezeTimeline.push({startTime:r,endTime:0}),o.isFreeze=!0),o||t._renderFreezeMap.set(e,{userId:i,type:n,isFreeze:!0,freezeTimeline:[{startTime:r,endTime:0}],renderFreezeTotal:0})}else if(o&&o.isFreeze){o.isFreeze=!1;let e=o.freezeTimeline.pop();if(e){e.endTime=sO();let t=e.endTime-e.startTime;o.freezeTimeline.push(e),o.renderFreezeTotal+=Math.min(5e3,t)}}}()}))}onPlayTrackStart(e){let{track:t}=e;if(!eO(t)||!this.hitTest(t.room)||t.kind!==RD.VIDEO||t.hasFlag)return;let i="".concat(t.userId,"_").concat(t.streamType);this._isVideoPlayingEventFiredMap.has(i)||this._isVideoPlayingEventFiredMap.set(i,!1)}getDataFreezeDuration(e){let t={dataFreeze:0,count:0},i=this._dataFreezeMap.get(e);if(i){if(i.isFreezing()){let e=i.durationItemList[i.durationItemList.length-1];e.stop(),e.getDuration()<sw&&i.durationItemList.pop()}t.dataFreeze=this.getTotalDuration(i.durationItemList),t.count=i.durationItemList.length}return t}getRenderFreezeDuration(e){let t=this._renderFreezeMap.get(e),i=0,r=0;if(t)if(t.isFreeze){let e=sO()-t.freezeTimeline[t.freezeTimeline.length-1].startTime;i=t.renderFreezeTotal+Math.min(e,5e3),r=t.freezeTimeline.length}else i=t.renderFreezeTotal;return{renderFreeze:i,count:r}}getMonitorFreeze(){return this._monitorFreezeData}isBlackStream(e){return!!this._isVideoPlayingEventFiredMap.has(e)&&!this._isVideoPlayingEventFiredMap.get(e)}resetMonitor(){this._monitorFreezeData.clear()}hitTest(e){return e===this._room}destroy(){this.uninstallEvents()}}({room:this}),this.audioManager=new class{constructor(e){let{room:t}=e;YA(this,"_localAudioTrack",null),YA(this,"_localScreenAudioTrack",null),YA(this,"localMixAudioTrack"),YA(this,"isDenoiserInit",!1),YA(this,"isDenoiserEnabled",!1),YA(this,"isDenoiserProcessed",!1),YA(this,"mixedMusicMap",new Map),YA(this,"cacheMusicMap",new Map),YA(this,"_log"),YA(this,"denoiserTrack",null),YA(this,"denoiser",null),YA(this,"denoiserProcessor"),YA(this,"initProcessorOptions"),YA(this,"denoiserContext"),this._log=wO.createLogger({id:"am",userId:t.userId,sdkAppId:t.sdkAppId})}get mixedAudioTrack(){return this.localMixAudioTrack?this.localMixAudioTrack.outMediaTrack:null}get hasScreenAudioTrack(){return null!==this._localScreenAudioTrack}get hasAudioTrack(){return null!==this._localAudioTrack}changeInput(e,t){var i,r;return e instanceof NM?(this._localScreenAudioTrack=e,void(e._outputTrack=e.mediaTrack)):e instanceof MM?(e._outputTrack=e.mediaTrack,void(null==(i=this.localMixAudioTrack)||i.replaceTrack(e,t))):e instanceof kM?(this._localAudioTrack=e,void(this.isDenoiserProcessed?(null==(r=this.denoiserProcessor)||r.updateTrack(e.mediaTrack),e._outputTrack=this.denoiserTrack):e._outputTrack=e.mediaTrack)):e instanceof WM?e.setOutputMediaStreamTrack(e.mediaTrack):void 0}removeInput(e){if(e instanceof kM)return this.removeAudioTrack(e)}addMusicSource(e){return XA(this,null,(function*(){this._log.info("add music source, id: ".concat(e.id," url: ").concat(e.url));let t,{id:i,url:r,loop:n,volume:o}=e;if(!this.mixedMusicMap.has(i))return t=this.cacheMusicMap.has(i)?this.cacheMusicMap.get(i):new MM(this,e),t.play(),this._log.info("start mix audio ".concat(i," success.")),this.mixedMusicMap.set(i,t),this.cacheMusicMap.set(i,t),t}))}updateMusicSource(e){return XA(this,null,(function*(){let{id:t,volume:i,loop:r,operation:n,seekFrom:o}=e;if(this._log.info("update music source, ".concat(JSON.stringify(e))),this.mixedMusicMap.has(t)){let e=this.mixedMusicMap.get(t);Qw(i)||e.setVolume(i),Qw(r)||e.loop(r),Qw(n)||e.setOperation(n),Qw(o)||e.seek(o)}}))}addAudioTrack(e){return XA(this,null,(function*(){var t;if(this.localMixAudioTrack||(this.localMixAudioTrack=new PM(this)),this._log.info("start add audioTrack, userId: ".concat(e.userId)),e===this._localAudioTrack){if($N){let i=yield null==(t=e.mediaTrack)?void 0:t.getSettings();this.localMixAudioTrack.channelCount=(null==i?void 0:i.channelCount)||1}this.mixedMusicMap.forEach((e=>{var t;null==(t=this.localMixAudioTrack)||t.setInputMediaStreamTrack(e.outMediaTrack)}))}this.localMixAudioTrack.setInputMediaStreamTrack(e.outMediaTrack)}))}removeAudioTrack(e){!this.localMixAudioTrack||(e===this._localAudioTrack&&this.mixedMusicMap.forEach((e=>{this.localMixAudioTrack.removeTrack(e.outMediaTrack)})),this.localMixAudioTrack.removeTrack(e.outMediaTrack))}removeMusicSource(e){let{id:t}=e;if(this.localMixAudioTrack){if(this.mixedMusicMap.has(t)){this._log.info("remove music source, music id: ".concat(t));let e=this.mixedMusicMap.get(t);e.stop(),this.localMixAudioTrack.removeTrack(e.outMediaTrack),this.mixedMusicMap.delete(t)}"*"===t&&this.destroyAllMusic()}}destroyAllMusic(){this._log.info("destroy all music source."),this.mixedMusicMap.forEach(((e,t)=>{this.removeMusicSource({id:t})}))}destroyAllCache(){this._log.info("destroy all music cache."),this.cacheMusicMap.forEach((e=>e.stop()))}initDenoiser(e){return XA(this,null,(function*(){let{assetsPath:t,sdkAppId:i,userId:r,userSig:n}=e;try{(!this.denoiserContext||"closed"===this.denoiserContext.state)&&(this.denoiserContext=ZP("denoiser")),this.denoiser||(this.denoiser=new class{constructor(e){let{assetsPath:t,log:i,audioContext:r}=e;this.isLoaded_=!1,this.audioContext_=r,this.log_=i,this.assetsPath_=t}createProcessor(e){return XA(this,null,(function*(){let t=String(Date.now()).slice(0,-3),{auth:i,sign:r,status:n,message:o}=yield function(e){return XA(this,arguments,(function(e){let{sdkAppId:t,userId:i,userSig:r,timestamp:n}=e;return function*(){let e="https://".concat(function(e){let t;return t=xM(e)?"intl-schedule.rtc.qq.com":"schedule.rtc.qq.com",t}(t),"/api/v1/audioAiAuth?sdkAppId=").concat(t,"&userId=").concat(i,"&userSig=").concat(r,"&timestamp=").concat(n),o=yield fetch(e),{data:{errCode:s,errMsg:a,sign:c,status:l}}=yield o.json();if("1"===l)return{auth:!0,sign:c,status:l,message:a};let u="Init RTCAIDenoiser failed.",d="";switch(s){case 1:d="Please check your params.";break;case 2:d="You need to buy packages. Refer to: https://cloud.tencent.com/document/product/647/44247";break;case 3:d="Server is invalid. Please contact our engineer. ";break;case 4:d="Your packages is not active. Refer to: https://cloud.tencent.com/document/product/647/44247";break;case 5:d="Your packages is expired. Refer to: https://cloud.tencent.com/document/product/647/44247";break;case 6:d="Your version is not supported."}return{auth:!1,status:l,message:a?"".concat(u," Reason: ").concat(a,". ").concat(d):"".concat(u,", ").concat(d)}}()}))}(GA(WA({},e),{timestamp:t}));if(!i)throw this.log_.info("RTCAIDenoiser: ".concat(e.userId," auth result: ").concat(i,". Message: ").concat(o)),new Error(o);try{yield this.load()}catch(e){throw new Error("Init wasm failed, please check your assetsPath.")}let s=yield this.initWorklet(),a=new class{constructor(e){let{sdkAppId:t,userId:i,audioContext:r,sign:n,status:o,worklet:s,timestamp:a,logger:c}=e;YA(this,"audioContext_"),YA(this,"destination_"),YA(this,"gainNode_"),YA(this,"log_"),YA(this,"workletNode_"),YA(this,"isDumping_",!1),YA(this,"dump_"),YA(this,"trackConstraint_",{}),YA(this,"audioTrack_"),YA(this,"source_"),YA(this,"denoiserTrack_"),YA(this,"enableDenoise_",!0),YA(this,"emitter_",new UM.default),this.audioContext_=r,this.destination_=this.audioContext_.createMediaStreamDestination(),this.gainNode_=this.audioContext_.createGain(),this.gainNode_.gain.value=1.1,this.log_=c,this.workletNode_=s,this.workletNode_.connect(this.gainNode_).connect(this.destination_),this.workletNode_.port.postMessage({type:"init",data:{sdkAppId:String(t),userId:i,timestamp:a,sign:n,status:o}}),this.workletNode_.port.onmessage=e=>{let{type:t,data:i}=e.data;if("ondump"===t&&this.isDumping_){let{inputPCM:e,outputPCM:t}=i;this.dump_.onDump(e,LM),this.dump_.onDump(t,VM)}"dumped"===t&&this.dumped()},this.dump_=new BM(this.audioContext_)}dumped(){this.isDumping_=!1;let e=this.dump_.getBlob(LM),t=this.dump_.getBlob(VM);this.emitter_.emit("ondumpend",{blob:e,name:LM}),this.emitter_.emit("ondumpend",{blob:t,name:VM}),this.dumpedWAV(e,LM),this.dumpedWAV(t,VM),this.dump_.reset()}dumpedWAV(e,t){let i=window.URL.createObjectURL(e),r=document.createElement("a");r.href=i,r.download="".concat(t,"-").concat(Date.now(),".wav"),r.click(),window.URL.revokeObjectURL(i),r.href=""}process(e){return XA(this,null,(function*(){if(this.audioTrack_=e,!this.audioTrack_)throw new Error("RTCAIDenoiser: cannot process without audioTrack.");let t=new MediaStream;t.addTrack(this.audioTrack_),this.source_=this.audioContext_.createMediaStreamSource(t),yield this.source_.connect(this.workletNode_),this.trackConstraint_=this.audioTrack_.getConstraints(),this.trackConstraint_.noiseSuppression=!1,yield this.audioTrack_.applyConstraints(this.trackConstraint_);let i=this.destination_.stream;return this.denoiserTrack_=i.getAudioTracks()[0],this.log_.info("RTCAIDenoiser: denoiser process track ID: ".concat(e.id," success.")),this.denoiserTrack_}))}updateTrack(e){return XA(this,null,(function*(){var t;let i=new MediaStream;yield i.addTrack(e);let r=this.audioContext_.createMediaStreamSource(i);this.source_.disconnect(),r.connect(this.workletNode_),null==(t=this.audioTrack_)||t.stop(),this.audioTrack_=e,this.source_=r,this.log_.info("RTCAIDenoiser: updateTrack success.")}))}disable(){return XA(this,null,(function*(){var e,t;return this.enableDenoise_=!1,null==(e=this.workletNode_)||e.port.postMessage({type:"disable"}),this.trackConstraint_.noiseSuppression=!0,yield null==(t=this.audioTrack_)?void 0:t.applyConstraints(this.trackConstraint_),this.log_.info("RTCAIDenoiser: disable ai denoiser."),this.enableDenoise_}))}enable(){return XA(this,null,(function*(){var e,t;return this.enableDenoise_=!0,null==(e=this.workletNode_)||e.port.postMessage({type:"enable"}),this.trackConstraint_.noiseSuppression=!1,yield null==(t=this.audioTrack_)?void 0:t.applyConstraints(this.trackConstraint_),this.log_.info("RTCAIDenoiser: enable ai denoiser."),this.enableDenoise_}))}startDump(){return this.isDumping_?(this.log_.info("RTCAIDenoiser: data is currently being dumped."),!1):(this.workletNode_.port.postMessage({type:"startDump"}),this.dump_?this.dump_.reset():this.dump_=new BM(this.audioContext_),this.isDumping_=!0,this.log_.info("RTCAIDenoiser: start dump data."),!0)}stopDump(){!this.isDumping_||(this.workletNode_.port.postMessage({type:"stopDump"}),this.isDumping_=!1,this.log_.info("RTCAIDenoiser: stop dump data."))}getAudioTrack(){return this.audioTrack_}getDenoiserTrack(){return this.destination_.stream.getAudioTracks()[0]}get enabled(){return this.enableDenoise_}destroy(){var e,t,i,r,n,o;this.log_.info("RTCAIDenoiser: destroy processor."),null==(e=this.audioTrack_)||e.stop(),null==(t=this.workletNode_)||t.port.postMessage({type:"destroy"}),this.workletNode_.port.onmessage=null,null==(i=this.source_)||i.disconnect(),null==(r=this.destination_)||r.disconnect(),null==(n=this.workletNode_)||n.disconnect(),null==(o=this.dump_)||o.destroy(),this.emitter_.removeAllListeners()}on(e,t,i){this.emitter_.on(e,t,i)}off(e,t,i){"*"===e?this.emitter_.removeAllListeners():this.emitter_.off(e,t,i)}}(GA(WA({},e),{audioContext:this.audioContext_,timestamp:t,sign:r,status:n,worklet:s,logger:this.log_}));return this.log_.info("RTCAIDenoiser: ".concat(e.userId," create denoiser processor success.")),a}))}load(){return XA(this,null,(function*(){if(!this.isLoaded_)try{yield this.audioContext_.audioWorklet.addModule("".concat(this.assetsPath_,"/denoiser-wasm.js")),this.isLoaded_=!0}catch(e){throw this.log_.error("Init assets from ".concat(this.assetsPath_," failed! Reason: ").concat(e)),e}}))}initWorklet(){return XA(this,null,(function*(){try{return new AudioWorkletNode(this.audioContext_,"trtc-denoiser-processor",{numberOfInputs:1,numberOfOutputs:1})}catch(e){return yield this.load(),new AudioWorkletNode(this.audioContext_,"trtc-denoiser-processor",{numberOfInputs:1,numberOfOutputs:1})}}))}destroy(){var e;null==(e=this.audioContext_)||e.close()}isSupported(){return"AudioWorklet"in window&&"WebAssembly"in window}}({assetsPath:t,log:this._log,audioContext:this.denoiserContext})),this.denoiserProcessor||(this.denoiserProcessor=yield this.denoiser.createProcessor({sdkAppId:i,userId:r,userSig:n})),this.isDenoiserInit=!0,this.initProcessorOptions=e}catch(e){throw e}}))}enableDenoiser(e){return XA(this,null,(function*(){var e,t,i;if(this.isDenoiserEnabled=!0,!this.hasAudioTrack){let e="enableDenoiser failed, there is no audio";throw this._log.error(e),new Error(e)}if(this.isDenoiserProcessed)null==(i=this.denoiserProcessor)||i.enable();else{let i=null==(e=this._localAudioTrack)?void 0:e.mediaTrack;if(!i)return;this.denoiserProcessor||(yield this.initDenoiser(this.initProcessorOptions)),this.denoiserTrack=yield this.denoiserProcessor.process(i),this.isDenoiserProcessed=!0,this._localAudioTrack._outputTrack=this.denoiserTrack,null==(t=this.localMixAudioTrack)||t.replaceTrack(this._localAudioTrack,i)}}))}disableDenoiser(){return XA(this,null,(function*(){var e;this.isDenoiserEnabled&&(null==(e=this.denoiserProcessor)||e.disable(),this.isDenoiserEnabled=!1)}))}destroyDenoiserProcessor(){var e;this.denoiserProcessor&&(this.denoiserProcessor.destroy(),delete this.denoiserProcessor,this.isDenoiserInit=!1,this.isDenoiserEnabled=!1,this.isDenoiserProcessed=!1,null==(e=this.denoiserTrack)||e.stop(),this.denoiserTrack=null),this.denoiserContext&&(this.denoiserContext.close(),delete this.denoiserContext)}destroy(){var e;this.destroyAllMusic(),this.destroyAllCache(),this.destroyDenoiserProcessor(),null==(e=this.denoiser)||e.destroy(),this.localMixAudioTrack&&(this.localMixAudioTrack.close(),delete this.localMixAudioTrack)}}({room:this}),this.videoManager=new Rx({room:this})}get isMainStreamPublished(){for(let e of this.localTracks)if(4&e.mediaType)return!0;return!1}get isAuxStreamPublished(){for(let e of this.localTracks)if(2&e.mediaType)return!0;return!1}get hasAuxStream(){for(let e of this.remotePublishedUserMap.values())if(e.muteState.hasAuxiliary)return!0;return this.isAuxStreamPublished}getLogger(){return this._log}get isJoined(){return"joined"===this.state}get isLeft(){return"left"===this.state}addTrack(e){return XA(this,null,(function*(){return this.publish(e)}))}removeTrack(e){return XA(this,null,(function*(){return this.unpublish(e)}))}replaceTrack(e){return XA(this,null,(function*(){}))}setEncodedDataProcessingListener(e){throw new Error("Method not implemented.")}enableAIVoice(e){throw new Error("Method not implemented.")}setProxyServer(e){if(zw(e))e.startsWith("wss://")?this.proxy_ws=e:e.startsWith("https://")&&(this.proxy_wt=e);else if(jw(e)){let{websocketProxy:t,webtransportProxy:i,loggerProxy:r,scheduleProxy:n,unifiedProxy:o}=e;this.proxy_ws=t,this.proxy_wt=i,this.proxy_unified=o,o?(sx([o,o]),rD("https://".concat(o))):(r&&rD(r),n&&sx(n))}}getRemoteAudioStats(){return XA(this,null,(function*(){let e={};return this.remotePublishedUserMap.forEach((t=>{e[t.userId]=t.remoteAudioTrack.stat})),e}))}getTransportStats(){return XA(this,null,(function*(){var e;let t={rtt:(null==(e=this.quality)?void 0:e.uplinkRTT)||0,downlinksRTT:{}};if(this.quality)for(let e of this.quality.downlinkInfo)t.downlinksRTT[e.userId]=e.rtt;return t}))}getRemoteVideoStats(){return XA(this,arguments,(function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"main";return function*(){let i={};return e.remotePublishedUserMap.forEach((e=>{let r="auxiliary"===t?e.remoteAuxiliaryTrack:e.remoteVideoTrack;i[e.userId]=r.stat})),i}()}))}checkDestroy(){if(this._isDestroyed)throw new ab({code:ob.INVALID_OPERATION,message:yN({key:$O,data:{funName:"join"}})})}destroy(){if(this.isJoined)throw this._log.warn(fN.INVALID_DESTROY),new ab({code:ob.INVALID_OPERATION,message:yN({key:QO})});this._log.info("destroy room"),this.audioManager.destroy(),this.videoManager.destroy(),this.keyPointManager.destroy(),this.callDurationCalculator.destroy(),this.badCaseDetector.destroy(),this._isDestroyed=!0,AO.emit(kO.ROOM_DESTROY,{room:this})}schedule(e,t,i){return XA(this,null,(function*(){var r,n;let o=sO();try{let{isCached:s,result:a,detailCost:c}=yield function(e){return XA(this,arguments,(function(e){let{userId:t,sdkAppId:i,useStringRoomId:r,roomId:n,userSig:o,version:s,frameWorkType:a}=e;return function*(){if(!rx&&ix)return{isCached:!0,result:ix};let e={delta:0,count:[1,1],msg:[],detail:[]};try{let c=new FormData;c.append("userId",String(t)),c.append("sdkAppId",String(i)),c.append("isStrGroupId",String(r)),c.append("groupId",String(n)),c.append("sdkVersion",s),c.append("userSig",String(o)),c.append("frameWorkType",String(a));let l=sO(),u=yield function(e,t,i){return new Promise(((r,n)=>{let o=null;oO([lx((e=>t.count[0]=e+1),(e=>{let{error:i,retry:r}=e;t.msg[0]=i.message,o||r()}))(ax(i,RD.MAIN),e,{get timeout(){return 1e3*Ww(2+t.count[0])}}),lx((e=>t.count[1]=e+1),(e=>{let{error:i,retry:r}=e;t.msg[1]=i.message,o||r()}))(ax(i,RD.BACKUP),e,{get timeout(){return 1e3*Ww(2+t.count[1])}})]).then((e=>{o=e,r(o)})).catch(n)}))}(c,e,i);u.config&&(u.config.loggerDomain&&rD(u.config.loggerDomain),qw(u.config.scheduleCache)&&nx(!u.config.scheduleCache)),e.delta=sO()-l;let d=function(e,t,i){let r=performance.getEntriesByType("resource"),n=ax(e,RD.MAIN),o=ax(e,RD.BACKUP),s={totalCost:0,local:0,dns:0,tcp:0,tls:0,request:0,response:0};for(let e of r)if(e.startTime>=i&&(e.name===n||e.name===o)&&e.transferSize>0){let i=e.name===n?RD.MAIN:RD.BACKUP,r=Math.round(e.duration),o=Math.round(e.domainLookupStart-e.startTime),a=Math.round(e.domainLookupEnd-e.domainLookupStart),c=Math.round(e.requestStart-e.secureConnectionStart),l=Math.round(e.secureConnectionStart-e.connectStart),u=Math.round(e.responseStart-e.requestStart),d=Math.round(e.responseEnd-e.responseStart),h=[o,a,c,l,u,d];EP.uploadEvent({log:"stat-schedule-net:".concat(r,"(").concat(h.join("->"),") ").concat(i),userId:t}),s=GA(WA({},s),{totalCost:r,local:o,dns:a,tcp:l,tls:c,request:u,response:d});break}return s}(Number(i),t,l);return ix=u,{isCached:!1,result:u,detailCost:d}}catch(e){let t=$w(e)?e[0]:e,i=Yw(t.code)?t.code:0,r="schedule failed".concat(t.message?": ".concat(t.message):""),n=new ab({code:ob.SCHEDULE_FAILED,extraCode:i,message:yN({key:JO,data:{error:r,code:i}})});throw wO.error(n),n}}()}))}({userId:this.userId,sdkAppId:this.sdkAppId,roomId:e,useStringRoomId:this.useStringRoomId,version:i,userSig:this.userSig,frameWorkType:t});this._isUsingCachedSchedule=s,this._log.info("schedule cache:".concat(+s," ").concat(SO(a,{keysToExclude:["username","credential"]}))),s&&AO.once(kO.JOIN_RECEIVED_CMD_RES,(()=>this.sendAbilityStatus({scheduleCache:1}))),this.scheduleResult=WA(WA({},this.scheduleResult),a),Yw(null==(r=a.config)?void 0:r.retryCount)&&zD(a.config.retryCount),zw(null==(n=a.config)?void 0:n.loggerDomain)&&rD(a.config.loggerDomain),AO.emit(kO.JOIN_SCHEDULE_SUCCESS,{room:this,schedule:this.scheduleResult,detailCost:c}),AO.emit(kO.API_SUCCESS_RATE,{room:this,apiName:"schedule",cost:sO()-o})}catch(e){throw AO.emit(kO.API_SUCCESS_RATE,{room:this,apiName:"schedule",error:e}),e}}))}},bx=new WeakMap,kx=new WeakMap;function Dx(){return function(e,t,i){let r=i.value,n=e=>{let{fn:t,args:i,context:r,resolve:n,reject:o}=e;t.apply(r,i).then(n,o)};return i.value=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return new Promise(((e,i)=>{if(bx.has(this)){let o=bx.get(this),{length:s}=o;o.push({fn:r,args:t,context:this,resolve:e,reject:i}),0===s&&n({fn:r,args:t,context:this,resolve:e,reject:i})}else bx.set(this,[{fn:r,args:t,context:this,resolve:e,reject:i}]),n({fn:r,args:t,context:this,resolve:e,reject:i})})).finally((()=>{let e=bx.get(this);e&&(e.shift(),e[0]&&n(WA({},e[0])))}))},i}}function wx(e){return function(t,i,r){let n=r.value,o=t=>Yw(e)?t[e]:e(...t),s=e=>{let{fn:t,args:i,context:r,resolve:n,reject:a}=e;t.apply(r,i).then(n,a).finally((()=>{if(kx.has(r)&&kx.get(r).has(o(i))){let e=kx.get(r).get(o(i));e&&(e.shift(),e[0]&&s(WA({},e[0])))}}))};return r.value=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return new Promise(((e,i)=>{if(kx.has(this))if(kx.get(this).has(o(t))){let r=kx.get(this).get(o(t));if(r){let{length:o}=r;r.push({fn:n,args:t,context:this,resolve:e,reject:i}),0===o&&s({fn:n,args:t,context:this,resolve:e,reject:i})}}else kx.get(this).set(o(t),[{fn:n,args:t,context:this,resolve:e,reject:i}]),s({fn:n,args:t,context:this,resolve:e,reject:i});else{let r=new Map;r.set(o(t),[{fn:n,args:t,context:this,resolve:e,reject:i}]),kx.set(this,r),s({fn:n,args:t,context:this,resolve:e,reject:i})}}))},r}}var Ox,Nx=QA($A()),Px=QA(ib()),Mx=e=>{let{serverAbility:t,clientAbility:i,offerSDP:r,enableCustomMessage:n}=e,o=NV(r),s={extmapAllowMixed:"extmap-allow-mixed",groups:o.groups,icelite:"ice-lite",media:[],msidSemantic:{semantic:"",token:"WMS"},name:"-",origin:{address:"127.0.0.1",username:"-",sessionId:String(Date.now()),sessionVersion:1,netType:"IN",ipVer:4},timing:{start:0,stop:0},version:0},a={candidates:t.candidates.map((e=>({component:1,foundation:"1",generation:0,ip:e.ip,port:e.port,priority:e.priority,transport:e.foundation,type:e.type}))),connection:{version:4,ip:"0.0.0.0"},direction:RD.TRANSCEIVER_DIRECTION_RECVONLY,ext:t.audio.extensions.map((e=>({value:e.id,uri:e.uri}))),fingerprint:{type:t.dtls.hash,hash:t.dtls.fingerprint},fmtp:[{payload:t.audio.codecs[0].payload,config:t.audio.codecs[0].fmtp}],icePwd:t.ice.password,iceUfrag:t.ice.ufrag,mid:"0",payloads:String(t.audio.codecs[0].payload),port:o.media[0].port,protocol:o.media[0].protocol,type:RD.AUDIO,setup:t.dtls.setup,rtcpFb:t.audio.codecs[0].rtcpfb.map((e=>({payload:t.audio.codecs[0].payload,type:e.id,subtype:e.params[0]}))),rtcpMux:"rtcp-mux",rtcpRsize:"rtcp-rsize",rtp:[{payload:t.audio.codecs[0].payload,codec:t.audio.codecs[0].codec,rate:t.audio.codecs[0].rate,encoding:t.audio.codecs[0].channels}]};return s.media.push(a),[1,2,3].forEach((e=>{s.media.push(Lx({mid:e,serverAbility:t,clientAbility:i,parsedOffer:o}))})),n&&s.media.push(o.media.find((e=>"dc"===e.mid))),PV(s)},Lx=e=>{let{mid:t,serverAbility:i,clientAbility:r,parsedOffer:n,useAllCodec:o=!1}=e,s={candidates:i.candidates.map((e=>({component:1,foundation:"1",generation:0,ip:e.ip,port:e.port,priority:e.priority,transport:e.foundation,type:e.type}))),connection:{version:4,ip:"0.0.0.0"},direction:RD.TRANSCEIVER_DIRECTION_RECVONLY,ext:i.video.extensions.map((e=>({value:e.id,uri:e.uri}))),fingerprint:{type:i.dtls.hash,hash:i.dtls.fingerprint},fmtp:[],icePwd:i.ice.password,iceUfrag:i.ice.ufrag,mid:String(t),payloads:"",port:n.media[0].port,protocol:n.media[0].protocol,type:RD.VIDEO,setup:i.dtls.setup,rtcpFb:[],rtcpMux:"rtcp-mux",rtcpRsize:"rtcp-rsize",rtp:[]};if(i.video.codecs.length>0)if(o)for(let e=0;e<i.video.codecs.length;e++)Vx(s,i.video.codecs[e]);else{let e=i.video.codecs.findIndex((e=>e.codec.toLowerCase()===(i.useVp8?"vp8":"h264")));Vx(s,i.video.codecs[e])}else if(o)for(let e=0;e<r.video.codecs.length;e++)Vx(s,r.video.codecs[e]);else Vx(s,r.video.codecs[0]);return s.payloads=s.payloads.trim(),s},Vx=(e,t)=>{e.payloads="".concat(e.payloads," ").concat(t.payload),e.fmtp.push({payload:t.payload,config:t.fmtp}),e.rtcpFb=[...e.rtcpFb||[],...(t.rtcpfb||t.rtcpFb).map((e=>({payload:t.payload,type:e.id,subtype:e.params[0]})))],e.rtp.push({payload:t.payload,codec:t.codec.toUpperCase(),rate:t.rate}),t.rtx&&(e.payloads="".concat(e.payloads," ").concat(t.rtx),e.fmtp.push({payload:t.rtx,config:"apt=".concat(t.payload)}),e.rtp.push({payload:t.rtx,codec:"rtx",rate:t.rate}))},xx=e=>{let t=Px.default.parse(e);return t.media.forEach((e=>{var i;(e.type===RD.AUDIO||e.type===RD.VIDEO)&&(function(e){if(!e.rtcpFb)return;let t=[];e.rtcpFb.forEach(((i,r)=>{var n;t.push(i),e.rtcpFb&&(null==(n=e.rtcpFb[r+1])?void 0:n.payload)!==i.payload&&"rrtr"!==i.type&&t.push({payload:i.payload,type:"rrtr"})})),e.rtcpFb=t}(e),function(e){e.type===RD.VIDEO&&e.fmtp&&e.fmtp.forEach((e=>{e.config.includes("apt")||(e.config+=";sps-pps-idr-in-keyframe=1")}))}(e),function(e){e.type===RD.AUDIO&&e.fmtp&&e.fmtp.forEach((e=>{e.config+=";sprop-stereo=1;stereo=1"}))}(e),function(e){let t=new Set(["urn:ietf:params:rtp-hdrext:sdes:mid","urn:ietf:params:rtp-hdrext:sdes:rtp-stream-id","urn:ietf:params:rtp-hdrext:sdes:repaired-rtp-stream-id"]);e.ext&&(e.ext=e.ext.filter((e=>!t.has(e.uri))))}(e)),(null==(i=e.payloads)?void 0:i.includes("datachannel"))&&t.groups&&e.mid&&(t.groups[0].mids=t.groups[0].mids.replace(e.mid,"dc"),e.mid="dc")})),Px.default.write(t)},Ux=((Ox=Ux||{}).TRACK="track",Ox.DATA_CHANNEL_MESSAGE="data_channel_msg",Ox[Ox.CONNECTION_STATE_CHANGED="connection-state-changed"]="CONNECTION_STATE_CHANGED",Ox[Ox.FIREWALL_RESTRICTION="firewall-restriction"]="FIREWALL_RESTRICTION",Ox.RECONNECTED="spc-reconnected",Ox.RECONNECT_FAILED="spc-reconnect-failed",Ox.ERROR="error",Ox),Fx=0,Bx=!1,Hx=new Set,jx=1,Wx=class extends Nx.default{constructor(e){let{signalChannel:t,room:i,enableCustomMessage:r}=e;super(),YA(this,"stat",{iceStartTime:0,iceEndTime:0,dtlsStartTime:0,dtlsEndTime:0,peerConnectionStartTime:0,peerConnectionEndTime:0}),YA(this,"currentState","DISCONNECTED"),YA(this,"_room"),YA(this,"_signalChannel"),YA(this,"_peerConnection",null),YA(this,"_datachannel",null),YA(this,"_enableCustomMessage"),YA(this,"_log"),YA(this,"_downlinkMIDMap",new Map),YA(this,"_reconnectionTimer",-1),YA(this,"reconnectionCount",0),YA(this,"_clientAbility",null),YA(this,"_serverAbility",null),YA(this,"addDownlinkQueue",new Set),YA(this,"removeDownlinkQueue",new Set),YA(this,"_parsedAnswer",null),YA(this,"_updateSDPPromise",null),YA(this,"_waitForPCConnectedPromise"),YA(this,"_waitForPCConnectedPromiseReject",null),YA(this,"_isSDPLogged",!1),this._room=i,this._enableCustomMessage=r,this._signalChannel=t,this._log=wO.createLogger({id:"spc".concat(jx++),userId:this._room.userId,sdkAppId:this._room.sdkAppId})}get isH264EncodeSupported(){let e=this._room.checkSystemResult.detail.isH264EncodeSupported;return this._serverAbility&&(e=e&&!!this._serverAbility.video.codecs.find((e=>"h264"===e.codec.toLowerCase()))),e}get isVP8EncodeSupported(){let e=this._room.checkSystemResult.detail.isVp8EncodeSupported;return this._serverAbility&&(e=e&&this._serverAbility.useVp8),e}get uplinkSSRC(){return this._peerConnection&&this._peerConnection.localDescription?(e=>{let t=NV(e),i={audioSsrc:0,audioRtxSsrc:0,bigVideoSsrc:0,bigVideoRtxSsrc:0,smallVideoSsrc:0,smallVideoRtxSsrc:0,auxVideoSsrc:0,auxVideoRtxSsrc:0};return t.media.forEach(((e,t)=>{var r;if(e.ssrcs&&!Qw(e.ssrcs[0].id)){let n=Number(e.ssrcs[0].id),o=Number(null==(r=e.ssrcs.filter((e=>"cname"===e.attribute))[1])?void 0:r.id);switch(t){case 0:i.audioSsrc=n;break;case 1:i.bigVideoSsrc=n,i.bigVideoRtxSsrc=o;break;case 2:i.smallVideoSsrc=n,i.smallVideoRtxSsrc=o;break;case 3:i.auxVideoSsrc=n,i.auxVideoRtxSsrc=o}}})),i})(this._peerConnection.localDescription.sdp):{audioSsrc:0,audioRtxSsrc:0,bigVideoSsrc:0,bigVideoRtxSsrc:0,smallVideoSsrc:0,smallVideoRtxSsrc:0,auxVideoSsrc:0,auxVideoRtxSsrc:0}}get isReconnecting(){return"RECONNECTING"===this.currentState||this._reconnectionTimer>0||this.reconnectionCount>0}get dtlsTransport(){if(!this._peerConnection)return null;let e=this._peerConnection.getSenders();return 0===e.length?null:e[0].transport}initialize(){return XA(this,null,(function*(){try{this._peerConnection=new RTCPeerConnection({offerExtmapAllowMixed:!0,iceServers:this._room.getIceServers(),iceTransportPolicy:this._room.getIceTransportPolicy(),sdpSemantics:this._room.sdpSemantics,bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",tcpCandidatePolicy:"disable",IceTransportsType:"nohost"}),this._peerConnection.oniceconnectionstatechange=()=>{if(!this._peerConnection)return;let e=this._peerConnection.iceConnectionState;this._log.debug("ice state: ".concat(e)),"checking"===e&&0===this.stat.iceStartTime?this.stat.iceStartTime=Date.now():"connected"===e&&0===this.stat.iceEndTime&&(this.stat.iceEndTime=Date.now())},this._peerConnection.onconnectionstatechange=this.onConnectionStateChange.bind(this),this._peerConnection.ontrack=e=>this.emit("track",e),this._enableCustomMessage&&(this._datachannel=this._peerConnection.createDataChannel("".concat(this._room.userId,"dc")),this._datachannel.binaryType="arraybuffer",this._datachannel.onopen=()=>{this._log.info("datachannel open")},this._datachannel.onclose=()=>{this._log.warn("datachannel close")},this._datachannel.onmessage=e=>{let t=new Jx(e.data);this.emit("data_channel_msg",{data:t})},this._datachannel.onerror=e=>{this._log.warn("datachannel error",e)}),this._peerConnection.addTransceiver(RD.AUDIO,{direction:RD.TRANSCEIVER_DIRECTION_SENDONLY}),this._peerConnection.addTransceiver(RD.VIDEO,{direction:RD.TRANSCEIVER_DIRECTION_SENDONLY}),this._peerConnection.addTransceiver(RD.VIDEO,{direction:RD.TRANSCEIVER_DIRECTION_SENDONLY}),this._peerConnection.addTransceiver(RD.VIDEO,{direction:RD.TRANSCEIVER_DIRECTION_SENDONLY});let e=yield this._peerConnection.createOffer();return yield this.setOffer(e),this.dtlsTransport&&(this.dtlsTransport.onstatechange=()=>{let{dtlsTransport:e}=this;!e||(this._log.debug("dtls state: ".concat(e.state)),"connecting"===e.state&&0===this.stat.dtlsStartTime?this.stat.dtlsStartTime=Date.now():"connected"===e.state&&0===this.stat.dtlsEndTime&&(this.stat.dtlsEndTime=Date.now()))}),this._clientAbility=((e,t)=>{var i,r;let n=NV(e),o={ice:{ufrag:"",password:""},dtls:{hash:"",fingerprint:"",setup:""},audio:{codecs:[],extensions:[]},video:{codecs:[],extensions:[]},useDataChannel:t};o.ice.ufrag=String(n.media[0].iceUfrag),o.ice.password=n.media[0].icePwd||"",n.fingerprint&&(o.dtls.hash=n.fingerprint.type,o.dtls.fingerprint=n.fingerprint.hash,o.dtls.setup=n.setup||""),n.media[0].fingerprint&&(o.dtls.hash=n.media[0].fingerprint.type,o.dtls.fingerprint=n.media[0].fingerprint.hash),o.dtls.setup=n.media[0].setup||"";let s=n.media[0],a=n.media[1];s.ext&&(o.audio.extensions=s.ext.map((e=>({id:e.value,uri:e.uri})))),a.ext&&(o.video.extensions=a.ext.map((e=>({id:e.value,uri:e.uri}))));let c={codec:s.rtp[0].codec,fmtp:s.fmtp[0].config,payload:s.fmtp[0].payload,rate:s.rtp[0].rate,channel:s.rtp[0].encoding,rtcpFb:[],rtx:0};null==(i=s.rtcpFb)||i.forEach((e=>{let{payload:t,type:i,subtype:r}=e;if(t===c.payload){let e={id:i,params:[]};r&&e.params.push(r),c.rtcpFb.push(e)}})),o.audio.codecs.push(c);for(let e=0;e<a.rtp.length;e++){if(["rtx","red","ulpfec"].includes(a.rtp[e].codec))continue;let t=a.fmtp.filter((t=>t.payload===a.rtp[e].payload))[0];o.video.codecs.push({payload:a.rtp[e].payload,codec:a.rtp[e].codec,fmtp:t?t.config:"",rate:a.rtp[e].rate,rtx:"rtx"===(null==(r=a.rtp[e+1])?void 0:r.codec)?a.rtp[e+1].payload:0,rtcpFb:((null==a?void 0:a.rtcpFb)||[]).filter((t=>t.payload===a.rtp[e].payload)).map((e=>{let{type:t,subtype:i}=e;return{id:t,params:i?[i]:[]}}))})}return o})(e.sdp,this._enableCustomMessage),this._clientAbility}catch(e){throw this._log.error("initialize failed ".concat(e)),e}}))}connect(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return XA(this,null,(function*(){try{if("CONNECTED"===this.currentState)return;let i=sO(),r={type:"answer",sdp:Mx({serverAbility:e,clientAbility:this._clientAbility,offerSDP:this._peerConnection.localDescription.sdp,enableCustomMessage:this._enableCustomMessage})};this._serverAbility=e,yield this.setAnswer(r),yield this.waitForPeerConnectionConnected(),t||AO.emit(kO.API_SUCCESS_RATE,{room:this._room,apiName:"SPCConnect",cost:Math.min(sO()-i,3e4)})}catch(t){let i=t instanceof ab&&t.code===ob.API_CALL_ABORTED;throw i||this._log.error("connect failed: ".concat(t),e),this.reset(),!i&&!this.isReconnecting&&(AO.emit(kO.API_SUCCESS_RATE,{room:this._room,apiName:"SPCConnect",error:t}),this.emitConnectionStateChangedEvent("DISCONNECTED"),this.startReconnection()),t}}))}reconnect(){return XA(this,null,(function*(){if(-1===this._reconnectionTimer){if(!this._signalChannel.isConnected)return this._log.warn("reconnect() wait signal channel is connected"),void this._signalChannel.once(aV,this.reconnect,this);try{this.reconnectionCount++,this._log.warn("reconnect() trying [".concat(this.reconnectionCount,"]")),this.reset();let e=yield this.initialize(),t=yield this._signalChannel.sendWaitForResponse({command:"rebuild_pc",responseCommand:pV.REBUILD_PEER_CONNECTION_RES,data:{ability:e},enableLog:!1});yield this.connect(t.data.data.ability,!0),this._log.warn("reconnect() successfully"),this.stopReconnection(),this.emit("spc-reconnected")}catch(e){if(!this.isReconnecting)return;if(null!=e&&e.message.includes("timeout")){let e=Gw(this.reconnectionCount);this._log.warn("reconnect() timeout, try again after ".concat(e/1e3,"s")),this._reconnectionTimer=window.setTimeout((()=>{this.clearReconnectionTimer(),this.reconnect()}),e)}else this._log.error("reconnect() failed ".concat(e)),AO.emit(kO.API_SUCCESS_RATE,{room:this._room,apiName:"SPCReconnect",error:e}),this.reconnectionCount>=YD()&&this._log.warn("SDK has tried reconnect for ".concat(YD()," times, but all failed, please check your network")),this.stopReconnection(),this.emitConnectionStateChangedEvent("DISCONNECTED"),this.emit("error")}}else this._log.warn("reconnect() is reconnecting, ignore current reconnection")}))}getPeerConnection(){return this._peerConnection}startReconnection(){return XA(this,null,(function*(){this._log.warn("start reconnect"),this.emitConnectionStateChangedEvent("RECONNECTING");let e=sO();yield this.reconnect(),AO.emit(kO.API_SUCCESS_RATE,{room:this._room,apiName:"SPCReconnect",cost:Math.min(sO()-e,3e4)})}))}stopReconnection(){this.isReconnecting&&(this._log.info("stop reconnect"),this.reconnectionCount=0,this.clearReconnectionTimer(),this._signalChannel.off(aV,this.reconnect,this))}checkPeerConnectionToReconnect(){var e;!this.isReconnecting&&(null==(e=this._peerConnection)?void 0:e.connectionState)===KD.CLOSED&&this.startReconnection()}clearReconnectionTimer(){-1!==this._reconnectionTimer&&(clearTimeout(this._reconnectionTimer),this._reconnectionTimer=-1)}onConnectionStateChange(e){let t=this._peerConnection.iceConnectionState,i=this.getDTLSTransportState();this._log.info("connectionState: ".concat(e.target.connectionState," ICE: ").concat(t," DTLS: ").concat(i)),e.target.connectionState===KD.CONNECTING&&(0===this.stat.peerConnectionStartTime&&(this.stat.peerConnectionStartTime=Date.now()),this.emitConnectionStateChangedEvent("CONNECTING")),(e.target.connectionState===KD.FAILED||e.target.connectionState===KD.CLOSED)&&(this.emitConnectionStateChangedEvent("DISCONNECTED"),this.startReconnection()),(e.target.connectionState===KD.CONNECTED||e.target.connectionState===KD.COMPLETED)&&(0===this.stat.peerConnectionEndTime&&(this.stat.peerConnectionEndTime=Date.now()),AO.emit(kO.SINGLE_CONNECTION_STAT,{room:this._room,stat:{ice:this.stat.iceEndTime-this.stat.iceStartTime,dtls:this.stat.dtlsEndTime-this.stat.dtlsStartTime,peerConnection:this.stat.peerConnectionEndTime-this.stat.peerConnectionStartTime}}),this.logSelectedCandidate(),this.emitConnectionStateChangedEvent("CONNECTED"))}getDTLSTransportState(){if(!this._peerConnection)return JD;let e=null;return JN()&&0!==this._peerConnection.getSenders().length?(e=this._peerConnection.getSenders()[0].transport,GN()&&0!==this._peerConnection.getReceivers().length&&e?e.state:JD):JD}emitConnectionStateChangedEvent(e){e!==this.currentState&&("RECONNECTING"===this.currentState&&"CONNECTING"===e||(this.emit(Ux.CONNECTION_STATE_CHANGED,{prevState:this.currentState,state:e}),this.currentState=e))}logSelectedCandidate(){return XA(this,null,(function*(){if(!this._peerConnection)return;let e=yield this._peerConnection.getStats();for(let[t,i]of e)if(xN(i)){let t=e.get(i.localCandidateId),r=e.get(i.remoteCandidateId);t&&this._log.info("local candidate: ".concat(t.candidateType," ").concat(t.protocol,":").concat(t.ip||t.address,":").concat(t.port," ").concat(t.networkType||""," ").concat("relay"===t.candidateType?"relayProtocol:".concat(t.relayProtocol):"")),r&&this._log.info("remote candidate: ".concat(r.candidateType," ").concat(r.protocol,":").concat(r.ip||r.address,":").concat(r.port));break}}))}waitForPeerConnectionConnected(){return this._waitForPCConnectedPromise||(this._waitForPCConnectedPromise=new Promise(((e,t)=>{if("CONNECTED"===this.currentState)return e();this._waitForPCConnectedPromiseReject=t;let i=t=>{"CONNECTED"===t.state&&(clearTimeout(o),n(),e())},r=e=>{let{room:i}=e;i===this._room&&(clearTimeout(o),n(),t(new ab({code:ob.API_CALL_ABORTED,message:yN({key:mN,data:"leave room"})})))},n=()=>{AO.off(kO.LEAVE_SUCCESS,r,this),this.off(Ux.CONNECTION_STATE_CHANGED,i,this)},o=setTimeout((()=>{n();let e=new ab({code:ob.API_CALL_TIMEOUT,message:"connection timeout"});Fx+=1,(e=>Fx>2&&!Bx&&0===Hx.size&&e)(this._signalChannel.isConnected)&&(this._log.warn("firewall restrition"),Bx=!0,this.emit(Ux.FIREWALL_RESTRICTION)),t(e)}),uw);AO.on(kO.LEAVE_SUCCESS,r,this),this.on(Ux.CONNECTION_STATE_CHANGED,i,this)})),this._waitForPCConnectedPromise=this._waitForPCConnectedPromise.finally((()=>{this._waitForPCConnectedPromise=null,this._waitForPCConnectedPromiseReject=null}))),this._waitForPCConnectedPromise}waitForReconnected(){return this.isReconnecting?new Promise(((e,t)=>{this.once("spc-reconnected",e),this.once("error",t)})):Promise.resolve()}addDownlink(e){return XA(this,null,(function*(){if(this._log.info("addDownlink(".concat(e.userId,") trying")),this.isReconnecting&&(yield this.waitForReconnected()),this.updateLocalAndRemoteSDPConfig(e),0===this.addDownlinkQueue.size)try{yield this.updateSDP({isNeedToCreateOffer:!0}),this._log.info("addDownlink(".concat(e.userId,") done"))}catch(t){this._log.info("addDownlink(".concat(e.userId,") failed")),yield this.startReconnection()}}))}updateLocalAndRemoteSDPConfig(e){let{ssrc:t,userId:i,tinyId:r}=e;if(!this._peerConnection)return;this._log.info("updateLocalAndRemoteSDPConfig ".concat(i," ").concat(JSON.stringify(t)));let n,o,s,a=this._peerConnection.getTransceivers().filter((e=>"inactive"===e.direction)).slice(0,3).map((e=>(e.direction=RD.TRANSCEIVER_DIRECTION_RECVONLY,Number(e.mid))));if(0===a.length&&(this._peerConnection.addTransceiver(RD.AUDIO,{direction:RD.TRANSCEIVER_DIRECTION_RECVONLY}),this._peerConnection.addTransceiver(RD.VIDEO,{direction:RD.TRANSCEIVER_DIRECTION_RECVONLY}),this._peerConnection.addTransceiver(RD.VIDEO,{direction:RD.TRANSCEIVER_DIRECTION_RECVONLY})),this._parsedAnswer||(this._parsedAnswer=NV(this._peerConnection.remoteDescription.sdp)),3===a.length)n=this._parsedAnswer.media.find((e=>Number(e.mid)===Number(a[0]))),o=this._parsedAnswer.media.find((e=>Number(e.mid)===Number(a[1]))),s=this._parsedAnswer.media.find((e=>Number(e.mid)===Number(a[2])));else{n=JSON.parse(JSON.stringify(this._parsedAnswer.media[0]));let e=Lx({mid:1,serverAbility:this._serverAbility,clientAbility:this._clientAbility,parsedOffer:NV(this._peerConnection.localDescription.sdp),useAllCodec:!0});o=JSON.parse(JSON.stringify(e)),s=JSON.parse(JSON.stringify(e)),n.mid=this._parsedAnswer.media.length,this._parsedAnswer.media.push(n),o.mid=this._parsedAnswer.media.length,this._parsedAnswer.media.push(o),s.mid=this._parsedAnswer.media.length,this._parsedAnswer.media.push(s)}n.direction=RD.TRANSCEIVER_DIRECTION_SENDONLY,n.ssrcs=[{id:t.audio,attribute:"cname",value:"".concat(r)},{id:t.audio,attribute:"msid",value:"".concat(r,"-").concat(RD.MAIN," ").concat(r,"-audio")}],o.direction=RD.TRANSCEIVER_DIRECTION_SENDONLY,o.ssrcs=[{id:t.video,attribute:"cname",value:"".concat(r)},{id:t.video,attribute:"msid",value:"".concat(r,"-").concat(RD.MAIN," ").concat(r,"-bigvideo")},{id:t.videoRtx,attribute:"cname",value:"".concat(r)},{id:t.videoRtx,attribute:"msid",value:"".concat(r,"-").concat(RD.MAIN," ").concat(r,"-bigvideo")}],o.ssrcGroups=[{semantics:"FID",ssrcs:"".concat(t.video," ").concat(t.videoRtx)}],s.direction=RD.TRANSCEIVER_DIRECTION_SENDONLY;let c="".concat(r,"-aux");s.ssrcs=[{id:t.auxiliary,attribute:"cname",value:c},{id:t.auxiliary,attribute:"msid",value:"".concat(c," ").concat(r,"-aux").concat(RD.VIDEO)},{id:t.auxiliaryRtx,attribute:"cname",value:"".concat(c," ").concat(r,"-aux").concat(RD.VIDEO)},{id:t.auxiliaryRtx,attribute:"msid",value:"".concat(c," ").concat(r,"-aux").concat(RD.VIDEO)}],s.ssrcGroups=[{semantics:"FID",ssrcs:"".concat(t.auxiliary," ").concat(t.auxiliaryRtx)}],this._parsedAnswer.groups&&(this._parsedAnswer.groups[0].mids=this._parsedAnswer.media.map((e=>e.mid)).join(" ")),this._downlinkMIDMap.set(r,[n.mid,o.mid,s.mid])}removeDownlink(e,t){return XA(this,null,(function*(){if(!this._downlinkMIDMap.has(e)||!this._peerConnection)return;this._log.info("removeDownlink(".concat(t,") trying")),this.isReconnecting&&(yield this.waitForReconnected());let i=this._downlinkMIDMap.get(e),r=!1;this._peerConnection.getTransceivers().forEach((e=>{null!=i&&i.includes(Number(e.mid))&&(r=!0,e.direction="inactive")})),this._parsedAnswer||(this._parsedAnswer=NV(this._peerConnection.remoteDescription.sdp)),this._parsedAnswer.media.forEach((e=>{null!=i&&i.includes(Number(e.mid))&&(r=!0,e.direction="inactive",e.ssrcs=[],e.ssrcGroups=[])})),0===this.removeDownlinkQueue.size&&r&&(yield this.updateSDP({isNeedToCreateOffer:!0,tinyIdRemoving:e})),this._downlinkMIDMap.delete(e),this._log.info("removeDownlink(".concat(t,") done"))}))}getDownlinkMids(e){return this._downlinkMIDMap.get(e)}setBandwidth(e){return XA(this,null,(function*(){if(!this._peerConnection)return;let{audio:t,bigVideo:i,smallVideo:r,auxVideo:n}=e;try{if(XN()){let e=this._peerConnection.getSenders().slice(0,4);for(let o=0;o<e.length;o++){let s,a=e[o];0===o&&t?s=t:1===o&&i?s=i:2===o&&r?s=r:3===o&&n&&(s=n),s&&(yield this.setSenderMaxBitrate(a,s))}}else yield this.setBandwidthBySDP(e);this._log.info("setBandwidth ".concat(JSON.stringify(e)))}catch(e){this._log.error("failed to set bandwidth".concat(e))}}))}setSenderMaxBitrate(e,t){let i=e.getParameters();return(!i.encodings||0===i.encodings.length)&&(i.encodings=[{}]),"unlimited"===t?delete i.encodings[0].maxBitrate:i.encodings[0].maxBitrate=1e3*t,e.setParameters(i)}setBandwidthBySDP(e){let{audio:t,bigVideo:i,smallVideo:r,auxVideo:n}=e;if(!this._peerConnection||!this._peerConnection.localDescription)return;let o=NV(this._peerConnection.localDescription.sdp);this._parsedAnswer||(this._parsedAnswer=NV(this._peerConnection.remoteDescription.sdp));let s=kb?"TIAS":"AS";t&&(o.media[0].bandwidth=[{type:s,limit:kb?1e3*t:t}],this._parsedAnswer.media[0].bandwidth=[{type:s,limit:kb?1e3*t:t}]),i&&(o.media[1].bandwidth=[{type:s,limit:kb?1e3*i:i}],this._parsedAnswer.media[1].bandwidth=[{type:s,limit:kb?1e3*i:i}]),r&&(o.media[2].bandwidth=[{type:s,limit:kb?1e3*r:r}],this._parsedAnswer.media[2].bandwidth=[{type:s,limit:kb?1e3*r:r}]),n&&(o.media[3].bandwidth=[{type:s,limit:kb?1e3*n:n}],this._parsedAnswer.media[3].bandwidth=[{type:s,limit:kb?1e3*n:n}]);let a={type:"offer",sdp:PV(o)};return this.updateSDP({localDescription:a})}updateSDP(e){let{isNeedToCreateOffer:t=!1,localDescription:i,tinyIdRemoving:r}=e;if(!this._parsedAnswer)return;let n=PV(this._parsedAnswer);return this._updateSDPPromise=new Promise(((e,r)=>XA(this,null,(function*(){try{t&&this._peerConnection&&(this._log.info("creating offer"),i=yield this._peerConnection.createOffer()),i&&(yield this.setOffer(i)),yield this.setAnswer({type:"answer",sdp:n}),this._updateSDPPromise=null,e()}catch(e){this._log.error(e),!this._isSDPLogged&&this._peerConnection&&(this._log.warn("transceivers: ".concat(JSON.stringify(this._peerConnection.getTransceivers().map((e=>{let{mid:t,currentDirection:i,direction:r,stopped:n}=e;return{mid:t,currentDirection:i,direction:r,stopped:n}}))))),this._log.warn("parsedAnswer: ".concat(JSON.stringify(this._parsedAnswer))),this._log.warn("local sdp: ".concat(null==i?void 0:i.sdp)||0),this._log.warn("remote sdp: ".concat(n)||0),this._isSDPLogged=!0),this._updateSDPPromise=null,r(e)}})))),this._updateSDPPromise}setOffer(e){return this._log.info("setting offer"),this._peerConnection.setLocalDescription({type:"offer",sdp:xx(e.sdp)})}setAnswer(e){return this._log.info("setting answer"),this._room.enableHWEncoder&&e.sdp&&(e.sdp=e.sdp.replaceAll("42e01f","42001f")),this._peerConnection.setRemoteDescription(e)}sendDataChannelMessage(e){var t;null==(t=this._datachannel)||t.send(e)}reset(){var e;null==(e=this._peerConnection)||e.close(),this._waitForPCConnectedPromise=null,this._parsedAnswer=null}close(){this._log.info("close pc"),this.reset(),this.emitConnectionStateChangedEvent("DISCONNECTED"),this._downlinkMIDMap.clear(),this.stopReconnection(),this.removeAllListeners()}};zA([Dx()],Wx.prototype,"updateSDP",1);var Gx=class{constructor(e){YA(this,"tag"),YA(this,"len"),YA(this,"data");let t=new DataView(e);this.tag=t.getUint16(),this.len=t.getUint16(2),this.data=new Uint8Array(e).slice(4,4+this.len).buffer}},Jx=class{constructor(e){YA(this,"tinyId"),YA(this,"data");let t=new DataView(e),i=0,r=[];for(;i<t.byteLength;){let n=t.getUint16(i+2),o=new Gx(new Uint8Array(e).slice(i,i+2+2+n).buffer);r.push(o),i+=4+n}r.forEach((e=>{1===e.tag?this.tinyId=(new TextDecoder).decode(e.data):2===e.tag&&(this.data=e.data)}))}},Kx=new Set;function Qx(){let e=Math.floor(4294967296*Math.random());return Kx.has(e)?Qx():(Kx.add(e),e)}var zx=QA($A()),Yx=class extends zx.default{constructor(e){super(),YA(this,"userId"),YA(this,"tinyId"),YA(this,"_sdpSemantics"),YA(this,"_isUplink"),YA(this,"_room"),YA(this,"_log"),YA(this,"_signalChannel"),YA(this,"_currentState","DISCONNECTED"),YA(this,"_prevTime",-1),YA(this,"_enableSEI"),YA(this,"_sei"),this.userId=e.userId,this.tinyId=e.tinyId,this._room=e.room,this._sdpSemantics=e.room.sdpSemantics,this._isUplink=e.isUplink,this._log=wO.createLogger({id:"n",userId:this._room.userId,remoteUserId:this._isUplink?void 0:this.userId,sdkAppId:this._room.sdkAppId,isLocal:this._isUplink}),this._signalChannel=e.signalChannel,this._enableSEI=e.enableSEI,this._enableSEI&&eP&&(this._sei=new CV(this,this._log,this._isUplink))}get _peerConnection(){var e;return(null==(e=this.singlePC)?void 0:e.getPeerConnection())||null}get singlePC(){return this._room.singlePC}close(e){this._log.info("close connection"),this.emit("closed",e),this._sei&&(this._sei.destroy(),this._sei=null)}emitConnectionStateChangedEvent(e){return e!==this._currentState&&(AO.emit(kO.PEER_CONNECTION_STATE_CHANGED,{room:this._room,prevState:this._currentState,state:e,remoteUserId:this._isUplink?void 0:this.userId}),this.emit("connection-state-changed",{prevState:this._currentState,state:e}),this._currentState=e,!0)}getPeerConnection(){return this._peerConnection}getRoom(){return this._room}getUserId(){return this.userId}getTinyId(){return this.tinyId}getCurrentState(){return this._currentState}get isH264(){var e,t;return!(null==(t=null==(e=this._peerConnection)?void 0:e.remoteDescription)||!t.sdp.includes("H264"))}},qx=class extends Yx{constructor(e){super(GA(WA({},e),{isUplink:!0})),YA(this,"localMainAudioTrack",null),YA(this,"localMainVideoTrack",null),YA(this,"localAuxAudioTrack",null),YA(this,"localAuxVideoTrack",null),YA(this,"_isPublishingAux",!1),YA(this,"_publishingLocalAudioTrack"),YA(this,"_publishingLocalVideoTrack"),YA(this,"_mediaSettings",{videoCodec:"",videoWidth:0,videoHeight:0,videoBps:0,videoFps:0,audioCodec:"opus",audioFs:0,audioChannel:0,audioBps:0,smallVideoWidth:0,smallVideoHeight:0,smallVideoFps:0,smallVideoBps:0,auxVideoWidth:0,auxVideoHeight:0,auxVideoFps:0,auxVideoBps:0}),YA(this,"_audioManager"),this._audioManager=e.audioManager,this.initialize()}get ssrc(){if(!this.singlePC)return{audio:0,video:0,videoRtx:0,small:0,smallRtx:0,auxiliary:0,auxiliaryRtx:0};let{audioSsrc:e,bigVideoSsrc:t,bigVideoRtxSsrc:i,smallVideoSsrc:r,smallVideoRtxSsrc:n,auxVideoSsrc:o,auxVideoRtxSsrc:s}=this.singlePC.uplinkSSRC;return{audio:e||0,video:t||0,videoRtx:i||0,small:r||0,smallRtx:n||0,auxiliary:o||0,auxiliaryRtx:s||0}}get isMainStreamPublished(){return!(!this.localMainAudioTrack&&!this.localMainVideoTrack)}get isAuxStreamPublished(){return!(!this.localAuxVideoTrack&&!this.localAuxAudioTrack)}get publishState(){var e,t,i,r;let n={audio:!1,bigVideo:!1,smallVideo:!1,auxVideo:!1};if(this._peerConnection){let o=this._peerConnection.getSenders();o&&(KN()?(n.audio=!(null==(e=o[0])||!e.track),n.bigVideo=!(null==(t=o[1])||!t.track),n.smallVideo=!(null==(i=o[2])||!i.track),n.auxVideo=!(null==(r=o[3])||!r.track)):o.forEach((e=>{e.track&&(e.track.kind===RD.AUDIO?n.audio=!0:(n.bigVideo=!0,this._room.videoManager.hasSmall&&(n.smallVideo=!0)))})))}return n}initialize(){this.installEvents()}reset(){this.uninstallEvents()}close(e){super.close(e),this.reset(),this.emitConnectionStateChangedEvent("DISCONNECTED")}installEvents(){var e;this.listeners("connection-state-changed").includes(this.handleConnectionStateChange)||this.on("connection-state-changed",this.handleConnectionStateChange,this),this.listeners("spc-reconnected").includes(this.onSinglePCReconnected)||null==(e=this.singlePC)||e.on("spc-reconnected",this.onSinglePCReconnected,this)}uninstallEvents(){var e;this.off("connection-state-changed",this.handleConnectionStateChange,this),null==(e=this.singlePC)||e.off("spc-reconnected",this.onSinglePCReconnected,this)}emitConnectionStateChangedEvent(e,t){var i,r,n;let o=this._currentState,s=super.emitConnectionStateChangedEvent(e);return s&&o!==e&&(t?t.emit("connection-state-changed",{prevState:o,state:e}):(null==(i=this.localMainVideoTrack)||i.emit("connection-state-changed",{prevState:o,state:e}),null==(r=this.localAuxVideoTrack)||r.emit("connection-state-changed",{prevState:o,state:e}),null==(n=this._publishingLocalVideoTrack)||n.emit("connection-state-changed",{prevState:o,state:e}))),s}publish(e){return XA(this,arguments,(function(e){var t=this;let{localAudioTrack:i,localVideoTrack:r,isAuxiliary:n}=e;return function*(){var e,o,s,a,c,l;if(!t.singlePC)return;if(yield t.singlePC.waitForPeerConnectionConnected(),i&&(t._publishingLocalAudioTrack=i),r){if(!t.singlePC.isH264EncodeSupported&&!t.singlePC.isVP8EncodeSupported)throw new ab({code:ob.NOT_SUPPORTED_H264,message:yN({key:iN})});Rb&&115===Ek()&&r.profile.width*r.profile.height<=230400&&(t._log.warn("fallback video to 480p"),r.setProfile(ED["480p_2"]),yield r.applyProfile()),t._publishingLocalVideoTrack=r}let u;t._isPublishingAux=n,r&&!n&&r.small&&(u=t._room.videoManager.smallTrack),QN()&&(yield t.publishByTransceiver({localAudioTrack:i,localVideoTrack:r,smallTrack:u,isAuxiliary:n})),t._publishingLocalAudioTrack=null,t._publishingLocalVideoTrack=null,t._isPublishingAux=!1,n?(r&&(t.localAuxVideoTrack=r),i&&(t.localAuxAudioTrack=i)):(r&&(t.localMainVideoTrack=r),i&&(t.localMainAudioTrack=i)),yield t.singlePC.setBandwidth({audio:(null==(e=t.localMainAudioTrack)?void 0:e.profile.bitrate)||(null==(o=t.localAuxAudioTrack)?void 0:o.profile.bitrate),bigVideo:null==(s=t.localMainVideoTrack)?void 0:s.profile.bitrate,smallVideo:null==(c=null==(a=t.localMainVideoTrack)?void 0:a.small)?void 0:c.bitrate,auxVideo:null==(l=t.localAuxVideoTrack)?void 0:l.profile.bitrate}),yield t._signalChannel.sendWaitForResponse({command:"publish/v2",responseCommand:pV.SPC_PUBLISH_RESULT,data:GA(WA({},t.singlePC.uplinkSSRC),{state:t.publishState})}),t.sendMediaSettings(),t.installTrackMuteEvents(i,r),t.sendMutedFlag()}()}))}publishByTransceiver(e){let{localAudioTrack:t,localVideoTrack:i,smallTrack:r,isAuxiliary:n}=e;this._log.info("publish by transceiver");let o=null==i?void 0:i.outMediaTrack,s=this._audioManager.mixedAudioTrack,a=this._peerConnection.getTransceivers(),c=[],l=[];if(s){let e=a[0].sender.replaceTrack(s);l.push(0),c.push(e)}if(o)if(n){let e=a[3].sender.replaceTrack(o);l.push(3),c.push(e)}else{let e=a[1].sender.replaceTrack(o);l.push(1),c.push(e)}if(r){let e=a[2].sender.replaceTrack(r);l.push(2),c.push(e)}let u=this.setTransceiverDirection(CD.SENDONLY,l);return c.push(u),Promise.all(c)}installTrackMuteEvents(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach((e=>{e&&(null==e||e.on("mute",this.sendMutedFlag,this),null==e||e.on("unmute",this.sendMutedFlag,this))}))}uninstallTrackMuteEvents(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];t.forEach((e=>{e&&(null==e||e.off("mute",this.sendMutedFlag,this),null==e||e.off("unmute",this.sendMutedFlag,this))}))}unpublish(e){return XA(this,arguments,(function(e){var t=this;let{localAudioTrack:i,localVideoTrack:r}=e;return function*(){let e=r&&r===t.localAuxVideoTrack,n=null==r?void 0:r.outMediaTrack,o=t._peerConnection.getSenders(),s=[];i&&(t._audioManager.mixedAudioTrack||(yield o[0].replaceTrack(null),s.push(0)),e?t.localAuxAudioTrack=null:t.localMainAudioTrack=null),n&&(e?(yield o[3].replaceTrack(null),t.localAuxVideoTrack=null,t._mediaSettings=GA(WA({},t._mediaSettings),{auxVideoBps:0,auxVideoFps:0,auxVideoWidth:0,auxVideoHeight:0}),s.push(3)):(yield o[1].replaceTrack(null),yield o[2].replaceTrack(null),t.localMainVideoTrack=null,t._mediaSettings=GA(WA({},t._mediaSettings),{videoWidth:0,videoHeight:0,videoBps:0,videoFps:0,audioFs:0,audioChannel:0,audioBps:0,smallVideoWidth:0,smallVideoHeight:0,smallVideoFps:0,smallVideoBps:0}),s.push(1,2))),t.isMainStreamPublished||t.isAuxStreamPublished?(yield t.setTransceiverDirection(CD.INACTIVE,s),yield t.doPublishChange(!1)):yield t.doUnpublish(),t.uninstallTrackMuteEvents(i,r),null==r||r.emit("connection-state-changed",{prevState:t._currentState,state:"DISCONNECTED"})}()}))}doPublishChange(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return XA(this,null,(function*(){let t={state:this.publishState,constraintConfig:this._mediaSettings},i=yield this._signalChannel.sendWaitForResponse({command:_V,data:t,responseCommand:pV.PUBLISH_STATE_CHANGE_RESULT,enableLog:e});this.checkPublishResultCode(i.data.code,i.data.message)}))}doUnpublish(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._signalChannel.sendWaitForResponse({command:fV,commandDesc:"unpublish",responseCommand:pV.UNPUBLISH_RESULT,enableLog:e}).catch((e=>{if(e.getCode()===ob.API_CALL_TIMEOUT)return Promise.resolve();throw e}))}updateMediaSettings(){let{detail:{isH264EncodeSupported:e,isVp8EncodeSupported:t}}=this._room.checkSystemResult;e?this._mediaSettings.videoCodec="H264":t&&(this._mediaSettings.videoCodec="VP8");let i=this._publishingLocalAudioTrack||this.localMainAudioTrack||this.localAuxAudioTrack,{localMainVideoTrack:r,localAuxVideoTrack:n}=this;if(this._publishingLocalVideoTrack&&(this._isPublishingAux?n=this._publishingLocalVideoTrack:r=this._publishingLocalVideoTrack),$N){if(i&&i.outMediaTrack){let e=i.outMediaTrack.getSettings();this._mediaSettings.audioChannel=e.channelCount||1,this._mediaSettings.audioBps=1e3*i.profile.bitrate,this._mediaSettings.audioFs=e.sampleRate||0}if(r&&r.outMediaTrack){let e=r.outMediaTrack.getSettings();this._mediaSettings.videoWidth=e.width||0,this._mediaSettings.videoHeight=e.height||0,this._mediaSettings.videoFps=e.frameRate||0,this._mediaSettings.videoBps=1e3*r.profile.bitrate,r.small&&(this._mediaSettings.smallVideoWidth=r.small.width,this._mediaSettings.smallVideoHeight=r.small.height,this._mediaSettings.smallVideoFps=r.small.frameRate,this._mediaSettings.smallVideoBps=1e3*r.small.bitrate)}if(n&&n.outMediaTrack){let e=n.outMediaTrack.getSettings();this._mediaSettings.auxVideoWidth=e.width||0,this._mediaSettings.auxVideoHeight=e.height||0,this._mediaSettings.auxVideoFps=e.frameRate||0,this._mediaSettings.auxVideoBps=1e3*n.profile.bitrate}}else i&&i.outMediaTrack&&(this._mediaSettings.audioChannel=i.profile.channelCount,this._mediaSettings.audioBps=1e3*i.profile.bitrate,this._mediaSettings.audioFs=i.profile.sampleRate),r&&r.outMediaTrack&&(this._mediaSettings.videoWidth=r.profile.width,this._mediaSettings.videoHeight=r.profile.height,this._mediaSettings.videoFps=r.profile.frameRate,this._mediaSettings.videoBps=1e3*r.profile.bitrate);this._log.info("updateMediaSettings: ".concat(JSON.stringify(this._mediaSettings)))}sendMediaSettings(){this.updateMediaSettings(),this._signalChannel.sendWaitForResponse({command:vV,data:this._mediaSettings,responseCommand:pV.UPDATE_CONSTRAINT_CONFIG_RES}).then((e=>{0!==e.data.code&&this._log.warn(e.data.message)})).catch((()=>{}))}addTrack(e){return XA(this,null,(function*(){var t;if(!this._peerConnection)return;let i=e===this.localAuxAudioTrack||e===this.localAuxVideoTrack;this._log.info("is adding ".concat(e.kind," track to current published local ").concat(i?RD.AUXILIARY:RD.MAIN," stream")),null==(t=this._sei)||t.handleEncodedStreams(),KN()&&(yield this.addTrackByTransceiver(e,i))}))}addTrackByTransceiver(e,t){return XA(this,null,(function*(){var i;if(!e.mediaTrack)return;let r=this._peerConnection.getTransceivers();if(e.kind===RD.AUDIO)yield r[0].sender.replaceTrack(this._audioManager.mixedAudioTrack);else{let n=t?3:1;yield r[n].sender.replaceTrack(e.outMediaTrack),1===n&&(null==(i=this.localMainVideoTrack)?void 0:i.small)&&(yield r[2].sender.replaceTrack(this._room.videoManager.smallTrack)),r[n].direction===CD.INACTIVE&&(yield this.setTransceiverDirection(CD.SENDONLY,[n]))}this.updateMediaSettings(),yield this.doPublishChange()}))}removeTrack(e){return XA(this,null,(function*(){if(!this._peerConnection)return;let t=e===this.localAuxAudioTrack||e===this.localAuxVideoTrack;this._log.info("is removing ".concat(e.kind," track from current published local ").concat(t?RD.AUXILIARY:RD.MAIN," stream")),KN()&&(yield this.removeTrackByTransceiver(e,t))}))}removeTrackByTransceiver(e,t){return XA(this,null,(function*(){if(!e.mediaTrack)return;let i=this._peerConnection.getTransceivers();if(e.kind===RD.AUDIO)this._audioManager.mixedAudioTrack||(yield i[0].sender.replaceTrack(null));else{let e=t?3:1;yield i[e].sender.replaceTrack(null),1===e&&this._room.videoManager.hasSmall&&(yield i[2].sender.replaceTrack(null)),yield this.setTransceiverDirection(CD.INACTIVE,[e])}this.updateMediaSettings(),yield this.doPublishChange()}))}setTransceiverDirection(e,t){return XA(this,null,(function*(){if(!kb)return;let i=!1,r=!1;this._log.info("setting transceiver ".concat(t.join(",")," direction to ").concat(e));let n=this._peerConnection.getTransceivers();if(t.forEach((t=>{n[t].direction!==e&&(n[t].direction=e,i=!0)})),i){this._log.info("updating offer");let e=yield this._peerConnection.createOffer();yield this._peerConnection.setLocalDescription(e)}let o=-1,s=this._peerConnection.remoteDescription.sdp.split("\r\n").map((i=>{if(i.match(new RegExp("a=(".concat(CD.INACTIVE,"|").concat(CD.RECVONLY,"|").concat(CD.SENDONLY,")")))&&o++,t.includes(o)){if(e===CD.INACTIVE&&i.includes("a=".concat(CD.RECVONLY)))return r=!0,"a=".concat(e);if(e===CD.SENDONLY&&i.includes("a=".concat(CD.INACTIVE)))return r=!0,"a=".concat(CD.RECVONLY)}return i})).join("\r\n");r&&(this._log.info("updating answer"),yield this._peerConnection.setRemoteDescription({type:"answer",sdp:s}))}))}replaceTrack(e){return XA(this,null,(function*(){var t;let i=null==(t=this._peerConnection)?void 0:t.getSenders(),r=e.mediaTrack;if(!i||0===i.length||!r)return;let n=e===this.localAuxAudioTrack||e===this.localAuxVideoTrack;this._log.info("is replacing ".concat(r.kind," track on ").concat(n?RD.AUXILIARY:RD.MAIN," stream")),r.kind===RD.AUDIO&&i[0]&&(yield i[0].replaceTrack(this._audioManager.mixedAudioTrack)),r.kind===RD.VIDEO&&(!n&&i[1]&&(yield i[1].replaceTrack(e.outMediaTrack||r)),n&&i[3]&&(yield i[3].replaceTrack(e.outMediaTrack)))}))}setBandwidth(e){return XA(this,arguments,(function(e){var t=this;let{bandwidth:i,type:r,videoType:n}=e;return function*(){if(t.singlePC){let e={};r===RD.AUDIO?e.audio=i:"big"===n?e.bigVideo=i:"small"===n?e.smallVideo=i:e.auxVideo=i,yield t.singlePC.setBandwidth(e)}}()}))}sendMutedFlag(e){var t,i,r;if(e===this.localAuxAudioTrack||e===this.localAuxVideoTrack)return;let n={audio:!(null==(t=this.localMainAudioTrack)||!t.muted),bigVideo:!(null==(i=this.localMainVideoTrack)||!i.muted),auxVideo:!(null==(r=this.localAuxVideoTrack)||!r.muted)};this._log.info("send muted state: ".concat(JSON.stringify(n))),this._signalChannel.send(mV,n)}handleConnectionStateChange(e){"CONNECTED"===e.state&&(this.localMainVideoTrack||this._publishingLocalVideoTrack&&!this._isPublishingAux)&&AO.emit(kO.SEND_FIRST_VIDEO_FRAME,{room:this._room})}getVideoTrackId(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:RD.VIDEO;if(this._peerConnection){let t=this._peerConnection.getSenders();if(e===RD.AUXILIARY&&t[3]&&t[3].track)return t[3].track.id;if(e===RD.VIDEO&&t[1]&&t[1].track)return t[1].track.id}if(this.localMainVideoTrack&&e===RD.VIDEO){let e=this.localMainVideoTrack.mediaTrack;if(e)return e.id}if(this.localAuxVideoTrack&&e===RD.AUXILIARY){let e=this.localAuxVideoTrack.mediaTrack;if(e)return e.id}return""}getSSRC(){return this.ssrc}checkPublishResultCode(e,t){if(0!==e)throw e===nw?(this._log.error(fN.NOT_SUPPORTED_H264ENCODE),new ab({code:ob.NOT_SUPPORTED_H264,message:yN({key:iN})})):new ab({code:ob.UNKNOWN,message:yN({key:sN,data:{signalResponse:pV.PUBLISH_RESULT,code:e,message:t}})})}sendSEI(e,t){var i;null==(i=this._sei)||i.push(e,t)}onSinglePCReconnected(){return XA(this,null,(function*(){this.isMainStreamPublished&&(yield this.publish({localAudioTrack:this.localMainAudioTrack,localVideoTrack:this.localMainVideoTrack,isAuxiliary:!1})),this.isAuxStreamPublished&&(yield this.publish({localAudioTrack:this.localAuxAudioTrack,localVideoTrack:this.localAuxVideoTrack,isAuxiliary:!0}))}))}};function Xx(e){return Object.keys(e).filter((t=>e[t]))}var $x=class extends Yx{constructor(e){super(GA(WA({},e),{isUplink:!1})),YA(this,"_flag",0),YA(this,"role","anchor"),YA(this,"remoteAudioTrack"),YA(this,"remoteVideoTrack"),YA(this,"remoteAuxiliaryTrack"),YA(this,"ssrc",{audio:0,video:0,videoRtx:0,auxiliary:0,auxiliaryRtx:0}),this.flag=e.flag,this.remoteAudioTrack=new WM(this._room,this),this.remoteVideoTrack=new GM(this._room,this),this.remoteAuxiliaryTrack=new JM(this._room,this),this.initialize()}get subscribeState(){let e={audio:!1,video:!1,auxiliary:!1,smallVideo:!1};return this.remoteVideoTrack.isSubscribed&&(8&this.remoteVideoTrack.mediaType?e.smallVideo=!0:e.video=!0),this.remoteAudioTrack.isSubscribed&&(e.audio=!0),this.remoteAuxiliaryTrack.isSubscribed&&(e.auxiliary=!0),e}get muteState(){return dO(this.flag,this.userId)}get flag(){return this._flag}set flag(e){var t,i,r;e!==this._flag&&(this._flag=e,null==(t=this.remoteAudioTrack)||t.onFlagChanged(),null==(i=this.remoteVideoTrack)||i.onFlagChanged(),null==(r=this.remoteAuxiliaryTrack)||r.onFlagChanged())}get hasMainStream(){return this.muteState.hasAudio||this.muteState.hasVideo||this.muteState.hasSmall}get hasAuxStream(){return this.muteState.hasAuxiliary}get isMainStreamSubscribed(){return(this.subscribeState.audio||this.subscribeState.video||this.subscribeState.smallVideo)&&(this.muteState.hasAudio||this.muteState.hasVideo||this.muteState.hasSmall)}get isAuxStreamSubscribed(){return this.subscribeState.auxiliary&&this.muteState.hasAuxiliary}get isSmallStreamSubscribed(){return this.subscribeState.smallVideo&&this.muteState.hasSmall}get isBigStreamSubscribed(){return this.subscribeState.video&&this.muteState.hasVideo}isStreamUnpublished(e){return e===RD.MAIN?!this.muteState.hasAudio&&!this.muteState.hasVideo:!this.muteState.hasAuxiliary}initialize(){this.installEvents()}close(e){super.close(e),this.emitConnectionStateChangedEvent("DISCONNECTED"),this.remoteAudioTrack.close(),this.remoteVideoTrack.close(),this.remoteAuxiliaryTrack.close(),this.uninstallEvents(),this.removeDownlink()}installEvents(){!this.singlePC||(this.listeners("track").includes(this.onTrack)||this.singlePC.on("track",this.onTrack,this),this.listeners("spc-reconnected").includes(this.onSinglePCReconnected)||this.singlePC.on("spc-reconnected",this.onSinglePCReconnected,this))}uninstallEvents(){!this.singlePC||(this.singlePC.off("track",this.onTrack,this),this.singlePC.off("spc-reconnected",this.onSinglePCReconnected,this))}emitConnectionStateChangedEvent(e){var t,i;let r=this._currentState,n=super.emitConnectionStateChangedEvent(e);return n&&r!==e&&(null==(t=this.remoteVideoTrack)||t.emit("connection-state-changed",{prevState:r,state:e}),null==(i=this.remoteAuxiliaryTrack)||i.emit("connection-state-changed",{prevState:r,state:e})),n}onTrack(e){let t=e.streams[0],{track:i}=e;if(t.id.split("-")[0]!==this.tinyId)return;let r=t.id.includes("aux")?"auxiliary":"main";this._log.debug("ontrack ".concat(r," ").concat(i.kind));let n=RD.AUDIO;i.kind===RD.VIDEO&&(n=r===RD.MAIN?RD.VIDEO:RD.AUXILIARY);let o=this.remoteAudioTrack;n===RD.VIDEO?o=this.remoteVideoTrack:n===RD.AUXILIARY&&(o=this.remoteAuxiliaryTrack),o.setInputMediaStreamTrack(i)}isSubscriptionStateNotChanged(e){return JSON.stringify(e)===JSON.stringify(this.subscribeState)}subscribe(e,t){return XA(this,null,(function*(){try{if(this.isSubscriptionStateNotChanged(e))return;if(this._log.info("subscribe ".concat(t," ").concat(Xx(e))),this.hasSSRC){let t="subscribe_change";Object.values(e).find((e=>!0===e))||(t="unsubscribe"),yield this.sendSubscription(t,e)}else yield this.doSubscribe(e)}catch(e){throw this._room.isJoined&&this.isStreamUnpublished(t)?(this._log.warn("".concat(e.message," ").concat(JSON.stringify(this.muteState))),new ab({code:ob.REMOTE_STREAM_NOT_EXIST,message:"remote user ".concat(this.userId," unpublished stream")})):e}}))}unsubscribe(e){return XA(this,arguments,(function(e){var t=this;let{remoteTracks:i,streamType:r}=e;return function*(){var e;if("main"===r&&!t.isMainStreamSubscribed||"auxiliary"===r&&!t.isAuxStreamSubscribed)return void t._log.info("".concat(r," stream already unsubscribed"));let n=WA({},t.subscribeState);i.forEach((e=>{switch(e.mediaType){case 1:n.audio=!1;break;case 4:n.video=!1;break;case 8:n.smallVideo=!1;break;case 2:n.auxiliary=!1}}));let o="subscribe_change";Object.values(n).find((e=>!0===e))||(o="unsubscribe"),t._log.info("".concat("unsubscribe"===o?o:"subscribe"," ").concat(r," [").concat(Xx(n),"]")),"unsubscribe"===o&&(null==(e=t.singlePC)||e.removeDownlinkQueue.add(t.tinyId)),yield t.sendSubscription(o,n),"unsubscribe"===o&&(yield t.removeDownlink())}()}))}sendSubscription(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.subscribeState,i={srcTinyId:this.tinyId,srcUserId:this.userId},r=gV,n=pV.UNSUBSCRIBE_RESULT;return"subscribe_change"===e&&(i={audio:t.audio,bigVideo:t.video,auxVideo:t.auxiliary,smallVideo:t.smallVideo,srcTinyId:this.tinyId},r=TV,n=pV.SUBSCRIBE_CHANGE_RESULT),this._signalChannel.sendWaitForResponse({command:r,data:i,responseCommand:n,timeout:1e4}).then((t=>{let{data:i}=t;if(0!==i.code){let t=new ab({code:i.code,message:yN({key:VO,data:{type:e,message:i.message}})});throw this._log.error(t),t}}))}getMainStreamVideoTrackId(){return this.remoteVideoTrack&&this.remoteVideoTrack.mediaTrack?this.remoteVideoTrack.mediaTrack.id:""}getAuxStreamVideoTrackId(){return this.remoteAuxiliaryTrack&&this.remoteAuxiliaryTrack.mediaTrack?this.remoteAuxiliaryTrack.mediaTrack.id:""}setDelay(e){let{audioDelay:t,videoDelay:i}=e;this.remoteAudioTrack.stat.end2EndDelay=t,this.remoteVideoTrack.stat.end2EndDelay=i}onSinglePCReconnected(){(this.ssrc.audio||this.ssrc.video||this.ssrc.auxiliary)&&this.doSubscribe(this.subscribeState,!1)}get hasSSRC(){return this.ssrc.audio&&this.ssrc.video&&this.ssrc.auxiliary}doSubscribe(){return XA(this,arguments,(function(){var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.subscribeState,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return function*(){if(e.singlePC){if(e.singlePC.addDownlinkQueue.add(e.tinyId),yield e.singlePC.waitForPeerConnectionConnected(),i||!e.hasSSRC){let i={audioSsrc:Qx(),bigVideoSsrc:Qx(),bigVideoRtxSsrc:Qx(),auxVideoSsrc:Qx(),auxVideoRtxSsrc:Qx()},{audioSsrc:r,bigVideoSsrc:n,bigVideoRtxSsrc:o,auxVideoSsrc:s,auxVideoRtxSsrc:a}=i;e.ssrc={audio:r,video:n,videoRtx:o,auxiliary:s,auxiliaryRtx:a},e.singlePC.addDownlinkQueue.delete(e.tinyId),yield e.singlePC.addDownlink({userId:e.userId,tinyId:e.tinyId,ssrc:e.ssrc});let c=yield e._signalChannel.sendWaitForResponse({command:SV,responseCommand:pV.SPC_SUBSCRIBE_RESULT,data:{srcUserId:e.userId,srcTinyId:e.tinyId,audio:t.audio,bigVideo:t.video,auxVideo:t.auxiliary,smallVideo:t.smallVideo,customData:!1,ssrc:i}});if(0!==c.data.code)throw yield e.removeDownlink(),new ab({code:c.data.code,message:c.data.message});return}e.singlePC.addDownlinkQueue.delete(e.tinyId),yield e.singlePC.addDownlink({userId:e.userId,tinyId:e.tinyId,ssrc:e.ssrc})}}()}))}removeDownlink(){return XA(this,null,(function*(){!this.singlePC||(this.ssrc={audio:0,video:0,videoRtx:0,auxiliary:0,auxiliaryRtx:0},this.singlePC.removeDownlinkQueue.delete(this.tinyId),yield this.singlePC.removeDownlink(this.tinyId,this.userId))}))}};zA([CM((e=>function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return new Promise(((t,r)=>{let n=e=>{this.off("closed",n),r(new ab({code:ob.API_CALL_ABORTED,message:yN({key:mN,data:e})}))};this.on("closed",n),e.apply(this,i).then(t,r).finally((()=>{this.off("closed",n)}))}))}))],$x.prototype,"subscribe",1);var Zx=$x,{isString:eU,isPlainObject:tU,isUndefined:iU,getNetworkType:rU,getTerminalType:nU,isEmpty:oU}=db,sU=class extends Ax{constructor(e){super(e),this.privateMapKey="",this._heartbeat=-1,this._lastHeartBeatTime=-1,this._joinTimeout=-1,this._firstPublishedList=null,this._joinReject=null,this._isRelayChanged=!1,this._signalChannel=null,this.uplinkConnection=null,this.singlePC=null,this.enableSPC=zN,this._changeBigSmallRecords=new Map,this._networkQuality=null,this._networkType=rU(),this._turnServers=[],this._syncUserListInterval=-1,this._smallStreamConfig={bitrate:100,frameRate:15,height:120,width:160},this.enableSEI=!1,this._enableAudioVolumeEvaluation=!1,this._audioVolumeIntervalId=0,this._enableMultiAuxStream=!1,this._pureAudioPushMode=!1,this.enableHWEncoder=!1,this._stats=new class{constructor(e,t){this.room=e,YA(this,"_log"),YA(this,"_prevReportTime"),YA(this,"_prevReport",{}),YA(this,"_prevEncoderImplementation"),YA(this,"_prevQualityLimitationReason"),YA(this,"_prevAuxQualityLimitationReason"),YA(this,"_prevDecoderImplementationMap",new Map),YA(this,"totalBytesSent",0),YA(this,"totalBytesReceived",0),YA(this,"_spcStats",null),this._log=t,this._prevReportTime=0,this._prevEncoderImplementation="",this._prevQualityLimitationReason="",this._prevAuxQualityLimitationReason=""}get statInterval(){return 0===this._prevReportTime?2:(Date.now()-this._prevReportTime)/1e3}getSenderStats(e){return XA(this,null,(function*(){let t={audio:{bytesSent:0,packetsSent:0,audioLevel:0,totalAudioEnergy:0},video:{bytesSent:0,packetsSent:0,framesEncoded:0,frameWidth:0,frameHeight:0,framesSent:0,fpsCapture:0},small:{bytesSent:0,packetsSent:0,framesEncoded:0,frameWidth:0,frameHeight:0,framesSent:0,fpsCapture:0},auxiliary:{bytesSent:0,packetsSent:0,framesEncoded:0,frameWidth:0,frameHeight:0,framesSent:0,fpsCapture:0},rtt:0},i=e.getPeerConnection(),r=e.getSSRC();if(i)try{if((this._spcStats||(yield i.getStats())).forEach((i=>{if("outbound-rtp"===i.type)if((i.mediaType||i.kind)===RD.VIDEO){let n,o;if(i.ssrc===r.video?(n=RD.VIDEO,o=e.localMainVideoTrack):i.ssrc===r.small?n=RD.SMALL:i.ssrc===r.auxiliary&&(o=e.localAuxVideoTrack,n=RD.AUXILIARY),!n)return;t[n].bytesSent=i.bytesSent,t[n].packetsSent=i.packetsSent,t[n].framesEncoded=i.framesEncoded,Qw(i.keyFramesEncoded)||(t[n].keyFramesEncoded=i.keyFramesEncoded),Qw(i.nackCount)||(t[n].nackCount=i.nackCount),Qw(i.pliCount)||(t[n].pliCount=i.pliCount),Qw(i.retransmittedPacketsSent)||(t[n].retransmittedPacketsSent=i.retransmittedPacketsSent),Qw(i.totalEncodeTime)||(t[n].totalEncodeTime=i.totalEncodeTime),Qw(i.totalPacketSendDelay)||(t[n].totalPacketSendDelay=i.totalPacketSendDelay),i.ssrc===r.video?(!Qw(i.encoderImplementation)&&this._prevEncoderImplementation!==i.encoderImplementation&&(this._log.info("encoderImplementation change to ".concat(i.encoderImplementation)),this._prevEncoderImplementation=i.encoderImplementation),!Qw(i.qualityLimitationReason)&&0!==i.bytesSent&&this._prevQualityLimitationReason!==i.qualityLimitationReason&&(this._log.info("qualityLimitationReason change to ".concat(i.qualityLimitationReason)),this._prevQualityLimitationReason=i.qualityLimitationReason)):i.ssrc===r.auxiliary&&!Qw(i.qualityLimitationReason)&&0!==i.bytesSent&&this._prevAuxQualityLimitationReason!==i.qualityLimitationReason&&(this._log.info("aux qualityLimitationReason change to ".concat(i.qualityLimitationReason)),this._prevAuxQualityLimitationReason=i.qualityLimitationReason)}else t.audio.bytesSent=i.bytesSent,t.audio.packetsSent=i.packetsSent;else"candidate-pair"===i.type?xN(i)&&Yw(i.currentRoundTripTime)&&(t.rtt=Math.floor(1e3*i.currentRoundTripTime),this.totalBytesSent=i.bytesSent):"media-source"===i.type&&(i.kind===RD.AUDIO?(t.audio.audioLevel=i.audioLevel||0,t.audio.totalAudioEnergy=i.totalAudioEnergy||0):i.kind===RD.VIDEO&&(i.trackIdentifier===e.getVideoTrackId(RD.VIDEO)?t.video.fpsCapture=i.framesPerSecond:i.trackIdentifier===e.getVideoTrackId(RD.AUXILIARY)?t.auxiliary.fpsCapture=i.framesPerSecond:t.small.fpsCapture=i.framesPerSecond));if(Qw(i.audioLevel)||(t.audio.audioLevel=i.audioLevel||0),!Qw(i.frameWidth)){let n=RD.SMALL;i.trackIdentifier===e.getVideoTrackId(RD.VIDEO)||i.ssrc===r.video?n=RD.VIDEO:(i.trackIdentifier===e.getVideoTrackId(RD.AUXILIARY)||i.ssrc===r.auxiliary)&&(n=RD.AUXILIARY),t[n].frameWidth=i.frameWidth,t[n].frameHeight=i.frameHeight,t[n].framesSent=i.framesSent}})),e.localMainAudioTrack){let i=e.localMainAudioTrack.getInternalAudioLevel();t.audio.micAudioLevel=i,0===t.audio.audioLevel&&(t.audio.audioLevel=i)}this.totalBytesSent||(this.totalBytesSent+=t.audio.bytesSent+t.video.bytesSent+t.auxiliary.bytesSent)}catch(e){this._log.warn("failed to getStats on sender connection ".concat(e))}return t}))}getReceiverStats(e){return XA(this,null,(function*(){let t={tinyId:e.tinyId,userId:e.userId,rtt:0,hasAudio:!1,hasVideo:!1,hasAuxiliary:!1,isSmallSubscribed:!1,audio:{bytesReceived:0,packetsReceived:0,packetsLost:0,jitter:0,audioLevel:0,totalAudioEnergy:0,insertedSamplesForDeceleration:0,removedSamplesForAcceleration:0},video:{bytesReceived:0,packetsReceived:0,packetsLost:0,framesReceived:0,framesDecoded:0,frameWidth:0,frameHeight:0,fpsDecoded:0},auxiliary:{bytesReceived:0,packetsReceived:0,packetsLost:0,framesReceived:0,framesDecoded:0,frameWidth:0,frameHeight:0,fpsDecoded:0}},i=e.getPeerConnection();if(i)try{let{ssrc:r}=e,{muteState:n,subscribeState:o}=e;(this._spcStats||(yield i.getStats())).forEach((i=>{if("inbound-rtp"===i.type)if((i.mediaType||i.kind)===RD.AUDIO){if(i.ssrc!==r.audio||!n.hasAudio)return;t.audio.packetsReceived=i.packetsReceived,t.audio.bytesReceived=i.bytesReceived,t.audio.packetsLost=i.packetsLost,i.insertedSamplesForDeceleration&&(t.audio.insertedSamplesForDeceleration=i.insertedSamplesForDeceleration),i.removedSamplesForAcceleration&&(t.audio.removedSamplesForAcceleration=i.removedSamplesForAcceleration);let{remoteAudioTrack:o}=e;o.stat.packetsReceived=i.packetsReceived,o.stat.bytesReceived=i.bytesReceived,o.stat.packetsLost=i.packetsLost,i.jitterBufferDelay&&(o.stat.jitterBufferDelay=Math.floor(i.jitterBufferDelay/i.jitterBufferEmittedCount*1e3)),t.hasAudio=!0}else{if(kb&&0===i.bytesReceived)return;let s;i.ssrc===r.video&&n.hasVideo&&(t.video.packetsReceived=i.packetsReceived,t.video.bytesReceived=i.bytesReceived,t.video.packetsLost=i.packetsLost,t.video.framesReceived=i.framesReceived,t.video.framesDecoded=i.framesDecoded,t.video.fpsDecoded=i.framesPerSecond,t.hasVideo=!0,s=e.remoteVideoTrack,n.hasSmall&&o.smallVideo&&(t.isSmallSubscribed=!0),i.decoderImplementation&&(!this._prevDecoderImplementationMap.has(t.userId)||this._prevDecoderImplementationMap.get(t.userId)!==i.decoderImplementation)&&(this._log.info("".concat(t.userId," decoderImplementation change to ").concat(i.decoderImplementation)),this._prevDecoderImplementationMap.set(t.userId,i.decoderImplementation))),i.ssrc===r.auxiliary&&n.hasAuxiliary&&(t.auxiliary.packetsReceived=i.packetsReceived,t.auxiliary.bytesReceived=i.bytesReceived,t.auxiliary.packetsLost=i.packetsLost,t.auxiliary.framesReceived=i.framesReceived,t.auxiliary.framesDecoded=i.framesDecoded,t.auxiliary.fpsDecoded=i.framesPerSecond,s=e.remoteAuxiliaryTrack,t.hasAuxiliary=!0),s&&(s.stat.packetsReceived=i.packetsReceived,s.stat.bytesReceived=i.bytesReceived,s.stat.packetsLost=i.packetsLost,s.stat.framesReceived=i.framesReceived,s.stat.framesDecoded=i.framesDecoded,i.jitterBufferDelay&&(s.stat.jitterBufferDelay=Math.floor(i.jitterBufferDelay/i.jitterBufferEmittedCount*1e3)))}else"candidate-pair"===i.type&&xN(i)&&Yw(i.currentRoundTripTime)&&(t.rtt=Math.floor(1e3*i.currentRoundTripTime),this.totalBytesReceived=i.bytesReceived);Qw(i.frameWidth)||((i.trackIdentifier===e.getMainStreamVideoTrackId()||i.ssrc===r.video)&&(t.video.frameWidth=i.frameWidth,t.video.frameHeight=i.frameHeight,e.remoteVideoTrack.stat.frameWidth=i.frameWidth,e.remoteVideoTrack.stat.frameHeight=i.frameHeight),(i.trackIdentifier===e.getAuxStreamVideoTrackId()||i.ssrc===r.auxiliary)&&(t.auxiliary.frameWidth=i.frameWidth,t.auxiliary.frameHeight=i.frameHeight,e.remoteAuxiliaryTrack.stat.frameWidth=i.frameWidth,e.remoteAuxiliaryTrack.stat.frameHeight=i.frameHeight)),Qw(i.audioLevel)||(t.audio.audioLevel=i.audioLevel||0,t.audio.totalAudioEnergy=i.totalAudioEnergy||0)})),0===t.audio.audioLevel&&(t.audio.audioLevel=e.remoteAudioTrack.getInternalAudioLevel()||0),this.totalBytesReceived||(this.totalBytesReceived+=t.audio.bytesReceived+t.video.bytesReceived+t.auxiliary.bytesReceived)}catch(e){this._log.warn("failed to getStats on receiver connection ".concat(e))}return t}))}getStats(e,t){return XA(this,null,(function*(){let i={},r=[];if(this.room.singlePC){let e=this.room.singlePC.getPeerConnection();if(!e)return{senderStats:i,receiverStats:r};let t=yield e.getStats(),n=[],o=new Set(["inbound-rtp","outbound-rtp","track","candidate-pair","media-source"]);t.forEach((e=>o.has(e.type)&&n.push(e))),this._spcStats=n}e&&(i=yield this.getSenderStats(e));for(let[e,i]of t){let e=yield this.getReceiverStats(i);r.push(e)}return{senderStats:i,receiverStats:r}}))}getDifferenceValue(e,t){if(sM(e))return t;let i=t-e;return i<0?0:i}prepareReport(e){let{stats:t,report:i,freezeMap:r}=e;if(!sM(t.senderStats)){let e={uint32_audio_level:t.senderStats.audio.audioLevel*bw,uint32_audio_energy:1e6*t.senderStats.audio.totalAudioEnergy,uint32_audio_codec_bitrate:t.senderStats.audio.bytesSent};t.senderStats.audio.micAudioLevel&&(e.uint32_mic_audio_level=t.senderStats.audio.micAudioLevel*bw);let r=[];if(t.senderStats.video.bytesSent){let e={uint32_video_stream_type:2,uint32_video_codec_fps:t.senderStats.video.framesSent,uint32_video_capture_fps:t.senderStats.video.fpsCapture,uint32_video_width:t.senderStats.video.frameWidth,uint32_video_height:t.senderStats.video.frameHeight,uint32_video_codec_bitrate:t.senderStats.video.bytesSent,uint32_video_enc_fps:t.senderStats.video.framesEncoded,uint32_key_frame_count:t.senderStats.video.keyFramesEncoded,uint32_nack_count:t.senderStats.video.nackCount,uint32_pli_count:t.senderStats.video.pliCount,uint32_encode_cost:1e3*(t.senderStats.video.totalEncodeTime||0),uint32_send_packet_cost:1e3*(t.senderStats.video.totalPacketSendDelay||0),uint32_video_arq_packets:t.senderStats.video.retransmittedPacketsSent};r.push(e)}if(t.senderStats.small.bytesSent){let e={uint32_video_stream_type:3,uint32_video_codec_fps:t.senderStats.small.framesSent||0,uint32_video_capture_fps:t.senderStats.small.fpsCapture||0,uint32_video_width:t.senderStats.small.frameWidth||0,uint32_video_height:t.senderStats.small.frameHeight||0,uint32_video_codec_bitrate:t.senderStats.small.bytesSent,uint32_video_enc_fps:t.senderStats.small.framesEncoded||0,uint32_key_frame_count:t.senderStats.small.keyFramesEncoded,uint32_nack_count:t.senderStats.small.nackCount,uint32_pli_count:t.senderStats.small.pliCount,uint32_encode_cost:1e3*(t.senderStats.small.totalEncodeTime||0),uint32_send_packet_cost:1e3*(t.senderStats.small.totalPacketSendDelay||0),uint32_video_arq_packets:t.senderStats.small.retransmittedPacketsSent};r.push(e)}if(t.senderStats.auxiliary.bytesSent){let e={uint32_video_stream_type:7,uint32_video_codec_fps:t.senderStats.auxiliary.framesSent||0,uint32_video_capture_fps:t.senderStats.auxiliary.fpsCapture||0,uint32_video_width:t.senderStats.auxiliary.frameWidth||0,uint32_video_height:t.senderStats.auxiliary.frameHeight||0,uint32_video_codec_bitrate:t.senderStats.auxiliary.bytesSent,uint32_video_enc_fps:t.senderStats.auxiliary.framesEncoded||0,uint32_key_frame_count:t.senderStats.auxiliary.keyFramesEncoded,uint32_nack_count:t.senderStats.auxiliary.nackCount,uint32_pli_count:t.senderStats.auxiliary.pliCount,uint32_encode_cost:1e3*(t.senderStats.auxiliary.totalEncodeTime||0),uint32_send_packet_cost:1e3*(t.senderStats.auxiliary.totalPacketSendDelay||0),uint32_video_arq_packets:t.senderStats.auxiliary.retransmittedPacketsSent};r.push(e)}let n={uint32_bitrate:0,uint32_lost:0,uint32_rtt:t.senderStats.rtt};i.msg_up_stream_info={msg_audio_status:e,msg_video_status:r,msg_network_status:n}}let{statInterval:n}=this;i.msg_down_stream_info=[],t.receiverStats.forEach((e=>{let t={msg_user_info:{str_identifier:e.userId,uint64_tinyid:e.tinyId},msg_network_status:{uint32_rtt:e.rtt,uint32_bitrate:0,uint32_lost:0},msg_audio_status:{},msg_video_status:[]};if(e.hasAudio){let i={uint32_audio_codec_bitrate:e.audio.bytesReceived,uint32_audio_total_bitrate:e.audio.bytesReceived,uint32_audio_level:1e8*e.audio.audioLevel,uint32_audio_energy:1e6*e.audio.totalAudioEnergy,uint32_audio_receive:e.audio.packetsReceived,uint32_audio_origin_lost:e.audio.packetsLost};t.msg_audio_status=i}if(e.hasVideo){let i=r.get("".concat(e.userId,"_").concat(VD)),n=i?i.duration:0,o={uint32_video_stream_type:e.isSmallSubscribed?3:2,uint32_video_receive_fps:e.video.framesReceived,uint32_video_width:e.video.frameWidth,uint32_video_height:e.video.frameHeight,uint32_video_codec_bitrate:e.video.bytesReceived,uint32_video_receive:e.video.packetsReceived,uint32_video_origin_lost:e.video.packetsLost,uint32_video_block_time:n,uint32_video_dec_fps:e.video.framesDecoded};t.msg_video_status.push(o)}if(e.hasAuxiliary){let i=r.get("".concat(e.userId,"_").concat(xD)),n=i?i.duration:0,o={uint32_video_stream_type:7,uint32_video_receive_fps:e.auxiliary.framesReceived,uint32_video_width:e.auxiliary.frameWidth,uint32_video_height:e.auxiliary.frameHeight,uint32_video_codec_bitrate:e.auxiliary.bytesReceived,uint32_video_receive:e.auxiliary.packetsReceived+e.auxiliary.packetsLost,uint32_video_origin_lost:e.auxiliary.packetsLost,uint32_video_block_time:n,uint32_video_dec_fps:e.auxiliary.framesDecoded};t.msg_video_status.push(o)}i.msg_down_stream_info.push(t)}));let o=this._prevReport;if(this._prevReport=JSON.parse(JSON.stringify(i)),i.msg_up_stream_info.msg_audio_status&&o.msg_up_stream_info.msg_audio_status){let e=o.msg_up_stream_info.msg_audio_status,t=i.msg_up_stream_info.msg_audio_status;if(0===e.uint32_audio_codec_bitrate)t.uint32_audio_codec_bitrate=0;else{let r=this.getDifferenceValue(e.uint32_audio_codec_bitrate,t.uint32_audio_codec_bitrate);t.uint32_audio_codec_bitrate=Math.round(8*r/n),i.msg_up_stream_info.msg_network_status.uint32_bitrate+=t.uint32_audio_codec_bitrate}}let s=o.msg_up_stream_info.msg_video_status;i.msg_up_stream_info.msg_video_status.forEach((e=>{let t=s.find((t=>t.uint32_video_stream_type===e.uint32_video_stream_type));if(!t||0===t.uint32_video_codec_bitrate)return e.uint32_video_codec_bitrate=0,e.uint32_video_enc_fps=0,void(e.uint32_video_codec_fps=0);let r=0,o=0,a=0;t&&e.uint32_video_codec_bitrate>=t.uint32_video_codec_bitrate&&(r=t.uint32_video_codec_bitrate,o=t.uint32_video_enc_fps,a=t.uint32_video_codec_fps);let c=this.getDifferenceValue(r,e.uint32_video_codec_bitrate);e.uint32_video_codec_bitrate=Math.round(8*c/n),i.msg_up_stream_info.msg_network_status.uint32_bitrate+=e.uint32_video_codec_bitrate,e.uint32_video_enc_fps=Math.round(this.getDifferenceValue(o,e.uint32_video_enc_fps)/n),e.uint32_video_codec_fps=Math.round(this.getDifferenceValue(a,e.uint32_video_codec_fps)/n),nk&&115===Ek()&&0===t.uint32_video_width&&0===t.uint32_video_height&&0===t.uint32_video_codec_fps&&(e.uint32_video_codec_fps=e.uint32_video_enc_fps),Qw(t.uint32_key_frame_count)||(e.uint32_key_frame_count=Math.round(this.getDifferenceValue(t.uint32_key_frame_count,e.uint32_key_frame_count))),Qw(t.uint32_nack_count)||(e.uint32_nack_count=Math.round(this.getDifferenceValue(t.uint32_nack_count,e.uint32_nack_count))),Qw(t.uint32_pli_count)||(e.uint32_pli_count=Math.round(this.getDifferenceValue(t.uint32_pli_count,e.uint32_pli_count))),Qw(t.uint32_video_arq_packets)||(e.uint32_video_arq_packets=Math.round(this.getDifferenceValue(t.uint32_video_arq_packets,e.uint32_video_arq_packets))),Qw(t.uint32_encode_cost)||(e.uint32_encode_cost=Math.round(this.getDifferenceValue(t.uint32_encode_cost,e.uint32_encode_cost)/n)),Qw(t.uint32_send_packet_cost)||(e.uint32_send_packet_cost=Math.round(this.getDifferenceValue(t.uint32_send_packet_cost,e.uint32_send_packet_cost)/n))}));let a=i.msg_down_stream_info,c=o.msg_down_stream_info;return a.forEach((e=>{let t=c.find((t=>t.msg_user_info.uint64_tinyid===e.msg_user_info.uint64_tinyid));if(t){if(sM(e.msg_audio_status)||sM(t.msg_audio_status))e.msg_audio_status={};else{let i=e.msg_audio_status,r=t.msg_audio_status;i.uint32_audio_origin_lost=this.getDifferenceValue(r.uint32_audio_origin_lost,i.uint32_audio_origin_lost),i.uint32_audio_receive=this.getDifferenceValue(r.uint32_audio_receive,i.uint32_audio_receive),i.uint32_audio_receive+=i.uint32_audio_origin_lost;let o=this.getDifferenceValue(r.uint32_audio_codec_bitrate,i.uint32_audio_codec_bitrate);i.uint32_audio_codec_bitrate=Math.round(8*o/n),i.uint32_audio_total_bitrate=Math.round(8*o/n)}if(e.msg_video_status&&t.msg_video_status){let i=t.msg_video_status;e.msg_video_status=e.msg_video_status.filter((e=>i.find((t=>t.uint32_video_stream_type===e.uint32_video_stream_type)))),e.msg_video_status.forEach((e=>{let t=i.find((t=>t.uint32_video_stream_type===e.uint32_video_stream_type)),r=t.uint32_video_receive,o=t.uint32_video_origin_lost,s=t.uint32_video_codec_bitrate,a=t.uint32_video_receive_fps,c=t.uint32_video_dec_fps;e.uint32_video_origin_lost=this.getDifferenceValue(o,e.uint32_video_origin_lost),e.uint32_video_receive=this.getDifferenceValue(r,e.uint32_video_receive)+e.uint32_video_origin_lost;let l=this.getDifferenceValue(s,e.uint32_video_codec_bitrate);e.uint32_video_codec_bitrate=Math.round(8*l/n);let u=this.getDifferenceValue(a,e.uint32_video_receive_fps);e.uint32_video_receive_fps=Math.round(u/n),e.uint32_video_dec_fps=Math.round(this.getDifferenceValue(c,e.uint32_video_dec_fps)/n)}))}}})),i}getStatsReport(e){return XA(this,arguments,(function(e){var t=this;let{uplinkConnection:i,downlinkConnections:r,freezeMap:n}=e;return function*(){let e={msg_up_stream_info:{msg_audio_status:{uint32_audio_format:11,uint32_audio_sample_rate:0,uint32_audio_codec_bitrate:0,uint32_audio_receive:0,uint32_audio_origin_lost:0,uint32_audio_level:0,uint32_audio_energy:0},msg_video_status:[],msg_network_status:{uint32_bitrate:0,uint32_rtt:0,uint32_lost:0}},msg_down_stream_info:[{msg_user_info:{str_identifier:"",uint64_tinyid:0},msg_audio_status:{uint32_audio_format:11,uint32_audio_sample_rate:0,uint32_audio_codec_bitrate:0,uint32_audio_total_bitrate:0,uint32_audio_level:0,uint32_audio_energy:0,uint32_audio_receive:0,uint32_audio_origin_lost:0,uint32_audio_final_lost:0},msg_video_status:[{uint32_video_stream_type:0,uint32_video_receive_fps:0,uint32_video_width:0,uint32_video_height:0,uint32_video_codec_bitrate:0,uint32_video_receive:0,uint32_video_origin_lost:0,uint32_video_block_time:0,uint32_video_dec_fps:0}],msg_network_status:{uint32_bitrate:0,uint32_rtt:0,uint32_lost:0}}]},o=yield t.getStats(i,r);return"{}"===JSON.stringify(t._prevReport)&&(t._prevReport=JSON.parse(JSON.stringify(e))),t.prepareReport({stats:o,report:e,freezeMap:n}),t._prevReportTime=Date.now(),e}()}))}reset(){this._prevReportTime=0,this._prevReport={},this._prevEncoderImplementation="",this._prevQualityLimitationReason="",this._prevDecoderImplementationMap=new Map}}(this,this._log),this.userManager=new lL(this.userId,this._log),this._version=zk,this.sdpSemantics=rw,iU(e.sdpSemantics)?NO.isUnifiedPlanDefault()&&(this.sdpSemantics=iw):this.sdpSemantics=e.sdpSemantics,this._log.info("sdpSemantics: ".concat(this.sdpSemantics,", netType: ").concat(this._networkType)),e.iceTransportPolicy&&(this._iceTransportPolicy=e.iceTransportPolicy),this._enableMultiAuxStream=!iU(e.enableMultiAuxStream)&&e.enableMultiAuxStream,this.enableSEI=e.enableSEI,!iU(e.enableSPC)&&zN&&(this.enableSPC=e.enableSPC),this.enableHWEncoder=e.enableHWEncoder||!1,this._initBusinessInfo(e)}get isMainStreamPublished(){var e;return!(null==(e=this.uplinkConnection)||!e.isMainStreamPublished)}get isMainAudioPublished(){var e;return!(null==(e=this.uplinkConnection)||!e.localMainAudioTrack)}get isAuxStreamPublished(){var e;return!(null==(e=this.uplinkConnection)||!e.isAuxStreamPublished)}get hasAuxStream(){return[...this.remotePublishedUserMap.values()].findIndex((e=>e.muteState.hasAuxiliary))>=0}get userMap(){return this.userManager.userMap}get remotePublishedUserMap(){return this.userManager.remotePublishedUserMap}get tinyIdToUserIdMap(){return new Map([...this.remotePublishedUserMap.values()].map((e=>[e.tinyId,e.userId])))}join(e,t,i){return XA(this,null,(function*(){return this.userManager.mySelfId=this.userId,this.userManager.on("1",(e=>{this.emit("peer-join",e)})),this.userManager.on("2",(e=>{this.closeDownLinkConnection(e,"remote user exitRoom"),this.emit("peer-leave",e)})),this.userManager.on("3",this.createDownlinkConnection,this),this.userManager.on("5",this.closeDownLinkConnection,this),this.userManager.on("6",(e=>{var t=((e,t)=>{var i={};for(var r in e)UA.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&VA)for(var r of VA(e))t.indexOf(r)<0&&FA.call(e,r)&&(i[r]=e[r]);return i})(e,[]);AO.emit(kO.REMOTE_PUBLISH_STATE_CHANGED,WA({room:this},t)),this.emit("remote-publish-state-changed",WA({},t))})),this._joinOptions=e,new Promise(((t,i)=>XA(this,null,(function*(){this._joinReject=i;try{this.checkDestroy();let i=yield this.initialize();yield this.doJoin(e,i),t(),this._firstPublishedList&&this.onPublishedUserList({data:{userList:this._firstPublishedList}})}catch(e){i(e)}this._joinReject=null}))))}))}doJoin(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(((i,r)=>XA(this,null,(function*(){var n,o,s;let a;if(e.privateMapKey&&(this.privateMapKey=e.privateMapKey),this._signalChannel.once("5",(e=>{this.clearJoinTimeout(),AO.emit(kO.JOIN_SIGNAL_CONNECTION_END,{room:this,error:e}),r(e)})),qw(null==(o=null==(n=this.scheduleResult)?void 0:n.config)?void 0:o.singlePC)&&zN&&(this.enableSPC=this.scheduleResult.config.singlePC),this.enableSPC&&!this.singlePC){this.singlePC=new Wx({signalChannel:this._signalChannel,room:this,enableCustomMessage:!1}),this.singlePC.once("error",(()=>this.fallbackToMPC()));try{a=yield this.singlePC.initialize()}catch(e){this.fallbackToMPC()}}this.keyPointManager.setConnectionType(this.singlePC?1:2);let c={roomId:String(e.roomId||e.strRoomId),useStringRoomId:this.useStringRoomId,privateMapKey:this.privateMapKey,trtcRole:e.role,trtcScene:"live"===this.scene?2:1,sdpSemantics:this.sdpSemantics,version:this._version,ua:navigator&&navigator.userAgent||"",terminalType:nU(),netType:TD[this._networkType],bussinessInfo:this._businessInfo,ability:a};t&&(c.userSig=this.userSig),this._log.debug("join room signal data: ".concat(JSON.stringify(c)));let l=5e3;(null==(s=this.scheduleResult.config)?void 0:s.enterRoomTimeout)&&this.scheduleResult.config.enterRoomTimeout>=1&&(l=1e3*this.scheduleResult.config.enterRoomTimeout),this._joinTimeout=window.setTimeout((()=>{r(new ab({code:ob.JOIN_ROOM_FAILED,message:yN({key:GO})}))}),l),AO.emit(kO.JOIN_SEND_CMD,{room:this}),this._signalChannel.send(this.singlePC?"join/v2":"join",c),this._signalChannel.once(pV.JOIN_ROOM_RESULT,(e=>{this.clearJoinTimeout();let{code:t,message:n,data:o}=e.data;AO.emit(kO.JOIN_RECEIVED_CMD_RES,{room:this,code:t}),0===t?(this._log.info("Join room success, start heartbeat"),this.startHeartbeat(),this.syncUserList(),this.startSyncUserListInterval(),this._firstPublishedList=o.publishers,this.singlePC&&this.singlePC.connect(o.ability).catch((()=>{})),i()):(this._log.error("Join room failed result: ".concat(t," error: ").concat(n)),r(new ab({code:ob.JOIN_ROOM_FAILED,extraCode:t,message:yN({key:JO,data:{error:n,code:t}})})))}))}))))}reJoin(){return XA(this,null,(function*(){if(this.isJoined)try{if(this._log.warn("reJoin pending: ".concat(this._joinOptions.roomId)),this.singlePC&&(this.singlePC.close(),this.singlePC=null),this._signalChannel.close(),yield this._signalChannel.connect(),yield this.doJoin(GA(WA({},this._joinOptions),{role:"anchor"===this.role?20:21,privateMapKey:this.privateMapKey})),this._log.warn("reJoin success"),EP.logSuccessEvent({userId:this.userId,eventType:$D.REJOIN}),this.singlePC){let e=t=>{var i;"CONNECTED"===t.state&&(null==(i=this.singlePC)||i.off(Ux.CONNECTION_STATE_CHANGED,e),this.uplinkConnection instanceof qx&&this.uplinkConnection.onSinglePCReconnected(),this.remotePublishedUserMap.forEach((e=>{e.installEvents(),e.doSubscribe()})))};this.singlePC.on(Ux.CONNECTION_STATE_CHANGED,e),this.checkConnectionsToReconnect(),this.uplinkConnection instanceof HV&&!this.uplinkConnection.getIsReconnecting()&&this.uplinkConnection.startReconnection()}}catch(e){this._log.warn("reJoin fail ".concat(e)),this.reset(),EP.logFailedEvent({userId:this.userId,eventType:$D.REJOIN,error:e}),this.emit("error",new ab({code:ob.JOIN_ROOM_FAILED,message:yN({key:KO,data:{roomId:this._joinOptions.roomId}})}))}else this._log.warn("reJoin abort")}))}initialize(){return XA(this,null,(function*(){let{mainUrl:e,backupUrl:t}=this.getSignalChannelUrl(),i=this._signalChannel||function(e){return[...yV.values()].find((t=>t.room.userId===e&&!t.room.isJoined))||null}(this.userId),r=!!(i&&i.isConnected&&i.keepAlive);return this._log.info("setup signal channel. reuse: ".concat(+r)),r?(i.url=e,i.backupUrl=t,i.room=this,this._signalChannel=i):this._signalChannel=new EV({sdkAppId:this.sdkAppId,userId:this.userId,userSig:this.userSig,url:e,backupUrl:t,room:this}),this._networkQuality||(this._networkQuality=new GV({signalChannel:this._signalChannel,room:this}),this._networkQuality.on(GV.EVENT_NETWORK_QUALITY,(e=>{this.emit("network-quality",e)}))),JP(this,this._signalChannel).add("2",(e=>{AO.emit(kO.SIGNAL_CONNECTION_STATE_CHANGED,WA({room:this},e)),this.emit("signal-connection-state-changed",e)})).add("4",(e=>{this.reset(),this.emit("error",e)})).add(pV.PEER_JOIN,(e=>{let{srcTinyId:t,userId:i,role:r}=e.data.data;this.userManager.addUser({userId:i,tinyId:t,role:r})})).add(pV.PEER_LEAVE,(e=>{let{userId:t,reason:i=0}=e.data.data;this.userManager.deleteUser(t,i)})).add(pV.UPDATE_REMOTE_MUTE_STAT,(e=>{this._lastHeartBeatTime>0&&Date.now()-this._lastHeartBeatTime>=1e4&&this.doHeartbeat(),this.onPublishedUserList(e.data)})).add(pV.CLIENT_BANNED,(e=>{let t=e.data.data,{reason:i}=t;if(EP.uploadEvent({log:"stat-banned:".concat(i),userId:this.userId}),"user_time_out"===i)return this._log.warn("".concat(i," last heart beat time: ").concat(this._lastHeartBeatTime," interval: ").concat(Date.now()-this._lastHeartBeatTime,", visibility: ").concat(document.visibilityState)),void this.reJoin();this._log["kick"===i?"error":"info"]("user was banned because of [".concat(i,"]")),this.reset(),this.emit("banned",{reason:i})})),this._signalChannel.once("1",(e=>{this.tinyId=e.signalInfo.tinyId,AO.emit(kO.JOIN_SIGNAL_CONNECTION_END,{room:this})})),AO.emit(kO.JOIN_SIGNAL_CONNECTION_START,{room:this}),yield this._signalChannel.connect(this._isUsingCachedSchedule?1e4:void 0),r}))}setSignalChannel(e){this._signalChannel=e,e||KP(this)}leave(){return XA(this,null,(function*(){var e;try{yield this.doHeartbeat()}catch(e){}this._log.info("leave() => leaving room"),AO.emit(kO.LEAVE_SEND_CMD,{room:this}),null==(e=this._signalChannel)||e.send("leave")}))}clearNetworkQuality(){this._networkQuality&&(this._networkQuality.stop(),this._networkQuality=null)}closeConnections(){this.remotePublishedUserMap.forEach((e=>{this.closeDownLinkConnection(e.userId,"you exitRoom")}))}clearJoinTimeout(){clearTimeout(this._joinTimeout),this._joinTimeout=-1}startHeartbeat(){-1===this._heartbeat&&(this._heartbeat=SP.run(Ew,this.doHeartbeat.bind(this),{delay:2e3}))}stopHeartbeat(){-1!==this._heartbeat&&(this._log.info("stopHeartbeat"),SP.clearTask(this._heartbeat),this._heartbeat=-1,this._lastHeartBeatTime=-1)}doHeartbeat(){return XA(this,null,(function*(){var e;let t=this.badCaseDetector.getMonitorFreeze(),i=yield this._stats.getStatsReport({uplinkConnection:this.uplinkConnection,downlinkConnections:this.remotePublishedUserMap,freezeMap:t});if(this.badCaseDetector.resetMonitor(),null==(e=this._signalChannel)||!e.isConnected)return;let r=this._signalChannel.isConnected?function(e){if(oL.has(e)){let t=oL.get(e).map((e=>({uint32_event_id:e.eventId,uint64_date:e.timestamp,str_userid:e.remoteUserId,str_event_json:e.eventDesc})));return oL.delete(e),t}return[]}(this.userId):[],n=WA({str_sdk_version:Qk,uint64_datetime:(new Date).getTime(),msg_user_info:{str_identifier:this.userId,uint64_tinyid:this.tinyId},msg_device_info:{uint32_terminal_type:15,str_device_name:navigator.platform,str_os_version:"",uint32_net_type:TD[this._networkType]},msg_event_msg:r,str_acc_ip:this.getSignalInfo().relayIp,str_client_ip:this.getSignalInfo().clientIp},i);AO.emit(kO.HEARTBEAT_REPORT,{room:this,report:n}),this._signalChannel.send("quality_report",n),this.emit("heartbeat-report",GA(WA({},n),{bytes_sent:this._stats.totalBytesSent+this._signalChannel.bytesSent,bytes_received:this._stats.totalBytesReceived+this._signalChannel.bytesReceived}));let o=Date.now();this._lastHeartBeatTime>0&&o-this._lastHeartBeatTime>1e4&&this._log.warn("heartbeat took ".concat(o-this._lastHeartBeatTime)),this._signalChannel.isConnected&&(this._lastHeartBeatTime=o),!this._isRelayChanged&&this.isRelayMaybeFailed()&&(this.reJoin(),this._isRelayChanged=!0)}))}onPublishedUserList(e){if(!this.isJoined)return;let t=e.data.userList.map((e=>{let{userId:t,srcTinyId:i,flag:r}=e,n=this.remotePublishedUserMap.get(t);return n&&this._changeBigSmallRecords.has(t)&&this.checkSubscribeBigSmallVideo(n),{userId:t,tinyId:i,flag:r}}));AO.emit(kO.RECEIVED_PUBLISHED_USER_LIST,{room:this,publishedUserList:t}),this.userManager.setRemotePublishedUserList(t)}closeUplink(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"you unpublished";this.uplinkConnection&&(this.localTracks.size>0&&this.uplinkConnection.doUnpublish(),this.uplinkConnection.close(e),this.uplinkConnection=null),this.localTracks.forEach((e=>e.unpublish())),this.localTracks.clear()}createDownlinkConnection(e){let{userId:t,tinyId:i,flag:r}=e,n=new(this.singlePC?Zx:xV)({userId:t,tinyId:i,room:this,signalChannel:this._signalChannel,enableSEI:this.enableSEI,flag:r});this.userManager.addRemotePublishedUser(n),this.installDownlinkEvents(n,t),this.emit("remote-published",n)}closeDownLinkConnection(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"remote user unpublished",i=this.remotePublishedUserMap.get(e);i&&(i.close(t),this.emit("remote-unpublished",i))}installDownlinkEvents(e,t){e.on("sei-message",(e=>{this.emit("sei-message",e)})),e.on("error",(e=>{let i=e.getCode();i!==ob.ICE_TRANSPORT_ERROR&&(i===ob.DOWNLINK_RECONNECTION_FAILED&&this.closeDownLinkConnection(t),this.emit("error",e))})),e.on("connection-state-changed",(t=>{this.emit("media-connection-state-changed",GA(WA({},t),{userId:e.userId}))})),e.on("firewall-restriction",(()=>{this.emit("firewall-restriction")}))}startSyncUserListInterval(){-1===this._syncUserListInterval&&(this._syncUserListInterval=SP.run(Ew,this.syncUserList.bind(this)))}stopSyncUserListInterval(){SP.clearTask(this._syncUserListInterval),this._syncUserListInterval=-1}syncUserList(){return this.getUserList().then((e=>{this.userManager.setUserList(e)})).catch((e=>{this._log.debug("sync user list failed: ".concat(e))}))}getUserList(){var e;return null!=(e=this._signalChannel)&&e.isConnected?this._signalChannel.sendWaitForResponse({command:"get_user_list",responseCommand:pV.USER_LIST_RES,enableLog:!1,timeout:2e3}).then((e=>{let{data:t}=e,{code:i,message:r}=t;if(0===i)return(t.data&&t.data.userList||[]).map((e=>{let{userId:t,srcTinyId:i,role:r}=e;return{userId:t,tinyId:i,role:r}}));throw yN({key:sN,data:{signalResponse:pV.USER_LIST_RES,code:i,message:r}})})):Promise.reject("not connected")}getAllConnections(){let e=[...this.remotePublishedUserMap.values()];return this.uplinkConnection&&e.push(this.uplinkConnection),e}isRelayMaybeFailed(){if(this._signalChannel&&!this._signalChannel.isOnline||!DV)return!1;if(this.singlePC)return this.singlePC.reconnectionCount>6;let e=this.getAllConnections();if(0===e.length)return!1;for(let t=0;t<e.length;t++)if(e[t].getReconnectionCount()<6)return!1;return!0}checkConnectionsToReconnect(){this.singlePC||this.getAllConnections().forEach((e=>{if(e instanceof wV&&!e.getIsReconnecting()){let t=e.getPeerConnection();t&&t.connectionState===KD.CLOSED&&(this._log.warn("[".concat(e.getUserId(),"] pc is closed but not reconnect")),e.startReconnection())}}))}fallbackToMPC(){return XA(this,null,(function*(){var e;if(this._log.warn("fallback to multi pc"),EP.uploadEvent({log:"stat-fallback",userId:this.userId}),this.enableSPC=!1,null==(e=this.singlePC)||e.close(),this.singlePC=null,yield this.reJoin(),this.uplinkConnection){let e=this.uplinkConnection;this.uplinkConnection=new HV({userId:this.userId,tinyId:this.tinyId,room:this,signalChannel:this._signalChannel,enableSEI:this.enableSEI,audioManager:this.audioManager}),e.isMainStreamPublished&&(yield this.uplinkConnection.publish({localAudioTrack:e.localMainAudioTrack,localVideoTrack:e.localMainVideoTrack,isAuxiliary:!1})),e.isAuxStreamPublished&&(yield this.uplinkConnection.publish({localAudioTrack:e.localAuxAudioTrack,localVideoTrack:e.localAuxVideoTrack,isAuxiliary:!0}))}this.remotePublishedUserMap.forEach((e=>{let t=new xV({userId:e.userId,tinyId:e.tinyId,room:this,signalChannel:this._signalChannel,enableSEI:this.enableSEI,flag:e.flag,remoteAudioTrack:e.remoteAudioTrack,remoteVideoTrack:e.remoteVideoTrack,remoteAuxiliaryTrack:e.remoteAuxiliaryTrack});this.installDownlinkEvents(t,e.userId),this.remotePublishedUserMap.set(e.userId,t),e.isMainStreamSubscribed&&t.subscribe(e.subscribeState,"main"),e.isAuxStreamSubscribed&&t.subscribe(e.subscribeState,"auxiliary")}))}))}destroy(){this._isDestroyed||(this._signalChannel&&(this._log.info("destroying SignalChannel"),this._signalChannel.close(),this._signalChannel=null),super.destroy(),this._joinReject&&(this._joinReject(new ab({code:ob.INVALID_OPERATION,message:yN({key:$O,data:{funName:"join"}})})),this.clearJoinTimeout(),this.reset()),this.removeAllListeners())}switchRole(e){return XA(this,null,(function*(){this.role!==e&&("audience"===e&&this.uplinkConnection&&this.closeUplink("you switch role to audience"),yield this.doSwitchRole(e))}))}doSwitchRole(e){let t={command:"change_role",data:{role:"anchor"===e?20:21,privateMapKey:this.privateMapKey},responseCommand:pV.SWITCH_ROLE_RES,retries:1};return this._log.info("switchRole signal data: ".concat(JSON.stringify(t.data))),this._signalChannel.sendWaitForResponseWithRetry(t).then((t=>{let{code:i,message:r}=t.data;if(0!==i)throw new ab({code:ob.SWITCH_ROLE_FAILED,message:yN({key:qO,data:{message:r,code:i}})});this.role=e})).catch((e=>{throw e instanceof ab&&e.getCode()===ob.API_CALL_TIMEOUT&&(e=new ab({code:ob.SWITCH_ROLE_FAILED,message:yN({key:YO})})),this._log.error(e),e}))}publish(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return XA(this,null,(function*(){let e={},i={};t.forEach((t=>{t instanceof kM&&(t instanceof NM?i.audio=t:e.audio=t),t instanceof DM&&(t instanceof OM&&2===t.mediaType?i.video=t:e.video=t)}));let r=oU(e),n=oU(i);(!r||!n)&&!this.uplinkConnection&&(this.singlePC?this.uplinkConnection=new qx({userId:this.userId,tinyId:this.tinyId,room:this,signalChannel:this._signalChannel,enableSEI:this.enableSEI,audioManager:this.audioManager}):this.uplinkConnection=new HV({userId:this.userId,tinyId:this.tinyId,room:this,signalChannel:this._signalChannel,enableSEI:this.enableSEI,audioManager:this.audioManager}),this.uplinkConnection.on("connection-state-changed",(e=>{this.emit("media-connection-state-changed",GA(WA({},e),{userId:this.userId}))})),this.uplinkConnection.on("firewall-restriction",(()=>{this.emit("firewall-restriction")})),this.uplinkConnection.on("error",(e=>{let t=e.getCode();t!==ob.ICE_TRANSPORT_ERROR&&(t===ob.UPLINK_RECONNECTION_FAILED&&this.closeUplink(),this.emit("error",e))})));let o=t.map((e=>e.kind)).join(",");r||(this._log.info("publish() => main ".concat(o)),yield this.uplinkConnection.publish({localAudioTrack:e.audio,localVideoTrack:e.video,isAuxiliary:!1}),this._log.info("main is published")),n||(this._log.info("publish() => aux ".concat(o)),yield this.uplinkConnection.publish({localAudioTrack:i.audio,localVideoTrack:i.video,isAuxiliary:!0}),this._log.info("aux is published"))}))}unpublish(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return XA(this,null,(function*(){if("live"===this.scene&&"anchor"!==this.role||!this.isMainStreamPublished&&!this.isAuxStreamPublished||!this.uplinkConnection)return;let e={},i={};t.forEach((t=>{!t.mediaTrack||(t instanceof kM&&(t instanceof NM?i.audio=t:e.audio=t),t instanceof DM&&(t instanceof OM&&2===t.mediaType?i.video=t:e.video=t))}));try{let r=t.map((e=>e.kind)).join(",");oU(e)||(this._log.info("unpublish() => main ".concat(r)),yield this.uplinkConnection.unpublish({localAudioTrack:e.audio,localVideoTrack:e.video})),oU(i)||(this._log.info("unpublish() => aux ".concat(r)),yield this.uplinkConnection.unpublish({localAudioTrack:i.audio,localVideoTrack:i.video}))}catch(e){}0===this.localTracks.size&&!this.audioManager.mixedAudioTrack&&this.closeUplink("you unpublished")}))}addTrack(e){if(!this.uplinkConnection||!e.mediaTrack)return Promise.resolve();let t=this.uplinkConnection.addTrack(e);return e.publish(this,t),t}removeTrack(e){return this.uplinkConnection&&e.mediaTrack?this.uplinkConnection.removeTrack(e).then((t=>(e.unpublish(),t))):Promise.resolve()}replaceTrack(e){return this.uplinkConnection&&e.mediaTrack?this.uplinkConnection.replaceTrack(e).then((t=>{AO.emit(kO.LOCAL_TRACK_REPLACED,{track:e})})):Promise.resolve()}setBandWidth(e){return XA(this,null,(function*(){!this.uplinkConnection||(yield this.uplinkConnection.setBandwidth(e),yield this.uplinkConnection.sendMediaSettings())}))}subscribe(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return XA(this,null,(function*(){if(t=t.filter((e=>!e.isSubscribed)),0===t.length)return;let{userId:e}=t[0],i=this.remotePublishedUserMap.get(e);if(!i)return;let r=t.find((e=>2===e.mediaType))?"auxiliary":"main";try{let n=WA({},i.subscribeState);t.forEach((e=>{switch(e.mediaType){case 1:n.audio=!0;break;case 4:n.video=!0;break;case 2:n.auxiliary=!0}}));let o=this._changeBigSmallRecords.get(e);o&&o.options.smallVideo&&i.muteState.hasSmall&&n.video&&(n.video=!1,n.smallVideo=!0),AO.emit(kO.SUBSCRIBE_START,{room:this,streamType:r,remotePublishedUser:i,subscribeState:n}),this._log.info("subscribe() => ".concat(e," ").concat(r," [").concat(MV(n),"] prev: [").concat(MV(i.subscribeState),"]")),yield i.subscribe(n,r);for(let e of t)e.mediaTrack||(yield e.waitHasMediaTrack());i.remoteVideoTrack.setMediaType(n.smallVideo?8:4),AO.emit(kO.SUBSCRIBE_SUCCESS,{room:this,streamType:r,remotePublishedUser:i})}catch(t){let i=t instanceof ab?t.getCode():ob.UNKNOWN,n=t;throw t instanceof ab?i===ob.REMOTE_STREAM_NOT_EXIST&&(n=new ab({code:ob.API_CALL_ABORTED,message:yN({key:_N,data:{message:t.message,userId:e,streamType:r}})}),this._log.warn(n)):(n=new ab({code:i,message:yN({key:zO,data:{message:t.message,userId:e,streamType:r}})}),this._log.error(n)),n}}))}unsubscribe(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return XA(this,null,(function*(){let{userId:e}=t[0],i=this.remotePublishedUserMap.get(e);if(!i)return;let r=t.find((e=>2===e.mediaType))?"auxiliary":"main";this._log.info("unsubscribe() => ".concat(e," ").concat(r));try{yield i.unsubscribe({remoteTracks:t,streamType:r})}catch(e){this._log.warn("unsubscribe() => failed ".concat(e))}t.forEach((e=>{e.unsubscribe(),8===e.mediaType&&e.setMediaType(4)})),AO.emit(kO.UNSUBSCRIBE_SUCCESS,{room:this,streamType:r,remotePublishedUser:i})}))}setEncodedDataProcessingListener(e){throw new Error("Method not implemented.")}enableAudioVolumeEvaluation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3,t=arguments.length>1?arguments[1]:void 0;if(e<=0)return this._enableAudioVolumeEvaluation=!1,void SP.clearTask(this._audioVolumeIntervalId);e=Math.floor(Math.max(e,100)),AO.emit(kO.AUDIO_LEVEL_INTERVAL,{interval:e}),this._audioVolumeIntervalId&&SP.clearTask(this._audioVolumeIntervalId),this._enableAudioVolumeEvaluation=!0,this._audioVolumeIntervalId=SP.run(Iw,(()=>{var e;let t=[];null==(e=this.remotePublishedUserMap)||e.forEach((e=>{if(e.muteState.hasAudio){let i=Math.floor(100*e.remoteAudioTrack.getAudioLevel());t.push({userId:e.userId,volume:i})}})),this.emit("audio-volume",t)}),{fps:1e3/e,backgroundTask:t})}getLocalAudioStats(){return XA(this,null,(function*(){let e={};if(e[this.userId]={bytesSent:0,packetsSent:0},this.uplinkConnection){let t=yield this._stats.getSenderStats(this.uplinkConnection);e[this.userId]={bytesSent:t.audio.bytesSent,packetsSent:t.audio.packetsSent}}return e}))}getLocalVideoStats(){return XA(this,null,(function*(){let e={};if(e[this.userId]={bytesSent:0,packetsSent:0,framesEncoded:0,framesSent:0,frameWidth:0,frameHeight:0},this.uplinkConnection){let{video:{bytesSent:t,packetsSent:i,framesEncoded:r,framesSent:n,frameWidth:o,frameHeight:s}}=yield this._stats.getSenderStats(this.uplinkConnection);e[this.userId]={bytesSent:t,packetsSent:i,framesEncoded:r,framesSent:n,frameWidth:o,frameHeight:s}}return e}))}getTransportStats(){return XA(this,null,(function*(){let e={rtt:0,downlinksRTT:{}};if(this.uplinkConnection){let t=yield this._stats.getSenderStats(this.uplinkConnection);e.rtt=t.rtt}for(let[,t]of this.remotePublishedUserMap){let i=yield this._stats.getReceiverStats(t);e.downlinksRTT[i.userId]=i.rtt}return e}))}getRemoteVideoStats(e){return XA(this,null,(function*(){let t={};for(let[i,r]of this.remotePublishedUserMap)"main"===e&&r.muteState.hasVideo&&(t[i]=r.remoteVideoTrack.stat),"auxiliary"===e&&r.muteState.hasAuxiliary&&(t[i]=r.remoteAuxiliaryTrack.stat);return t}))}getRemoteAudioStats(){return XA(this,null,(function*(){let e={};for(let[t,i]of this.remotePublishedUserMap)i.muteState.hasAudio&&(e[t]=i.remoteAudioTrack.stat);return e}))}setTurnServer(e,t){this._log.info("set turn server: ".concat(JSON.stringify(e)," ").concat(t||""));let i=[];Array.isArray(e)?e.forEach((e=>i.push(db.getTurnServer(e)))):db.isPlainObject(e)&&i.push(db.getTurnServer(e)),this._turnServers=i,t&&(this._iceTransportPolicy=t)}sendStartMixTranscode(e){return this._signalChannel.sendWaitForResponse({command:"start_mcu_mix",data:e,timeout:5e3,responseCommand:pV.START_MIX_TRANSCODE_RES,commandDesc:"startMixTranscode"})}sendStopMixTranscode(e){return this._signalChannel.sendWaitForResponse({command:"stop_mcu_mix",data:e,timeout:5e3,responseCommand:pV.STOP_MIX_TRANSCODE_RES,commandDesc:"stopMixTranscode"})}sendStartPublishCDN(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._signalChannel.sendWaitForResponse({command:t?"start_publishing":"start_push_user_cdn",data:e,timeout:5e3,responseCommand:t?pV.START_PUBLISH_TENCENT_CDN_RES:pV.START_PUBLISH_GIVEN_CDN_RES,commandDesc:"startPublishCDN"})}sendStopPublishCDN(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._signalChannel.sendWaitForResponse({command:t?"stop_publishing":"stop_push_user_cdn",data:e,timeout:5e3,responseCommand:t?pV.STOP_PUBLISH_TENCENT_CDN_RES:pV.STOP_PUBLISH_GIVEN_CDN_RES,commandDesc:"stopPublishCDN"})}sendAbilityStatus(e){var t;null==(t=this._signalChannel)||t.sendWaitForResponse({command:"ability_status_report",data:e,timeout:5e3,responseCommand:pV.ABILITY_STATUS_REPORT_RESULT,commandDesc:"ability status report"}).catch((e=>{}))}getIceServers(){return 0===this._turnServers.length&&this.scheduleResult.iceServers?this.scheduleResult.iceServers:this._turnServers}getIceTransportPolicy(){return this._iceTransportPolicy||this.scheduleResult.iceTransportPolicy||"all"}getLogger(){return this._log}enableAIVoice(){throw new Error("Method not implemented.")}getSignalChannelUrl(){let e={mainUrl:"",backupUrl:""},t=db.getEnv();return t?(e.mainUrl="wss://".concat(t,".rtc.qq.com"),e.backupUrl=e.mainUrl):this.proxy_ws?(e.mainUrl=this.proxy_ws,e.backupUrl=e.mainUrl):Array.isArray(this.scheduleResult.domains)&&this.scheduleResult.domains.length>0&&(e.mainUrl="wss://".concat(this.scheduleResult.domains[0]),e.backupUrl=e.mainUrl,this.scheduleResult.domains[1]&&(e.backupUrl="wss://".concat(this.scheduleResult.domains[1]))),e}getSignalInfo(){var e;return(null==(e=this._signalChannel)?void 0:e.getSignalInfo())||{clientIp:"",relayIp:""}}reset(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.stopSyncUserListInterval(),this.stopHeartbeat(),this.closeConnections(),this.clearNetworkQuality(),this.closeUplink("you exitRoom"),this._signalChannel&&(e&&this._signalChannel.keepAlive&&this._signalChannel.isConnected?this._signalChannel.stopKeepAliveIn(3600):this._signalChannel.close(),this.setSignalChannel(null)),this._stats.reset(),this.userManager.clear(),this.userManager.removeAllListeners(),this.singlePC&&(this.singlePC.close(),this.singlePC=null),this.scheduleResult={domains:null,iceServers:null,iceTransportPolicy:null,trtcAutoConf:null}}checkSubscribeBigSmallVideo(e){return XA(this,null,(function*(){let t=null==e?void 0:e.muteState.hasSmall,i=null==e?void 0:e.muteState.hasVideo;if(!t&&!i||!e.isBigStreamSubscribed&&!e.isSmallStreamSubscribed)return;let r=e.getUserId(),n=this._changeBigSmallRecords.get(r)||{},{subscribeState:o}=e,{options:s,isSubscribing:a,reSubscribeCount:c}=n;if(s.video&&o.video||s.smallVideo&&o.smallVideo&&t||a)return;let l={audio:e.remoteAudioTrack.isSubscribed||e.remoteAudioTrack.isSubscribing,auxiliary:e.remoteAuxiliaryTrack.isSubscribed||e.remoteAuxiliaryTrack.isSubscribing,video:s.video,smallVideo:s.smallVideo};if(t&&e.isBigStreamSubscribed||e.isSmallStreamSubscribed)try{s&&!a&&c>=1&&(n.isSubscribing=!0,n.reSubscribeCount=c-1,!t&&e.isSmallStreamSubscribed&&(l.video=!0,l.smallVideo=!1),yield null==e?void 0:e.subscribe(l,"main"),e.remoteVideoTrack.setMediaType(l.smallVideo?8:4),this._log.info("change [".concat(r,"] to ").concat(l.smallVideo?"small":"big"," video successfully. count ").concat(Sw-n.reSubscribeCount,".")),n.isSubscribing=!1,n.reSubscribeCount=Sw)}catch(e){this._log.info("change [".concat(r,"] to ").concat(l.smallVideo?"small":"big"," video failed. count ").concat(Sw-n.reSubscribeCount,".")),n.isSubscribing=!1,0===c&&this._changeBigSmallRecords.delete(r)}}))}changeType(e,t){let i={options:{video:!e,smallVideo:e},isSubscribing:!1,reSubscribeCount:Sw};this._changeBigSmallRecords.set(t.userId,i),this._log.info("set [".concat(t.userId,"] video prefer type: ").concat(e?"small":"big"))}get smallStreamConfig(){return this._smallStreamConfig}_initBusinessInfo(e){this._businessInfo=e.businessInfo;let t={};if(eU(e.businessInfo)&&(t=JSON.parse(e.businessInfo)),!iU(e.pureAudioPushMode)){if(!Number.isInteger(Number(e.pureAudioPushMode)))throw new ab({code:ob.INVALID_PARAMETER,message:yN({key:BO})});this._pureAudioPushMode=e.pureAudioPushMode,t.Str_uc_params||(t.Str_uc_params={}),t.Str_uc_params.pure_audio_push_mod=this._pureAudioPushMode}if(!iU(e.userDefineRecordId)){let i=/^[A-Za-z0-9_-]{1,64}$/gi;if(null===e.userDefineRecordId.match(i))throw new ab({code:ob.INVALID_PARAMETER,message:yN({key:HO})});t.Str_uc_params||(t.Str_uc_params={}),t.Str_uc_params.userdefine_record_id=e.userDefineRecordId}if(!iU(e.userDefinePushArgs)){if(!(eU(e.userDefinePushArgs)&&String(e.userDefinePushArgs)&&String(e.userDefinePushArgs).length<=256))throw new ab({code:ob.INVALID_PARAMETER,message:yN({key:jO})});t.Str_uc_params||(t.Str_uc_params={}),t.Str_uc_params.userdefine_push_args=e.userDefinePushArgs}oU(t)||(this._businessInfo=JSON.stringify(t))}sendSEI(e,t){var i;null==(i=this.uplinkConnection)||i.sendSEI(e,t)}};return zA([hP(["left",_P.INIT],"joined"),KV({settings:{retries:1,timeout:0},onError(e,t,i){this._isUsingCachedSchedule&&!this._isDestroyed?(this._log.warn("is using cached schedule, retry join"),nx(!0),this.reset(),t()):this._signalChannel&&this._signalChannel.isConnected&&this._signalChannel.keepAlive?(this._log.warn("is using keepAlive ws, retry join"),this._signalChannel.close(),this.reset(),t()):(this.reset(),this._log.error(e),i(e))}}),CM((e=>{let t=new class{constructor(){this._set=new Set,AO.on(kO.LEAVE_SUCCESS,this.delete,this)}add(e){let{room:t,roomId:i}=e;if("rtc"===t.scene)return;let r=this.getKey(t.userId,i||t.roomId,t.sdkAppId,t.useStringRoomId);this._set.add(r)}delete(e){let{room:t,roomId:i}=e;if("rtc"===t.scene)return;let r=this.getKey(t.userId,t.roomId||i,t.sdkAppId,t.useStringRoomId);this._set.delete(r)}getKey(e,t,i,r){return"".concat(i,"_").concat(t,"_").concat(e,"_").concat(r)}isJoined(e){let{userId:t,roomId:i,sdkAppId:r,room:n}=e;return"rtc"!==n.scene&&this._set.has(this.getKey(t,i,r,n.useStringRoomId))}};return function(i,r,n){return XA(this,null,(function*(){let o=String(i.roomId||i.strRoomId);if(this.userId=i.userId,this.sdkAppId=i.sdkAppId,this.userSig=i.userSig,this._log.setSdkAppId(this.sdkAppId),this._log.setUserId(this.userId),this.scene=r,i.privateMapKey=i.privateMapKey||"",this.isJoined)throw new ab({code:ob.INVALID_OPERATION,message:yN({key:WO})});if(this.checkDestroy(),t.isJoined({userId:this.userId,roomId:o,sdkAppId:this.sdkAppId,room:this}))throw new ab({code:ob.INVALID_OPERATION,message:yN({key:XO,data:this.userId})});t.add({room:this,roomId:o}),this.role=21===i.role?"audience":"anchor",this._log.info("Join() => joining room: ".concat(o," useStringRoomId: ").concat(this.useStringRoomId," scene: ").concat(this.scene," role: ").concat(this.role)),AO.emit(kO.JOIN_START,{room:this,roomId:o,params:i}),this.checkSystemResult=yield NO.checkSystemRequirementsInternal(),this.checkDestroy();let s=db.getEnv();s||(s=mD.QCLOUD,this.proxy_ws&&(this.proxy_ws.startsWith(AD.OLD_CLOUD_LADDER)?s=mD.OLD_CLOUD_LADDER:this.proxy_ws.startsWith(AD.WEBRTC)&&(s=mD.WEBRTC))),EP.setConfig({env:s,sdkAppId:String(this.sdkAppId),userId:this.userId,roomId:o}),oV.call(this);let{isH264EncodeSupported:a,isVp8EncodeSupported:c}=this.checkSystemResult.detail;if(!NO.isWebRTCSupported()||!a&&!c)throw new ab({code:ob.NOT_SUPPORTED,message:yN({key:tN})});try{!this.proxy_ws&&!this.proxy_wt&&!this.scheduleResult.domains&&!db.getEnv()&&(yield this.schedule(o,n,zk));let t=yield e.call(this,i,r,n);return this.roomId=o,this._joinedTimestamp=db.performanceNow(),AO.emit(kO.JOIN_SUCCESS,{room:this}),EP.uploadEvent({log:"stat-conv-".concat(Number(xk),"-").concat(location.hostname),userId:this.userId}),t}catch(e){throw t.delete({room:this,roomId:o}),AO.emit(kO.JOIN_FAILED,{room:this,error:e}),e}}))}}))],sU.prototype,"join",1),zA([hP("joined","left",{ignoreError:!0,success(){this.reset(!0)}}),CM((e=>function(){return XA(this,null,(function*(){AO.emit(kO.LEAVE_START,{room:this}),yield e.call(this),AO.emit(kO.LEAVE_SUCCESS,{room:this,roomId:this.roomId})}))})),function(e){return function(t,i,r){let n=r.value;return r.value=function(){var t,i;let r=[];for(var o=arguments.length,s=new Array(o),a=0;a<o;a++)s[a]=arguments[a];return null==(t=bx.get(this))||t.forEach((e=>r.push(e))),null==(i=kx.get(this))||i.forEach((e=>e.forEach((e=>r.push(e))))),r.forEach((t=>{t.reject(new ab({code:ob.API_CALL_ABORTED,message:e}))})),bx.delete(this),kx.delete(this),n.apply(this,s)},r}}("leave room"),QV({fnName:"publish",validateArgs:!1}),QV({fnName:"unsubscribe",validateArgs:!1})],sU.prototype,"leave",1),zA([Dx(),CM((e=>function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return XA(this,null,(function*(){if("live"===this.scene&&"anchor"!==this.role||(i=i.filter((e=>e.outMediaTrack&&"capture"===e.state)),!i.length))return;AO.emit("61",{room:this}),i.forEach((e=>{"audio"===e.kind&&this.audioManager.addAudioTrack(e)}));let t=e.apply(this,i);return i.forEach((e=>{var i;e.publish(this,t),"audio"===e.kind&&(null==(i=this.audioManager.localMixAudioTrack)||i.publish(this,t))})),t}))})),KV({settings:{retries:YD,timeout:e=>Gw(e)},onError(e,t,i){var r;null!=(r=e.message)&&r.includes("timeout")?(this._log.warn("publish timeout"),t()):(this._log.error("publish failed: ".concat(e)),i(e),AO.emit(kO.PUBLISH_FAILED,{room:this}))}})],sU.prototype,"publish",1),zA([QV({fnName:"publish",callback(){for(var e,t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];0===this.localTracks.size&&(null==(e=this.uplinkConnection)||e.close("you unpublished"),this.uplinkConnection=null,i.forEach((e=>e.unpublish())))}}),function(e){return function(t,i,r){let n=r.value;return r.value=function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];let o=bx.get(this);if(o){let t=o.filter(((t,r)=>{if(0===r)return!0;let n=!0;return t.args.forEach((e=>{i.find((t=>t===e))||(n=!1)})),!n||(t.reject(new ab({code:ob.API_CALL_ABORTED,message:e})),!1)}));bx.set(this,t)}return n.apply(this,i)},r}}("api-call"),Dx(),CM((e=>function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];i.forEach((e=>{"audio"===e.kind&&this.audioManager.removeAudioTrack(e)}));let n=e.apply(this,i);return i.forEach((e=>e.unpublish())),n}))],sU.prototype,"unpublish",1),zA([wx((function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return t[0].userId})),CM((e=>function(){for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];let n=e.apply(this,i);return i.forEach((e=>!e.isSubscribed&&e.subscribe(n))),n})),KV({settings:{retries:YD,timeout:e=>Gw(e)},onError(e,t,i,r){e.message.includes("timeout")?(this._log.warn("subscribe timeout"),t()):(this._log.error("subscribe failed: ".concat(e)),i(e),AO.emit(kO.SUBSCRIBE_FAILED,{room:this,remoteTracks:r}))}})],sU.prototype,"subscribe",1),zA([QV({fnName:"subscribe",callback(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.singlePC||t.forEach((e=>{let t=this.remotePublishedUserMap.get(e.userId);t&&!t.isMainStreamSubscribed&&!t.isAuxStreamSubscribed&&t.close("you unsubscribed")}))}}),wx((function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return t[0].userId}))],sU.prototype,"unsubscribe",1),nV.create=nV._create.bind(nV,sU),nV}()},627:(e,t)=>{"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.onError="onError",e.onWarning="onWarning",e.onEnterRoom="onEnterRoom",e.onExitRoom="onExitRoom",e.onSwitchRole="onSwitchRole",e.onRemoteUserEnterRoom="onRemoteUserEnterRoom",e.onRemoteUserLeaveRoom="onRemoteUserLeaveRoom",e.onConnectOtherRoom="onConnectOtherRoom",e.onDisConnectOtherRoom="onDisConnectOtherRoom",e.onSwitchRoom="onSwitchRoom",e.onUserVideoAvailable="onUserVideoAvailable",e.onUserSubStreamAvailable="onUserSubStreamAvailable",e.onUserAudioAvailable="onUserAudioAvailable",e.onFirstVideoFrame="onFirstVideoFrame",e.onFirstAudioFrame="onFirstAudioFrame",e.onSendFirstLocalVideoFrame="onSendFirstLocalVideoFrame",e.onSendFirstLocalAudioFrame="onSendFirstLocalAudioFrame",e.onNetworkQuality="onNetworkQuality",e.onStatistics="onStatistics",e.onConnectionLost="onConnectionLost",e.onTryToReconnect="onTryToReconnect",e.onConnectionRecovery="onConnectionRecovery",e.onSpeedTest="onSpeedTest",e.onCameraDidReady="onCameraDidReady",e.onMicDidReady="onMicDidReady",e.onUserVoiceVolume="onUserVoiceVolume",e.onRecvCustomCmdMsg="onRecvCustomCmdMsg",e.onMissCustomCmdMsg="onMissCustomCmdMsg",e.onRecvSEIMsg="onRecvSEIMsg",e.onStartPublishing="onStartPublishing",e.onStopPublishing="onStopPublishing",e.onStartPublishCDNStream="onStartPublishCDNStream",e.onStopPublishCDNStream="onStopPublishCDNStream",e.onSetMixTranscodingConfig="onSetMixTranscodingConfig",e.onMusicObserverStart="onMusicObserverStart",e.onMusicObserverPlayProgress="onMusicObserverPlayProgress",e.onMusicObserverComplete="onMusicObserverComplete",e.onSnapshotComplete="onSnapshotComplete",e.onScreenCaptureStarted="onScreenCaptureStarted",e.onScreenCapturePaused="onScreenCapturePaused",e.onScreenCaptureResumed="onScreenCaptureResumed",e.onScreenCaptureStoped="onScreenCaptureStoped",e.onDeviceChange="onDeviceChange",e.onTestMicVolume="onTestMicVolume",e.onTestSpeakerVolume="onTestSpeakerVolume"}(i||(i={})),t.default=i},315:function(e,t,i){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},r.apply(this,arguments)},n=this&&this.__createBinding||(Object.create?function(e,t,i,r){void 0===r&&(r=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,n)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return o(t,e),t},a=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))((function(n,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var i,r,n,o,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,r&&(n=2&o[0]?r.return:o[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,o[1])).done)return n;switch(r=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((n=(n=s.trys).length>0&&n[n.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){s.label=o[1];break}if(6===o[0]&&s.label<n[1]){s.label=n[1],n=o;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(o);break}n[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{i=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var u=l(i(627)),d=s(i(79)),h=i(802),p=function(){function e(){this._trtcCloud=null,this._framework=7,this._localPlayOptions={rotation:d.TRTCVideoRotation.TRTCVideoRotation0,fillMode:d.TRTCVideoFillMode.TRTCVideoFillMode_Fill,mirrorType:d.TRTCVideoMirrorType.TRTCVideoMirrorType_Enable},this._remotePlayOptions={rotation:d.TRTCVideoRotation.TRTCVideoRotation0,fillMode:d.TRTCVideoFillMode.TRTCVideoFillMode_Fill,mirrorType:d.TRTCVideoMirrorType.TRTCVideoMirrorType_Disable},this._screenShareOptions={videoResolution:d.TRTCVideoResolution.TRTCVideoResolution_1920_1080,videoFps:15,videoBitrate:1500,screenAudio:!1},(0,h.logSuccess)("TrtcWrapper new come"),this._trtcCloud=d.default.getTRTCShareInstance({frameWorkType:this._framework}),this._addTRTCEvents()}return e.prototype.getSDKVersion=function(){return this._trtcCloud.getSDKVersion()},e.prototype.sharedInstance=function(){return a(this,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},e.prototype.destroySharedInstance=function(){return a(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),this._removeTRTCEvents(),[4,this.exitRoom()];case 1:return e.sent(),(0,h.logSuccess)("destroySharedInstance success"),[3,3];case 2:return e.sent(),[3,3];case 3:return[2]}}))}))},e.prototype.enterRoom=function(e){var t;return a(this,void 0,void 0,(function(){var i,r,n,o,s,a,l,u,d,p,m;return c(this,(function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),(0,h.logSuccess)("begin enterRoom"),i=(0,h.getFlutterArgs)(e,"userId"),r=(0,h.getFlutterArgs)(e,"sdkAppId"),n=(0,h.getFlutterArgs)(e,"userSig"),o=(0,h.getFlutterArgs)(e,"roomId"),s=(0,h.getFlutterArgs)(e,"strRoomId"),a=(0,h.getFlutterArgs)(e,"role"),l=(0,h.getFlutterArgs)(e,"streamId"),u=(0,h.getFlutterArgs)(e,"userDefineRecordId"),d=(0,h.getFlutterArgs)(e,"privateMapKey"),p=(0,h.getFlutterArgs)(e,"scene"),m={userId:i,sdkAppId:r,userSig:n,roomId:"string"==typeof o?parseInt(o,10):o,strRoomId:s,role:a,streamId:l,userDefineRecordId:u,privateMapKey:d},[4,null===(t=this._trtcCloud)||void 0===t?void 0:t.enterRoom(m,p)];case 1:case 2:return c.sent(),[3,3];case 3:return[2]}}))}))},e.prototype.exitRoom=function(){return a(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),[4,this.stopLocalPreview()];case 1:return e.sent(),[4,this._trtcCloud.stopLocalAudio()];case 2:return e.sent(),[4,this._trtcCloud.exitRoom()];case 3:return e.sent(),window.DestoryLocalStreamCallBack(),(0,h.logSuccess)("exitRoom success"),[3,5];case 4:return e.sent(),[3,5];case 5:return[2]}}))}))},e.prototype.switchRole=function(e){return a(this,void 0,void 0,(function(){var t;return c(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=(0,h.getFlutterArgs)(e,"role"),[4,this._trtcCloud.switchRole(t)];case 1:case 2:return i.sent(),[3,3];case 3:return[2]}}))}))},e.prototype.switchRoom=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("switchRoom"),[2]}))}))},e.prototype.connectOtherRoom=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("connectOtherRoom"),[2]}))}))},e.prototype.disconnectOtherRoom=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("disconnectOtherRoom"),[2]}))}))},e.prototype.setDefaultStreamRecvMode=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("setDefaultStreamRecvMode"),[2]}))}))},e.prototype.createSubCloud=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("createSubCloud"),[2]}))}))},e.prototype.destroySubCloud=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("destroySubCloud"),[2]}))}))},e.prototype.startLocalAudio=function(){return a(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._trtcCloud.startLocalAudio()];case 1:case 2:return e.sent(),[3,3];case 3:return[2]}}))}))},e.prototype.stopLocalAudio=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._trtcCloud.stopLocalAudio()];case 1:case 2:return e.sent(),[3,3];case 3:return[2]}}))}))},e.prototype.muteLocalAudio=function(e){return a(this,void 0,void 0,(function(){var t;return c(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=(0,h.getFlutterArgs)(e,"mute"),[4,this._trtcCloud.muteLocalAudio(t)];case 1:case 2:return i.sent(),[3,3];case 3:return[2]}}))}))},e.prototype.setAudioCaptureVolume=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("setAudioCaptureVolume"),[2]}))}))},e.prototype.setAudioPlayoutVolume=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("setAudioPlayoutVolume"),[2]}))}))},e.prototype.getAudioPlayoutVolume=function(e){(0,h.noSupportFunction)("getAudioPlayoutVolume")},e.prototype.setAudioRoute=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("setAudioRoute"),[2]}))}))},e.prototype.startLocalPreview=function(e,t,i){var r,n;return a(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,null===(r=this._trtcCloud)||void 0===r?void 0:r.startLocalPreview(t)];case 1:return e.sent(),[4,null===(n=this._trtcCloud)||void 0===n?void 0:n.setLocalRenderParams(this.getLocalPlayOptions())];case 2:case 3:return e.sent(),[3,4];case 4:return[2]}}))}))},e.prototype.stopLocalPreview=function(e){var t;return a(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,null===(t=this._trtcCloud)||void 0===t?void 0:t.stopLocalPreview()];case 1:case 2:return e.sent(),[3,3];case 3:return[2]}}))}))},e.prototype.muteLocalVideo=function(e){return a(this,void 0,void 0,(function(){var t;return c(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=(0,h.getFlutterArgs)(e,"mute"),[4,this._trtcCloud.muteLocalVideo(t)];case 1:case 2:return i.sent(),[3,3];case 3:return[2]}}))}))},e.prototype.switchCamera=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("switchCamera"),[2]}))}))},e.prototype.startRemoteView=function(e,t,i){var r;return a(this,void 0,void 0,(function(){var e,n;return c(this,(function(o){switch(o.label){case 0:e=(0,h.getFlutterArgs)(i,"userId"),n=(0,h.getFlutterArgs)(i,"streamType"),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,null===(r=this._trtcCloud)||void 0===r?void 0:r.startRemoteView(e,t,n)];case 2:case 3:return o.sent(),[3,4];case 4:return[2]}}))}))},e.prototype.stopRemoteView=function(e){var t;return a(this,void 0,void 0,(function(){var i;return c(this,(function(r){switch(r.label){case 0:i=(0,h.getFlutterArgs)(e,"userId"),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,null===(t=this._trtcCloud)||void 0===t?void 0:t.stopRemoteView(i,d.TRTCVideoStreamType.TRTCVideoStreamTypeBig)];case 2:case 3:return r.sent(),[3,4];case 4:return[2]}}))}))},e.prototype.stopAllRemoteView=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){try{this._trtcCloud.stopAllRemoteView()}catch(e){}return[2]}))}))},e.prototype.setVideoEncoderParam=function(e){var t;return a(this,void 0,void 0,(function(){var i;return c(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),(i=JSON.parse(e))?[4,null===(t=this._trtcCloud)||void 0===t?void 0:t.setVideoEncoderParam(i)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[3,4];case 3:return r.sent(),[3,4];case 4:return[2]}}))}))},e.prototype.muteRemoteVideoStream=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("muteRemoteVideoStream"),[2]}))}))},e.prototype.muteAllRemoteVideoStreams=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("muteAllRemoteVideoStreams"),[2]}))}))},e.prototype.muteRemoteAudio=function(e){return a(this,void 0,void 0,(function(){var t,i;return c(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t=(0,h.getFlutterArgs)(e,"mute"),i=(0,h.getFlutterArgs)(e,"userId"),[4,this._trtcCloud.muteRemoteAudio(i,t)];case 1:case 2:return r.sent(),[3,3];case 3:return[2]}}))}))},e.prototype.muteAllRemoteAudio=function(e){return a(this,void 0,void 0,(function(){var t;return c(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),t=(0,h.getFlutterArgs)(e,"mute"),[4,this._trtcCloud.muteAllRemoteAudio(t)];case 1:case 2:return i.sent(),[3,3];case 3:return[2]}}))}))},e.prototype.enableAudioVolumeEvaluation=function(e){try{var t=(0,h.getFlutterArgs)(e,"intervalMs");return this._trtcCloud.enableAudioVolumeEvaluation(t),0}catch(e){}},e.prototype.setRemoteAudioVolume=function(e){try{var t=(0,h.getFlutterArgs)(e,"userId"),i=(0,h.getFlutterArgs)(e,"volume");this._trtcCloud.setRemoteAudioVolume(t,i)}catch(e){}},e.prototype.enableEncSmallVideoStream=function(e){return a(this,void 0,Number,(function(){var t,i;return c(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t=(0,h.getFlutterArgs)(e,"enable"),i=(0,h.getFlutterArgs)(e,"params"),[4,this._trtcCloud.enableSmallVideoStream(t,i)];case 1:case 2:return r.sent(),[3,3];case 3:return[2]}}))}))},e.prototype.setLogLevel=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("setLogLevel"),[2]}))}))},e.prototype.startPublishing=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("startPublishing"),[2]}))}))},e.prototype.stopPublishing=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("stopPublishing"),[2]}))}))},e.prototype.startPublishCDNStream=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("startPublishCDNStream"),[2]}))}))},e.prototype.stopPublishCDNStream=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("stopPublishCDNStream"),[2]}))}))},e.prototype.setMixTranscodingConfig=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("setMixTranscodingConfig"),[2]}))}))},e.prototype.startScreenCapture=function(e){return a(this,void 0,void 0,(function(){var t,i,r;return c(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=(0,h.getFlutterArgs)(e,"viewId"),i=(0,h.getFlutterArgs)(e,"streamType"),r=this.getScreenShareOptions(),[4,this._trtcCloud.startScreenShare(t,i,r)];case 1:case 2:return n.sent(),[3,3];case 3:return[2]}}))}))},e.prototype.stopScreenCapture=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this._trtcCloud.stopScreenShare()];case 1:case 2:return e.sent(),[3,3];case 3:return[2]}}))}))},e.prototype.pauseScreenCapture=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("pauseScreenCapture"),[2]}))}))},e.prototype.resumeScreenCapture=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("resumeScreenCapture"),[2]}))}))},e.prototype.getDevicesList=function(e){return a(this,void 0,void 0,(function(){var t,i,r;return c(this,(function(n){switch(n.label){case 0:switch(n.trys.push([0,8,,9]),t=(0,h.getFlutterArgs)(e,"type"),i=[],t){case 0:return[3,1];case 1:return[3,3];case 2:return[3,5]}return[3,7];case 1:return[4,this._trtcCloud.getMicDevicesList()];case 2:case 4:case 6:return i=n.sent(),[3,7];case 3:return[4,this._trtcCloud.getSpeakerDevicesList()];case 5:return[4,this._trtcCloud.getCameraDevicesList()];case 7:return r={deviceList:i,count:i.length},[2,JSON.stringify(r)];case 8:return n.sent(),[3,9];case 9:return[2]}}))}))},e.prototype.setCurrentDevice=function(e){return a(this,void 0,void 0,(function(){var t,i;return c(this,(function(r){switch(r.label){case 0:return r.trys.push([0,7,,8]),t=(0,h.getFlutterArgs)(e,"type"),i=(0,h.getFlutterArgs)(e,"deviceId"),1!==t?[3,3]:i?[4,this._trtcCloud.setCurrentMicDevice(i)]:[3,2];case 1:r.sent(),r.label=2;case 2:r.label=3;case 3:return 2!==t?[3,6]:i?[4,this._trtcCloud.setCurrentCameraDevice(i)]:[3,5];case 4:r.sent(),r.label=5;case 5:r.label=6;case 6:return[3,8];case 7:return r.sent(),[3,8];case 8:return[2]}}))}))},e.prototype.getCurrentDevice=function(e){return a(this,void 0,void 0,(function(){var t,i;return c(this,(function(r){switch(r.label){case 0:t=(0,h.getFlutterArgs)(e,"type"),i={},r.label=1;case 1:switch(r.trys.push([1,9,,10]),t){case 0:return[3,2];case 1:return[3,4];case 2:return[3,6]}return[3,8];case 2:return[4,this._trtcCloud.getCurrentMicDevice()];case 3:return i=r.sent(),[3,8];case 4:return[4,this._trtcCloud.getCurrentSpeakerDevice()];case 5:return i=r.sent(),[3,8];case 6:return[4,this._trtcCloud.getCurrentCameraDevice()];case 7:return i=r.sent(),[3,8];case 8:return[2,JSON.stringify(i)];case 9:return r.sent(),[3,10];case 10:return[2]}}))}))},e.prototype.setCurrentDeviceVolume=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("setCurrentDeviceVolume"),[2]}))}))},e.prototype.getCurrentDeviceVolume=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("getCurrentDeviceVolume"),[2]}))}))},e.prototype.setCurrentDeviceMute=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("setCurrentDeviceMute"),[2]}))}))},e.prototype.getCurrentDeviceMute=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("getCurrentDeviceMute"),[2]}))}))},e.prototype.startCameraDeviceTest=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("startCameraDeviceTest"),[2]}))}))},e.prototype.stopCameraDeviceTest=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("stopCameraDeviceTest"),[2]}))}))},e.prototype.startMicDeviceTest=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("startMicDeviceTest"),[2]}))}))},e.prototype.stopMicDeviceTest=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("stopMicDeviceTest"),[2]}))}))},e.prototype.startSpeakerDeviceTest=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("startSpeakerDeviceTest"),[2]}))}))},e.prototype.stopSpeakerDeviceTest=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("stopSpeakerDeviceTest"),[2]}))}))},e.prototype.setLocalRenderParams=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("setLocalRenderParams"),[2]}))}))},e.prototype.updateLocalView=function(e,t,i){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("updateLocalView"),[2]}))}))},e.prototype.updateRemoteView=function(e,t,i){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("updateLocalView"),[2]}))}))},e.prototype.setWatermark=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("setWatermark"),[2]}))}))},e.prototype.getAudioCaptureVolume=function(e){(0,h.noSupportFunction)("getAudioCaptureVolume")},e.prototype.setRemoteVideoStreamType=function(e){(0,h.noSupportFunction)("setAudioCaptureVolume")},e.prototype.startAudioRecording=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},e.prototype.stopAudioRecording=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},e.prototype.startLocalRecording=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},e.prototype.stopLocalRecording=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},e.prototype.startPlayMusic=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("startPlayMusic"),resumeScreenCapture,[2]}))}))},e.prototype.stopPlayMusic=function(){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("stopPlayMusic"),[2]}))}))},e.prototype.resumePlayMusic=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("resumePlayMusic"),[2]}))}))},e.prototype.pausePlayMusic=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return(0,h.noSupportFunction)("pausePlayMusic"),[2]}))}))},e.prototype.setConsoleEnabled=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(t){return(0,h.getFlutterArgs)(e,"enabled")?TRTC.Logger.enableUploadLog():TRTC.Logger.disableUploadLog(),[2]}))}))},e.prototype.setLogCompressEnabled=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},e.prototype.setLogDirPath=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},e.prototype.setLogDelegate=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},e.prototype.showDebugView=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},e.prototype.setDebugViewMargin=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},e.prototype.callExperimentalAPI=function(e){return a(this,void 0,void 0,(function(){return c(this,(function(e){return[2]}))}))},e.prototype.setLocalPlayOptions=function(e){this._localPlayOptions=r(r({},this._localPlayOptions),e)},e.prototype.getLocalPlayOptions=function(){return this._localPlayOptions},e.prototype.setRemotePlayOptions=function(e){void 0===e&&(e={}),this._remotePlayOptions=r(r({},this._remotePlayOptions),e)},e.prototype.getRemotePlayOptions=function(){return this._remotePlayOptions||{}},e.prototype.setScreenShareOptions=function(e){void 0===e&&(e={}),this._screenShareOptions=r(r({},this._screenShareOptions),e)},e.prototype.getScreenShareOptions=function(){return this._screenShareOptions},e.prototype.setEventHandler=function(e){this.handler=e},e.prototype._emitEvent=function(e,t){var i;(t instanceof Array||"object"==typeof t)&&(t=JSON.stringify(t)),null===(i=this.handler)||void 0===i||i.call(this,e.toString(),t)},e.prototype._addTRTCEvents=function(){var e,t,i,r,n,o,s,l,d,p=this;null===(e=this._trtcCloud)||void 0===e||e.on("onEnterRoom",(function(e){return a(p,void 0,void 0,(function(){return c(this,(function(t){return e>0&&(0,h.logInfo)("enter room success, time consuming: ".concat(e)),[2]}))}))})),null===(t=this._trtcCloud)||void 0===t||t.on("onExitRoom",(function(e){return a(p,void 0,void 0,(function(){return c(this,(function(t){return(0,h.logInfo)("exit room, reason: ".concat(e)),[2]}))}))})),null===(i=this._trtcCloud)||void 0===i||i.on("onRemoteUserEnterRoom",(function(e){return a(p,void 0,void 0,(function(){return c(this,(function(t){return this._emitEvent(u.default.onRemoteUserEnterRoom,e),[2]}))}))})),null===(r=this._trtcCloud)||void 0===r||r.on("onRemoteUserLeaveRoom",(function(e,t){return a(p,void 0,void 0,(function(){return c(this,(function(i){return this._emitEvent(u.default.onRemoteUserLeaveRoom,{userId:e,reason:t}),[2]}))}))})),null===(n=this._trtcCloud)||void 0===n||n.on("onUserVideoAvailable",(function(e,t){p._emitEvent(u.default.onUserVideoAvailable,{userId:e,available:t})})),null===(o=this._trtcCloud)||void 0===o||o.on("onUserAudioAvailable",(function(e,t){p._emitEvent(u.default.onUserAudioAvailable,{userId:e,available:t})})),null===(s=this._trtcCloud)||void 0===s||s.on("onUserSubStreamAvailable",(function(e,t){p._emitEvent(u.default.onUserSubStreamAvailable,{userId:e,available:t})})),null===(l=this._trtcCloud)||void 0===l||l.on("onUserVoiceVolume",(function(e){p._emitEvent(u.default.onUserVoiceVolume,{userVolumes:e,totalVolume:0})})),null===(d=this._trtcCloud)||void 0===d||d.on("onError",(function(e,t){p._emitEvent(u.default.onError,{errCode:e,errMsg:t})}))},e.prototype._removeTRTCEvents=function(){var e;null===(e=this._trtcCloud)||void 0===e||e.removeAllListeners()},e}();t.default=p},802:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getVideoResolution=t.logError=t.logInfo=t.logSuccess=t.noSupportFunction=t.getFlutterArgs=void 0;var i="<TRTC Wrapper>";function r(){var e=new Date,t="hh:mm:ss:S",i={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(var r in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),i)new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[r]:("00"+i[r]).substr((""+i[r]).length)));return t}function n(e){console.error("%c [".concat(r(),"] ").concat(i," ").concat(e),"color:red;font-size:18px")}t.getFlutterArgs=function(e,t){try{return JSON.parse(e)[t]}catch(i){n("_getFlutterArgs error _args: ".concat(e," ,key:").concat(t))}},t.noSupportFunction=function(e){console.warn("[".concat(r(),"] ").concat(i," web sdk not supper ").concat(e))},t.logSuccess=function(e){console.info("%c [".concat(r(),"] ").concat(i," ").concat(e),"color:green;font-size:18px;")},t.logInfo=function(e){console.info("%c [".concat(r(),"] ").concat(i," ").concat(e),"font-size:18px;color:blue;")},t.logError=n,t.getVideoResolution=function(e){var t="120*120 = 1;\n  160*160 = 3;\n  270*270 = 5;\n  480*480 = 7;\n  160*120 = 50;\n  240*180 = 52;\n  280*210 = 54;\n  320*240 = 56;\n  400*300 = 58;\n  480*360 = 60;\n  640*480 = 62;\n  960*720 = 64;\n  160*90 = 100;\n  256*144 = 102;\n  320*180 = 104;\n  480*270 = 106;\n  640*360 = 108;\n  960*540 = 110;\n  1280*720 = 112;\n  1920*1080 = 114;".split(";"),i="360*360";return t.forEach((function(t){if(t.indexOf("=")>=0&&t.endsWith("= ".concat(e)))return i=t.split("=")[0].trim().replace(/\n/g,"")})),i}}},t={};function i(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,i),o.exports}i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();var r=i(315);return r.default})()));